{"pageProps":{"guide":{"name":"gitlab","displayName":"Gitlab","slug":"gitlab","description":"Repo for gitlab","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/gitlab","updatedAt":"2025-09-14T01:30:01Z","createdAt":"2025-09-08T03:07:56Z","readmeRaw":"# GitLab Installation Guide\n\nComplete DevOps platform with Git repository management, CI/CD pipelines, issue tracking, and container registry. Enterprise-grade solution for modern software development lifecycle with advanced security features.\n\n## Prerequisites\n\n- Linux system (any modern distribution)\n- 8GB RAM minimum, 16GB+ recommended for production\n- 4 CPU cores minimum, 8+ recommended\n- 50GB+ available disk space, SSD recommended\n- Domain name for external access\n- SSL certificates for production deployment\n- SMTP server for email notifications\n\n## Installation\n\n### Using Omnibus Package (Recommended)\n\n#### Ubuntu/Debian\n```bash\n# Install dependencies\nsudo apt-get update\nsudo apt-get install -y curl openssh-server ca-certificates tzdata perl postfix\n\n# Configure Postfix for email\nsudo dpkg-reconfigure postfix\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash\n\n# Install GitLab Enterprise Edition\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" apt-get install -y gitlab-ee\n\n# For GitLab Community Edition\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" apt-get install -y gitlab-ce\n\n# Initial configuration\nsudo gitlab-ctl reconfigure\n\n# Check status\nsudo gitlab-ctl status\n```\n\n#### RHEL/CentOS/Rocky Linux/AlmaLinux\n```bash\n# Install dependencies\nsudo yum install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# For newer versions\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable and start services\nsudo systemctl enable --now sshd postfix\n\n# Configure SELinux and firewall\nsudo setsebool -P httpd_can_network_connect 1\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --permanent --add-service=ssh\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" yum install -y gitlab-ee\n\n# Configure and start\nsudo gitlab-ctl reconfigure\n```\n\n#### Fedora\n```bash\n# Install dependencies\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable services\nsudo systemctl enable --now sshd postfix\n\n# Configure firewall\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" dnf install -y gitlab-ee\n\nsudo gitlab-ctl reconfigure\n```\n\n### Docker Installation (Single Container)\n```bash\n# Create GitLab directories\nsudo mkdir -p /srv/gitlab/{config,logs,data}\n\n# Set environment variables\nexport GITLAB_HOME=/srv/gitlab\n\n# Run GitLab container with comprehensive configuration\nsudo docker run --detach \\\n  --hostname gitlab.example.com \\\n  --env GITLAB_OMNIBUS_CONFIG=\"\n    external_url 'https://gitlab.example.com';\n    gitlab_rails['gitlab_shell_ssh_port'] = 2222;\n    \n    # SSL configuration\n    nginx['ssl_certificate'] = '/etc/gitlab/ssl/gitlab.crt';\n    nginx['ssl_certificate_key'] = '/etc/gitlab/ssl/gitlab.key';\n    nginx['ssl_protocols'] = 'TLSv1.2 TLSv1.3';\n    nginx['ssl_prefer_server_ciphers'] = 'off';\n    \n    # Security settings\n    gitlab_rails['rack_attack_git_basic_auth'] = {\n      'enabled' => true,\n      'ip_whitelist' => ['127.0.0.1', '192.168.1.0/24'],\n      'maxretry' => 10,\n      'findtime' => 60,\n      'bantime' => 3600\n    };\n    \n    # Performance settings\n    postgresql['shared_preload_libraries'] = 'pg_stat_statements';\n    postgresql['max_connections'] = 200;\n    postgresql['shared_buffers'] = '1GB';\n    postgresql['effective_cache_size'] = '4GB';\n    \n    # Container Registry\n    registry_external_url 'https://registry.example.com';\n    gitlab_rails['registry_enabled'] = true;\n    \n    # Monitoring\n    prometheus_monitoring['enable'] = true;\n    grafana['enable'] = true;\n    grafana['admin_password'] = 'secure_grafana_password';\n    \n    # Email configuration\n    gitlab_rails['smtp_enable'] = true;\n    gitlab_rails['smtp_address'] = 'smtp.example.com';\n    gitlab_rails['smtp_port'] = 587;\n    gitlab_rails['smtp_user_name'] = 'gitlab@example.com';\n    gitlab_rails['smtp_password'] = 'smtp_secure_password';\n    gitlab_rails['smtp_domain'] = 'example.com';\n    gitlab_rails['smtp_authentication'] = 'login';\n    gitlab_rails['smtp_enable_starttls_auto'] = true;\n    gitlab_rails['smtp_tls'] = false;\n    gitlab_rails['smtp_openssl_verify_mode'] = 'peer';\n    \n    # Email settings\n    gitlab_rails['gitlab_email_from'] = 'gitlab@example.com';\n    gitlab_rails['gitlab_email_display_name'] = 'GitLab';\n    \n    # Backup configuration\n    gitlab_rails['backup_keep_time'] = 604800;\n    gitlab_rails['backup_upload_connection'] = {\n      'provider' => 'AWS',\n      'region' => 'us-west-2',\n      'aws_access_key_id' => 'backup_access_key',\n      'aws_secret_access_key' => 'backup_secret_key'\n    };\n    gitlab_rails['backup_upload_remote_directory'] = 'gitlab-backups';\n    \" \\\n  --publish 443:443 --publish 80:80 --publish 2222:22 \\\n  --name gitlab \\\n  --restart unless-stopped \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  gitlab/gitlab-ee:latest\n```\n\n### Docker Compose (Production Setup)\n```bash\nmkdir -p ~/gitlab-stack\ncd ~/gitlab-stack\n\ncat > docker-compose.yml <<EOF\nversion: '3.8'\n\nservices:\n  gitlab:\n    image: gitlab/gitlab-ee:latest\n    container_name: gitlab\n    restart: unless-stopped\n    hostname: gitlab.example.com\n    environment:\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url 'https://gitlab.example.com'\n        \n        # Performance settings\n        postgresql['shared_buffers'] = \"2GB\"\n        postgresql['effective_cache_size'] = \"8GB\"\n        postgresql['max_connections'] = 300\n        \n        # Security settings\n        gitlab_rails['rack_attack_git_basic_auth'] = {\n          'enabled' => true,\n          'ip_whitelist' => ['127.0.0.1', '10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16'],\n          'maxretry' => 10,\n          'findtime' => 60,\n          'bantime' => 3600\n        }\n        \n        # Container Registry\n        registry_external_url 'https://registry.example.com'\n        gitlab_rails['registry_enabled'] = true\n        \n        # Monitoring\n        prometheus_monitoring['enable'] = true\n        grafana['enable'] = true\n        \n        # Let's Encrypt (disable for reverse proxy setup)\n        letsencrypt['enable'] = false\n        nginx['listen_port'] = 80\n        nginx['listen_https'] = false\n        \n        # GitLab Pages\n        pages_external_url \"https://pages.example.com\"\n        gitlab_pages['enable'] = true\n    ports:\n      - '80:80'\n      - '443:443'\n      - '2222:22'\n    volumes:\n      - './config:/etc/gitlab'\n      - './logs:/var/log/gitlab'\n      - './data:/var/opt/gitlab'\n    networks:\n      - gitlab\n    shm_size: '256m'\n    healthcheck:\n      test: [\"CMD-SHELL\", \"gitlab-healthcheck --fail --max-time 10\"]\n      interval: 60s\n      timeout: 30s\n      retries: 5\n      start_period: 200s\n\n  gitlab-runner:\n    image: gitlab/gitlab-runner:latest\n    container_name: gitlab-runner\n    restart: unless-stopped\n    volumes:\n      - './runner-config:/etc/gitlab-runner'\n      - '/var/run/docker.sock:/var/run/docker.sock'\n    networks:\n      - gitlab\n    depends_on:\n      - gitlab\n\n  redis:\n    image: redis:7-alpine\n    container_name: gitlab-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass redis_secure_password\n    volumes:\n      - redis-data:/data\n    networks:\n      - gitlab\n\n  nginx:\n    image: nginx:alpine\n    container_name: gitlab-nginx\n    restart: unless-stopped\n    ports:\n      - '443:443'\n    volumes:\n      - './nginx/nginx.conf:/etc/nginx/nginx.conf:ro'\n      - './nginx/ssl:/etc/nginx/ssl:ro'\n    depends_on:\n      - gitlab\n    networks:\n      - gitlab\n\nnetworks:\n  gitlab:\n    driver: bridge\n\nvolumes:\n  redis-data:\nEOF\n\n# Create NGINX reverse proxy configuration\nmkdir -p nginx\ncat > nginx/nginx.conf <<EOF\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream gitlab {\n        server gitlab:80;\n    }\n    \n    upstream registry {\n        server gitlab:5000;\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name gitlab.example.com;\n\n        ssl_certificate /etc/nginx/ssl/gitlab.crt;\n        ssl_certificate_key /etc/nginx/ssl/gitlab.key;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;\n\n        client_max_body_size 0;\n        gzip off;\n\n        location / {\n            proxy_pass http://gitlab;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name registry.example.com;\n\n        ssl_certificate /etc/nginx/ssl/registry.crt;\n        ssl_certificate_key /etc/nginx/ssl/registry.key;\n\n        client_max_body_size 0;\n\n        location /v2/ {\n            proxy_pass http://registry;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n}\nEOF\n\ndocker-compose up -d\n```\n\n## Enterprise Configuration\n\n### Production Configuration (/etc/gitlab/gitlab.rb)\n```bash\nsudo tee /etc/gitlab/gitlab.rb > /dev/null <<EOF\n# GitLab Enterprise Production Configuration\n\nexternal_url 'https://gitlab.example.com'\n\n# Performance and Resource Settings\nunicorn['worker_timeout'] = 60\nunicorn['worker_processes'] = 8\nsidekiq['max_concurrency'] = 25\nsidekiq['min_concurrency'] = 10\n\n# PostgreSQL configuration\npostgresql['enable'] = true\npostgresql['max_connections'] = 300\npostgresql['shared_buffers'] = \"2GB\"\npostgresql['effective_cache_size'] = \"8GB\"\npostgresql['work_mem'] = \"16MB\"\npostgresql['maintenance_work_mem'] = \"256MB\"\npostgresql['checkpoint_completion_target'] = 0.9\npostgresql['wal_buffers'] = \"16MB\"\npostgresql['default_statistics_target'] = 100\npostgresql['random_page_cost'] = 1.1\npostgresql['effective_io_concurrency'] = 200\n\n# Redis configuration\nredis['enable'] = true\nredis['maxmemory'] = \"1gb\"\nredis['maxmemory_policy'] = \"allkeys-lru\"\nredis['save'] = '900 1 300 10 60 10000'\nredis['password'] = 'redis_secure_password'\n\n# Gitaly configuration (Git RPC service)\ngitaly['enable'] = true\ngitaly['auth_token'] = 'secure_gitaly_token'\ngitaly['ruby_max_rss'] = 300000000  # 300MB\ngitaly['concurrency'] = [\n  {\n    'rpc' => \"/gitaly.SmartHTTPService/PostReceivePack\",\n    'max_per_repo' => 3\n  },\n  {\n    'rpc' => \"/gitaly.SSHService/SSHUploadPack\", \n    'max_per_repo' => 3\n  }\n]\n\n# NGINX configuration\nnginx['enable'] = true\nnginx['listen_port'] = 80\nnginx['listen_https'] = false\nnginx['redirect_http_to_https'] = false\nnginx['ssl_certificate'] = \"/etc/gitlab/ssl/gitlab.crt\"\nnginx['ssl_certificate_key'] = \"/etc/gitlab/ssl/gitlab.key\"\nnginx['ssl_protocols'] = \"TLSv1.2 TLSv1.3\"\nnginx['ssl_prefer_server_ciphers'] = \"off\"\nnginx['ssl_ciphers'] = \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\"\n\n# Container Registry\nregistry_external_url 'https://registry.example.com'\ngitlab_rails['registry_enabled'] = true\nregistry['enable'] = true\nregistry['username'] = \"registry\"\nregistry['uid'] = 996\nregistry['gid'] = 996\nregistry['dir'] = \"/var/opt/gitlab/registry\"\nregistry['log_directory'] = \"/var/log/gitlab/registry\"\nregistry['log_level'] = \"info\"\nregistry['rootcertbundle'] = \"/opt/gitlab/embedded/ssl/certs/cacert.pem\"\n\n# GitLab Pages\npages_external_url \"https://pages.example.com\"\ngitlab_pages['enable'] = true\ngitlab_pages['dir'] = \"/var/opt/gitlab/gitlab-pages\"\ngitlab_pages['log_directory'] = \"/var/log/gitlab/gitlab-pages\"\ngitlab_pages['access_control'] = true\ngitlab_pages['use_legacy_storage'] = false\n\n# Email configuration\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.example.com\"\ngitlab_rails['smtp_port'] = 587\ngitlab_rails['smtp_user_name'] = \"gitlab@example.com\"\ngitlab_rails['smtp_password'] = \"smtp_secure_password\"\ngitlab_rails['smtp_domain'] = \"example.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\ngitlab_rails['smtp_openssl_verify_mode'] = 'peer'\n\ngitlab_rails['gitlab_email_enabled'] = true\ngitlab_rails['gitlab_email_from'] = 'gitlab@example.com'\ngitlab_rails['gitlab_email_display_name'] = 'GitLab'\ngitlab_rails['gitlab_email_reply_to'] = 'noreply@example.com'\n\n# Security settings\ngitlab_rails['rack_attack_git_basic_auth'] = {\n  'enabled' => true,\n  'ip_whitelist' => %w{127.0.0.1 192.168.1.0/24 10.0.0.0/8},\n  'maxretry' => 10,\n  'findtime' => 60,\n  'bantime' => 3600\n}\n\n# Two-factor authentication\ngitlab_rails['require_two_factor_authentication'] = false\ngitlab_rails['two_factor_grace_period'] = 8  # 8 hours instead of default 48\n\n# Session settings\ngitlab_rails['session_expire_delay'] = 10080  # 1 week\ngitlab_rails['session_store_enabled'] = true\n\n# Backup configuration\ngitlab_rails['backup_keep_time'] = 604800  # 7 days\ngitlab_rails['backup_upload_connection'] = {\n  'provider' => 'AWS',\n  'region' => 'us-west-2',\n  'aws_access_key_id' => 'backup_access_key',\n  'aws_secret_access_key' => 'backup_secret_key'\n}\ngitlab_rails['backup_upload_remote_directory'] = 'gitlab-backups'\ngitlab_rails['backup_multipart_chunk_size'] = 104857600  # 100MB\n\n# Monitoring\nprometheus_monitoring['enable'] = true\nprometheus['enable'] = true\nprometheus['listen_address'] = 'localhost:9090'\nprometheus['scrape_configs'] = [\n  {\n    'job_name' => 'gitlab-workhorse',\n    'static_configs' => [\n      { 'targets' => ['localhost:9229'] }\n    ]\n  },\n  {\n    'job_name' => 'gitlab-unicorn',\n    'static_configs' => [\n      { 'targets' => ['localhost:8080'] }\n    ]\n  },\n  {\n    'job_name' => 'gitlab-sidekiq',\n    'static_configs' => [\n      { 'targets' => ['localhost:8082'] }\n    ]\n  }\n]\n\ngrafana['enable'] = true\ngrafana['admin_password'] = 'secure_grafana_password'\ngrafana['disable_login_form'] = false\n\n# Logging\nlogging['svlogd_size'] = 200 * 1024 * 1024  # 200MB\nlogging['svlogd_num'] = 30\nlogging['svlogd_timeout'] = 24 * 60 * 60    # rotate after 24 hours\nlogging['logrotate_frequency'] = \"daily\"\nlogging['logrotate_rotate'] = 30\nlogging['logrotate_compress'] = \"compress\"\n\n# Git settings\ngitlab_rails['gitlab_default_branch'] = 'main'\ngitlab_rails['max_request_duration_seconds'] = 60\n\n# Rate limiting\ngitlab_rails['rate_limit_requests_per_period'] = 300\ngitlab_rails['rate_limit_period'] = 60\n\n# Enterprise features (if using GitLab EE)\n# gitlab_rails['ee_license'] = File.read('/etc/gitlab/GitLab.gitlab-license')\n\n# Security scanning\ngitlab_rails['dependency_scanning_enabled'] = true\ngitlab_rails['container_scanning_enabled'] = true\ngitlab_rails['sast_enabled'] = true\ngitlab_rails['secret_detection_enabled'] = true\n\n# LDAP configuration (Enterprise)\ngitlab_rails['ldap_enabled'] = false\ngitlab_rails['prevent_ldap_sign_in'] = false\ngitlab_rails['ldap_servers'] = {\n  'main' => {\n    'label' => 'LDAP',\n    'host' => 'ldap.example.com',\n    'port' => 636,\n    'uid' => 'sAMAccountName',\n    'bind_dn' => 'CN=gitlab,OU=Service Accounts,DC=example,DC=com',\n    'password' => 'ldap_service_password',\n    'encryption' => 'ssl',\n    'verify_certificates' => true,\n    'ca_file' => '/etc/gitlab/ssl/ldap-ca.crt',\n    'base' => 'DC=example,DC=com',\n    'user_filter' => '',\n    'attributes' => {\n      'username' => ['uid', 'userid', 'sAMAccountName'],\n      'email' => ['mail', 'email', 'userPrincipalName'],\n      'name' => 'cn',\n      'first_name' => 'givenName',\n      'last_name' => 'sn'\n    },\n    'group_base' => 'OU=Groups,DC=example,DC=com',\n    'admin_group' => 'GitLab Administrators'\n  }\n}\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Security Hardening (2024 Best Practices)\n\n### SSL/TLS Configuration\n```bash\n# Generate SSL certificates\nsudo mkdir -p /etc/gitlab/ssl\n\n# Self-signed certificate for testing\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 \\\n  -keyout /etc/gitlab/ssl/gitlab.key \\\n  -out /etc/gitlab/ssl/gitlab.crt \\\n  -subj \"/C=US/ST=State/L=City/O=Organization/CN=gitlab.example.com\"\n\n# Production: Let's Encrypt integration\nsudo tee -a /etc/gitlab/gitlab.rb > /dev/null <<EOF\n\n# Let's Encrypt configuration\nletsencrypt['enable'] = true\nletsencrypt['contact_emails'] = ['admin@example.com']\nletsencrypt['auto_renew'] = true\nletsencrypt['auto_renew_hour'] = 0\nletsencrypt['auto_renew_minute'] = 0\nletsencrypt['auto_renew_day_of_month'] = \"*/4\"\n\n# Force HTTPS\nnginx['redirect_http_to_https'] = true\nnginx['ssl_protocols'] = \"TLSv1.2 TLSv1.3\"\nnginx['ssl_prefer_server_ciphers'] = \"off\"\nnginx['ssl_ciphers'] = \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\"\n\n# HSTS\nnginx['hsts_max_age'] = 31536000\nnginx['hsts_include_subdomains'] = true\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n### Advanced Security Configuration\n```bash\n# Configure security settings\nsudo tee -a /etc/gitlab/gitlab.rb > /dev/null <<EOF\n\n# Security hardening\ngitlab_rails['webhook_timeout'] = 10\ngitlab_rails['webhook_max_redirects'] = 3\n\n# Disable password authentication (use SSO/LDAP)\ngitlab_rails['omniauth_allow_single_sign_on'] = ['saml', 'ldapmain']\ngitlab_rails['omniauth_block_auto_created_users'] = false\ngitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'\n\n# API rate limiting\ngitlab_rails['rate_limit_requests_per_period'] = 1000\ngitlab_rails['rate_limit_period'] = 60\n\n# Git over HTTP rate limiting\ngitlab_rails['rack_attack_git_basic_auth'] = {\n  'enabled' => true,\n  'ip_whitelist' => %w{127.0.0.1 192.168.1.0/24},\n  'maxretry' => 20,\n  'findtime' => 60,\n  'bantime' => 3600\n}\n\n# Protected paths\ngitlab_rails['rack_attack_protected_paths'] = [\n  '/users/password',\n  '/users/sign_in',\n  '/api/v4/session.json',\n  '/api/v4/session',\n  '/users/confirmation',\n  '/unsubscribes/',\n  '/import/github/personal_access_token',\n  '/admin/session'\n]\n\n# SSH security\ngitlab_rails['gitlab_shell_ssh_port'] = 2222\ngitlab_shell['auth_file'] = \"/var/opt/gitlab/.ssh/authorized_keys\"\n\n# Container Registry security\nregistry['notifications'] = [\n  {\n    'name' => 'security_scan',\n    'url' => 'https://security-scanner.example.com/webhook',\n    'timeout' => '2000ms',\n    'threshold' => 3,\n    'backoff' => '1000ms'\n  }\n]\n\n# Secrets management\ngitlab_rails['db_password'] = File.read('/etc/gitlab/secrets/db_password').strip\ngitlab_rails['secret_key_base'] = File.read('/etc/gitlab/secrets/secret_key_base').strip\ngitlab_rails['otp_key_base'] = File.read('/etc/gitlab/secrets/otp_key_base').strip\ngitlab_rails['encrypted_settings_key_base'] = File.read('/etc/gitlab/secrets/encrypted_settings_key_base').strip\n\n# Audit logging\ngitlab_rails['audit_events_enabled'] = true\n\n# Disable features that increase attack surface\ngitlab_rails['usage_ping_enabled'] = false\ngitlab_rails['sentry_enabled'] = false\nEOF\n\n# Create secrets directory and files\nsudo mkdir -p /etc/gitlab/secrets\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/db_password\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/secret_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/otp_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/encrypted_settings_key_base\n\n# Secure permissions\nsudo chmod 600 /etc/gitlab/secrets/*\nsudo chown git:git /etc/gitlab/secrets/*\n\nsudo gitlab-ctl reconfigure\n```\n\n### GitLab Runner Security Configuration\n```bash\n# Create secure runner configuration\nsudo mkdir -p /etc/gitlab-runner\n\nsudo tee /etc/gitlab-runner/config.toml > /dev/null <<EOF\nconcurrent = 4\ncheck_interval = 0\nshutdown_timeout = 0\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = \"docker-runner-secure\"\n  url = \"https://gitlab.example.com/\"\n  token = \"runner_registration_token\"\n  executor = \"docker\"\n  \n  # Security settings\n  pre_clone_script = \"echo 'Starting secure build'\"\n  pre_build_script = \"echo 'Preparing secure environment'\"\n  post_build_script = \"echo 'Cleaning up secure environment'\"\n  \n  [runners.docker]\n    tls_verify = false\n    image = \"alpine:latest\"\n    privileged = false  # Critical: Never use privileged mode\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\"/cache\", \"/certs/client\"]\n    shm_size = 0\n    network_mode = \"bridge\"\n    \n    # Security restrictions\n    cap_drop = [\"ALL\"]\n    cap_add = [\"CHOWN\", \"SETGID\", \"SETUID\"]\n    security_opt = [\"no-new-privileges:true\"]\n    \n    # Resource limits\n    memory = \"2g\"\n    memory_swap = \"2g\"\n    memory_reservation = \"1g\"\n    cpus = \"1.5\"\n    \n    # Network security\n    dns = [\"8.8.8.8\", \"8.8.4.4\"]\n    extra_hosts = [\"gitlab.example.com:192.168.1.100\"]\n    \n    # Image scanning\n    pull_policy = [\"if-not-present\"]\n    \n  [runners.docker.tmpfs]\n    \"/tmp\" = \"rw,noexec,nosuid,size=100m\"\n    \"/var/tmp\" = \"rw,noexec,nosuid,size=100m\"\n\n# Kubernetes executor (more secure)\n[[runners]]\n  name = \"k8s-runner-secure\"\n  url = \"https://gitlab.example.com/\"\n  token = \"k8s_runner_token\"\n  executor = \"kubernetes\"\n  \n  [runners.kubernetes]\n    host = \"https://k8s.example.com:6443\"\n    namespace = \"gitlab-runner\"\n    privileged = false  # Never use privileged\n    image = \"alpine:latest\"\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \"2Gi\"\n    memory_request = \"1Gi\"\n    cpu_limit = \"1000m\"\n    cpu_request = \"500m\"\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"tmp\"\n      mount_path = \"/tmp\"\n      medium = \"Memory\"\nEOF\n\n# Register runner with security tags\nsudo gitlab-runner register \\\n  --url \"https://gitlab.example.com/\" \\\n  --registration-token \"RUNNER_TOKEN\" \\\n  --description \"secure-docker-runner\" \\\n  --tag-list \"docker,secure,production\" \\\n  --run-untagged=\"false\" \\\n  --locked=\"true\" \\\n  --access-level=\"ref_protected\" \\\n  --executor \"docker\" \\\n  --docker-image alpine:latest \\\n  --docker-privileged=\"false\" \\\n  --docker-volumes \"/certs/client\"\n\nsudo systemctl enable --now gitlab-runner\n```\n\n## CI/CD Pipeline Security\n\n### Secure Pipeline Configuration\n```bash\n# Create .gitlab-ci.yml with security best practices\ncat > .gitlab-ci.yml <<EOF\n# GitLab CI/CD Security Best Practices - 2024\n\nstages:\n  - security-scan\n  - test\n  - build\n  - security-test\n  - deploy\n\nvariables:\n  # Security variables\n  DOCKER_DRIVER: overlay2\n  DOCKER_TLS_CERTDIR: \"/certs\"\n  SECURE_LOG_LEVEL: info\n  \n  # Use protected variables for sensitive data\n  # DEPLOY_TOKEN: (set in GitLab UI as protected variable)\n  # AWS_ACCESS_KEY: (set in GitLab UI as protected variable)\n\n# Security scanning stage\nsecret-detection:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/secrets:latest\n  script:\n    - echo \"Scanning for secrets in code...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      secret_detection: gl-secret-detection-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\ndependency-scanning:\n  stage: security-scan  \n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/gemnasium:latest\n  script:\n    - echo \"Scanning dependencies for vulnerabilities...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      dependency_scanning: gl-dependency-scanning-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\nsast:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/sobelow:latest\n  script:\n    - echo \"Static application security testing...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\n# Container scanning\ncontainer-scanning:\n  stage: security-test\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/klar:latest\n  script:\n    - echo \"Scanning container image for vulnerabilities...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n  dependencies:\n    - build\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\n# Secure build stage\nbuild:\n  stage: build\n  image: docker:latest\n  services:\n    - docker:dind\n  before_script:\n    # Verify image signatures\n    - echo \"Verifying base image integrity...\"\n    - docker trust inspect alpine:latest\n  script:\n    - echo \"Building application with security scanning...\"\n    - docker build -t \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA .\n    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock aquasec/trivy image \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n    - docker login -u \\$CI_REGISTRY_USER -p \\$CI_REGISTRY_PASSWORD \\$CI_REGISTRY\n    - docker push \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n  tags:\n    - secure\n\n# Secure deployment\ndeploy-production:\n  stage: deploy\n  image: alpine:latest\n  before_script:\n    # Install kubectl and verify cluster connectivity\n    - apk add --no-cache curl\n    - curl -LO \"https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl\"\n    - chmod +x kubectl && mv kubectl /usr/local/bin/\n    - kubectl config use-context production-cluster\n    - kubectl auth can-i create deployments --namespace=production\n  script:\n    - echo \"Deploying to production with security validations...\"\n    - kubectl apply -f k8s/production/ --namespace=production\n    - kubectl rollout status deployment/app --namespace=production --timeout=300s\n  environment:\n    name: production\n    url: https://app.example.com\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n      when: manual\n  only:\n    variables:\n      - \\$CI_COMMIT_REF_PROTECTED == \"true\"\n  tags:\n    - secure\n    - production\n\n# Security compliance check\ncompliance-check:\n  stage: security-test\n  image: alpine:latest\n  script:\n    - echo \"Running compliance checks...\"\n    - apk add --no-cache curl jq\n    - |\n      # Check for required security labels in Docker images\n      if ! docker inspect \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA | jq -r '.[].Config.Labels[\"security.scan\"]' | grep -q \"passed\"; then\n        echo \"ERROR: Image failed security scan\"\n        exit 1\n      fi\n    - echo \"Compliance check passed\"\n  dependencies:\n    - container-scanning\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n  tags:\n    - secure\n\n# Infrastructure as Code scanning\niac-scanning:\n  stage: security-scan\n  image: bridgecrew/checkov:latest\n  script:\n    - checkov --framework terraform --framework kubernetes --framework dockerfile\n  artifacts:\n    reports:\n      junit: checkov-report.xml\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n      changes:\n        - \"**/*.tf\"\n        - \"**/*.yml\"\n        - \"**/*.yaml\"\n        - \"**/Dockerfile*\"\n  tags:\n    - secure\nEOF\n```\n\n### RBAC and Access Control\n```bash\n# Configure GitLab RBAC via API\nGITLAB_URL=\"https://gitlab.example.com\"\nADMIN_TOKEN=\"your_admin_token\"\n\n# Create groups with specific permissions\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=developers&path=developers&description=Development team&visibility=private\" \\\n  \"${GITLAB_URL}/api/v4/groups\"\n\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=security-team&path=security-team&description=Security team&visibility=private\" \\\n  \"${GITLAB_URL}/api/v4/groups\"\n\n# Create projects with security templates\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=secure-app&description=Secure application&visibility=private&issues_enabled=true&merge_requests_enabled=true&wiki_enabled=false&builds_enabled=true&snippets_enabled=false&container_registry_enabled=true&shared_runners_enabled=false\" \\\n  \"${GITLAB_URL}/api/v4/projects\"\n\n# Configure branch protection\nPROJECT_ID=\"1\"  # Replace with actual project ID\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=main&code_owner_approval_required=true&push_access_level=40&merge_access_level=40&unprotect_access_level=40\" \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/protected_branches\"\n\n# Configure push rules (Premium/Ultimate)\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"deny_delete_tag=true&member_check=true&prevent_secrets=true&author_email_regex=.*@example.com&file_extension_restriction=jar,exe&max_file_size=100\" \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/push_rule\"\n```\n\n### Vulnerability Scanning Integration\n```bash\n# Configure dependency proxy for secure image caching\nsudo tee -a /etc/gitlab/gitlab.rb > /dev/null <<EOF\n\n# Dependency Proxy for secure image caching\ngitlab_rails['dependency_proxy_enabled'] = true\ngitlab_rails['dependency_proxy_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/dependency_proxy\"\n\n# Security scanning\ngitlab_rails['sast_enabled'] = true\ngitlab_rails['dependency_scanning_enabled'] = true\ngitlab_rails['container_scanning_enabled'] = true\ngitlab_rails['secret_detection_enabled'] = true\ngitlab_rails['license_scanning_enabled'] = true\n\n# Secure package registry\ngitlab_rails['packages_enabled'] = true\ngitlab_rails['packages_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/packages\"\nEOF\n\n# Create custom security scanning templates\nmkdir -p .gitlab/ci-templates\n\ncat > .gitlab/ci-templates/Security-Scanning.gitlab-ci.yml <<EOF\n# Custom Security Scanning Template\n\n.security-scan-template:\n  stage: security-scan\n  variables:\n    SECURE_LOG_LEVEL: info\n  before_script:\n    - echo \"Preparing security scan environment...\"\n    - apk add --no-cache curl jq\n  tags:\n    - secure\n\ncustom-sast:\n  extends: .security-scan-template\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/semgrep:latest\n  script:\n    - echo \"Running custom SAST analysis...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n    expire_in: 1 week\n\ncustom-secrets-scan:\n  extends: .security-scan-template\n  image: trufflesecurity/trufflehog:latest\n  script:\n    - echo \"Scanning for secrets with TruffleHog...\"\n    - trufflehog git file://. --json > trufflehog-report.json\n    - |\n      if [ -s trufflehog-report.json ]; then\n        echo \"Secrets detected!\"\n        cat trufflehog-report.json\n        exit 1\n      fi\n  artifacts:\n    reports:\n      secret_detection: trufflehog-report.json\n    expire_in: 1 week\n\nimage-vulnerability-scan:\n  extends: .security-scan-template\n  image: aquasec/trivy:latest\n  script:\n    - echo \"Scanning Docker images for vulnerabilities...\"\n    - trivy image --format template --template \"@contrib/gitlab.tpl\" \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n    expire_in: 1 week\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Backup and Disaster Recovery\n\n### Enterprise Backup Strategy\n```bash\nsudo tee /usr/local/bin/gitlab-backup.sh > /dev/null <<'EOF'\n#!/bin/bash\nBACKUP_DIR=\"/backup/gitlab\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p ${BACKUP_DIR}/{omnibus,secrets,ssl,logs}\n\n# Create GitLab backup\ngitlab-backup create STRATEGY=copy SKIP=uploads,builds,artifacts,lfs,registry,pages\n\n# Backup configuration files\ntar -czf ${BACKUP_DIR}/omnibus/gitlab-config-${DATE}.tar.gz \\\n    /etc/gitlab/gitlab.rb \\\n    /etc/gitlab/gitlab-secrets.json\n\n# Backup SSL certificates\ntar -czf ${BACKUP_DIR}/ssl/gitlab-ssl-${DATE}.tar.gz \\\n    /etc/gitlab/ssl/ \\\n    /etc/letsencrypt/\n\n# Backup secrets\ntar -czf ${BACKUP_DIR}/secrets/gitlab-secrets-${DATE}.tar.gz \\\n    /etc/gitlab/secrets/\n\n# Upload to multiple cloud storage backends\naws s3 cp ${BACKUP_DIR}/ s3://gitlab-backups/ --recursive\naz storage blob upload-batch --source ${BACKUP_DIR} --destination gitlab-backups\ngsutil cp -r ${BACKUP_DIR}/* gs://gitlab-backups/\n\n# Geo-replication backup (Enterprise)\nif command -v gitlab-rake >/dev/null 2>&1; then\n    gitlab-rake gitlab:geo:check\n    gitlab-rake geo:status\nfi\n\n# Test backup integrity\nLATEST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar | head -1)\nif [ -n \"$LATEST_BACKUP\" ]; then\n    echo \"Latest backup: $LATEST_BACKUP\"\n    tar -tf \"$LATEST_BACKUP\" > /tmp/backup-contents.txt\n    if [ $? -eq 0 ]; then\n        echo \"✓ Backup integrity verified\"\n    else\n        echo \"✗ Backup integrity check failed\"\n    fi\nfi\n\n# Keep only last 7 backups locally\nfind /var/opt/gitlab/backups/ -name \"*_gitlab_backup.tar\" -mtime +7 -delete\nfind ${BACKUP_DIR} -name \"gitlab-*\" -type f -mtime +7 -delete\n\necho \"GitLab backup completed: ${DATE}\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-backup.sh\n\n# Schedule daily backups\necho \"0 2 * * * root /usr/local/bin/gitlab-backup.sh\" | sudo tee -a /etc/crontab\n\n# Create disaster recovery script\nsudo tee /usr/local/bin/gitlab-restore.sh > /dev/null <<'EOF'\n#!/bin/bash\nBACKUP_FILE=\"${1}\"\n\nif [ -z \"$BACKUP_FILE\" ]; then\n    echo \"Usage: $0 <backup_file>\"\n    echo \"Available backups:\"\n    ls -la /var/opt/gitlab/backups/*_gitlab_backup.tar\n    exit 1\nfi\n\n# Stop GitLab services\ngitlab-ctl stop unicorn\ngitlab-ctl stop puma\ngitlab-ctl stop sidekiq\n\n# Restore from backup\ngitlab-backup restore BACKUP=$(basename $BACKUP_FILE _gitlab_backup.tar) force=yes\n\n# Restore configuration\nif [ -f \"/backup/gitlab/omnibus/gitlab-config-latest.tar.gz\" ]; then\n    cd /\n    tar -xzf /backup/gitlab/omnibus/gitlab-config-latest.tar.gz\nfi\n\n# Reconfigure and restart\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n# Verify installation\ngitlab-rake gitlab:check SANITIZE=true\n\necho \"GitLab restore completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-restore.sh\n```\n\n### High Availability Setup\n```bash\n# Configure GitLab for HA with external services\nsudo tee /etc/gitlab/gitlab.rb > /dev/null <<EOF\n# GitLab High Availability Configuration\n\nexternal_url 'https://gitlab.example.com'\n\n# Disable built-in services (use external)\npostgresql['enable'] = false\nredis['enable'] = false\nnginx['enable'] = true\nunicorn['enable'] = true\nsidekiq['enable'] = true\ngitlab_workhorse['enable'] = true\ngitaly['enable'] = true\n\n# External PostgreSQL\ngitlab_rails['db_adapter'] = 'postgresql'\ngitlab_rails['db_encoding'] = 'unicode'\ngitlab_rails['db_host'] = 'postgres-master.example.com'\ngitlab_rails['db_port'] = 5432\ngitlab_rails['db_database'] = 'gitlabhq_production'\ngitlab_rails['db_username'] = 'gitlab'\ngitlab_rails['db_password'] = 'secure_db_password'\ngitlab_rails['db_load_balancing'] = {\n  'hosts' => ['postgres-slave1.example.com', 'postgres-slave2.example.com']\n}\n\n# External Redis\ngitlab_rails['redis_host'] = 'redis-master.example.com'\ngitlab_rails['redis_port'] = 6379\ngitlab_rails['redis_password'] = 'redis_secure_password'\ngitlab_rails['redis_sentinels'] = [\n  {'host' => 'redis-sentinel1.example.com', 'port' => 26379},\n  {'host' => 'redis-sentinel2.example.com', 'port' => 26379},\n  {'host' => 'redis-sentinel3.example.com', 'port' => 26379}\n]\n\n# Load balancing\nnginx['listen_addresses'] = ['0.0.0.0']\nnginx['real_ip_header'] = 'X-Forwarded-For'\nnginx['real_ip_recursive'] = 'on'\nnginx['real_ip_trusted_addresses'] = ['10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16']\n\n# Gitaly cluster (Enterprise)\ngit_data_dirs({\n  'default' => {\n    'gitaly_address' => 'tcp://gitaly1.example.com:8075',\n    'gitaly_token' => 'gitaly_secure_token'\n  },\n  'storage1' => {\n    'gitaly_address' => 'tcp://gitaly2.example.com:8075',\n    'gitaly_token' => 'gitaly_secure_token'\n  }\n})\n\n# Object storage (S3-compatible)\ngitlab_rails['object_store']['enabled'] = true\ngitlab_rails['object_store']['proxy_download'] = true\ngitlab_rails['object_store']['connection'] = {\n  'provider' => 'AWS',\n  'region' => 'us-west-2',\n  'aws_access_key_id' => 'object_store_access_key',\n  'aws_secret_access_key' => 'object_store_secret_key'\n}\ngitlab_rails['object_store']['objects']['artifacts']['bucket'] = 'gitlab-artifacts'\ngitlab_rails['object_store']['objects']['lfs']['bucket'] = 'gitlab-lfs'\ngitlab_rails['object_store']['objects']['uploads']['bucket'] = 'gitlab-uploads'\ngitlab_rails['object_store']['objects']['packages']['bucket'] = 'gitlab-packages'\n\n# Geo replication (Enterprise Premium)\ngitlab_rails['geo_primary_role'] = true  # Set to false for secondary\ngitlab_rails['geo_node_name'] = 'primary-site'\ngitlab_rails['geo_registry_replication_enabled'] = true\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Container Registry and Package Management\n\n### Secure Container Registry Setup\n```bash\n# Configure container registry with security scanning\nsudo tee -a /etc/gitlab/gitlab.rb > /dev/null <<EOF\n\n# Container Registry configuration\nregistry_external_url 'https://registry.example.com'\ngitlab_rails['registry_enabled'] = true\nregistry['enable'] = true\n\n# Registry storage\nregistry['storage'] = {\n  's3' => {\n    'accesskey' => 'registry_s3_access_key',\n    'secretkey' => 'registry_s3_secret_key',\n    'bucket' => 'gitlab-registry',\n    'region' => 'us-west-2',\n    'encrypt' => true\n  }\n}\n\n# Registry security\nregistry['auth_token_realm'] = \"https://gitlab.example.com/jwt/auth\"\nregistry['auth_token_service'] = \"container_registry\"\nregistry['auth_token_issuer'] = \"gitlab-issuer\"\nregistry['auth_token_autoredirect'] = false\n\n# Health checks\nregistry['health_storagedriver_enabled'] = true\nregistry['health_storagedriver_interval'] = '10s'\nregistry['health_storagedriver_threshold'] = 3\n\n# Container scanning\ngitlab_rails['container_registry_token_expire_delay'] = 300\ngitlab_rails['container_registry_cleanup_enabled'] = true\n\n# Image retention policies\nregistry['middleware'] = {\n  'repository' => [\n    {\n      'name' => 'cloudfront',\n      'disabled' => false,\n      'options' => {\n        'baseurl' => 'https://registry-cdn.example.com',\n        'privatekey' => '/etc/gitlab/registry-cdn-private-key.pem',\n        'keypairid' => 'CLOUDFRONT_KEY_PAIR_ID',\n        'duration' => '3600s'\n      }\n    }\n  ]\n}\n\n# Package registry\ngitlab_rails['packages_enabled'] = true\ngitlab_rails['packages_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/packages\"\nEOF\n\n# Create container registry cleanup policy\ncat > registry-cleanup-policy.json <<EOF\n{\n  \"name_regex\": \".*\",\n  \"name_regex_keep\": \"v\\\\d+\\\\.\\\\d+\\\\.\\\\d+\",\n  \"cadence\": \"7d\",\n  \"older_than\": \"30d\",\n  \"keep_n\": 10\n}\nEOF\n\n# Apply cleanup policy via API\ncurl --request PUT --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --header \"Content-Type: application/json\" \\\n  --data @registry-cleanup-policy.json \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/registry/repositories/1\"\n\nsudo gitlab-ctl reconfigure\n```\n\n## Monitoring and Observability\n\n### Comprehensive Monitoring Setup\n```bash\n# Enable built-in monitoring stack\nsudo tee -a /etc/gitlab/gitlab.rb > /dev/null <<EOF\n\n# Prometheus monitoring\nprometheus_monitoring['enable'] = true\nprometheus['enable'] = true\nprometheus['monitor_kubernetes'] = true\nprometheus['scrape_configs'] = [\n  {\n    'job_name' => 'gitlab-workhorse',\n    'static_configs' => [\n      { 'targets' => ['localhost:9229'] }\n    ]\n  },\n  {\n    'job_name' => 'gitlab-unicorn',  \n    'static_configs' => [\n      { 'targets' => ['localhost:8080'] }\n    ]\n  },\n  {\n    'job_name' => 'gitlab-sidekiq',\n    'static_configs' => [\n      { 'targets' => ['localhost:8082'] }\n    ]\n  },\n  {\n    'job_name' => 'gitlab-pages',\n    'static_configs' => [\n      { 'targets' => ['localhost:8090'] }\n    ]\n  },\n  {\n    'job_name' => 'docker-registry',\n    'static_configs' => [\n      { 'targets' => ['localhost:5001'] }\n    ]\n  }\n]\n\n# Grafana configuration\ngrafana['enable'] = true\ngrafana['admin_password'] = 'secure_grafana_password'\ngrafana['disable_login_form'] = false\ngrafana['allow_user_sign_up'] = false\n\n# Grafana LDAP integration\ngrafana['ldap_enabled'] = true\ngrafana['ldap_allow_sign_up'] = false\ngrafana['ldap_servers'] = [{\n  'host' => 'ldap.example.com',\n  'port' => 636,\n  'uid' => 'sAMAccountName',\n  'bind_dn' => 'CN=grafana,OU=Service Accounts,DC=example,DC=com',\n  'password' => 'ldap_service_password',\n  'encryption' => 'ssl',\n  'base' => 'DC=example,DC=com',\n  'user_filter' => '',\n  'group_base' => 'OU=Groups,DC=example,DC=com',\n  'admin_group' => 'GitLab Administrators'\n}]\n\n# Node Exporter\nnode_exporter['enable'] = true\nnode_exporter['listen_address'] = 'localhost:9100'\n\n# Alert Manager\nalertmanager['enable'] = true\nalertmanager['admin_email'] = 'alerts@example.com'\nalertmanager['flags'] = {\n  'storage.path' => '/var/opt/gitlab/alertmanager/data',\n  'config.file' => '/var/opt/gitlab/alertmanager/alertmanager.yml'\n}\n\n# Log forwarding\nlogging['logrotate_frequency'] = \"daily\"\nlogging['logrotate_rotate'] = 30\nlogging['logrotate_compress'] = \"compress\"\nlogging['svlogd_size'] = 200 * 1024 * 1024  # 200MB\nlogging['svlogd_num'] = 30\nEOF\n\n# Create custom alerting rules\nsudo mkdir -p /var/opt/gitlab/alertmanager\n\nsudo tee /var/opt/gitlab/alertmanager/alertmanager.yml > /dev/null <<EOF\nglobal:\n  smtp_smarthost: 'smtp.example.com:587'\n  smtp_from: 'gitlab-alerts@example.com'\n  smtp_auth_username: 'gitlab-alerts@example.com'\n  smtp_auth_password: 'smtp_password'\n\nroute:\n  group_by: ['alertname', 'cluster', 'service']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\n  receiver: 'gitlab-alerts'\n  routes:\n  - match:\n      severity: critical\n    receiver: 'critical-alerts'\n    group_wait: 10s\n    repeat_interval: 5m\n\nreceivers:\n- name: 'gitlab-alerts'\n  email_configs:\n  - to: 'gitlab-admin@example.com'\n    subject: 'GitLab Alert: {{ .GroupLabels.alertname }}'\n    body: |\n      {{ range .Alerts }}\n      Alert: {{ .Annotations.summary }}\n      Description: {{ .Annotations.description }}\n      Instance: {{ .Labels.instance }}\n      {{ end }}\n\n- name: 'critical-alerts'\n  email_configs:\n  - to: 'oncall@example.com'\n    subject: 'CRITICAL GitLab Alert: {{ .GroupLabels.alertname }}'\n  slack_configs:\n  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'\n    channel: '#critical-alerts'\n    title: 'Critical GitLab Alert'\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n### Performance Monitoring\n```bash\n# Create GitLab performance monitoring script\nsudo tee /usr/local/bin/gitlab-performance-monitor.sh > /dev/null <<'EOF'\n#!/bin/bash\nMONITOR_LOG=\"/var/log/gitlab-performance.log\"\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${MONITOR_LOG}\n}\n\n# Check GitLab service health\nfor service in unicorn sidekiq workhorse gitaly; do\n    if gitlab-ctl status $service | grep -q \"run:\"; then\n        log_message \"✓ $service is running\"\n    else\n        log_message \"✗ $service is not running\"\n    fi\ndone\n\n# Check database performance\nDB_CONNECTIONS=$(gitlab-psql -c \"SELECT count(*) FROM pg_stat_activity;\" -t)\nlog_message \"ℹ Database connections: ${DB_CONNECTIONS}\"\n\n# Check Redis performance  \nREDIS_MEMORY=$(redis-cli info memory | grep used_memory_human: | cut -d: -f2)\nlog_message \"ℹ Redis memory usage: ${REDIS_MEMORY}\"\n\n# Check Git repository storage\nREPO_SIZE=$(du -sh /var/opt/gitlab/git-data/repositories | cut -f1)\nlog_message \"ℹ Repository storage usage: ${REPO_SIZE}\"\n\n# Check background job queue\nSIDEKIQ_QUEUE=$(gitlab-rails runner \"puts Sidekiq::Queue.new.size\")\nlog_message \"ℹ Sidekiq queue size: ${SIDEKIQ_QUEUE}\"\n\n# Check GitLab metrics\nGITLAB_VERSION=$(gitlab-rake gitlab:env:info | grep \"GitLab information\" -A 10 | grep \"Version:\" | awk '{print $2}')\nlog_message \"ℹ GitLab version: ${GITLAB_VERSION}\"\n\n# Performance metrics via API\nAPI_RESPONSE_TIME=$(curl -w \"%{time_total}\" -s -o /dev/null https://gitlab.example.com/api/v4/projects)\nlog_message \"ℹ API response time: ${API_RESPONSE_TIME}s\"\n\n# Check disk I/O\nDISK_USAGE=$(df /var/opt/gitlab | awk 'NR==2 {print $5}' | sed 's/%//')\nlog_message \"ℹ Disk usage: ${DISK_USAGE}%\"\n\nif [ ${DISK_USAGE} -gt 85 ]; then\n    log_message \"⚠ High disk usage detected\"\nfi\n\nlog_message \"Performance monitoring completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-performance-monitor.sh\n\n# Schedule performance monitoring\necho \"*/15 * * * * root /usr/local/bin/gitlab-performance-monitor.sh\" | sudo tee -a /etc/crontab\n```\n\n## GitLab Runner Advanced Configuration\n\n### Secure Multi-Platform Runner Setup\n```bash\n# Create advanced runner configuration with security\nsudo tee /etc/gitlab-runner/config.toml > /dev/null <<EOF\nconcurrent = 10\ncheck_interval = 0\nlog_level = \"info\"\nlog_format = \"runner\"\nshutdown_timeout = 30\n\n[session_server]\n  session_timeout = 1800\n\n# Docker executor with security hardening\n[[runners]]\n  name = \"docker-secure-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"secure_runner_token\"\n  executor = \"docker\"\n  output_limit = 4096\n  \n  # Security scripts\n  pre_clone_script = \"\"\"\n    echo 'Security scan initiated'\n    id\n    pwd\n    env | grep -E '^(CI_|GITLAB_)' | sort\n  \"\"\"\n  \n  pre_build_script = \"\"\"\n    echo 'Preparing secure build environment'\n    # Verify no sensitive data in environment\n    if env | grep -i -E '(password|secret|key|token)' | grep -v -E '^(CI_JOB_TOKEN|GITLAB_CI|CI_SERVER)'; then\n      echo 'ERROR: Sensitive data detected in environment'\n      exit 1\n    fi\n  \"\"\"\n  \n  post_build_script = \"\"\"\n    echo 'Cleaning up build artifacts'\n    rm -rf /tmp/* 2>/dev/null || true\n  \"\"\"\n  \n  [runners.docker]\n    tls_verify = false\n    image = \"alpine:latest\"\n    privileged = false\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\"/cache\", \"/certs/client\"]\n    shm_size = 268435456  # 256MB\n    \n    # Security restrictions\n    cap_drop = [\"ALL\"]\n    cap_add = [\"CHOWN\", \"SETGID\", \"SETUID\"]\n    security_opt = [\"no-new-privileges:true\", \"apparmor:unconfined\"]\n    \n    # Resource limits\n    memory = \"2g\"\n    memory_swap = \"2g\"\n    memory_reservation = \"1g\"\n    cpus = \"2\"\n    \n    # Network security\n    network_mode = \"bridge\"\n    dns = [\"8.8.8.8\", \"8.8.4.4\"]\n    \n    # Disable dangerous features\n    disable_entrypoint_overwrite = true\n    \n    # Image pull policy\n    pull_policy = [\"if-not-present\"]\n    \n  [runners.docker.tmpfs]\n    \"/tmp\" = \"rw,noexec,nosuid,size=100m\"\n    \"/var/tmp\" = \"rw,noexec,nosuid,size=100m\"\n\n# Kubernetes executor (Enterprise recommended)\n[[runners]]\n  name = \"k8s-secure-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"k8s_runner_token\"\n  executor = \"kubernetes\"\n  \n  [runners.kubernetes]\n    host = \"https://k8s.example.com:6443\"\n    namespace = \"gitlab-runner\"\n    privileged = false\n    image = \"alpine:latest\"\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \"4Gi\"\n    memory_request = \"2Gi\"\n    cpu_limit = \"2000m\"\n    cpu_request = \"1000m\"\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      seccomp_profile_type = \"RuntimeDefault\"\n      \n    [runners.kubernetes.container_security_context]\n      allow_privilege_escalation = false\n      read_only_root_filesystem = true\n      capabilities = { drop = [\"ALL\"] }\n      \n    # Volume mounts for security\n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"tmp\"\n      mount_path = \"/tmp\"\n      medium = \"Memory\"\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"var-tmp\"\n      mount_path = \"/var/tmp\"\n      medium = \"Memory\"\n\n# Shell executor for specific tasks (limited use)\n[[runners]]\n  name = \"shell-restricted-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"shell_runner_token\"\n  executor = \"shell\"\n  shell = \"bash\"\n  \n  # Restricted tags only\n  tag_list = [\"shell\", \"restricted\"]\n  run_untagged = false\n  locked = true\n  \n  # Security environment\n  environment = [\n    \"PATH=/usr/local/bin:/usr/bin:/bin\",\n    \"HOME=/home/gitlab-runner\",\n    \"SHELL=/bin/bash\"\n  ]\n  \n  # Cleanup\n  builds_dir = \"/home/gitlab-runner/builds\"\n  cache_dir = \"/home/gitlab-runner/cache\"\n  \n  [runners.cache]\n    Type = \"s3\"\n    [runners.cache.s3]\n      ServerAddress = \"s3.amazonaws.com\"\n      BucketName = \"gitlab-runner-cache\"\n      BucketLocation = \"us-west-2\"\n      Insecure = false\nEOF\n\nsudo systemctl restart gitlab-runner\n```\n\n### GitLab Runner Auto-scaling (Cloud)\n```bash\n# Configure GitLab Runner with Docker Machine for auto-scaling\nsudo tee /etc/gitlab-runner/autoscale-config.toml > /dev/null <<EOF\nconcurrent = 50\ncheck_interval = 0\n\n[[runners]]\n  name = \"autoscale-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"autoscale_runner_token\"\n  executor = \"docker+machine\"\n  \n  [runners.docker]\n    image = \"alpine:latest\"\n    privileged = false\n    disable_cache = false\n    volumes = [\"/cache\"]\n    \n    # Security\n    cap_drop = [\"ALL\"]\n    security_opt = [\"no-new-privileges:true\"]\n    \n  [runners.machine]\n    IdleCount = 2\n    IdleTime = 1800\n    MaxBuilds = 20\n    MachineName = \"gitlab-runner-%s\"\n    MachineDriver = \"amazonec2\"\n    \n    # AWS EC2 configuration\n    [runners.machine.autoscaling]\n      Periods = [\"* * 9-17 * * mon-fri *\", \"* * 18-8 * * * *\"]\n      IdleCount = [5, 1]\n      IdleTime = [1800, 3600]\n      Timezone = \"UTC\"\n    \n    # Machine options for security\n    [runners.machine.machineoptions]\n      amazonec2-access-key = \"aws_access_key\"\n      amazonec2-secret-key = \"aws_secret_key\"\n      amazonec2-region = \"us-west-2\"\n      amazonec2-vpc-id = \"vpc-12345678\"\n      amazonec2-subnet-id = \"subnet-87654321\"\n      amazonec2-security-group = \"gitlab-runner-sg\"\n      amazonec2-instance-type = \"t3.medium\"\n      amazonec2-ami = \"ami-0c02fb55956c7d316\"  # Amazon Linux 2\n      amazonec2-iam-instance-profile = \"GitLabRunnerInstanceProfile\"\n      amazonec2-use-private-address = \"true\"\n      amazonec2-tags = \"Name,gitlab-runner,Environment,production\"\n      amazonec2-root-size = \"20\"\n      amazonec2-volume-type = \"gp3\"\n      amazonec2-use-ebs-optimized = \"true\"\n      \n  [runners.cache]\n    Type = \"s3\"\n    Shared = true\n    [runners.cache.s3]\n      ServerAddress = \"s3.amazonaws.com\"\n      AccessKey = \"cache_access_key\"\n      SecretKey = \"cache_secret_key\"  \n      BucketName = \"gitlab-runner-cache\"\n      BucketLocation = \"us-west-2\"\n      Insecure = false\nEOF\n```\n\n## Verification and Health Checks\n\n### Comprehensive Health Monitoring\n```bash\nsudo tee /usr/local/bin/gitlab-health-check.sh > /dev/null <<'EOF'\n#!/bin/bash\nHEALTH_LOG=\"/var/log/gitlab-health.log\"\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${HEALTH_LOG}\n}\n\n# Check GitLab service status\nif gitlab-ctl status | grep -q \"down:\"; then\n    log_message \"⚠ Some GitLab services are down:\"\n    gitlab-ctl status | grep \"down:\" | while read line; do\n        log_message \"  - $line\"\n    done\nelse\n    log_message \"✓ All GitLab services are running\"\nfi\n\n# Check GitLab application health\nif gitlab-rake gitlab:check >/dev/null 2>&1; then\n    log_message \"✓ GitLab application health check passed\"\nelse\n    log_message \"✗ GitLab application health check failed\"\n    gitlab-rake gitlab:check | tail -10 >> ${HEALTH_LOG}\nfi\n\n# Check GitLab Runner connectivity\nRUNNERS_ONLINE=$(curl -s --header \"PRIVATE-TOKEN: admin_token\" https://gitlab.example.com/api/v4/runners | jq '[.[] | select(.status==\"online\")] | length')\nTOTAL_RUNNERS=$(curl -s --header \"PRIVATE-TOKEN: admin_token\" https://gitlab.example.com/api/v4/runners | jq '. | length')\nlog_message \"ℹ GitLab Runners: ${RUNNERS_ONLINE}/${TOTAL_RUNNERS} online\"\n\n# Check database connectivity\nif gitlab-psql -c \"SELECT version();\" >/dev/null 2>&1; then\n    log_message \"✓ Database connection is healthy\"\nelse\n    log_message \"✗ Database connection issues\"\nfi\n\n# Check Redis connectivity\nif redis-cli ping | grep -q \"PONG\"; then\n    log_message \"✓ Redis connection is healthy\"\nelse\n    log_message \"✗ Redis connection issues\"\nfi\n\n# Check container registry\nREGISTRY_STATUS=$(curl -s https://registry.example.com/v2/ | jq -r .message 2>/dev/null)\nif [ \"$REGISTRY_STATUS\" = \"authentication required\" ] || [ \"$REGISTRY_STATUS\" = \"null\" ]; then\n    log_message \"✓ Container registry is responding\"\nelse\n    log_message \"⚠ Container registry issues\"\nfi\n\n# Check backup status\nLAST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar 2>/dev/null | head -1)\nif [ -n \"$LAST_BACKUP\" ]; then\n    BACKUP_AGE=$(stat -c %Y \"$LAST_BACKUP\")\n    CURRENT_TIME=$(date +%s)\n    HOURS_SINCE_BACKUP=$(( (CURRENT_TIME - BACKUP_AGE) / 3600 ))\n    \n    if [ $HOURS_SINCE_BACKUP -lt 48 ]; then\n        log_message \"✓ Recent backup available (${HOURS_SINCE_BACKUP} hours old)\"\n    else\n        log_message \"⚠ Last backup is ${HOURS_SINCE_BACKUP} hours old\"\n    fi\nelse\n    log_message \"✗ No backup files found\"\nfi\n\n# Check SSL certificate expiry\nSSL_EXPIRY=$(echo | openssl s_client -servername gitlab.example.com -connect gitlab.example.com:443 2>/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)\nSSL_EXPIRY_EPOCH=$(date -d \"$SSL_EXPIRY\" +%s)\nCURRENT_EPOCH=$(date +%s)\nDAYS_TO_EXPIRY=$(( (SSL_EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))\n\nif [ $DAYS_TO_EXPIRY -lt 30 ]; then\n    log_message \"⚠ SSL certificate expires in ${DAYS_TO_EXPIRY} days\"\nelse\n    log_message \"✓ SSL certificate expires in ${DAYS_TO_EXPIRY} days\"\nfi\n\n# Check system resources\nCPU_USAGE=$(top -bn1 | grep \"Cpu(s)\" | awk '{print $2}' | cut -d'%' -f1)\nMEMORY_USAGE=$(free | grep Mem | awk '{printf \"%.0f\", $3/$2 * 100.0}')\nlog_message \"ℹ System usage - CPU: ${CPU_USAGE}%, Memory: ${MEMORY_USAGE}%\"\n\nlog_message \"GitLab health check completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-health-check.sh\n\n# Schedule health checks every 15 minutes\necho \"*/15 * * * * root /usr/local/bin/gitlab-health-check.sh\" | sudo tee -a /etc/crontab\n```\n\n### Security Audit and Compliance\n```bash\nsudo tee /usr/local/bin/gitlab-security-audit.sh > /dev/null <<'EOF'\n#!/bin/bash\nAUDIT_LOG=\"/var/log/gitlab-security-audit.log\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${AUDIT_LOG}\n}\n\nlog_message \"Starting GitLab security audit...\"\n\n# Check user accounts with admin privileges\nADMIN_USERS=$(gitlab-rails runner \"puts User.admins.count\")\nlog_message \"ℹ ${ADMIN_USERS} users with admin privileges\"\n\n# Check for users without 2FA\nUSERS_WITHOUT_2FA=$(gitlab-rails runner \"puts User.where(two_factor_enabled: false).count\")\nlog_message \"ℹ ${USERS_WITHOUT_2FA} users without 2FA enabled\"\n\n# Check SSH key security\nWEAK_SSH_KEYS=$(gitlab-rails runner \"puts Key.where('LENGTH(key) < ?', 2048).count\")\nlog_message \"ℹ ${WEAK_SSH_KEYS} SSH keys shorter than 2048 bits\"\n\n# Check project visibility\nPUBLIC_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 20).count\")\nINTERNAL_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 10).count\")\nPRIVATE_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 0).count\")\nlog_message \"ℹ Projects - Public: ${PUBLIC_PROJECTS}, Internal: ${INTERNAL_PROJECTS}, Private: ${PRIVATE_PROJECTS}\"\n\n# Check for projects without security scanning\nPROJECTS_WITHOUT_SAST=$(gitlab-rails runner \"\nputs Project.joins(:ci_pipelines)\n  .where('ci_pipelines.created_at > ?', 30.days.ago)\n  .where.not(id: Ci::Build.joins(:pipeline).where('ci_builds.name ILIKE ?', '%sast%').select(:project_id))\n  .distinct.count\n\")\nlog_message \"ℹ ${PROJECTS_WITHOUT_SAST} active projects without SAST scanning\"\n\n# Check external integrations\nWEBHOOK_COUNT=$(gitlab-rails runner \"puts ProjectHook.count + SystemHook.count\")\nlog_message \"ℹ ${WEBHOOK_COUNT} webhooks configured\"\n\n# Check audit events (Enterprise)\nif gitlab-rails runner \"puts defined?(AuditEvent)\" | grep -q \"constant\"; then\n    RECENT_AUDIT_EVENTS=$(gitlab-rails runner \"puts AuditEvent.where('created_at > ?', 24.hours.ago).count\")\n    log_message \"ℹ ${RECENT_AUDIT_EVENTS} audit events in last 24 hours\"\nfi\n\n# Check for suspicious activity\nFAILED_LOGINS=$(grep \"Failed Login\" /var/log/gitlab/gitlab-rails/production.log | grep \"$(date +'%Y-%m-%d')\" | wc -l)\nif [ ${FAILED_LOGINS} -gt 20 ]; then\n    log_message \"⚠ ${FAILED_LOGINS} failed login attempts today\"\nelse\n    log_message \"✓ ${FAILED_LOGINS} failed login attempts today (normal)\"\nfi\n\n# Check for large file uploads\nLARGE_UPLOADS=$(find /var/opt/gitlab/git-data/repositories -type f -size +100M -mtime -7 | wc -l)\nif [ ${LARGE_UPLOADS} -gt 0 ]; then\n    log_message \"ℹ ${LARGE_UPLOADS} large files (>100MB) uploaded in last week\"\nfi\n\nlog_message \"Security audit completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-security-audit.sh\n\n# Schedule daily security audits\necho \"0 8 * * * root /usr/local/bin/gitlab-security-audit.sh\" | sudo tee -a /etc/crontab\n```\n\n## Troubleshooting (Cross-Platform)\n\n### Common Issues and Solutions\n```bash\n# Check GitLab status\nsudo gitlab-ctl status\nsudo gitlab-ctl tail\n\n# Check configuration\nsudo gitlab-ctl show-config\nsudo gitlab-rake gitlab:check SANITIZE=true\n\n# Reconfigure GitLab\nsudo gitlab-ctl reconfigure\nsudo gitlab-ctl restart\n\n# Database issues\nsudo gitlab-psql -d gitlabhq_production\nsudo gitlab-rake db:migrate:status\n\n# Redis issues\nredis-cli ping\nredis-cli info\n\n# Check logs for errors\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\n\n# Performance issues\nsudo gitlab-rake gitlab:env:info\nsudo gitlab-ctl status | grep memory\n\n# SSL/TLS issues\nsudo gitlab-rake gitlab:check\nopenssl s_client -connect gitlab.example.com:443\n\n# Container registry issues\nsudo gitlab-ctl registry-garbage-collect\ndocker login registry.example.com\n\n# Runner connectivity issues\nsudo gitlab-runner verify\nsudo gitlab-runner list\n\n# Backup issues\ngitlab-backup create STRATEGY=copy\ngitlab-backup restore BACKUP=timestamp\n\n# Reset admin password\nsudo gitlab-rake \"gitlab:password:reset[root]\"\n\n# Check disk usage\ndf -h /var/opt/gitlab/\nsudo du -sh /var/opt/gitlab/git-data/\n\n# Memory usage analysis\nps aux --sort=-%mem | grep gitlab\ngitlab-ctl status | grep memory\n\n# Network connectivity\ncurl -I https://gitlab.example.com\ntelnet gitlab.example.com 443\n\n# Service restart order (if needed)\nsudo gitlab-ctl stop\nsudo gitlab-ctl start postgresql\nsudo gitlab-ctl start redis\nsudo gitlab-ctl start\n```\n\n### Advanced Debugging\n```bash\n# Enable debug logging\nsudo gitlab-ctl edit-config\n# Add: gitlab_rails['log_level'] = 'DEBUG'\n\nsudo gitlab-ctl reconfigure\n\n# Debug specific services\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\nsudo gitlab-ctl tail gitaly\n\n# Database debugging\nsudo gitlab-psql -d gitlabhq_production -c \"\\l\"\nsudo gitlab-rake db:migrate:status\n\n# Git debugging\nsudo -u git gitaly-debug\nsudo gitlab-rake gitlab:gitaly:check\n\n# Performance profiling\nsudo gitlab-rake gitlab:setup\nsudo gitlab-rake gitlab:check:repos\nsudo gitlab-rake gitlab:cleanup:sessions\n\n# Container registry debugging\nsudo gitlab-ctl registry-garbage-collect -m\ndocker system df\n\n# Runner debugging\nsudo gitlab-runner --debug run\nsudo gitlab-runner exec docker test-job\n\n# Network debugging for distributed setup\nping -c 4 postgres-master.example.com\nping -c 4 redis-master.example.com\ntelnet postgres-master.example.com 5432\ntelnet redis-master.example.com 6379\n\n# Memory leak detection\npmap -x $(pgrep gitlab-workhorse)\nvalgrind --tool=memcheck --leak-check=full gitlab-workhorse\n\n# Strace for syscall analysis\nstrace -p $(pgrep gitlab-workhorse) -e trace=network,file\n```\n\n## Additional Resources\n\n- [Official Documentation](https://docs.gitlab.com/)\n- [GitLab Admin Documentation](https://docs.gitlab.com/ee/administration/)\n- [Security Hardening Guide](https://docs.gitlab.com/security/hardening/)\n- [GitLab Runner Documentation](https://docs.gitlab.com/runner/)\n- [Container Registry Guide](https://docs.gitlab.com/ee/administration/packages/container_registry.html)\n- [GitLab API Documentation](https://docs.gitlab.com/ee/api/)\n\n---\n\n**Note:** This guide is part of the [HowToMgr](https://howtomgr.github.io) collection.","readmeHtml":"<h1 id=\"gitlab-installation-guide\" class=\"mobile-header\">GitLab Installation Guide</h1>\n<p class=\"mobile-paragraph\">Complete DevOps platform with Git repository management, CI/CD pipelines, issue tracking, and container registry. Enterprise-grade solution for modern software development lifecycle with advanced security features.</p>\n<h2 id=\"prerequisites\" class=\"mobile-header\">Prerequisites</h2>\n<li class=\"mobile-list-item\">Linux system (any modern distribution)</li>\n<li class=\"mobile-list-item\">8GB RAM minimum, 16GB+ recommended for production</li>\n<li class=\"mobile-list-item\">4 CPU cores minimum, 8+ recommended</li>\n<li class=\"mobile-list-item\">50GB+ available disk space, SSD recommended</li>\n<li class=\"mobile-list-item\">Domain name for external access</li>\n<li class=\"mobile-list-item\">SSL certificates for production deployment</li>\n<li class=\"mobile-list-item\">SMTP server for email notifications</li>\n<h2 id=\"installation\" class=\"mobile-header\">Installation</h2>\n<h3 id=\"using-omnibus-package-recommended\" class=\"mobile-header\">Using Omnibus Package (Recommended)</h3>\n<p class=\"mobile-paragraph\">#### Ubuntu/Debian</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install dependencies\nsudo apt-get update\nsudo apt-get install -y curl openssh-server ca-certificates tzdata perl postfix\n\n# Configure Postfix for email\nsudo dpkg-reconfigure postfix\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash\n\n# Install GitLab Enterprise Edition\nsudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; apt-get install -y gitlab-ee\n\n# For GitLab Community Edition\nsudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; apt-get install -y gitlab-ce\n\n# Initial configuration\nsudo gitlab-ctl reconfigure\n\n# Check status\nsudo gitlab-ctl status</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### RHEL/CentOS/Rocky Linux/AlmaLinux</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install dependencies\nsudo yum install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# For newer versions\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable and start services\nsudo systemctl enable --now sshd postfix\n\n# Configure SELinux and firewall\nsudo setsebool -P httpd_can_network_connect 1\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --permanent --add-service=ssh\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; yum install -y gitlab-ee\n\n# Configure and start\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### Fedora</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install dependencies\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable services\nsudo systemctl enable --now sshd postfix\n\n# Configure firewall\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; dnf install -y gitlab-ee\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h3 id=\"docker-installation-single-container\" class=\"mobile-header\">Docker Installation (Single Container)</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create GitLab directories\nsudo mkdir -p /srv/gitlab/{config,logs,data}\n\n# Set environment variables\nexport GITLAB_HOME=/srv/gitlab\n\n# Run GitLab container with comprehensive configuration\nsudo docker run --detach \\\n  --hostname gitlab.example.com \\\n  --env GITLAB_OMNIBUS_CONFIG=&quot;\n    external_url &#039;https://gitlab.example.com&#039;;\n    gitlab_rails[&#039;gitlab_shell_ssh_port&#039;] = 2222;\n    \n    # SSL configuration\n    nginx[&#039;ssl_certificate&#039;] = &#039;/etc/gitlab/ssl/gitlab.crt&#039;;\n    nginx[&#039;ssl_certificate_key&#039;] = &#039;/etc/gitlab/ssl/gitlab.key&#039;;\n    nginx[&#039;ssl_protocols&#039;] = &#039;TLSv1.2 TLSv1.3&#039;;\n    nginx[&#039;ssl_prefer_server_ciphers&#039;] = &#039;off&#039;;\n    \n    # Security settings\n    gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {\n      &#039;enabled&#039; =&gt; true,\n      &#039;ip_whitelist&#039; =&gt; [&#039;127.0.0.1&#039;, &#039;192.168.1.0/24&#039;],\n      &#039;maxretry&#039; =&gt; 10,\n      &#039;findtime&#039; =&gt; 60,\n      &#039;bantime&#039; =&gt; 3600\n    };\n    \n    # Performance settings\n    postgresql[&#039;shared_preload_libraries&#039;] = &#039;pg_stat_statements&#039;;\n    postgresql[&#039;max_connections&#039;] = 200;\n    postgresql[&#039;shared_buffers&#039;] = &#039;1GB&#039;;\n    postgresql[&#039;effective_cache_size&#039;] = &#039;4GB&#039;;\n    \n    # Container Registry\n    registry_external_url &#039;https://registry.example.com&#039;;\n    gitlab_rails[&#039;registry_enabled&#039;] = true;\n    \n    # Monitoring\n    prometheus_monitoring[&#039;enable&#039;] = true;\n    grafana[&#039;enable&#039;] = true;\n    grafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;;\n    \n    # Email configuration\n    gitlab_rails[&#039;smtp_enable&#039;] = true;\n    gitlab_rails[&#039;smtp_address&#039;] = &#039;smtp.example.com&#039;;\n    gitlab_rails[&#039;smtp_port&#039;] = 587;\n    gitlab_rails[&#039;smtp_user_name&#039;] = &#039;gitlab@example.com&#039;;\n    gitlab_rails[&#039;smtp_password&#039;] = &#039;smtp_secure_password&#039;;\n    gitlab_rails[&#039;smtp_domain&#039;] = &#039;example.com&#039;;\n    gitlab_rails[&#039;smtp_authentication&#039;] = &#039;login&#039;;\n    gitlab_rails[&#039;smtp_enable_starttls_auto&#039;] = true;\n    gitlab_rails[&#039;smtp_tls&#039;] = false;\n    gitlab_rails[&#039;smtp_openssl_verify_mode&#039;] = &#039;peer&#039;;\n    \n    # Email settings\n    gitlab_rails[&#039;gitlab_email_from&#039;] = &#039;gitlab@example.com&#039;;\n    gitlab_rails[&#039;gitlab_email_display_name&#039;] = &#039;GitLab&#039;;\n    \n    # Backup configuration\n    gitlab_rails[&#039;backup_keep_time&#039;] = 604800;\n    gitlab_rails[&#039;backup_upload_connection&#039;] = {\n      &#039;provider&#039; =&gt; &#039;AWS&#039;,\n      &#039;region&#039; =&gt; &#039;us-west-2&#039;,\n      &#039;aws_access_key_id&#039; =&gt; &#039;backup_access_key&#039;,\n      &#039;aws_secret_access_key&#039; =&gt; &#039;backup_secret_key&#039;\n    };\n    gitlab_rails[&#039;backup_upload_remote_directory&#039;] = &#039;gitlab-backups&#039;;\n    &quot; \\\n  --publish 443:443 --publish 80:80 --publish 2222:22 \\\n  --name gitlab \\\n  --restart unless-stopped \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  gitlab/gitlab-ee:latest</code></pre>\n      </div>\n    </div>\n<h3 id=\"docker-compose-production-setup\" class=\"mobile-header\">Docker Compose (Production Setup)</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">mkdir -p ~/gitlab-stack\ncd ~/gitlab-stack\n\ncat &gt; docker-compose.yml &lt;&lt;EOF\nversion: &#039;3.8&#039;\n\nservices:\n  gitlab:\n    image: gitlab/gitlab-ee:latest\n    container_name: gitlab\n    restart: unless-stopped\n    hostname: gitlab.example.com\n    environment:\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url &#039;https://gitlab.example.com&#039;\n        \n        # Performance settings\n        postgresql[&#039;shared_buffers&#039;] = &quot;2GB&quot;\n        postgresql[&#039;effective_cache_size&#039;] = &quot;8GB&quot;\n        postgresql[&#039;max_connections&#039;] = 300\n        \n        # Security settings\n        gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {\n          &#039;enabled&#039; =&gt; true,\n          &#039;ip_whitelist&#039; =&gt; [&#039;127.0.0.1&#039;, &#039;10.0.0.0/8&#039;, &#039;172.16.0.0/12&#039;, &#039;192.168.0.0/16&#039;],\n          &#039;maxretry&#039; =&gt; 10,\n          &#039;findtime&#039; =&gt; 60,\n          &#039;bantime&#039; =&gt; 3600\n        }\n        \n        # Container Registry\n        registry_external_url &#039;https://registry.example.com&#039;\n        gitlab_rails[&#039;registry_enabled&#039;] = true\n        \n        # Monitoring\n        prometheus_monitoring[&#039;enable&#039;] = true\n        grafana[&#039;enable&#039;] = true\n        \n        # Let&#039;s Encrypt (disable for reverse proxy setup)\n        letsencrypt[&#039;enable&#039;] = false\n        nginx[&#039;listen_port&#039;] = 80\n        nginx[&#039;listen_https&#039;] = false\n        \n        # GitLab Pages\n        pages_external_url &quot;https://pages.example.com&quot;\n        gitlab_pages[&#039;enable&#039;] = true\n    ports:\n      - &#039;80:80&#039;\n      - &#039;443:443&#039;\n      - &#039;2222:22&#039;\n    volumes:\n      - &#039;./config:/etc/gitlab&#039;\n      - &#039;./logs:/var/log/gitlab&#039;\n      - &#039;./data:/var/opt/gitlab&#039;\n    networks:\n      - gitlab\n    shm_size: &#039;256m&#039;\n    healthcheck:\n      test: [&quot;CMD-SHELL&quot;, &quot;gitlab-healthcheck --fail --max-time 10&quot;]\n      interval: 60s\n      timeout: 30s\n      retries: 5\n      start_period: 200s\n\n  gitlab-runner:\n    image: gitlab/gitlab-runner:latest\n    container_name: gitlab-runner\n    restart: unless-stopped\n    volumes:\n      - &#039;./runner-config:/etc/gitlab-runner&#039;\n      - &#039;/var/run/docker.sock:/var/run/docker.sock&#039;\n    networks:\n      - gitlab\n    depends_on:\n      - gitlab\n\n  redis:\n    image: redis:7-alpine\n    container_name: gitlab-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass redis_secure_password\n    volumes:\n      - redis-data:/data\n    networks:\n      - gitlab\n\n  nginx:\n    image: nginx:alpine\n    container_name: gitlab-nginx\n    restart: unless-stopped\n    ports:\n      - &#039;443:443&#039;\n    volumes:\n      - &#039;./nginx/nginx.conf:/etc/nginx/nginx.conf:ro&#039;\n      - &#039;./nginx/ssl:/etc/nginx/ssl:ro&#039;\n    depends_on:\n      - gitlab\n    networks:\n      - gitlab\n\nnetworks:\n  gitlab:\n    driver: bridge\n\nvolumes:\n  redis-data:\nEOF\n\n# Create NGINX reverse proxy configuration\nmkdir -p nginx\ncat &gt; nginx/nginx.conf &lt;&lt;EOF\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream gitlab {\n        server gitlab:80;\n    }\n    \n    upstream registry {\n        server gitlab:5000;\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name gitlab.example.com;\n\n        ssl_certificate /etc/nginx/ssl/gitlab.crt;\n        ssl_certificate_key /etc/nginx/ssl/gitlab.key;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;\n\n        client_max_body_size 0;\n        gzip off;\n\n        location / {\n            proxy_pass http://gitlab;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name registry.example.com;\n\n        ssl_certificate /etc/nginx/ssl/registry.crt;\n        ssl_certificate_key /etc/nginx/ssl/registry.key;\n\n        client_max_body_size 0;\n\n        location /v2/ {\n            proxy_pass http://registry;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n}\nEOF\n\ndocker-compose up -d</code></pre>\n      </div>\n    </div>\n<h2 id=\"enterprise-configuration\" class=\"mobile-header\">Enterprise Configuration</h2>\n<h3 id=\"production-configuration-etcgitlabgitlabrb\" class=\"mobile-header\">Production Configuration (/etc/gitlab/gitlab.rb)</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">sudo tee /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n# GitLab Enterprise Production Configuration\n\nexternal_url &#039;https://gitlab.example.com&#039;\n\n# Performance and Resource Settings\nunicorn[&#039;worker_timeout&#039;] = 60\nunicorn[&#039;worker_processes&#039;] = 8\nsidekiq[&#039;max_concurrency&#039;] = 25\nsidekiq[&#039;min_concurrency&#039;] = 10\n\n# PostgreSQL configuration\npostgresql[&#039;enable&#039;] = true\npostgresql[&#039;max_connections&#039;] = 300\npostgresql[&#039;shared_buffers&#039;] = &quot;2GB&quot;\npostgresql[&#039;effective_cache_size&#039;] = &quot;8GB&quot;\npostgresql[&#039;work_mem&#039;] = &quot;16MB&quot;\npostgresql[&#039;maintenance_work_mem&#039;] = &quot;256MB&quot;\npostgresql[&#039;checkpoint_completion_target&#039;] = 0.9\npostgresql[&#039;wal_buffers&#039;] = &quot;16MB&quot;\npostgresql[&#039;default_statistics_target&#039;] = 100\npostgresql[&#039;random_page_cost&#039;] = 1.1\npostgresql[&#039;effective_io_concurrency&#039;] = 200\n\n# Redis configuration\nredis[&#039;enable&#039;] = true\nredis[&#039;maxmemory&#039;] = &quot;1gb&quot;\nredis[&#039;maxmemory_policy&#039;] = &quot;allkeys-lru&quot;\nredis[&#039;save&#039;] = &#039;900 1 300 10 60 10000&#039;\nredis[&#039;password&#039;] = &#039;redis_secure_password&#039;\n\n# Gitaly configuration (Git RPC service)\ngitaly[&#039;enable&#039;] = true\ngitaly[&#039;auth_token&#039;] = &#039;secure_gitaly_token&#039;\ngitaly[&#039;ruby_max_rss&#039;] = 300000000  # 300MB\ngitaly[&#039;concurrency&#039;] = [\n  {\n    &#039;rpc&#039; =&gt; &quot;/gitaly.SmartHTTPService/PostReceivePack&quot;,\n    &#039;max_per_repo&#039; =&gt; 3\n  },\n  {\n    &#039;rpc&#039; =&gt; &quot;/gitaly.SSHService/SSHUploadPack&quot;, \n    &#039;max_per_repo&#039; =&gt; 3\n  }\n]\n\n# NGINX configuration\nnginx[&#039;enable&#039;] = true\nnginx[&#039;listen_port&#039;] = 80\nnginx[&#039;listen_https&#039;] = false\nnginx[&#039;redirect_http_to_https&#039;] = false\nnginx[&#039;ssl_certificate&#039;] = &quot;/etc/gitlab/ssl/gitlab.crt&quot;\nnginx[&#039;ssl_certificate_key&#039;] = &quot;/etc/gitlab/ssl/gitlab.key&quot;\nnginx[&#039;ssl_protocols&#039;] = &quot;TLSv1.2 TLSv1.3&quot;\nnginx[&#039;ssl_prefer_server_ciphers&#039;] = &quot;off&quot;\nnginx[&#039;ssl_ciphers&#039;] = &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&quot;\n\n# Container Registry\nregistry_external_url &#039;https://registry.example.com&#039;\ngitlab_rails[&#039;registry_enabled&#039;] = true\nregistry[&#039;enable&#039;] = true\nregistry[&#039;username&#039;] = &quot;registry&quot;\nregistry[&#039;uid&#039;] = 996\nregistry[&#039;gid&#039;] = 996\nregistry[&#039;dir&#039;] = &quot;/var/opt/gitlab/registry&quot;\nregistry[&#039;log_directory&#039;] = &quot;/var/log/gitlab/registry&quot;\nregistry[&#039;log_level&#039;] = &quot;info&quot;\nregistry[&#039;rootcertbundle&#039;] = &quot;/opt/gitlab/embedded/ssl/certs/cacert.pem&quot;\n\n# GitLab Pages\npages_external_url &quot;https://pages.example.com&quot;\ngitlab_pages[&#039;enable&#039;] = true\ngitlab_pages[&#039;dir&#039;] = &quot;/var/opt/gitlab/gitlab-pages&quot;\ngitlab_pages[&#039;log_directory&#039;] = &quot;/var/log/gitlab/gitlab-pages&quot;\ngitlab_pages[&#039;access_control&#039;] = true\ngitlab_pages[&#039;use_legacy_storage&#039;] = false\n\n# Email configuration\ngitlab_rails[&#039;smtp_enable&#039;] = true\ngitlab_rails[&#039;smtp_address&#039;] = &quot;smtp.example.com&quot;\ngitlab_rails[&#039;smtp_port&#039;] = 587\ngitlab_rails[&#039;smtp_user_name&#039;] = &quot;gitlab@example.com&quot;\ngitlab_rails[&#039;smtp_password&#039;] = &quot;smtp_secure_password&quot;\ngitlab_rails[&#039;smtp_domain&#039;] = &quot;example.com&quot;\ngitlab_rails[&#039;smtp_authentication&#039;] = &quot;login&quot;\ngitlab_rails[&#039;smtp_enable_starttls_auto&#039;] = true\ngitlab_rails[&#039;smtp_tls&#039;] = false\ngitlab_rails[&#039;smtp_openssl_verify_mode&#039;] = &#039;peer&#039;\n\ngitlab_rails[&#039;gitlab_email_enabled&#039;] = true\ngitlab_rails[&#039;gitlab_email_from&#039;] = &#039;gitlab@example.com&#039;\ngitlab_rails[&#039;gitlab_email_display_name&#039;] = &#039;GitLab&#039;\ngitlab_rails[&#039;gitlab_email_reply_to&#039;] = &#039;noreply@example.com&#039;\n\n# Security settings\ngitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {\n  &#039;enabled&#039; =&gt; true,\n  &#039;ip_whitelist&#039; =&gt; %w{127.0.0.1 192.168.1.0/24 10.0.0.0/8},\n  &#039;maxretry&#039; =&gt; 10,\n  &#039;findtime&#039; =&gt; 60,\n  &#039;bantime&#039; =&gt; 3600\n}\n\n# Two-factor authentication\ngitlab_rails[&#039;require_two_factor_authentication&#039;] = false\ngitlab_rails[&#039;two_factor_grace_period&#039;] = 8  # 8 hours instead of default 48\n\n# Session settings\ngitlab_rails[&#039;session_expire_delay&#039;] = 10080  # 1 week\ngitlab_rails[&#039;session_store_enabled&#039;] = true\n\n# Backup configuration\ngitlab_rails[&#039;backup_keep_time&#039;] = 604800  # 7 days\ngitlab_rails[&#039;backup_upload_connection&#039;] = {\n  &#039;provider&#039; =&gt; &#039;AWS&#039;,\n  &#039;region&#039; =&gt; &#039;us-west-2&#039;,\n  &#039;aws_access_key_id&#039; =&gt; &#039;backup_access_key&#039;,\n  &#039;aws_secret_access_key&#039; =&gt; &#039;backup_secret_key&#039;\n}\ngitlab_rails[&#039;backup_upload_remote_directory&#039;] = &#039;gitlab-backups&#039;\ngitlab_rails[&#039;backup_multipart_chunk_size&#039;] = 104857600  # 100MB\n\n# Monitoring\nprometheus_monitoring[&#039;enable&#039;] = true\nprometheus[&#039;enable&#039;] = true\nprometheus[&#039;listen_address&#039;] = &#039;localhost:9090&#039;\nprometheus[&#039;scrape_configs&#039;] = [\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-workhorse&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:9229&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-unicorn&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:8080&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-sidekiq&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:8082&#039;] }\n    ]\n  }\n]\n\ngrafana[&#039;enable&#039;] = true\ngrafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;\ngrafana[&#039;disable_login_form&#039;] = false\n\n# Logging\nlogging[&#039;svlogd_size&#039;] = 200 * 1024 * 1024  # 200MB\nlogging[&#039;svlogd_num&#039;] = 30\nlogging[&#039;svlogd_timeout&#039;] = 24 * 60 * 60    # rotate after 24 hours\nlogging[&#039;logrotate_frequency&#039;] = &quot;daily&quot;\nlogging[&#039;logrotate_rotate&#039;] = 30\nlogging[&#039;logrotate_compress&#039;] = &quot;compress&quot;\n\n# Git settings\ngitlab_rails[&#039;gitlab_default_branch&#039;] = &#039;main&#039;\ngitlab_rails[&#039;max_request_duration_seconds&#039;] = 60\n\n# Rate limiting\ngitlab_rails[&#039;rate_limit_requests_per_period&#039;] = 300\ngitlab_rails[&#039;rate_limit_period&#039;] = 60\n\n# Enterprise features (if using GitLab EE)\n# gitlab_rails[&#039;ee_license&#039;] = File.read(&#039;/etc/gitlab/GitLab.gitlab-license&#039;)\n\n# Security scanning\ngitlab_rails[&#039;dependency_scanning_enabled&#039;] = true\ngitlab_rails[&#039;container_scanning_enabled&#039;] = true\ngitlab_rails[&#039;sast_enabled&#039;] = true\ngitlab_rails[&#039;secret_detection_enabled&#039;] = true\n\n# LDAP configuration (Enterprise)\ngitlab_rails[&#039;ldap_enabled&#039;] = false\ngitlab_rails[&#039;prevent_ldap_sign_in&#039;] = false\ngitlab_rails[&#039;ldap_servers&#039;] = {\n  &#039;main&#039; =&gt; {\n    &#039;label&#039; =&gt; &#039;LDAP&#039;,\n    &#039;host&#039; =&gt; &#039;ldap.example.com&#039;,\n    &#039;port&#039; =&gt; 636,\n    &#039;uid&#039; =&gt; &#039;sAMAccountName&#039;,\n    &#039;bind_dn&#039; =&gt; &#039;CN=gitlab,OU=Service Accounts,DC=example,DC=com&#039;,\n    &#039;password&#039; =&gt; &#039;ldap_service_password&#039;,\n    &#039;encryption&#039; =&gt; &#039;ssl&#039;,\n    &#039;verify_certificates&#039; =&gt; true,\n    &#039;ca_file&#039; =&gt; &#039;/etc/gitlab/ssl/ldap-ca.crt&#039;,\n    &#039;base&#039; =&gt; &#039;DC=example,DC=com&#039;,\n    &#039;user_filter&#039; =&gt; &#039;&#039;,\n    &#039;attributes&#039; =&gt; {\n      &#039;username&#039; =&gt; [&#039;uid&#039;, &#039;userid&#039;, &#039;sAMAccountName&#039;],\n      &#039;email&#039; =&gt; [&#039;mail&#039;, &#039;email&#039;, &#039;userPrincipalName&#039;],\n      &#039;name&#039; =&gt; &#039;cn&#039;,\n      &#039;first_name&#039; =&gt; &#039;givenName&#039;,\n      &#039;last_name&#039; =&gt; &#039;sn&#039;\n    },\n    &#039;group_base&#039; =&gt; &#039;OU=Groups,DC=example,DC=com&#039;,\n    &#039;admin_group&#039; =&gt; &#039;GitLab Administrators&#039;\n  }\n}\nEOF\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h2 id=\"security-hardening-2024-best-practices\" class=\"mobile-header\">Security Hardening (2024 Best Practices)</h2>\n<h3 id=\"ssltls-configuration\" class=\"mobile-header\">SSL/TLS Configuration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Generate SSL certificates\nsudo mkdir -p /etc/gitlab/ssl\n\n# Self-signed certificate for testing\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 \\\n  -keyout /etc/gitlab/ssl/gitlab.key \\\n  -out /etc/gitlab/ssl/gitlab.crt \\\n  -subj &quot;/C=US/ST=State/L=City/O=Organization/CN=gitlab.example.com&quot;\n\n# Production: Let&#039;s Encrypt integration\nsudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n\n# Let&#039;s Encrypt configuration\nletsencrypt[&#039;enable&#039;] = true\nletsencrypt[&#039;contact_emails&#039;] = [&#039;admin@example.com&#039;]\nletsencrypt[&#039;auto_renew&#039;] = true\nletsencrypt[&#039;auto_renew_hour&#039;] = 0\nletsencrypt[&#039;auto_renew_minute&#039;] = 0\nletsencrypt[&#039;auto_renew_day_of_month&#039;] = &quot;*/4&quot;\n\n# Force HTTPS\nnginx[&#039;redirect_http_to_https&#039;] = true\nnginx[&#039;ssl_protocols&#039;] = &quot;TLSv1.2 TLSv1.3&quot;\nnginx[&#039;ssl_prefer_server_ciphers&#039;] = &quot;off&quot;\nnginx[&#039;ssl_ciphers&#039;] = &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&quot;\n\n# HSTS\nnginx[&#039;hsts_max_age&#039;] = 31536000\nnginx[&#039;hsts_include_subdomains&#039;] = true\nEOF\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h3 id=\"advanced-security-configuration\" class=\"mobile-header\">Advanced Security Configuration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure security settings\nsudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n\n# Security hardening\ngitlab_rails[&#039;webhook_timeout&#039;] = 10\ngitlab_rails[&#039;webhook_max_redirects&#039;] = 3\n\n# Disable password authentication (use SSO/LDAP)\ngitlab_rails[&#039;omniauth_allow_single_sign_on&#039;] = [&#039;saml&#039;, &#039;ldapmain&#039;]\ngitlab_rails[&#039;omniauth_block_auto_created_users&#039;] = false\ngitlab_rails[&#039;omniauth_auto_sign_in_with_provider&#039;] = &#039;saml&#039;\n\n# API rate limiting\ngitlab_rails[&#039;rate_limit_requests_per_period&#039;] = 1000\ngitlab_rails[&#039;rate_limit_period&#039;] = 60\n\n# Git over HTTP rate limiting\ngitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {\n  &#039;enabled&#039; =&gt; true,\n  &#039;ip_whitelist&#039; =&gt; %w{127.0.0.1 192.168.1.0/24},\n  &#039;maxretry&#039; =&gt; 20,\n  &#039;findtime&#039; =&gt; 60,\n  &#039;bantime&#039; =&gt; 3600\n}\n\n# Protected paths\ngitlab_rails[&#039;rack_attack_protected_paths&#039;] = [\n  &#039;/users/password&#039;,\n  &#039;/users/sign_in&#039;,\n  &#039;/api/v4/session.json&#039;,\n  &#039;/api/v4/session&#039;,\n  &#039;/users/confirmation&#039;,\n  &#039;/unsubscribes/&#039;,\n  &#039;/import/github/personal_access_token&#039;,\n  &#039;/admin/session&#039;\n]\n\n# SSH security\ngitlab_rails[&#039;gitlab_shell_ssh_port&#039;] = 2222\ngitlab_shell[&#039;auth_file&#039;] = &quot;/var/opt/gitlab/.ssh/authorized_keys&quot;\n\n# Container Registry security\nregistry[&#039;notifications&#039;] = [\n  {\n    &#039;name&#039; =&gt; &#039;security_scan&#039;,\n    &#039;url&#039; =&gt; &#039;https://security-scanner.example.com/webhook&#039;,\n    &#039;timeout&#039; =&gt; &#039;2000ms&#039;,\n    &#039;threshold&#039; =&gt; 3,\n    &#039;backoff&#039; =&gt; &#039;1000ms&#039;\n  }\n]\n\n# Secrets management\ngitlab_rails[&#039;db_password&#039;] = File.read(&#039;/etc/gitlab/secrets/db_password&#039;).strip\ngitlab_rails[&#039;secret_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/secret_key_base&#039;).strip\ngitlab_rails[&#039;otp_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/otp_key_base&#039;).strip\ngitlab_rails[&#039;encrypted_settings_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/encrypted_settings_key_base&#039;).strip\n\n# Audit logging\ngitlab_rails[&#039;audit_events_enabled&#039;] = true\n\n# Disable features that increase attack surface\ngitlab_rails[&#039;usage_ping_enabled&#039;] = false\ngitlab_rails[&#039;sentry_enabled&#039;] = false\nEOF\n\n# Create secrets directory and files\nsudo mkdir -p /etc/gitlab/secrets\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/db_password\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/secret_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/otp_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/encrypted_settings_key_base\n\n# Secure permissions\nsudo chmod 600 /etc/gitlab/secrets/*\nsudo chown git:git /etc/gitlab/secrets/*\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h3 id=\"gitlab-runner-security-configuration\" class=\"mobile-header\">GitLab Runner Security Configuration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create secure runner configuration\nsudo mkdir -p /etc/gitlab-runner\n\nsudo tee /etc/gitlab-runner/config.toml &gt; /dev/null &lt;&lt;EOF\nconcurrent = 4\ncheck_interval = 0\nshutdown_timeout = 0\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = &quot;docker-runner-secure&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;runner_registration_token&quot;\n  executor = &quot;docker&quot;\n  \n  # Security settings\n  pre_clone_script = &quot;echo &#039;Starting secure build&#039;&quot;\n  pre_build_script = &quot;echo &#039;Preparing secure environment&#039;&quot;\n  post_build_script = &quot;echo &#039;Cleaning up secure environment&#039;&quot;\n  \n  [runners.docker]\n    tls_verify = false\n    image = &quot;alpine:latest&quot;\n    privileged = false  # Critical: Never use privileged mode\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [&quot;/cache&quot;, &quot;/certs/client&quot;]\n    shm_size = 0\n    network_mode = &quot;bridge&quot;\n    \n    # Security restrictions\n    cap_drop = [&quot;ALL&quot;]\n    cap_add = [&quot;CHOWN&quot;, &quot;SETGID&quot;, &quot;SETUID&quot;]\n    security_opt = [&quot;no-new-privileges:true&quot;]\n    \n    # Resource limits\n    memory = &quot;2g&quot;\n    memory_swap = &quot;2g&quot;\n    memory_reservation = &quot;1g&quot;\n    cpus = &quot;1.5&quot;\n    \n    # Network security\n    dns = [&quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;]\n    extra_hosts = [&quot;gitlab.example.com:192.168.1.100&quot;]\n    \n    # Image scanning\n    pull_policy = [&quot;if-not-present&quot;]\n    \n  [runners.docker.tmpfs]\n    &quot;/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;\n    &quot;/var/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;\n\n# Kubernetes executor (more secure)\n[[runners]]\n  name = &quot;k8s-runner-secure&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;k8s_runner_token&quot;\n  executor = &quot;kubernetes&quot;\n  \n  [runners.kubernetes]\n    host = &quot;https://k8s.example.com:6443&quot;\n    namespace = &quot;gitlab-runner&quot;\n    privileged = false  # Never use privileged\n    image = &quot;alpine:latest&quot;\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = &quot;2Gi&quot;\n    memory_request = &quot;1Gi&quot;\n    cpu_limit = &quot;1000m&quot;\n    cpu_request = &quot;500m&quot;\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = &quot;tmp&quot;\n      mount_path = &quot;/tmp&quot;\n      medium = &quot;Memory&quot;\nEOF\n\n# Register runner with security tags\nsudo gitlab-runner register \\\n  --url &quot;https://gitlab.example.com/&quot; \\\n  --registration-token &quot;RUNNER_TOKEN&quot; \\\n  --description &quot;secure-docker-runner&quot; \\\n  --tag-list &quot;docker,secure,production&quot; \\\n  --run-untagged=&quot;false&quot; \\\n  --locked=&quot;true&quot; \\\n  --access-level=&quot;ref_protected&quot; \\\n  --executor &quot;docker&quot; \\\n  --docker-image alpine:latest \\\n  --docker-privileged=&quot;false&quot; \\\n  --docker-volumes &quot;/certs/client&quot;\n\nsudo systemctl enable --now gitlab-runner</code></pre>\n      </div>\n    </div>\n<h2 id=\"cicd-pipeline-security\" class=\"mobile-header\">CI/CD Pipeline Security</h2>\n<h3 id=\"secure-pipeline-configuration\" class=\"mobile-header\">Secure Pipeline Configuration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create .gitlab-ci.yml with security best practices\ncat &gt; .gitlab-ci.yml &lt;&lt;EOF\n# GitLab CI/CD Security Best Practices - 2024\n\nstages:\n  - security-scan\n  - test\n  - build\n  - security-test\n  - deploy\n\nvariables:\n  # Security variables\n  DOCKER_DRIVER: overlay2\n  DOCKER_TLS_CERTDIR: &quot;/certs&quot;\n  SECURE_LOG_LEVEL: info\n  \n  # Use protected variables for sensitive data\n  # DEPLOY_TOKEN: (set in GitLab UI as protected variable)\n  # AWS_ACCESS_KEY: (set in GitLab UI as protected variable)\n\n# Security scanning stage\nsecret-detection:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/secrets:latest\n  script:\n    - echo &quot;Scanning for secrets in code...&quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      secret_detection: gl-secret-detection-report.json\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH&#039;\n  tags:\n    - secure\n\ndependency-scanning:\n  stage: security-scan  \n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/gemnasium:latest\n  script:\n    - echo &quot;Scanning dependencies for vulnerabilities...&quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      dependency_scanning: gl-dependency-scanning-report.json\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH&#039;\n  tags:\n    - secure\n\nsast:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/sobelow:latest\n  script:\n    - echo &quot;Static application security testing...&quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH&#039;\n  tags:\n    - secure\n\n# Container scanning\ncontainer-scanning:\n  stage: security-test\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/klar:latest\n  script:\n    - echo &quot;Scanning container image for vulnerabilities...&quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n  dependencies:\n    - build\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH&#039;\n  tags:\n    - secure\n\n# Secure build stage\nbuild:\n  stage: build\n  image: docker:latest\n  services:\n    - docker:dind\n  before_script:\n    # Verify image signatures\n    - echo &quot;Verifying base image integrity...&quot;\n    - docker trust inspect alpine:latest\n  script:\n    - echo &quot;Building application with security scanning...&quot;\n    - docker build -t \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA .\n    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock aquasec/trivy image \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n    - docker login -u \\$CI_REGISTRY_USER -p \\$CI_REGISTRY_PASSWORD \\$CI_REGISTRY\n    - docker push \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;\n  tags:\n    - secure\n\n# Secure deployment\ndeploy-production:\n  stage: deploy\n  image: alpine:latest\n  before_script:\n    # Install kubectl and verify cluster connectivity\n    - apk add --no-cache curl\n    - curl -LO &quot;https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl&quot;\n    - chmod +x kubectl &amp;&amp; mv kubectl /usr/local/bin/\n    - kubectl config use-context production-cluster\n    - kubectl auth can-i create deployments --namespace=production\n  script:\n    - echo &quot;Deploying to production with security validations...&quot;\n    - kubectl apply -f k8s/production/ --namespace=production\n    - kubectl rollout status deployment/app --namespace=production --timeout=300s\n  environment:\n    name: production\n    url: https://app.example.com\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;\n      when: manual\n  only:\n    variables:\n      - \\$CI_COMMIT_REF_PROTECTED == &quot;true&quot;\n  tags:\n    - secure\n    - production\n\n# Security compliance check\ncompliance-check:\n  stage: security-test\n  image: alpine:latest\n  script:\n    - echo &quot;Running compliance checks...&quot;\n    - apk add --no-cache curl jq\n    - |\n      # Check for required security labels in Docker images\n      if ! docker inspect \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA | jq -r &#039;.[].Config.Labels[&quot;security.scan&quot;]&#039; | grep -q &quot;passed&quot;; then\n        echo &quot;ERROR: Image failed security scan&quot;\n        exit 1\n      fi\n    - echo &quot;Compliance check passed&quot;\n  dependencies:\n    - container-scanning\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;\n  tags:\n    - secure\n\n# Infrastructure as Code scanning\niac-scanning:\n  stage: security-scan\n  image: bridgecrew/checkov:latest\n  script:\n    - checkov --framework terraform --framework kubernetes --framework dockerfile\n  artifacts:\n    reports:\n      junit: checkov-report.xml\n  rules:\n    - if: &#039;\\$CI_COMMIT_BRANCH&#039;\n      changes:\n        - &quot;**/*.tf&quot;\n        - &quot;**/*.yml&quot;\n        - &quot;**/*.yaml&quot;\n        - &quot;**/Dockerfile*&quot;\n  tags:\n    - secure\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"rbac-and-access-control\" class=\"mobile-header\">RBAC and Access Control</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure GitLab RBAC via API\nGITLAB_URL=&quot;https://gitlab.example.com&quot;\nADMIN_TOKEN=&quot;your_admin_token&quot;\n\n# Create groups with specific permissions\ncurl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --data &quot;name=developers&amp;path=developers&amp;description=Development team&amp;visibility=private&quot; \\\n  &quot;${GITLAB_URL}/api/v4/groups&quot;\n\ncurl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --data &quot;name=security-team&amp;path=security-team&amp;description=Security team&amp;visibility=private&quot; \\\n  &quot;${GITLAB_URL}/api/v4/groups&quot;\n\n# Create projects with security templates\ncurl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --data &quot;name=secure-app&amp;description=Secure application&amp;visibility=private&amp;issues_enabled=true&amp;merge_requests_enabled=true&amp;wiki_enabled=false&amp;builds_enabled=true&amp;snippets_enabled=false&amp;container_registry_enabled=true&amp;shared_runners_enabled=false&quot; \\\n  &quot;${GITLAB_URL}/api/v4/projects&quot;\n\n# Configure branch protection\nPROJECT_ID=&quot;1&quot;  # Replace with actual project ID\ncurl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --data &quot;name=main&amp;code_owner_approval_required=true&amp;push_access_level=40&amp;merge_access_level=40&amp;unprotect_access_level=40&quot; \\\n  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/protected_branches&quot;\n\n# Configure push rules (Premium/Ultimate)\ncurl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --data &quot;deny_delete_tag=true&amp;member_check=true&amp;prevent_secrets=true&amp;author_email_regex=.*@example.com&amp;file_extension_restriction=jar,exe&amp;max_file_size=100&quot; \\\n  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/push_rule&quot;</code></pre>\n      </div>\n    </div>\n<h3 id=\"vulnerability-scanning-integration\" class=\"mobile-header\">Vulnerability Scanning Integration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure dependency proxy for secure image caching\nsudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n\n# Dependency Proxy for secure image caching\ngitlab_rails[&#039;dependency_proxy_enabled&#039;] = true\ngitlab_rails[&#039;dependency_proxy_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/dependency_proxy&quot;\n\n# Security scanning\ngitlab_rails[&#039;sast_enabled&#039;] = true\ngitlab_rails[&#039;dependency_scanning_enabled&#039;] = true\ngitlab_rails[&#039;container_scanning_enabled&#039;] = true\ngitlab_rails[&#039;secret_detection_enabled&#039;] = true\ngitlab_rails[&#039;license_scanning_enabled&#039;] = true\n\n# Secure package registry\ngitlab_rails[&#039;packages_enabled&#039;] = true\ngitlab_rails[&#039;packages_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/packages&quot;\nEOF\n\n# Create custom security scanning templates\nmkdir -p .gitlab/ci-templates\n\ncat &gt; .gitlab/ci-templates/Security-Scanning.gitlab-ci.yml &lt;&lt;EOF\n# Custom Security Scanning Template\n\n.security-scan-template:\n  stage: security-scan\n  variables:\n    SECURE_LOG_LEVEL: info\n  before_script:\n    - echo &quot;Preparing security scan environment...&quot;\n    - apk add --no-cache curl jq\n  tags:\n    - secure\n\ncustom-sast:\n  extends: .security-scan-template\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/semgrep:latest\n  script:\n    - echo &quot;Running custom SAST analysis...&quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n    expire_in: 1 week\n\ncustom-secrets-scan:\n  extends: .security-scan-template\n  image: trufflesecurity/trufflehog:latest\n  script:\n    - echo &quot;Scanning for secrets with TruffleHog...&quot;\n    - trufflehog git file://. --json &gt; trufflehog-report.json\n    - |\n      if [ -s trufflehog-report.json ]; then\n        echo &quot;Secrets detected!&quot;\n        cat trufflehog-report.json\n        exit 1\n      fi\n  artifacts:\n    reports:\n      secret_detection: trufflehog-report.json\n    expire_in: 1 week\n\nimage-vulnerability-scan:\n  extends: .security-scan-template\n  image: aquasec/trivy:latest\n  script:\n    - echo &quot;Scanning Docker images for vulnerabilities...&quot;\n    - trivy image --format template --template &quot;@contrib/gitlab.tpl&quot; \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n    expire_in: 1 week\nEOF\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h2 id=\"backup-and-disaster-recovery\" class=\"mobile-header\">Backup and Disaster Recovery</h2>\n<h3 id=\"enterprise-backup-strategy\" class=\"mobile-header\">Enterprise Backup Strategy</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">sudo tee /usr/local/bin/gitlab-backup.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\nBACKUP_DIR=&quot;/backup/gitlab&quot;\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p ${BACKUP_DIR}/{omnibus,secrets,ssl,logs}\n\n# Create GitLab backup\ngitlab-backup create STRATEGY=copy SKIP=uploads,builds,artifacts,lfs,registry,pages\n\n# Backup configuration files\ntar -czf ${BACKUP_DIR}/omnibus/gitlab-config-${DATE}.tar.gz \\\n    /etc/gitlab/gitlab.rb \\\n    /etc/gitlab/gitlab-secrets.json\n\n# Backup SSL certificates\ntar -czf ${BACKUP_DIR}/ssl/gitlab-ssl-${DATE}.tar.gz \\\n    /etc/gitlab/ssl/ \\\n    /etc/letsencrypt/\n\n# Backup secrets\ntar -czf ${BACKUP_DIR}/secrets/gitlab-secrets-${DATE}.tar.gz \\\n    /etc/gitlab/secrets/\n\n# Upload to multiple cloud storage backends\naws s3 cp ${BACKUP_DIR}/ s3://gitlab-backups/ --recursive\naz storage blob upload-batch --source ${BACKUP_DIR} --destination gitlab-backups\ngsutil cp -r ${BACKUP_DIR}/* gs://gitlab-backups/\n\n# Geo-replication backup (Enterprise)\nif command -v gitlab-rake &gt;/dev/null 2&gt;&amp;1; then\n    gitlab-rake gitlab:geo:check\n    gitlab-rake geo:status\nfi\n\n# Test backup integrity\nLATEST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar | head -1)\nif [ -n &quot;$LATEST_BACKUP&quot; ]; then\n    echo &quot;Latest backup: $LATEST_BACKUP&quot;\n    tar -tf &quot;$LATEST_BACKUP&quot; &gt; /tmp/backup-contents.txt\n    if [ $? -eq 0 ]; then\n        echo &quot;✓ Backup integrity verified&quot;\n    else\n        echo &quot;✗ Backup integrity check failed&quot;\n    fi\nfi\n\n# Keep only last 7 backups locally\nfind /var/opt/gitlab/backups/ -name &quot;*_gitlab_backup.tar&quot; -mtime +7 -delete\nfind ${BACKUP_DIR} -name &quot;gitlab-*&quot; -type f -mtime +7 -delete\n\necho &quot;GitLab backup completed: ${DATE}&quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-backup.sh\n\n# Schedule daily backups\necho &quot;0 2 * * * root /usr/local/bin/gitlab-backup.sh&quot; | sudo tee -a /etc/crontab\n\n# Create disaster recovery script\nsudo tee /usr/local/bin/gitlab-restore.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\nBACKUP_FILE=&quot;${1}&quot;\n\nif [ -z &quot;$BACKUP_FILE&quot; ]; then\n    echo &quot;Usage: $0 &lt;backup_file&gt;&quot;\n    echo &quot;Available backups:&quot;\n    ls -la /var/opt/gitlab/backups/*_gitlab_backup.tar\n    exit 1\nfi\n\n# Stop GitLab services\ngitlab-ctl stop unicorn\ngitlab-ctl stop puma\ngitlab-ctl stop sidekiq\n\n# Restore from backup\ngitlab-backup restore BACKUP=$(basename $BACKUP_FILE _gitlab_backup.tar) force=yes\n\n# Restore configuration\nif [ -f &quot;/backup/gitlab/omnibus/gitlab-config-latest.tar.gz&quot; ]; then\n    cd /\n    tar -xzf /backup/gitlab/omnibus/gitlab-config-latest.tar.gz\nfi\n\n# Reconfigure and restart\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n# Verify installation\ngitlab-rake gitlab:check SANITIZE=true\n\necho &quot;GitLab restore completed&quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-restore.sh</code></pre>\n      </div>\n    </div>\n<h3 id=\"high-availability-setup\" class=\"mobile-header\">High Availability Setup</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure GitLab for HA with external services\nsudo tee /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n# GitLab High Availability Configuration\n\nexternal_url &#039;https://gitlab.example.com&#039;\n\n# Disable built-in services (use external)\npostgresql[&#039;enable&#039;] = false\nredis[&#039;enable&#039;] = false\nnginx[&#039;enable&#039;] = true\nunicorn[&#039;enable&#039;] = true\nsidekiq[&#039;enable&#039;] = true\ngitlab_workhorse[&#039;enable&#039;] = true\ngitaly[&#039;enable&#039;] = true\n\n# External PostgreSQL\ngitlab_rails[&#039;db_adapter&#039;] = &#039;postgresql&#039;\ngitlab_rails[&#039;db_encoding&#039;] = &#039;unicode&#039;\ngitlab_rails[&#039;db_host&#039;] = &#039;postgres-master.example.com&#039;\ngitlab_rails[&#039;db_port&#039;] = 5432\ngitlab_rails[&#039;db_database&#039;] = &#039;gitlabhq_production&#039;\ngitlab_rails[&#039;db_username&#039;] = &#039;gitlab&#039;\ngitlab_rails[&#039;db_password&#039;] = &#039;secure_db_password&#039;\ngitlab_rails[&#039;db_load_balancing&#039;] = {\n  &#039;hosts&#039; =&gt; [&#039;postgres-slave1.example.com&#039;, &#039;postgres-slave2.example.com&#039;]\n}\n\n# External Redis\ngitlab_rails[&#039;redis_host&#039;] = &#039;redis-master.example.com&#039;\ngitlab_rails[&#039;redis_port&#039;] = 6379\ngitlab_rails[&#039;redis_password&#039;] = &#039;redis_secure_password&#039;\ngitlab_rails[&#039;redis_sentinels&#039;] = [\n  {&#039;host&#039; =&gt; &#039;redis-sentinel1.example.com&#039;, &#039;port&#039; =&gt; 26379},\n  {&#039;host&#039; =&gt; &#039;redis-sentinel2.example.com&#039;, &#039;port&#039; =&gt; 26379},\n  {&#039;host&#039; =&gt; &#039;redis-sentinel3.example.com&#039;, &#039;port&#039; =&gt; 26379}\n]\n\n# Load balancing\nnginx[&#039;listen_addresses&#039;] = [&#039;0.0.0.0&#039;]\nnginx[&#039;real_ip_header&#039;] = &#039;X-Forwarded-For&#039;\nnginx[&#039;real_ip_recursive&#039;] = &#039;on&#039;\nnginx[&#039;real_ip_trusted_addresses&#039;] = [&#039;10.0.0.0/8&#039;, &#039;172.16.0.0/12&#039;, &#039;192.168.0.0/16&#039;]\n\n# Gitaly cluster (Enterprise)\ngit_data_dirs({\n  &#039;default&#039; =&gt; {\n    &#039;gitaly_address&#039; =&gt; &#039;tcp://gitaly1.example.com:8075&#039;,\n    &#039;gitaly_token&#039; =&gt; &#039;gitaly_secure_token&#039;\n  },\n  &#039;storage1&#039; =&gt; {\n    &#039;gitaly_address&#039; =&gt; &#039;tcp://gitaly2.example.com:8075&#039;,\n    &#039;gitaly_token&#039; =&gt; &#039;gitaly_secure_token&#039;\n  }\n})\n\n# Object storage (S3-compatible)\ngitlab_rails[&#039;object_store&#039;][&#039;enabled&#039;] = true\ngitlab_rails[&#039;object_store&#039;][&#039;proxy_download&#039;] = true\ngitlab_rails[&#039;object_store&#039;][&#039;connection&#039;] = {\n  &#039;provider&#039; =&gt; &#039;AWS&#039;,\n  &#039;region&#039; =&gt; &#039;us-west-2&#039;,\n  &#039;aws_access_key_id&#039; =&gt; &#039;object_store_access_key&#039;,\n  &#039;aws_secret_access_key&#039; =&gt; &#039;object_store_secret_key&#039;\n}\ngitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;artifacts&#039;][&#039;bucket&#039;] = &#039;gitlab-artifacts&#039;\ngitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;lfs&#039;][&#039;bucket&#039;] = &#039;gitlab-lfs&#039;\ngitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;uploads&#039;][&#039;bucket&#039;] = &#039;gitlab-uploads&#039;\ngitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;packages&#039;][&#039;bucket&#039;] = &#039;gitlab-packages&#039;\n\n# Geo replication (Enterprise Premium)\ngitlab_rails[&#039;geo_primary_role&#039;] = true  # Set to false for secondary\ngitlab_rails[&#039;geo_node_name&#039;] = &#039;primary-site&#039;\ngitlab_rails[&#039;geo_registry_replication_enabled&#039;] = true\nEOF\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h2 id=\"container-registry-and-package-management\" class=\"mobile-header\">Container Registry and Package Management</h2>\n<h3 id=\"secure-container-registry-setup\" class=\"mobile-header\">Secure Container Registry Setup</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure container registry with security scanning\nsudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n\n# Container Registry configuration\nregistry_external_url &#039;https://registry.example.com&#039;\ngitlab_rails[&#039;registry_enabled&#039;] = true\nregistry[&#039;enable&#039;] = true\n\n# Registry storage\nregistry[&#039;storage&#039;] = {\n  &#039;s3&#039; =&gt; {\n    &#039;accesskey&#039; =&gt; &#039;registry_s3_access_key&#039;,\n    &#039;secretkey&#039; =&gt; &#039;registry_s3_secret_key&#039;,\n    &#039;bucket&#039; =&gt; &#039;gitlab-registry&#039;,\n    &#039;region&#039; =&gt; &#039;us-west-2&#039;,\n    &#039;encrypt&#039; =&gt; true\n  }\n}\n\n# Registry security\nregistry[&#039;auth_token_realm&#039;] = &quot;https://gitlab.example.com/jwt/auth&quot;\nregistry[&#039;auth_token_service&#039;] = &quot;container_registry&quot;\nregistry[&#039;auth_token_issuer&#039;] = &quot;gitlab-issuer&quot;\nregistry[&#039;auth_token_autoredirect&#039;] = false\n\n# Health checks\nregistry[&#039;health_storagedriver_enabled&#039;] = true\nregistry[&#039;health_storagedriver_interval&#039;] = &#039;10s&#039;\nregistry[&#039;health_storagedriver_threshold&#039;] = 3\n\n# Container scanning\ngitlab_rails[&#039;container_registry_token_expire_delay&#039;] = 300\ngitlab_rails[&#039;container_registry_cleanup_enabled&#039;] = true\n\n# Image retention policies\nregistry[&#039;middleware&#039;] = {\n  &#039;repository&#039; =&gt; [\n    {\n      &#039;name&#039; =&gt; &#039;cloudfront&#039;,\n      &#039;disabled&#039; =&gt; false,\n      &#039;options&#039; =&gt; {\n        &#039;baseurl&#039; =&gt; &#039;https://registry-cdn.example.com&#039;,\n        &#039;privatekey&#039; =&gt; &#039;/etc/gitlab/registry-cdn-private-key.pem&#039;,\n        &#039;keypairid&#039; =&gt; &#039;CLOUDFRONT_KEY_PAIR_ID&#039;,\n        &#039;duration&#039; =&gt; &#039;3600s&#039;\n      }\n    }\n  ]\n}\n\n# Package registry\ngitlab_rails[&#039;packages_enabled&#039;] = true\ngitlab_rails[&#039;packages_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/packages&quot;\nEOF\n\n# Create container registry cleanup policy\ncat &gt; registry-cleanup-policy.json &lt;&lt;EOF\n{\n  &quot;name_regex&quot;: &quot;.*&quot;,\n  &quot;name_regex_keep&quot;: &quot;v\\\\d+\\\\.\\\\d+\\\\.\\\\d+&quot;,\n  &quot;cadence&quot;: &quot;7d&quot;,\n  &quot;older_than&quot;: &quot;30d&quot;,\n  &quot;keep_n&quot;: 10\n}\nEOF\n\n# Apply cleanup policy via API\ncurl --request PUT --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \\\n  --header &quot;Content-Type: application/json&quot; \\\n  --data @registry-cleanup-policy.json \\\n  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/registry/repositories/1&quot;\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h2 id=\"monitoring-and-observability\" class=\"mobile-header\">Monitoring and Observability</h2>\n<h3 id=\"comprehensive-monitoring-setup\" class=\"mobile-header\">Comprehensive Monitoring Setup</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Enable built-in monitoring stack\nsudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF\n\n# Prometheus monitoring\nprometheus_monitoring[&#039;enable&#039;] = true\nprometheus[&#039;enable&#039;] = true\nprometheus[&#039;monitor_kubernetes&#039;] = true\nprometheus[&#039;scrape_configs&#039;] = [\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-workhorse&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:9229&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-unicorn&#039;,  \n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:8080&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-sidekiq&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:8082&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;gitlab-pages&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:8090&#039;] }\n    ]\n  },\n  {\n    &#039;job_name&#039; =&gt; &#039;docker-registry&#039;,\n    &#039;static_configs&#039; =&gt; [\n      { &#039;targets&#039; =&gt; [&#039;localhost:5001&#039;] }\n    ]\n  }\n]\n\n# Grafana configuration\ngrafana[&#039;enable&#039;] = true\ngrafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;\ngrafana[&#039;disable_login_form&#039;] = false\ngrafana[&#039;allow_user_sign_up&#039;] = false\n\n# Grafana LDAP integration\ngrafana[&#039;ldap_enabled&#039;] = true\ngrafana[&#039;ldap_allow_sign_up&#039;] = false\ngrafana[&#039;ldap_servers&#039;] = [{\n  &#039;host&#039; =&gt; &#039;ldap.example.com&#039;,\n  &#039;port&#039; =&gt; 636,\n  &#039;uid&#039; =&gt; &#039;sAMAccountName&#039;,\n  &#039;bind_dn&#039; =&gt; &#039;CN=grafana,OU=Service Accounts,DC=example,DC=com&#039;,\n  &#039;password&#039; =&gt; &#039;ldap_service_password&#039;,\n  &#039;encryption&#039; =&gt; &#039;ssl&#039;,\n  &#039;base&#039; =&gt; &#039;DC=example,DC=com&#039;,\n  &#039;user_filter&#039; =&gt; &#039;&#039;,\n  &#039;group_base&#039; =&gt; &#039;OU=Groups,DC=example,DC=com&#039;,\n  &#039;admin_group&#039; =&gt; &#039;GitLab Administrators&#039;\n}]\n\n# Node Exporter\nnode_exporter[&#039;enable&#039;] = true\nnode_exporter[&#039;listen_address&#039;] = &#039;localhost:9100&#039;\n\n# Alert Manager\nalertmanager[&#039;enable&#039;] = true\nalertmanager[&#039;admin_email&#039;] = &#039;alerts@example.com&#039;\nalertmanager[&#039;flags&#039;] = {\n  &#039;storage.path&#039; =&gt; &#039;/var/opt/gitlab/alertmanager/data&#039;,\n  &#039;config.file&#039; =&gt; &#039;/var/opt/gitlab/alertmanager/alertmanager.yml&#039;\n}\n\n# Log forwarding\nlogging[&#039;logrotate_frequency&#039;] = &quot;daily&quot;\nlogging[&#039;logrotate_rotate&#039;] = 30\nlogging[&#039;logrotate_compress&#039;] = &quot;compress&quot;\nlogging[&#039;svlogd_size&#039;] = 200 * 1024 * 1024  # 200MB\nlogging[&#039;svlogd_num&#039;] = 30\nEOF\n\n# Create custom alerting rules\nsudo mkdir -p /var/opt/gitlab/alertmanager\n\nsudo tee /var/opt/gitlab/alertmanager/alertmanager.yml &gt; /dev/null &lt;&lt;EOF\nglobal:\n  smtp_smarthost: &#039;smtp.example.com:587&#039;\n  smtp_from: &#039;gitlab-alerts@example.com&#039;\n  smtp_auth_username: &#039;gitlab-alerts@example.com&#039;\n  smtp_auth_password: &#039;smtp_password&#039;\n\nroute:\n  group_by: [&#039;alertname&#039;, &#039;cluster&#039;, &#039;service&#039;]\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\n  receiver: &#039;gitlab-alerts&#039;\n  routes:\n  - match:\n      severity: critical\n    receiver: &#039;critical-alerts&#039;\n    group_wait: 10s\n    repeat_interval: 5m\n\nreceivers:\n- name: &#039;gitlab-alerts&#039;\n  email_configs:\n  - to: &#039;gitlab-admin@example.com&#039;\n    subject: &#039;GitLab Alert: {{ .GroupLabels.alertname }}&#039;\n    body: |\n      {{ range .Alerts }}\n      Alert: {{ .Annotations.summary }}\n      Description: {{ .Annotations.description }}\n      Instance: {{ .Labels.instance }}\n      {{ end }}\n\n- name: &#039;critical-alerts&#039;\n  email_configs:\n  - to: &#039;oncall@example.com&#039;\n    subject: &#039;CRITICAL GitLab Alert: {{ .GroupLabels.alertname }}&#039;\n  slack_configs:\n  - api_url: &#039;https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK&#039;\n    channel: &#039;#critical-alerts&#039;\n    title: &#039;Critical GitLab Alert&#039;\nEOF\n\nsudo gitlab-ctl reconfigure</code></pre>\n      </div>\n    </div>\n<h3 id=\"performance-monitoring\" class=\"mobile-header\">Performance Monitoring</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create GitLab performance monitoring script\nsudo tee /usr/local/bin/gitlab-performance-monitor.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\nMONITOR_LOG=&quot;/var/log/gitlab-performance.log&quot;\n\nlog_message() {\n    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${MONITOR_LOG}\n}\n\n# Check GitLab service health\nfor service in unicorn sidekiq workhorse gitaly; do\n    if gitlab-ctl status $service | grep -q &quot;run:&quot;; then\n        log_message &quot;✓ $service is running&quot;\n    else\n        log_message &quot;✗ $service is not running&quot;\n    fi\ndone\n\n# Check database performance\nDB_CONNECTIONS=$(gitlab-psql -c &quot;SELECT count(*) FROM pg_stat_activity;&quot; -t)\nlog_message &quot;ℹ Database connections: ${DB_CONNECTIONS}&quot;\n\n# Check Redis performance  \nREDIS_MEMORY=$(redis-cli info memory | grep used_memory_human: | cut -d: -f2)\nlog_message &quot;ℹ Redis memory usage: ${REDIS_MEMORY}&quot;\n\n# Check Git repository storage\nREPO_SIZE=$(du -sh /var/opt/gitlab/git-data/repositories | cut -f1)\nlog_message &quot;ℹ Repository storage usage: ${REPO_SIZE}&quot;\n\n# Check background job queue\nSIDEKIQ_QUEUE=$(gitlab-rails runner &quot;puts Sidekiq::Queue.new.size&quot;)\nlog_message &quot;ℹ Sidekiq queue size: ${SIDEKIQ_QUEUE}&quot;\n\n# Check GitLab metrics\nGITLAB_VERSION=$(gitlab-rake gitlab:env:info | grep &quot;GitLab information&quot; -A 10 | grep &quot;Version:&quot; | awk &#039;{print $2}&#039;)\nlog_message &quot;ℹ GitLab version: ${GITLAB_VERSION}&quot;\n\n# Performance metrics via API\nAPI_RESPONSE_TIME=$(curl -w &quot;%{time_total}&quot; -s -o /dev/null https://gitlab.example.com/api/v4/projects)\nlog_message &quot;ℹ API response time: ${API_RESPONSE_TIME}s&quot;\n\n# Check disk I/O\nDISK_USAGE=$(df /var/opt/gitlab | awk &#039;NR==2 {print $5}&#039; | sed &#039;s/%//&#039;)\nlog_message &quot;ℹ Disk usage: ${DISK_USAGE}%&quot;\n\nif [ ${DISK_USAGE} -gt 85 ]; then\n    log_message &quot;⚠ High disk usage detected&quot;\nfi\n\nlog_message &quot;Performance monitoring completed&quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-performance-monitor.sh\n\n# Schedule performance monitoring\necho &quot;*/15 * * * * root /usr/local/bin/gitlab-performance-monitor.sh&quot; | sudo tee -a /etc/crontab</code></pre>\n      </div>\n    </div>\n<h2 id=\"gitlab-runner-advanced-configuration\" class=\"mobile-header\">GitLab Runner Advanced Configuration</h2>\n<h3 id=\"secure-multi-platform-runner-setup\" class=\"mobile-header\">Secure Multi-Platform Runner Setup</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create advanced runner configuration with security\nsudo tee /etc/gitlab-runner/config.toml &gt; /dev/null &lt;&lt;EOF\nconcurrent = 10\ncheck_interval = 0\nlog_level = &quot;info&quot;\nlog_format = &quot;runner&quot;\nshutdown_timeout = 30\n\n[session_server]\n  session_timeout = 1800\n\n# Docker executor with security hardening\n[[runners]]\n  name = &quot;docker-secure-runner&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;secure_runner_token&quot;\n  executor = &quot;docker&quot;\n  output_limit = 4096\n  \n  # Security scripts\n  pre_clone_script = &quot;&quot;&quot;\n    echo &#039;Security scan initiated&#039;\n    id\n    pwd\n    env | grep -E &#039;^(CI_|GITLAB_)&#039; | sort\n  &quot;&quot;&quot;\n  \n  pre_build_script = &quot;&quot;&quot;\n    echo &#039;Preparing secure build environment&#039;\n    # Verify no sensitive data in environment\n    if env | grep -i -E &#039;(password|secret|key|token)&#039; | grep -v -E &#039;^(CI_JOB_TOKEN|GITLAB_CI|CI_SERVER)&#039;; then\n      echo &#039;ERROR: Sensitive data detected in environment&#039;\n      exit 1\n    fi\n  &quot;&quot;&quot;\n  \n  post_build_script = &quot;&quot;&quot;\n    echo &#039;Cleaning up build artifacts&#039;\n    rm -rf /tmp/* 2&gt;/dev/null || true\n  &quot;&quot;&quot;\n  \n  [runners.docker]\n    tls_verify = false\n    image = &quot;alpine:latest&quot;\n    privileged = false\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [&quot;/cache&quot;, &quot;/certs/client&quot;]\n    shm_size = 268435456  # 256MB\n    \n    # Security restrictions\n    cap_drop = [&quot;ALL&quot;]\n    cap_add = [&quot;CHOWN&quot;, &quot;SETGID&quot;, &quot;SETUID&quot;]\n    security_opt = [&quot;no-new-privileges:true&quot;, &quot;apparmor:unconfined&quot;]\n    \n    # Resource limits\n    memory = &quot;2g&quot;\n    memory_swap = &quot;2g&quot;\n    memory_reservation = &quot;1g&quot;\n    cpus = &quot;2&quot;\n    \n    # Network security\n    network_mode = &quot;bridge&quot;\n    dns = [&quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;]\n    \n    # Disable dangerous features\n    disable_entrypoint_overwrite = true\n    \n    # Image pull policy\n    pull_policy = [&quot;if-not-present&quot;]\n    \n  [runners.docker.tmpfs]\n    &quot;/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;\n    &quot;/var/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;\n\n# Kubernetes executor (Enterprise recommended)\n[[runners]]\n  name = &quot;k8s-secure-runner&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;k8s_runner_token&quot;\n  executor = &quot;kubernetes&quot;\n  \n  [runners.kubernetes]\n    host = &quot;https://k8s.example.com:6443&quot;\n    namespace = &quot;gitlab-runner&quot;\n    privileged = false\n    image = &quot;alpine:latest&quot;\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = &quot;4Gi&quot;\n    memory_request = &quot;2Gi&quot;\n    cpu_limit = &quot;2000m&quot;\n    cpu_request = &quot;1000m&quot;\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      seccomp_profile_type = &quot;RuntimeDefault&quot;\n      \n    [runners.kubernetes.container_security_context]\n      allow_privilege_escalation = false\n      read_only_root_filesystem = true\n      capabilities = { drop = [&quot;ALL&quot;] }\n      \n    # Volume mounts for security\n    [[runners.kubernetes.volumes.empty_dir]]\n      name = &quot;tmp&quot;\n      mount_path = &quot;/tmp&quot;\n      medium = &quot;Memory&quot;\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = &quot;var-tmp&quot;\n      mount_path = &quot;/var/tmp&quot;\n      medium = &quot;Memory&quot;\n\n# Shell executor for specific tasks (limited use)\n[[runners]]\n  name = &quot;shell-restricted-runner&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;shell_runner_token&quot;\n  executor = &quot;shell&quot;\n  shell = &quot;bash&quot;\n  \n  # Restricted tags only\n  tag_list = [&quot;shell&quot;, &quot;restricted&quot;]\n  run_untagged = false\n  locked = true\n  \n  # Security environment\n  environment = [\n    &quot;PATH=/usr/local/bin:/usr/bin:/bin&quot;,\n    &quot;HOME=/home/gitlab-runner&quot;,\n    &quot;SHELL=/bin/bash&quot;\n  ]\n  \n  # Cleanup\n  builds_dir = &quot;/home/gitlab-runner/builds&quot;\n  cache_dir = &quot;/home/gitlab-runner/cache&quot;\n  \n  [runners.cache]\n    Type = &quot;s3&quot;\n    [runners.cache.s3]\n      ServerAddress = &quot;s3.amazonaws.com&quot;\n      BucketName = &quot;gitlab-runner-cache&quot;\n      BucketLocation = &quot;us-west-2&quot;\n      Insecure = false\nEOF\n\nsudo systemctl restart gitlab-runner</code></pre>\n      </div>\n    </div>\n<h3 id=\"gitlab-runner-auto-scaling-cloud\" class=\"mobile-header\">GitLab Runner Auto-scaling (Cloud)</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Configure GitLab Runner with Docker Machine for auto-scaling\nsudo tee /etc/gitlab-runner/autoscale-config.toml &gt; /dev/null &lt;&lt;EOF\nconcurrent = 50\ncheck_interval = 0\n\n[[runners]]\n  name = &quot;autoscale-runner&quot;\n  url = &quot;https://gitlab.example.com/&quot;\n  token = &quot;autoscale_runner_token&quot;\n  executor = &quot;docker+machine&quot;\n  \n  [runners.docker]\n    image = &quot;alpine:latest&quot;\n    privileged = false\n    disable_cache = false\n    volumes = [&quot;/cache&quot;]\n    \n    # Security\n    cap_drop = [&quot;ALL&quot;]\n    security_opt = [&quot;no-new-privileges:true&quot;]\n    \n  [runners.machine]\n    IdleCount = 2\n    IdleTime = 1800\n    MaxBuilds = 20\n    MachineName = &quot;gitlab-runner-%s&quot;\n    MachineDriver = &quot;amazonec2&quot;\n    \n    # AWS EC2 configuration\n    [runners.machine.autoscaling]\n      Periods = [&quot;* * 9-17 * * mon-fri *&quot;, &quot;* * 18-8 * * * *&quot;]\n      IdleCount = [5, 1]\n      IdleTime = [1800, 3600]\n      Timezone = &quot;UTC&quot;\n    \n    # Machine options for security\n    [runners.machine.machineoptions]\n      amazonec2-access-key = &quot;aws_access_key&quot;\n      amazonec2-secret-key = &quot;aws_secret_key&quot;\n      amazonec2-region = &quot;us-west-2&quot;\n      amazonec2-vpc-id = &quot;vpc-12345678&quot;\n      amazonec2-subnet-id = &quot;subnet-87654321&quot;\n      amazonec2-security-group = &quot;gitlab-runner-sg&quot;\n      amazonec2-instance-type = &quot;t3.medium&quot;\n      amazonec2-ami = &quot;ami-0c02fb55956c7d316&quot;  # Amazon Linux 2\n      amazonec2-iam-instance-profile = &quot;GitLabRunnerInstanceProfile&quot;\n      amazonec2-use-private-address = &quot;true&quot;\n      amazonec2-tags = &quot;Name,gitlab-runner,Environment,production&quot;\n      amazonec2-root-size = &quot;20&quot;\n      amazonec2-volume-type = &quot;gp3&quot;\n      amazonec2-use-ebs-optimized = &quot;true&quot;\n      \n  [runners.cache]\n    Type = &quot;s3&quot;\n    Shared = true\n    [runners.cache.s3]\n      ServerAddress = &quot;s3.amazonaws.com&quot;\n      AccessKey = &quot;cache_access_key&quot;\n      SecretKey = &quot;cache_secret_key&quot;  \n      BucketName = &quot;gitlab-runner-cache&quot;\n      BucketLocation = &quot;us-west-2&quot;\n      Insecure = false\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"verification-and-health-checks\" class=\"mobile-header\">Verification and Health Checks</h2>\n<h3 id=\"comprehensive-health-monitoring\" class=\"mobile-header\">Comprehensive Health Monitoring</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">sudo tee /usr/local/bin/gitlab-health-check.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\nHEALTH_LOG=&quot;/var/log/gitlab-health.log&quot;\n\nlog_message() {\n    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${HEALTH_LOG}\n}\n\n# Check GitLab service status\nif gitlab-ctl status | grep -q &quot;down:&quot;; then\n    log_message &quot;⚠ Some GitLab services are down:&quot;\n    gitlab-ctl status | grep &quot;down:&quot; | while read line; do\n        log_message &quot;  - $line&quot;\n    done\nelse\n    log_message &quot;✓ All GitLab services are running&quot;\nfi\n\n# Check GitLab application health\nif gitlab-rake gitlab:check &gt;/dev/null 2&gt;&amp;1; then\n    log_message &quot;✓ GitLab application health check passed&quot;\nelse\n    log_message &quot;✗ GitLab application health check failed&quot;\n    gitlab-rake gitlab:check | tail -10 &gt;&gt; ${HEALTH_LOG}\nfi\n\n# Check GitLab Runner connectivity\nRUNNERS_ONLINE=$(curl -s --header &quot;PRIVATE-TOKEN: admin_token&quot; https://gitlab.example.com/api/v4/runners | jq &#039;[.[] | select(.status==&quot;online&quot;)] | length&#039;)\nTOTAL_RUNNERS=$(curl -s --header &quot;PRIVATE-TOKEN: admin_token&quot; https://gitlab.example.com/api/v4/runners | jq &#039;. | length&#039;)\nlog_message &quot;ℹ GitLab Runners: ${RUNNERS_ONLINE}/${TOTAL_RUNNERS} online&quot;\n\n# Check database connectivity\nif gitlab-psql -c &quot;SELECT version();&quot; &gt;/dev/null 2&gt;&amp;1; then\n    log_message &quot;✓ Database connection is healthy&quot;\nelse\n    log_message &quot;✗ Database connection issues&quot;\nfi\n\n# Check Redis connectivity\nif redis-cli ping | grep -q &quot;PONG&quot;; then\n    log_message &quot;✓ Redis connection is healthy&quot;\nelse\n    log_message &quot;✗ Redis connection issues&quot;\nfi\n\n# Check container registry\nREGISTRY_STATUS=$(curl -s https://registry.example.com/v2/ | jq -r .message 2&gt;/dev/null)\nif [ &quot;$REGISTRY_STATUS&quot; = &quot;authentication required&quot; ] || [ &quot;$REGISTRY_STATUS&quot; = &quot;null&quot; ]; then\n    log_message &quot;✓ Container registry is responding&quot;\nelse\n    log_message &quot;⚠ Container registry issues&quot;\nfi\n\n# Check backup status\nLAST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar 2&gt;/dev/null | head -1)\nif [ -n &quot;$LAST_BACKUP&quot; ]; then\n    BACKUP_AGE=$(stat -c %Y &quot;$LAST_BACKUP&quot;)\n    CURRENT_TIME=$(date +%s)\n    HOURS_SINCE_BACKUP=$(( (CURRENT_TIME - BACKUP_AGE) / 3600 ))\n    \n    if [ $HOURS_SINCE_BACKUP -lt 48 ]; then\n        log_message &quot;✓ Recent backup available (${HOURS_SINCE_BACKUP} hours old)&quot;\n    else\n        log_message &quot;⚠ Last backup is ${HOURS_SINCE_BACKUP} hours old&quot;\n    fi\nelse\n    log_message &quot;✗ No backup files found&quot;\nfi\n\n# Check SSL certificate expiry\nSSL_EXPIRY=$(echo | openssl s_client -servername gitlab.example.com -connect gitlab.example.com:443 2&gt;/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)\nSSL_EXPIRY_EPOCH=$(date -d &quot;$SSL_EXPIRY&quot; +%s)\nCURRENT_EPOCH=$(date +%s)\nDAYS_TO_EXPIRY=$(( (SSL_EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))\n\nif [ $DAYS_TO_EXPIRY -lt 30 ]; then\n    log_message &quot;⚠ SSL certificate expires in ${DAYS_TO_EXPIRY} days&quot;\nelse\n    log_message &quot;✓ SSL certificate expires in ${DAYS_TO_EXPIRY} days&quot;\nfi\n\n# Check system resources\nCPU_USAGE=$(top -bn1 | grep &quot;Cpu(s)&quot; | awk &#039;{print $2}&#039; | cut -d&#039;%&#039; -f1)\nMEMORY_USAGE=$(free | grep Mem | awk &#039;{printf &quot;%.0f&quot;, $3/$2 * 100.0}&#039;)\nlog_message &quot;ℹ System usage - CPU: ${CPU_USAGE}%, Memory: ${MEMORY_USAGE}%&quot;\n\nlog_message &quot;GitLab health check completed&quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-health-check.sh\n\n# Schedule health checks every 15 minutes\necho &quot;*/15 * * * * root /usr/local/bin/gitlab-health-check.sh&quot; | sudo tee -a /etc/crontab</code></pre>\n      </div>\n    </div>\n<h3 id=\"security-audit-and-compliance\" class=\"mobile-header\">Security Audit and Compliance</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">sudo tee /usr/local/bin/gitlab-security-audit.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\nAUDIT_LOG=&quot;/var/log/gitlab-security-audit.log&quot;\nDATE=$(date +%Y%m%d_%H%M%S)\n\nlog_message() {\n    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${AUDIT_LOG}\n}\n\nlog_message &quot;Starting GitLab security audit...&quot;\n\n# Check user accounts with admin privileges\nADMIN_USERS=$(gitlab-rails runner &quot;puts User.admins.count&quot;)\nlog_message &quot;ℹ ${ADMIN_USERS} users with admin privileges&quot;\n\n# Check for users without 2FA\nUSERS_WITHOUT_2FA=$(gitlab-rails runner &quot;puts User.where(two_factor_enabled: false).count&quot;)\nlog_message &quot;ℹ ${USERS_WITHOUT_2FA} users without 2FA enabled&quot;\n\n# Check SSH key security\nWEAK_SSH_KEYS=$(gitlab-rails runner &quot;puts Key.where(&#039;LENGTH(key) &lt; ?&#039;, 2048).count&quot;)\nlog_message &quot;ℹ ${WEAK_SSH_KEYS} SSH keys shorter than 2048 bits&quot;\n\n# Check project visibility\nPUBLIC_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 20).count&quot;)\nINTERNAL_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 10).count&quot;)\nPRIVATE_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 0).count&quot;)\nlog_message &quot;ℹ Projects - Public: ${PUBLIC_PROJECTS}, Internal: ${INTERNAL_PROJECTS}, Private: ${PRIVATE_PROJECTS}&quot;\n\n# Check for projects without security scanning\nPROJECTS_WITHOUT_SAST=$(gitlab-rails runner &quot;\nputs Project.joins(:ci_pipelines)\n  .where(&#039;ci_pipelines.created_at &gt; ?&#039;, 30.days.ago)\n  .where.not(id: Ci::Build.joins(:pipeline).where(&#039;ci_builds.name ILIKE ?&#039;, &#039;%sast%&#039;).select(:project_id))\n  .distinct.count\n&quot;)\nlog_message &quot;ℹ ${PROJECTS_WITHOUT_SAST} active projects without SAST scanning&quot;\n\n# Check external integrations\nWEBHOOK_COUNT=$(gitlab-rails runner &quot;puts ProjectHook.count + SystemHook.count&quot;)\nlog_message &quot;ℹ ${WEBHOOK_COUNT} webhooks configured&quot;\n\n# Check audit events (Enterprise)\nif gitlab-rails runner &quot;puts defined?(AuditEvent)&quot; | grep -q &quot;constant&quot;; then\n    RECENT_AUDIT_EVENTS=$(gitlab-rails runner &quot;puts AuditEvent.where(&#039;created_at &gt; ?&#039;, 24.hours.ago).count&quot;)\n    log_message &quot;ℹ ${RECENT_AUDIT_EVENTS} audit events in last 24 hours&quot;\nfi\n\n# Check for suspicious activity\nFAILED_LOGINS=$(grep &quot;Failed Login&quot; /var/log/gitlab/gitlab-rails/production.log | grep &quot;$(date +&#039;%Y-%m-%d&#039;)&quot; | wc -l)\nif [ ${FAILED_LOGINS} -gt 20 ]; then\n    log_message &quot;⚠ ${FAILED_LOGINS} failed login attempts today&quot;\nelse\n    log_message &quot;✓ ${FAILED_LOGINS} failed login attempts today (normal)&quot;\nfi\n\n# Check for large file uploads\nLARGE_UPLOADS=$(find /var/opt/gitlab/git-data/repositories -type f -size +100M -mtime -7 | wc -l)\nif [ ${LARGE_UPLOADS} -gt 0 ]; then\n    log_message &quot;ℹ ${LARGE_UPLOADS} large files (&gt;100MB) uploaded in last week&quot;\nfi\n\nlog_message &quot;Security audit completed&quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-security-audit.sh\n\n# Schedule daily security audits\necho &quot;0 8 * * * root /usr/local/bin/gitlab-security-audit.sh&quot; | sudo tee -a /etc/crontab</code></pre>\n      </div>\n    </div>\n<h2 id=\"troubleshooting-cross-platform\" class=\"mobile-header\">Troubleshooting (Cross-Platform)</h2>\n<h3 id=\"common-issues-and-solutions\" class=\"mobile-header\">Common Issues and Solutions</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Check GitLab status\nsudo gitlab-ctl status\nsudo gitlab-ctl tail\n\n# Check configuration\nsudo gitlab-ctl show-config\nsudo gitlab-rake gitlab:check SANITIZE=true\n\n# Reconfigure GitLab\nsudo gitlab-ctl reconfigure\nsudo gitlab-ctl restart\n\n# Database issues\nsudo gitlab-psql -d gitlabhq_production\nsudo gitlab-rake db:migrate:status\n\n# Redis issues\nredis-cli ping\nredis-cli info\n\n# Check logs for errors\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\n\n# Performance issues\nsudo gitlab-rake gitlab:env:info\nsudo gitlab-ctl status | grep memory\n\n# SSL/TLS issues\nsudo gitlab-rake gitlab:check\nopenssl s_client -connect gitlab.example.com:443\n\n# Container registry issues\nsudo gitlab-ctl registry-garbage-collect\ndocker login registry.example.com\n\n# Runner connectivity issues\nsudo gitlab-runner verify\nsudo gitlab-runner list\n\n# Backup issues\ngitlab-backup create STRATEGY=copy\ngitlab-backup restore BACKUP=timestamp\n\n# Reset admin password\nsudo gitlab-rake &quot;gitlab:password:reset[root]&quot;\n\n# Check disk usage\ndf -h /var/opt/gitlab/\nsudo du -sh /var/opt/gitlab/git-data/\n\n# Memory usage analysis\nps aux --sort=-%mem | grep gitlab\ngitlab-ctl status | grep memory\n\n# Network connectivity\ncurl -I https://gitlab.example.com\ntelnet gitlab.example.com 443\n\n# Service restart order (if needed)\nsudo gitlab-ctl stop\nsudo gitlab-ctl start postgresql\nsudo gitlab-ctl start redis\nsudo gitlab-ctl start</code></pre>\n      </div>\n    </div>\n<h3 id=\"advanced-debugging\" class=\"mobile-header\">Advanced Debugging</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Enable debug logging\nsudo gitlab-ctl edit-config\n# Add: gitlab_rails[&#039;log_level&#039;] = &#039;DEBUG&#039;\n\nsudo gitlab-ctl reconfigure\n\n# Debug specific services\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\nsudo gitlab-ctl tail gitaly\n\n# Database debugging\nsudo gitlab-psql -d gitlabhq_production -c &quot;\\l&quot;\nsudo gitlab-rake db:migrate:status\n\n# Git debugging\nsudo -u git gitaly-debug\nsudo gitlab-rake gitlab:gitaly:check\n\n# Performance profiling\nsudo gitlab-rake gitlab:setup\nsudo gitlab-rake gitlab:check:repos\nsudo gitlab-rake gitlab:cleanup:sessions\n\n# Container registry debugging\nsudo gitlab-ctl registry-garbage-collect -m\ndocker system df\n\n# Runner debugging\nsudo gitlab-runner --debug run\nsudo gitlab-runner exec docker test-job\n\n# Network debugging for distributed setup\nping -c 4 postgres-master.example.com\nping -c 4 redis-master.example.com\ntelnet postgres-master.example.com 5432\ntelnet redis-master.example.com 6379\n\n# Memory leak detection\npmap -x $(pgrep gitlab-workhorse)\nvalgrind --tool=memcheck --leak-check=full gitlab-workhorse\n\n# Strace for syscall analysis\nstrace -p $(pgrep gitlab-workhorse) -e trace=network,file</code></pre>\n      </div>\n    </div>\n<h2 id=\"additional-resources\" class=\"mobile-header\">Additional Resources</h2>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Official Documentation</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/ee/administration/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">GitLab Admin Documentation</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/security/hardening/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Security Hardening Guide</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/runner/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">GitLab Runner Documentation</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/ee/administration/packages/container_registry.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Container Registry Guide</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.gitlab.com/ee/api/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">GitLab API Documentation</a></li>\n<p class=\"mobile-paragraph\">---</p>\n<p class=\"mobile-paragraph\"><strong>Note:</strong> This guide is part of the <a href=\"https://howtomgr.github.io\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">HowToMgr</a> collection.</p>","readTime":"29 min","wordCount":5786,"lastBuilt":"2025-09-14T03:45:49.621Z"},"category":{"key":"infrastructure","name":"Infrastructure","description":"DevOps and infrastructure automation tools","icon":"🏗️","color":"#44475a","keywords":["ansible","terraform","gitlab","jenkins","consul","etcd"]},"relatedGuides":[{"name":"adguard-home","displayName":"Adguard Home","slug":"adguard-home","description":"Repo for adguard-home","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/adguard-home","updatedAt":"2025-09-08T03:04:18Z","createdAt":"2025-09-08T03:04:08Z","readmeRaw":"## 👋 Welcome to adguard-home 🚀  \n\nadguard-home README  \n  \n  \n## Author  \n\n🤖 casjay: [Github](https://github.com/casjay) 🤖  \n","readmeHtml":"<h2 id=\"welcome-to-adguard-home\" class=\"mobile-header\">👋 Welcome to adguard-home 🚀  </h2>\n<p class=\"mobile-paragraph\">adguard-home README  </p>\n<h2 id=\"author\" class=\"mobile-header\">Author  </h2>\n<p class=\"mobile-paragraph\">🤖 casjay: <a href=\"https://github.com/casjay\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Github</a> 🤖  </p>","readTime":"1 min","wordCount":15,"lastBuilt":"2025-09-14T03:46:07.037Z"},{"name":"adminer","displayName":"Adminer","slug":"adminer","description":"Repo for adminer","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/adminer","updatedAt":"2025-09-08T03:04:32Z","createdAt":"2025-09-08T03:04:22Z","readmeRaw":"## 👋 Welcome to adminer 🚀  \n\nadminer README  \n  \n  \n## Author  \n\n🤖 casjay: [Github](https://github.com/casjay) 🤖  \n","readmeHtml":"<h2 id=\"welcome-to-adminer\" class=\"mobile-header\">👋 Welcome to adminer 🚀  </h2>\n<p class=\"mobile-paragraph\">adminer README  </p>\n<h2 id=\"author\" class=\"mobile-header\">Author  </h2>\n<p class=\"mobile-paragraph\">🤖 casjay: <a href=\"https://github.com/casjay\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Github</a> 🤖  </p>","readTime":"1 min","wordCount":15,"lastBuilt":"2025-09-14T03:46:06.794Z"},{"name":"ansible","displayName":"Ansible","slug":"ansible","description":"Repo for ansible","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/ansible","updatedAt":"2025-09-14T01:29:39Z","createdAt":"2025-09-08T03:04:35Z","readmeRaw":"# Ansible Installation Guide\n\nAgentless automation platform for configuration management, application deployment, and task automation across multiple systems. Industry standard for infrastructure automation with enterprise-grade security.\n\n## Prerequisites\n\n- Linux control machine (any modern distribution)\n- Python 3.8+ on control machine\n- SSH access to target hosts\n- Python 2.7+ or 3.5+ on target hosts\n- 2GB RAM minimum, 4GB+ recommended for large infrastructures\n\n## Installation\n\n### Using Package Manager (Recommended)\n\n#### Ubuntu/Debian\n```bash\n# Update package list\nsudo apt update\n\n# Install Ansible and dependencies\nsudo apt install -y ansible python3-pip python3-venv sshpass\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Verify installation\nansible --version\nansible-galaxy collection list\n```\n\n#### RHEL/CentOS/Rocky Linux/AlmaLinux\n```bash\n# Install EPEL repository\nsudo yum install -y epel-release\n\n# Install Ansible\nsudo yum install -y ansible python3-pip\n\n# For newer distributions\nsudo dnf install -y ansible python3-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\n```\n\n#### Fedora\n```bash\n# Install Ansible\nsudo dnf install -y ansible python3-pip python3-virtualenv\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\n```\n\n#### Arch Linux\n```bash\n# Install Ansible\nsudo pacman -Syu ansible python-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\n\n# Verify installation\nansible --version\n```\n\n#### Alpine Linux\n```bash\n# Install Ansible\nsudo apk update\nsudo apk add ansible python3 py3-pip openssh\n\n# Install collections\nansible-galaxy collection install community.general\n\n# Verify installation\nansible --version\n```\n\n### Using pip (Latest Version)\n```bash\n# Create virtual environment (recommended)\npython3 -m venv ~/ansible-venv\nsource ~/ansible-venv/bin/activate\n\n# Install Ansible via pip\npip install --upgrade pip\npip install ansible ansible-core\n\n# Install additional packages\npip install paramiko jinja2 PyYAML cryptography\n\n# Install cloud provider SDKs\npip install boto3 botocore azure-cli google-cloud-storage\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Add to PATH permanently\necho 'source ~/ansible-venv/bin/activate' >> ~/.bashrc\n\n# Verify installation\nansible --version\n```\n\n### Using Docker\n```bash\n# Create Ansible Docker container with mounted volumes\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  --workdir /ansible \\\n  ansible/ansible:latest\n\n# Create wrapper script for ease of use\nsudo tee /usr/local/bin/ansible-docker > /dev/null <<'EOF'\n#!/bin/bash\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  -v ~/.kube:/root/.kube:ro \\\n  --workdir /ansible \\\n  --network host \\\n  ansible/ansible:latest \"$@\"\nEOF\nsudo chmod +x /usr/local/bin/ansible-docker\n\n# Create aliases\necho 'alias ansible=\"ansible-docker ansible\"' >> ~/.bashrc\necho 'alias ansible-playbook=\"ansible-docker ansible-playbook\"' >> ~/.bashrc\n```\n\n## Project Structure and Configuration\n\n### Professional Project Structure\n```bash\n# Create comprehensive Ansible project structure\nmkdir -p ~/ansible-infrastructure/{\n  inventories/{production,staging,development},\n  playbooks,\n  roles,\n  group_vars,\n  host_vars,\n  library,\n  filter_plugins,\n  callback_plugins,\n  vault,\n  collections,\n  logs\n}\n\ncd ~/ansible-infrastructure\n\n# Create ansible.cfg with security best practices\ncat > ansible.cfg <<EOF\n[defaults]\ninventory = inventories/production/hosts.yml\nremote_user = ansible\nprivate_key_file = ~/.ssh/ansible_key\nhost_key_checking = True\ntimeout = 30\nretry_files_enabled = False\nstdout_callback = yaml\nbin_ansible_callbacks = True\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = ~/.ansible/facts_cache\nfact_caching_timeout = 86400\ninterpreter_python = auto_silent\nvault_password_file = ~/.ansible_vault_pass\n\n# Logging\nlog_path = logs/ansible.log\ndisplay_skipped_hosts = False\ndisplay_ok_hosts = False\n\n# Performance\nforks = 20\npoll_interval = 15\ninternal_poll_interval = 0.001\n\n# Security\ncommand_warnings = True\ndeprecation_warnings = True\naction_warnings = True\nlocalhost_warning = True\n\n[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=3600s -o PreferredAuthentications=publickey\npipelining = True\ncontrol_path = ~/.ansible/cp/%%h-%%p-%%r\nretries = 3\n\n[privilege_escalation]\nbecome = False\nbecome_method = sudo\nbecome_user = root\nbecome_ask_pass = False\n\n[inventory]\nenable_plugins = host_list, script, auto, yaml, ini, toml\ncache = True\ncache_plugin = jsonfile\ncache_timeout = 3600\ncache_connection = ~/.ansible/inventory_cache\n\n[galaxy]\nserver_list = automation_hub, galaxy\nEOF\n```\n\n### Advanced Inventory Management\n```bash\n# Create production inventory with groups and variables\ncat > inventories/production/hosts.yml <<EOF\nall:\n  children:\n    webservers:\n      hosts:\n        web-prod-01:\n          ansible_host: 10.0.1.10\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-02:\n          ansible_host: 10.0.1.11\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-03:\n          ansible_host: 10.0.1.12\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n      vars:\n        http_port: 80\n        https_port: 443\n        max_clients: 200\n        environment: production\n        monitoring_enabled: true\n\n    dbservers:\n      hosts:\n        db-prod-01:\n          ansible_host: 10.0.2.10\n          ansible_user: ansible\n          mysql_server_id: 1\n          mysql_role: master\n        db-prod-02:\n          ansible_host: 10.0.2.11\n          ansible_user: ansible\n          mysql_server_id: 2\n          mysql_role: slave\n      vars:\n        mysql_port: 3306\n        mysql_root_password: \"{{ vault_mysql_root_password }}\"\n        mysql_replication_user: \"{{ vault_mysql_replication_user }}\"\n        mysql_replication_password: \"{{ vault_mysql_replication_password }}\"\n\n    loadbalancers:\n      hosts:\n        lb-prod-01:\n          ansible_host: 10.0.3.10\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n        lb-prod-02:\n          ansible_host: 10.0.3.11\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n      vars:\n        haproxy_stats_enabled: true\n        haproxy_stats_user: admin\n        haproxy_stats_password: \"{{ vault_haproxy_stats_password }}\"\n\n    monitoring:\n      hosts:\n        monitor-prod-01:\n          ansible_host: 10.0.4.10\n          ansible_user: ansible\n          prometheus_retention: 30d\n          grafana_admin_password: \"{{ vault_grafana_admin_password }}\"\n\n    bastion:\n      hosts:\n        bastion-prod-01:\n          ansible_host: bastion.example.com\n          ansible_user: ansible\n          ansible_port: 22\n\n# Global variables for all hosts\nwebservers:\n  vars:\n    nginx_worker_processes: auto\n    nginx_worker_connections: 1024\n    ssl_certificate_path: /etc/ssl/certs\n    backup_schedule: \"0 2 * * *\"\n\ndbservers:\n  vars:\n    mysql_innodb_buffer_pool_size: 2G\n    mysql_max_connections: 200\n    backup_schedule: \"0 1 * * *\"\n    monitoring_enabled: true\nEOF\n\n# Create dynamic inventory script for cloud environments\ncat > inventories/production/aws_ec2.yml <<EOF\nplugin: amazon.aws.aws_ec2\nregions:\n  - us-west-2\n  - us-east-1\nfilters:\n  tag:Environment: production\n  tag:Ansible: managed\n  instance-state-name: running\n\nhostnames:\n  - tag:Name\n  - dns-name\n  - private-ip-address\n\ncompose:\n  ansible_host: private_ip_address\n  ec2_state: ec2_state_name\n  ec2_arch: ec2_architecture\n\ngroups:\n  # Group by instance type\n  webservers: \"'web' in tags.Role\"\n  databases: \"'db' in tags.Role\"\n  loadbalancers: \"'lb' in tags.Role\"\n  \n  # Group by environment\n  production: \"tags.Environment == 'production'\"\n  staging: \"tags.Environment == 'staging'\"\n  \n  # Group by availability zone\n  us_west_2a: ec2_placement_availability_zone == \"us-west-2a\"\n  us_west_2b: ec2_placement_availability_zone == \"us-west-2b\"\n\nkeyed_groups:\n  # Create groups based on tags\n  - key: tags.Environment\n    prefix: env\n  - key: tags.Role  \n    prefix: role\n  - key: ec2_instance_type\n    prefix: type\nEOF\n```\n\n### Ansible Vault Security\n```bash\n# Create strong vault password\nopenssl rand -base64 32 > ~/.ansible_vault_pass\nchmod 600 ~/.ansible_vault_pass\n\n# Create encrypted vault file for secrets\nansible-vault create group_vars/all/vault.yml\n# Enter secure passwords and API keys:\n# vault_mysql_root_password: your_secure_mysql_password\n# vault_grafana_admin_password: your_secure_grafana_password  \n# vault_ssl_private_key: |\n#   -----BEGIN PRIVATE KEY-----\n#   your_private_key_content\n#   -----END PRIVATE KEY-----\n\n# Create non-encrypted variables file\ncat > group_vars/all/vars.yml <<EOF\n# Non-sensitive variables\nmysql_port: 3306\nnginx_port: 80\ngrafana_port: 3000\nprometheus_port: 9090\n\n# Reference vault variables\nmysql_root_password: \"{{ vault_mysql_root_password }}\"\ngrafana_admin_password: \"{{ vault_grafana_admin_password }}\"\n\n# SSL configuration\nssl_certificate_path: /etc/ssl/certs/server.crt\nssl_private_key_path: /etc/ssl/private/server.key\nssl_private_key_content: \"{{ vault_ssl_private_key }}\"\n\n# Security settings\nansible_ssh_common_args: '-o StrictHostKeyChecking=yes -o UserKnownHostsFile=~/.ssh/known_hosts'\nansible_become_method: sudo\nansible_become_user: root\nEOF\n\n# Edit vault file\nansible-vault edit group_vars/all/vault.yml\n\n# View vault file (read-only)\nansible-vault view group_vars/all/vault.yml\n\n# Change vault password\nansible-vault rekey group_vars/all/vault.yml\n```\n\n## Comprehensive Playbooks\n\n### System Hardening Playbook\n```bash\ncat > playbooks/system-hardening.yml <<EOF\n---\n- name: System Security Hardening\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    security_packages:\n      - fail2ban\n      - ufw\n      - aide\n      - chkrootkit\n      - rkhunter\n      - clamav\n      - lynis\n    \n    disabled_services:\n      - telnet\n      - rsh\n      - rlogin\n      - tftp\n      - talk\n      - finger\n\n  pre_tasks:\n    - name: Update package cache\n      package:\n        update_cache: yes\n        cache_valid_time: 3600\n      when: ansible_os_family in [\"Debian\", \"RedHat\"]\n\n  tasks:\n    # System updates\n    - name: Upgrade all packages\n      package:\n        name: \"*\"\n        state: latest\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Upgrade all packages (Debian/Ubuntu)\n      apt:\n        upgrade: dist\n        autoremove: yes\n        autoclean: yes\n      when: ansible_os_family == \"Debian\"\n\n    # Install security packages\n    - name: Install security packages\n      package:\n        name: \"{{ security_packages }}\"\n        state: present\n\n    # User security\n    - name: Create ansible user with limited privileges\n      user:\n        name: ansible\n        groups: sudo\n        shell: /bin/bash\n        create_home: yes\n        generate_ssh_key: yes\n        ssh_key_bits: 4096\n        ssh_key_type: rsa\n\n    - name: Configure sudo for ansible user\n      lineinfile:\n        path: /etc/sudoers.d/ansible\n        line: 'ansible ALL=(ALL) NOPASSWD:ALL'\n        create: yes\n        mode: '0440'\n        validate: 'visudo -cf %s'\n\n    # SSH hardening\n    - name: Configure SSH security\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: \"{{ item.regexp }}\"\n        line: \"{{ item.line }}\"\n        backup: yes\n      loop:\n        - { regexp: '^#?PermitRootLogin', line: 'PermitRootLogin no' }\n        - { regexp: '^#?PasswordAuthentication', line: 'PasswordAuthentication no' }\n        - { regexp: '^#?X11Forwarding', line: 'X11Forwarding no' }\n        - { regexp: '^#?MaxAuthTries', line: 'MaxAuthTries 3' }\n        - { regexp: '^#?ClientAliveInterval', line: 'ClientAliveInterval 300' }\n        - { regexp: '^#?ClientAliveCountMax', line: 'ClientAliveCountMax 0' }\n        - { regexp: '^#?Protocol', line: 'Protocol 2' }\n        - { regexp: '^#?LogLevel', line: 'LogLevel VERBOSE' }\n      notify: restart ssh\n\n    # Firewall configuration\n    - name: Configure UFW firewall (Debian/Ubuntu)\n      ufw:\n        state: enabled\n        policy: deny\n        direction: incoming\n      when: ansible_os_family == \"Debian\"\n\n    - name: Allow SSH through UFW\n      ufw:\n        rule: allow\n        port: 22\n        proto: tcp\n        comment: 'SSH access'\n      when: ansible_os_family == \"Debian\"\n\n    - name: Configure firewalld (RHEL/CentOS/Fedora)\n      firewalld:\n        state: enabled\n        permanent: yes\n        immediate: yes\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Allow SSH through firewalld\n      firewalld:\n        service: ssh\n        permanent: yes\n        state: enabled\n        immediate: yes\n      when: ansible_os_family == \"RedHat\"\n\n    # Disable unnecessary services\n    - name: Disable unnecessary services\n      systemd:\n        name: \"{{ item }}\"\n        enabled: no\n        state: stopped\n      loop: \"{{ disabled_services }}\"\n      ignore_errors: yes\n\n    # File system security\n    - name: Set proper permissions on sensitive files\n      file:\n        path: \"{{ item.path }}\"\n        mode: \"{{ item.mode }}\"\n        owner: root\n        group: root\n      loop:\n        - { path: '/etc/passwd', mode: '0644' }\n        - { path: '/etc/shadow', mode: '0640' }\n        - { path: '/etc/group', mode: '0644' }\n        - { path: '/etc/gshadow', mode: '0640' }\n        - { path: '/etc/ssh/sshd_config', mode: '0600' }\n\n    # Kernel security parameters\n    - name: Configure kernel security parameters\n      sysctl:\n        name: \"{{ item.key }}\"\n        value: \"{{ item.value }}\"\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: 'net.ipv4.ip_forward', value: '0' }\n        - { key: 'net.ipv4.conf.all.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.accept_source_route', value: '0' }\n        - { key: 'net.ipv4.conf.default.accept_source_route', value: '0' }\n        - { key: 'net.ipv4.conf.all.accept_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.accept_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.secure_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.secure_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.default.log_martians', value: '1' }\n        - { key: 'kernel.randomize_va_space', value: '2' }\n\n    # Configure fail2ban\n    - name: Configure fail2ban for SSH protection\n      template:\n        src: templates/fail2ban-jail.local.j2\n        dest: /etc/fail2ban/jail.local\n        backup: yes\n      notify: restart fail2ban\n\n  handlers:\n    - name: restart ssh\n      service:\n        name: \"{{ 'ssh' if ansible_os_family == 'Debian' else 'sshd' }}\"\n        state: restarted\n\n    - name: restart fail2ban\n      service:\n        name: fail2ban\n        state: restarted\nEOF\n```\n\n### Application Deployment Playbook\n```bash\ncat > playbooks/web-application-deployment.yml <<EOF\n---\n- name: Deploy Web Application Stack\n  hosts: webservers\n  become: yes\n  serial: \"25%\"  # Rolling deployment\n  max_fail_percentage: 10\n  vars:\n    app_name: mywebapp\n    app_version: \"{{ app_version | default('latest') }}\"\n    app_port: 3000\n    nginx_workers: \"{{ ansible_processor_cores }}\"\n    \n  pre_tasks:\n    - name: Check if maintenance mode file exists\n      stat:\n        path: /var/www/html/maintenance.html\n      register: maintenance_mode\n\n    - name: Fail if in maintenance mode\n      fail:\n        msg: \"Server is in maintenance mode\"\n      when: maintenance_mode.stat.exists and not force_deployment | default(false)\n\n  tasks:\n    # Application deployment\n    - name: Create application user\n      user:\n        name: \"{{ app_name }}\"\n        system: yes\n        shell: /bin/false\n        home: \"/opt/{{ app_name }}\"\n        create_home: yes\n\n    - name: Create application directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        mode: '0755'\n      loop:\n        - \"/opt/{{ app_name }}\"\n        - \"/opt/{{ app_name }}/releases\"\n        - \"/opt/{{ app_name }}/shared\"\n        - \"/var/log/{{ app_name }}\"\n\n    - name: Download application release\n      get_url:\n        url: \"https://releases.example.com/{{ app_name }}/{{ app_version }}/{{ app_name }}-{{ app_version }}.tar.gz\"\n        dest: \"/tmp/{{ app_name }}-{{ app_version }}.tar.gz\"\n        mode: '0644'\n        timeout: 300\n      register: download_result\n\n    - name: Extract application\n      unarchive:\n        src: \"/tmp/{{ app_name }}-{{ app_version }}.tar.gz\"\n        dest: \"/opt/{{ app_name }}/releases/\"\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        remote_src: yes\n        creates: \"/opt/{{ app_name }}/releases/{{ app_version }}\"\n\n    - name: Create symlink to current release\n      file:\n        src: \"/opt/{{ app_name }}/releases/{{ app_version }}\"\n        dest: \"/opt/{{ app_name }}/current\"\n        state: link\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n      notify:\n        - reload application\n        - reload nginx\n\n    # Configuration management\n    - name: Deploy application configuration\n      template:\n        src: \"templates/{{ app_name }}.conf.j2\"\n        dest: \"/opt/{{ app_name }}/shared/{{ app_name }}.conf\"\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        mode: '0640'\n        backup: yes\n      notify: reload application\n\n    # Service management\n    - name: Deploy systemd service file\n      template:\n        src: \"templates/{{ app_name }}.service.j2\"\n        dest: \"/etc/systemd/system/{{ app_name }}.service\"\n        mode: '0644'\n      notify:\n        - daemon reload\n        - restart application\n\n    - name: Enable and start application service\n      systemd:\n        name: \"{{ app_name }}\"\n        enabled: yes\n        state: started\n        daemon_reload: yes\n\n    # Health check\n    - name: Wait for application to be ready\n      uri:\n        url: \"http://localhost:{{ app_port }}/health\"\n        method: GET\n        status_code: 200\n      retries: 30\n      delay: 10\n\n    # Cleanup old releases\n    - name: Clean up old releases (keep last 3)\n      shell: |\n        cd /opt/{{ app_name }}/releases\n        ls -t | tail -n +4 | xargs rm -rf\n      args:\n        executable: /bin/bash\n\n  post_tasks:\n    - name: Verify application is running\n      uri:\n        url: \"http://{{ ansible_default_ipv4.address }}:{{ app_port }}/health\"\n        method: GET\n        status_code: 200\n      delegate_to: localhost\n\n    - name: Log deployment success\n      lineinfile:\n        path: \"/var/log/{{ app_name }}/deployments.log\"\n        line: \"{{ ansible_date_time.iso8601 }} - Successfully deployed {{ app_version }} to {{ inventory_hostname }}\"\n        create: yes\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart application\n      systemd:\n        name: \"{{ app_name }}\"\n        state: restarted\n\n    - name: reload application\n      systemd:\n        name: \"{{ app_name }}\"\n        state: reloaded\n\n    - name: reload nginx\n      service:\n        name: nginx\n        state: reloaded\nEOF\n```\n\n### Infrastructure as Code Playbook\n```bash\ncat > playbooks/infrastructure-provisioning.yml <<EOF\n---\n- name: Infrastructure Provisioning and Configuration\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  vars:\n    base_packages:\n      Debian:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n      RedHat:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n        - epel-release\n\n  tasks:\n    # System preparation\n    - name: Set hostname\n      hostname:\n        name: \"{{ inventory_hostname }}\"\n\n    - name: Update /etc/hosts\n      lineinfile:\n        path: /etc/hosts\n        line: \"{{ ansible_default_ipv4.address }} {{ inventory_hostname }}\"\n        backup: yes\n\n    # Package management\n    - name: Install base packages\n      package:\n        name: \"{{ base_packages[ansible_os_family] | default(base_packages['Debian']) }}\"\n        state: present\n\n    # Time synchronization\n    - name: Install and configure NTP\n      package:\n        name: \"{{ 'ntp' if ansible_os_family == 'Debian' else 'chrony' }}\"\n        state: present\n\n    - name: Start and enable time synchronization\n      service:\n        name: \"{{ 'ntp' if ansible_os_family == 'Debian' else 'chronyd' }}\"\n        state: started\n        enabled: yes\n\n    # Log management\n    - name: Configure logrotate for application logs\n      template:\n        src: templates/app-logrotate.j2\n        dest: /etc/logrotate.d/applications\n        mode: '0644'\n\n    # Monitoring agent installation\n    - name: Install Node Exporter for Prometheus monitoring\n      get_url:\n        url: \"https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz\"\n        dest: /tmp/node_exporter.tar.gz\n        mode: '0644'\n\n    - name: Extract Node Exporter\n      unarchive:\n        src: /tmp/node_exporter.tar.gz\n        dest: /tmp\n        remote_src: yes\n\n    - name: Copy Node Exporter binary\n      copy:\n        src: /tmp/node_exporter-1.6.1.linux-amd64/node_exporter\n        dest: /usr/local/bin/node_exporter\n        mode: '0755'\n        owner: root\n        group: root\n        remote_src: yes\n\n    - name: Create node_exporter systemd service\n      template:\n        src: templates/node_exporter.service.j2\n        dest: /etc/systemd/system/node_exporter.service\n        mode: '0644'\n      notify:\n        - daemon reload\n        - restart node_exporter\n\n    # Security configuration\n    - name: Configure kernel parameters for security\n      sysctl:\n        name: \"{{ item.key }}\"\n        value: \"{{ item.value }}\"\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: 'kernel.dmesg_restrict', value: '1' }\n        - { key: 'kernel.kptr_restrict', value: '2' }\n        - { key: 'kernel.yama.ptrace_scope', value: '1' }\n        - { key: 'net.ipv4.conf.all.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.default.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.all.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.send_redirects', value: '0' }\n\n    # File integrity monitoring\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \"AIDE integrity check\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/bin/aide --check\"\n        user: root\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart node_exporter\n      service:\n        name: node_exporter\n        state: restarted\n        enabled: yes\nEOF\n```\n\n## Advanced Role Development\n\n### Comprehensive NGINX Role\n```bash\n# Create NGINX role structure\nansible-galaxy init roles/nginx\n\n# Main tasks\ncat > roles/nginx/tasks/main.yml <<EOF\n---\n# NGINX Installation and Configuration Role\n- name: Include OS-specific variables\n  include_vars: \"{{ ansible_os_family }}.yml\"\n\n- name: Install NGINX\n  include_tasks: \"install-{{ ansible_os_family }}.yml\"\n\n- name: Create NGINX directories\n  file:\n    path: \"{{ item }}\"\n    state: directory\n    owner: root\n    group: root\n    mode: '0755'\n  loop:\n    - /etc/nginx/sites-available\n    - /etc/nginx/sites-enabled\n    - /etc/nginx/conf.d\n    - /var/log/nginx\n    - /var/cache/nginx\n\n- name: Generate DH parameters\n  openssl_dhparam:\n    path: /etc/ssl/certs/dhparam.pem\n    size: 2048\n  when: nginx_ssl_enabled | default(false)\n\n- name: Deploy NGINX main configuration\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n    backup: yes\n    validate: 'nginx -t -c %s'\n  notify: reload nginx\n\n- name: Deploy virtual host configurations\n  template:\n    src: vhost.conf.j2\n    dest: \"/etc/nginx/sites-available/{{ item.name }}.conf\"\n    backup: yes\n  loop: \"{{ nginx_vhosts | default([]) }}\"\n  notify: reload nginx\n\n- name: Enable virtual hosts\n  file:\n    src: \"/etc/nginx/sites-available/{{ item.name }}.conf\"\n    dest: \"/etc/nginx/sites-enabled/{{ item.name }}.conf\"\n    state: link\n  loop: \"{{ nginx_vhosts | default([]) }}\"\n  when: item.enabled | default(true)\n  notify: reload nginx\n\n- name: Remove default site\n  file:\n    path: /etc/nginx/sites-enabled/default\n    state: absent\n  notify: reload nginx\n\n- name: Start and enable NGINX\n  service:\n    name: nginx\n    state: started\n    enabled: yes\n\n- name: Configure log rotation\n  template:\n    src: nginx-logrotate.j2\n    dest: /etc/logrotate.d/nginx\n    mode: '0644'\n\n- name: Setup NGINX monitoring\n  include_tasks: monitoring.yml\n  when: nginx_monitoring_enabled | default(false)\n\n- name: Configure SSL certificates\n  include_tasks: ssl.yml\n  when: nginx_ssl_enabled | default(false)\nEOF\n\n# OS-specific installation tasks\ncat > roles/nginx/tasks/install-Debian.yml <<EOF\n---\n- name: Add NGINX signing key (Debian/Ubuntu)\n  apt_key:\n    url: https://nginx.org/keys/nginx_signing.key\n    state: present\n\n- name: Add NGINX repository (Debian/Ubuntu)\n  apt_repository:\n    repo: \"deb https://nginx.org/packages/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx\"\n    state: present\n\n- name: Install NGINX (Debian/Ubuntu)\n  apt:\n    name: nginx\n    state: present\n    update_cache: yes\nEOF\n\ncat > roles/nginx/tasks/install-RedHat.yml <<EOF\n---\n- name: Add NGINX repository (RHEL/CentOS)\n  yum_repository:\n    name: nginx\n    description: NGINX Repository\n    baseurl: \"https://nginx.org/packages/centos/{{ ansible_distribution_major_version }}/$basearch/\"\n    gpgcheck: yes\n    gpgkey: https://nginx.org/keys/nginx_signing.key\n    enabled: yes\n\n- name: Install NGINX (RHEL/CentOS)\n  yum:\n    name: nginx\n    state: present\nEOF\n\n# Variables\ncat > roles/nginx/vars/main.yml <<EOF\n---\nnginx_user: nginx\nnginx_worker_processes: auto\nnginx_worker_connections: 1024\nnginx_keepalive_timeout: 65\nnginx_ssl_enabled: false\nnginx_monitoring_enabled: true\n\nnginx_security_headers:\n  - \"add_header X-Frame-Options SAMEORIGIN always;\"\n  - \"add_header X-Content-Type-Options nosniff always;\"\n  - \"add_header X-XSS-Protection '1; mode=block' always;\"\n  - \"add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains' always;\"\n\nnginx_default_vhost:\n  name: default\n  listen: 80\n  server_name: \"_\"\n  root: /var/www/html\n  index: index.html\n  enabled: false\nEOF\n\n# Templates\ncat > roles/nginx/templates/nginx.conf.j2 <<EOF\nuser {{ nginx_user }};\nworker_processes {{ nginx_worker_processes }};\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections {{ nginx_worker_connections }};\n    use epoll;\n    multi_accept on;\n}\n\nhttp {\n    # Basic settings\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout {{ nginx_keepalive_timeout }};\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # SSL configuration\n{% if nginx_ssl_enabled %}\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers off;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n{% endif %}\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types\n        application/javascript\n        application/json\n        application/xml\n        text/css\n        text/javascript\n        text/xml\n        text/plain;\n\n    # Security headers\n{% for header in nginx_security_headers %}\n    {{ header }}\n{% endfor %}\n\n    # Logging\n    log_format main '\\$remote_addr - \\$remote_user [\\$time_local] \"\\$request\" '\n                    '\\$status \\$body_bytes_sent \"\\$http_referer\" '\n                    '\"\\$http_user_agent\" \"\\$http_x_forwarded_for\"';\n\n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log;\n\n    # Rate limiting\n    limit_req_zone \\$binary_remote_addr zone=login:10m rate=10r/m;\n    limit_conn_zone \\$binary_remote_addr zone=addr:10m;\n\n    # Include configurations\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\nEOF\n\n# Handlers\ncat > roles/nginx/handlers/main.yml <<EOF\n---\n- name: restart nginx\n  service:\n    name: nginx\n    state: restarted\n\n- name: reload nginx\n  service:\n    name: nginx\n    state: reloaded\n\n- name: validate nginx config\n  command: nginx -t\n  changed_when: false\nEOF\n```\n\n## Security and Compliance\n\n### Ansible Security Scanner Integration\n```bash\n# Create security scanning playbook\ncat > playbooks/security-scan.yml <<EOF\n---\n- name: Security Compliance Scanning\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    scan_results_dir: \"/tmp/security-scans\"\n    \n  tasks:\n    - name: Create scan results directory\n      file:\n        path: \"{{ scan_results_dir }}\"\n        state: directory\n        mode: '0755'\n\n    # CIS benchmark scanning\n    - name: Download CIS benchmark script\n      get_url:\n        url: \"https://github.com/dev-sec/cis-dil-benchmark/archive/master.zip\"\n        dest: \"/tmp/cis-benchmark.zip\"\n        mode: '0644'\n\n    - name: Run CIS benchmark scan\n      shell: |\n        cd /tmp\n        unzip -o cis-benchmark.zip\n        cd cis-dil-benchmark-master\n        bash cis_ubuntu2204.sh > {{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\n      args:\n        creates: \"{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\"\n\n    # Lynis security audit\n    - name: Install Lynis\n      package:\n        name: lynis\n        state: present\n\n    - name: Run Lynis security audit\n      command: lynis audit system --quiet --cronjob\n      register: lynis_result\n      changed_when: false\n\n    - name: Save Lynis results\n      copy:\n        content: \"{{ lynis_result.stdout }}\"\n        dest: \"{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\"\n        mode: '0644'\n\n    # OpenSCAP compliance scanning\n    - name: Install OpenSCAP (RHEL/CentOS)\n      package:\n        name:\n          - openscap-scanner\n          - scap-security-guide\n        state: present\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Install OpenSCAP (Debian/Ubuntu)\n      package:\n        name:\n          - libopenscap8\n          - ssg-debian\n        state: present\n      when: ansible_os_family == \"Debian\"\n\n    - name: Run OpenSCAP scan\n      shell: |\n        oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard \\\n          --results {{ scan_results_dir }}/oscap-results-{{ inventory_hostname }}.xml \\\n          --report {{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html \\\n          /usr/share/xml/scap/ssg/content/ssg-{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}-xccdf.xml\n      ignore_errors: yes\n      when: ansible_os_family in [\"RedHat\", \"Debian\"]\n\n    # Vulnerability scanning with Trivy\n    - name: Install Trivy vulnerability scanner\n      shell: |\n        curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin\n      args:\n        creates: /usr/local/bin/trivy\n\n    - name: Run Trivy filesystem scan\n      shell: |\n        trivy fs --format json --output {{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json /\n      ignore_errors: yes\n\n    # Collect scan results\n    - name: Fetch scan results to control machine\n      fetch:\n        src: \"{{ item }}\"\n        dest: \"./security-reports/{{ inventory_hostname }}/\"\n        flat: yes\n      loop:\n        - \"{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\"\n        - \"{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\"\n        - \"{{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html\"\n        - \"{{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json\"\n      ignore_errors: yes\n      delegate_to: localhost\n\n  post_tasks:\n    - name: Generate compliance summary\n      template:\n        src: templates/compliance-summary.j2\n        dest: \"{{ scan_results_dir }}/compliance-summary-{{ inventory_hostname }}.txt\"\n        mode: '0644'\nEOF\n```\n\n### Ansible AWX/Tower Integration\n```bash\n# Install Ansible AWX (open source)\ncat > playbooks/install-awx.yml <<EOF\n---\n- name: Install Ansible AWX\n  hosts: localhost\n  connection: local\n  become: yes\n  vars:\n    awx_namespace: awx\n    awx_admin_user: admin\n    awx_admin_password: \"{{ vault_awx_admin_password }}\"\n\n  tasks:\n    - name: Install prerequisite packages\n      package:\n        name:\n          - git\n          - curl\n          - docker.io\n          - docker-compose\n        state: present\n\n    - name: Clone AWX repository\n      git:\n        repo: https://github.com/ansible/awx.git\n        dest: /opt/awx\n        version: devel\n\n    - name: Create AWX Docker inventory\n      template:\n        src: templates/awx-docker-inventory.j2\n        dest: /opt/awx/installer/inventory\n        mode: '0644'\n\n    - name: Install AWX using Ansible\n      shell: ansible-playbook -i inventory install.yml\n      args:\n        chdir: /opt/awx/installer\n      environment:\n        ANSIBLE_HOST_KEY_CHECKING: False\n\n    - name: Wait for AWX to be ready\n      uri:\n        url: \"http://localhost:80/api/v2/ping/\"\n        method: GET\n      retries: 30\n      delay: 10\n\n    - name: Configure AWX organizations and projects\n      uri:\n        url: \"http://localhost:80/api/v2/organizations/\"\n        method: POST\n        user: \"{{ awx_admin_user }}\"\n        password: \"{{ awx_admin_password }}\"\n        force_basic_auth: yes\n        body_format: json\n        body:\n          name: \"Production\"\n          description: \"Production environment organization\"\n        status_code: [200, 201, 409]\nEOF\n```\n\n## Multi-Cloud Automation\n\n### AWS Infrastructure Automation\n```bash\ncat > playbooks/aws-infrastructure.yml <<EOF\n---\n- name: AWS Infrastructure Automation\n  hosts: localhost\n  connection: local\n  gather_facts: no\n  vars:\n    aws_region: \"{{ aws_region | default('us-west-2') }}\"\n    vpc_cidr: \"{{ vpc_cidr | default('10.0.0.0/16') }}\"\n    environment: \"{{ environment | default('production') }}\"\n\n  tasks:\n    # VPC Creation\n    - name: Create VPC\n      amazon.aws.ec2_vpc_info:\n        filters:\n          \"tag:Name\": \"{{ environment }}-vpc\"\n        region: \"{{ aws_region }}\"\n      register: existing_vpc\n\n    - name: Create new VPC if not exists\n      amazon.aws.ec2_vpc_net:\n        name: \"{{ environment }}-vpc\"\n        cidr_block: \"{{ vpc_cidr }}\"\n        region: \"{{ aws_region }}\"\n        state: present\n        dns_hostnames: yes\n        dns_support: yes\n        tags:\n          Environment: \"{{ environment }}\"\n          ManagedBy: ansible\n      register: vpc\n      when: existing_vpc.vpcs | length == 0\n\n    # Security Groups\n    - name: Create web security group\n      amazon.aws.ec2_group:\n        name: \"{{ environment }}-web-sg\"\n        description: \"Security group for web servers\"\n        vpc_id: \"{{ vpc.vpc.id if vpc.vpc is defined else existing_vpc.vpcs[0].vpc_id }}\"\n        region: \"{{ aws_region }}\"\n        rules:\n          - proto: tcp\n            ports:\n              - 80\n              - 443\n            cidr_ip: 0.0.0.0/0\n            rule_desc: \"HTTP and HTTPS access\"\n          - proto: tcp\n            ports:\n              - 22\n            group_id: \"{{ environment }}-bastion-sg\"\n            rule_desc: \"SSH from bastion\"\n        tags:\n          Environment: \"{{ environment }}\"\n\n    # Launch EC2 instances\n    - name: Launch web servers\n      amazon.aws.ec2_instance:\n        name: \"{{ environment }}-web-{{ item }}\"\n        instance_type: t3.medium\n        image_id: ami-0c02fb55956c7d316  # Amazon Linux 2\n        key_name: \"{{ ec2_key_name }}\"\n        vpc_subnet_id: \"{{ web_subnet_id }}\"\n        security_groups:\n          - \"{{ environment }}-web-sg\"\n        region: \"{{ aws_region }}\"\n        state: running\n        wait: yes\n        wait_timeout: 300\n        user_data: |\n          #!/bin/bash\n          yum update -y\n          yum install -y python3\n        tags:\n          Environment: \"{{ environment }}\"\n          Role: webserver\n          Ansible: managed\n      loop: \"{{ range(1, web_server_count + 1) | list }}\"\n      register: web_instances\n\n    # Add instances to inventory\n    - name: Add web servers to inventory\n      add_host:\n        name: \"{{ item.instances[0].tags.Name }}\"\n        hostname: \"{{ item.instances[0].public_ip_address }}\"\n        groups: webservers\n        ansible_ssh_private_key_file: \"~/.ssh/{{ ec2_key_name }}.pem\"\n        ansible_user: ec2-user\n      loop: \"{{ web_instances.results }}\"\n      changed_when: false\nEOF\n```\n\n### Kubernetes Cluster Management\n```bash\ncat > playbooks/k8s-cluster-management.yml <<EOF\n---\n- name: Kubernetes Cluster Management with Ansible\n  hosts: k8s_masters\n  become: yes\n  serial: 1\n  vars:\n    k8s_version: \"1.28.2\"\n    containerd_version: \"1.6.24\"\n    cni_version: \"1.3.0\"\n\n  tasks:\n    # Pre-flight checks\n    - name: Check system requirements\n      assert:\n        that:\n          - ansible_memtotal_mb >= 1700\n          - ansible_processor_cores >= 2\n        fail_msg: \"System doesn't meet minimum requirements\"\n\n    - name: Verify connectivity to all nodes\n      ping:\n      delegate_to: \"{{ item }}\"\n      loop: \"{{ groups['k8s_all'] }}\"\n\n    # Container runtime setup\n    - name: Install containerd\n      include_role:\n        name: containerd\n      vars:\n        containerd_version: \"{{ containerd_version }}\"\n\n    # Kubernetes installation\n    - name: Install Kubernetes components\n      include_role:\n        name: kubernetes\n      vars:\n        kubernetes_version: \"{{ k8s_version }}\"\n\n    # Cluster initialization\n    - name: Initialize Kubernetes cluster\n      shell: |\n        kubeadm init \\\n          --pod-network-cidr=10.244.0.0/16 \\\n          --service-cidr=10.96.0.0/12 \\\n          --apiserver-advertise-address={{ ansible_default_ipv4.address }} \\\n          --node-name={{ inventory_hostname }}\n      args:\n        creates: /etc/kubernetes/admin.conf\n      register: kubeadm_init\n\n    - name: Create .kube directory\n      file:\n        path: \"{{ ansible_env.HOME }}/.kube\"\n        state: directory\n        mode: '0755'\n\n    - name: Copy admin.conf to user's kube config\n      copy:\n        src: /etc/kubernetes/admin.conf\n        dest: \"{{ ansible_env.HOME }}/.kube/config\"\n        owner: \"{{ ansible_user }}\"\n        group: \"{{ ansible_user }}\"\n        mode: '0644'\n        remote_src: yes\n\n    # Network plugin installation\n    - name: Install Flannel CNI\n      shell: kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n      environment:\n        KUBECONFIG: \"{{ ansible_env.HOME }}/.kube/config\"\n\n    # Join worker nodes\n    - name: Get join command\n      shell: kubeadm token create --print-join-command\n      register: join_command\n      when: inventory_hostname in groups['k8s_masters'][0]\n\n    - name: Join worker nodes to cluster\n      shell: \"{{ hostvars[groups['k8s_masters'][0]]['join_command'].stdout }}\"\n      when: inventory_hostname in groups['k8s_workers']\n\n  post_tasks:\n    - name: Verify cluster status\n      shell: kubectl get nodes\n      environment:\n        KUBECONFIG: \"{{ ansible_env.HOME }}/.kube/config\"\n      register: cluster_status\n      when: inventory_hostname in groups['k8s_masters'][0]\n\n    - name: Display cluster status\n      debug:\n        var: cluster_status.stdout_lines\n      when: inventory_hostname in groups['k8s_masters'][0]\nEOF\n```\n\n## Performance Optimization and Scaling\n\n### Parallel Execution Strategies\n```bash\n# Create high-performance playbook configuration\ncat > playbooks/high-performance-deployment.yml <<EOF\n---\n- name: High-Performance Deployment\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  serial: \"30%\"   # Process 30% of hosts at a time\n  max_fail_percentage: 10\n  gather_facts: yes\n  fact_caching: smart\n  vars:\n    deployment_batch_size: 10\n    max_concurrent_tasks: 50\n\n  pre_tasks:\n    - name: Check system load\n      shell: uptime | awk '{print $(NF-2)}' | sed 's/,//'\n      register: system_load\n      changed_when: false\n\n    - name: Skip high-load systems\n      meta: end_host\n      when: system_load.stdout | float > 5.0\n\n  tasks:\n    - name: Update packages with retries\n      package:\n        name: \"*\"\n        state: latest\n      retries: 3\n      delay: 30\n      async: 300\n      poll: 10\n\n    - name: Deploy configuration files in parallel\n      template:\n        src: \"{{ item.src }}\"\n        dest: \"{{ item.dest }}\"\n        mode: \"{{ item.mode | default('0644') }}\"\n        backup: yes\n      loop:\n        - { src: \"nginx.conf.j2\", dest: \"/etc/nginx/nginx.conf\" }\n        - { src: \"mysql.cnf.j2\", dest: \"/etc/mysql/my.cnf\" }\n        - { src: \"redis.conf.j2\", dest: \"/etc/redis/redis.conf\" }\n      async: 120\n      poll: 5\n      register: config_deployment\n\n    - name: Wait for all configuration deployments\n      async_status:\n        jid: \"{{ item.ansible_job_id }}\"\n      loop: \"{{ config_deployment.results }}\"\n      when: item.ansible_job_id is defined\n\n  handlers:\n    - name: restart services\n      service:\n        name: \"{{ item }}\"\n        state: restarted\n      loop:\n        - nginx\n        - mysql\n        - redis\n      listen: \"restart all services\"\nEOF\n\n# Performance monitoring playbook\ncat > playbooks/performance-monitoring.yml <<EOF\n---\n- name: Performance Monitoring Setup\n  hosts: all\n  become: yes\n  vars:\n    monitoring_tools:\n      - htop\n      - iotop\n      - nethogs\n      - dstat\n      - sysstat\n      - perf\n\n  tasks:\n    - name: Install performance monitoring tools\n      package:\n        name: \"{{ monitoring_tools }}\"\n        state: present\n\n    - name: Configure system monitoring\n      template:\n        src: templates/sysstat.j2\n        dest: /etc/default/sysstat\n        backup: yes\n      when: ansible_os_family == \"Debian\"\n\n    - name: Enable system statistics collection\n      service:\n        name: \"{{ 'sysstat' if ansible_os_family == 'Debian' else 'sysstat' }}\"\n        enabled: yes\n        state: started\n\n    - name: Create performance monitoring script\n      template:\n        src: templates/performance-monitor.sh.j2\n        dest: /usr/local/bin/performance-monitor.sh\n        mode: '0755'\n\n    - name: Schedule performance monitoring\n      cron:\n        name: \"Performance monitoring\"\n        minute: \"*/5\"\n        job: \"/usr/local/bin/performance-monitor.sh\"\n        user: root\nEOF\n```\n\n## Testing and Validation\n\n### Molecule Testing Framework\n```bash\n# Install Molecule for role testing\npip install molecule[docker] molecule[vagrant] molecule[libvirt]\n\n# Initialize Molecule in role directory\ncd roles/nginx\nmolecule init scenario --driver-name docker\n\n# Create molecule configuration\ncat > molecule/default/molecule.yml <<EOF\n---\ndependency:\n  name: galaxy\ndriver:\n  name: docker\nplatforms:\n  - name: nginx-ubuntu\n    image: ubuntu:22.04\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /lib/systemd/systemd\n    networks:\n      - name: molecule\n  - name: nginx-centos\n    image: centos:8\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /usr/sbin/init\n    networks:\n      - name: molecule\nprovisioner:\n  name: ansible\n  config_options:\n    defaults:\n      callbacks_enabled: profile_tasks,timer,yaml\n  inventory:\n    host_vars:\n      nginx-ubuntu:\n        ansible_python_interpreter: /usr/bin/python3\n      nginx-centos:\n        ansible_python_interpreter: /usr/bin/python3\nverifier:\n  name: ansible\nlint: |\n  set -e\n  yamllint .\n  ansible-lint\n  flake8\nEOF\n\n# Create test playbook\ncat > molecule/default/converge.yml <<EOF\n---\n- name: Converge\n  hosts: all\n  become: true\n  tasks:\n    - name: \"Include nginx role\"\n      include_role:\n        name: nginx\n      vars:\n        nginx_vhosts:\n          - name: default\n            server_name: localhost\n            listen: 80\n            root: /var/www/html\n            enabled: true\nEOF\n\n# Create test verification\ncat > molecule/default/verify.yml <<EOF\n---\n- name: Verify\n  hosts: all\n  gather_facts: false\n  tasks:\n    - name: Check if NGINX is running\n      uri:\n        url: http://localhost\n        method: GET\n      register: nginx_check\n\n    - name: Verify NGINX is responding\n      assert:\n        that:\n          - nginx_check.status == 200\n        fail_msg: \"NGINX is not responding correctly\"\n\n    - name: Check NGINX configuration\n      shell: nginx -t\n      changed_when: false\n\n    - name: Verify NGINX process\n      shell: pgrep nginx\n      changed_when: false\nEOF\n\n# Run tests\nmolecule test\n```\n\n### Ansible Lint and Security Scanning\n```bash\n# Install Ansible Lint\npip install ansible-lint\n\n# Create .ansible-lint configuration\ncat > .ansible-lint <<EOF\n---\nprofile: production\n\nexclude_paths:\n  - .cache/\n  - .github/\n  - molecule/\n  - .venv/\n\nskip_list:\n  - yaml[line-length]  # Allow longer lines for readability\n\nwarn_list:\n  - experimental  # Warn about experimental features\n\n# Custom rules\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments:\n    min-spaces-from-content: 1\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  trailing-spaces: enable\n  truthy:\n    allowed-values: ['true', 'false', 'yes', 'no']\nEOF\n\n# Create security-focused playbook linting\ncat > .yamllint <<EOF\n---\nextends: default\n\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments: disable\n  comments-indentation: disable\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n    check-multi-line-strings: false\n  key-duplicates: enable\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  octal-values:\n    forbid-implicit-octal: true\n  trailing-spaces: enable\n  truthy: disable\nEOF\n\n# Run linting\nansible-lint playbooks/\nyamllint .\n```\n\n## Backup and Disaster Recovery\n\n### Comprehensive Backup Automation\n```bash\ncat > playbooks/backup-automation.yml <<EOF\n---\n- name: Automated Backup System\n  hosts: all\n  become: yes\n  vars:\n    backup_root: /backup\n    backup_retention_days: 30\n    backup_schedule:\n      databases: \"0 2 * * *\"\n      files: \"0 3 * * *\"\n      configs: \"0 4 * * *\"\n\n  tasks:\n    - name: Create backup directories\n      file:\n        path: \"{{ backup_root }}/{{ item }}\"\n        state: directory\n        mode: '0755'\n        owner: root\n        group: root\n      loop:\n        - databases\n        - files\n        - configs\n        - logs\n\n    # Database backups\n    - name: Create database backup script\n      template:\n        src: templates/mysql-backup.sh.j2\n        dest: /usr/local/bin/mysql-backup.sh\n        mode: '0755'\n      when: \"'dbservers' in group_names\"\n\n    - name: Schedule database backups\n      cron:\n        name: \"MySQL backup\"\n        minute: \"0\"\n        hour: \"2\"\n        job: \"/usr/local/bin/mysql-backup.sh\"\n        user: root\n      when: \"'dbservers' in group_names\"\n\n    # File system backups\n    - name: Create file backup script\n      template:\n        src: templates/file-backup.sh.j2\n        dest: /usr/local/bin/file-backup.sh\n        mode: '0755'\n\n    - name: Schedule file backups\n      cron:\n        name: \"File system backup\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/local/bin/file-backup.sh\"\n        user: root\n\n    # Configuration backups\n    - name: Backup system configurations\n      archive:\n        path:\n          - /etc/nginx\n          - /etc/mysql\n          - /etc/systemd/system\n          - /etc/crontab\n          - /etc/hosts\n          - /etc/fstab\n        dest: \"{{ backup_root }}/configs/system-config-{{ ansible_date_time.epoch }}.tar.gz\"\n        mode: '0600'\n\n    # Remote backup synchronization\n    - name: Synchronize backups to remote storage\n      synchronize:\n        src: \"{{ backup_root }}/\"\n        dest: \"backup-server.example.com:{{ backup_root }}/{{ inventory_hostname }}/\"\n        delete: yes\n        rsync_opts:\n          - \"--exclude=*.tmp\"\n          - \"--compress\"\n          - \"--archive\"\n      when: backup_remote_sync | default(true)\n\n    # Cleanup old backups\n    - name: Clean up old backup files\n      find:\n        paths: \"{{ backup_root }}\"\n        age: \"{{ backup_retention_days }}d\"\n        file_type: file\n      register: old_backups\n\n    - name: Remove old backup files\n      file:\n        path: \"{{ item.path }}\"\n        state: absent\n      loop: \"{{ old_backups.files }}\"\nEOF\n```\n\n## Verification and Monitoring\n\n### Cross-Platform System Verification\n```bash\n# Create comprehensive verification playbook\ncat > playbooks/system-verification.yml <<EOF\n---\n- name: System Verification and Health Check\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    health_checks:\n      - service: nginx\n        port: 80\n        process: nginx\n      - service: mysql\n        port: 3306\n        process: mysqld\n      - service: redis\n        port: 6379\n        process: redis-server\n\n  tasks:\n    # System information gathering\n    - name: Gather system information\n      setup:\n        gather_subset:\n          - all\n          - !facter\n          - !ohai\n\n    # Service verification\n    - name: Check critical services status\n      service_facts:\n\n    - name: Verify services are running\n      assert:\n        that:\n          - \"ansible_facts.services[item.service + '.service'].state == 'running'\"\n        fail_msg: \"Service {{ item.service }} is not running\"\n        success_msg: \"Service {{ item.service }} is healthy\"\n      loop: \"{{ health_checks }}\"\n      when: \"item.service + '.service' in ansible_facts.services\"\n\n    # Network connectivity tests\n    - name: Test network connectivity\n      wait_for:\n        host: \"{{ item.host }}\"\n        port: \"{{ item.port }}\"\n        timeout: 5\n      loop:\n        - { host: \"8.8.8.8\", port: 53 }\n        - { host: \"1.1.1.1\", port: 53 }\n      ignore_errors: yes\n\n    # Disk space monitoring\n    - name: Check disk space usage\n      shell: df -h | awk '$5 > \"85%\" {print $0}'\n      register: disk_usage\n      changed_when: false\n      failed_when: disk_usage.stdout != \"\"\n\n    # Memory usage check\n    - name: Check memory usage\n      shell: free | grep Mem | awk '{printf \"%.0f\", $3/$2 * 100.0}'\n      register: memory_usage\n      changed_when: false\n\n    - name: Alert on high memory usage\n      debug:\n        msg: \"WARNING: Memory usage is {{ memory_usage.stdout }}%\"\n      when: memory_usage.stdout | int > 85\n\n    # Security verification\n    - name: Check for failed login attempts\n      shell: grep \"Failed password\" /var/log/auth.log | tail -10\n      register: failed_logins\n      changed_when: false\n      ignore_errors: yes\n      when: ansible_os_family == \"Debian\"\n\n    - name: Check firewall status\n      shell: |\n        if command -v ufw >/dev/null 2>&1; then\n          ufw status\n        elif command -v firewall-cmd >/dev/null 2>&1; then\n          firewall-cmd --state\n        else\n          echo \"No supported firewall found\"\n        fi\n      register: firewall_status\n      changed_when: false\n\n  post_tasks:\n    - name: Generate system health report\n      template:\n        src: templates/health-report.j2\n        dest: \"/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\"\n        mode: '0644'\n\n    - name: Fetch health reports\n      fetch:\n        src: \"/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\"\n        dest: \"./reports/\"\n        flat: yes\nEOF\n```\n\n### Continuous Compliance Monitoring\n```bash\ncat > playbooks/compliance-monitoring.yml <<EOF\n---\n- name: Continuous Compliance Monitoring\n  hosts: all\n  become: yes\n  vars:\n    compliance_standards:\n      - cis\n      - pci_dss\n      - soc2\n      - hipaa\n    \n    audit_log_paths:\n      - /var/log/auth.log\n      - /var/log/syslog\n      - /var/log/audit/audit.log\n\n  tasks:\n    # Install audit tools\n    - name: Install audit daemon\n      package:\n        name: \"{{ 'auditd' if ansible_os_family == 'RedHat' else 'auditd' }}\"\n        state: present\n\n    - name: Configure audit rules\n      template:\n        src: templates/audit.rules.j2\n        dest: /etc/audit/rules.d/audit.rules\n        backup: yes\n      notify: restart auditd\n\n    # CIS compliance checks\n    - name: Run CIS benchmark checks\n      shell: |\n        if [ -f /opt/cis-cat/CIS-CAT.sh ]; then\n          /opt/cis-cat/CIS-CAT.sh -b /opt/cis-cat/benchmarks/\n        else\n          echo \"CIS-CAT not installed, skipping\"\n        fi\n      register: cis_results\n      ignore_errors: yes\n\n    # File integrity monitoring\n    - name: Install AIDE\n      package:\n        name: aide\n        state: present\n\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \"AIDE integrity check\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/bin/aide --check | mail -s 'AIDE Report' security@example.com\"\n        user: root\n\n    # Log monitoring\n    - name: Install log monitoring tools\n      package:\n        name:\n          - logwatch\n          - rsyslog\n        state: present\n\n    - name: Configure centralized logging\n      template:\n        src: templates/rsyslog.conf.j2\n        dest: /etc/rsyslog.conf\n        backup: yes\n      notify: restart rsyslog\n\n  handlers:\n    - name: restart auditd\n      service:\n        name: auditd\n        state: restarted\n\n    - name: restart rsyslog\n      service:\n        name: rsyslog\n        state: restarted\nEOF\n```\n\n## CI/CD Integration\n\n### Jenkins Pipeline Integration\n```bash\n# Create Jenkinsfile for Ansible automation\ncat > Jenkinsfile <<EOF\npipeline {\n    agent any\n    \n    environment {\n        ANSIBLE_CONFIG = 'ansible.cfg'\n        ANSIBLE_HOST_KEY_CHECKING = 'False'\n    }\n    \n    stages {\n        stage('Lint') {\n            steps {\n                sh 'ansible-lint playbooks/'\n                sh 'yamllint .'\n            }\n        }\n        \n        stage('Syntax Check') {\n            steps {\n                sh 'ansible-playbook playbooks/site.yml --syntax-check'\n            }\n        }\n        \n        stage('Dry Run') {\n            steps {\n                sh 'ansible-playbook playbooks/site.yml --check --diff'\n            }\n        }\n        \n        stage('Deploy to Staging') {\n            when {\n                branch 'develop'\n            }\n            steps {\n                sh 'ansible-playbook -i inventories/staging playbooks/site.yml'\n            }\n        }\n        \n        stage('Deploy to Production') {\n            when {\n                branch 'main'\n            }\n            steps {\n                input 'Deploy to Production?'\n                sh 'ansible-playbook -i inventories/production playbooks/site.yml'\n            }\n        }\n        \n        stage('Verify Deployment') {\n            steps {\n                sh 'ansible-playbook playbooks/system-verification.yml'\n            }\n        }\n    }\n    \n    post {\n        always {\n            archiveArtifacts artifacts: 'logs/*.log', allowEmptyArchive: true\n            publishHTML([\n                allowMissing: false,\n                alwaysLinkToLastBuild: true,\n                keepAll: true,\n                reportDir: 'reports',\n                reportFiles: '*.html',\n                reportName: 'Ansible Report'\n            ])\n        }\n        failure {\n            emailext (\n                subject: \"Failed Pipeline: ${env.JOB_NAME} - ${env.BUILD_NUMBER}\",\n                body: \"Something is wrong with ${env.BUILD_URL}\",\n                to: \"${env.DEFAULT_RECIPIENTS}\"\n            )\n        }\n    }\n}\nEOF\n```\n\n### GitLab CI Integration\n```bash\ncat > .gitlab-ci.yml <<EOF\nstages:\n  - lint\n  - test\n  - deploy-staging\n  - deploy-production\n\nvariables:\n  ANSIBLE_CONFIG: ansible.cfg\n  ANSIBLE_HOST_KEY_CHECKING: \"False\"\n\nbefore_script:\n  - pip install ansible ansible-lint yamllint\n  - ansible-galaxy install -r requirements.yml\n\nlint:\n  stage: lint\n  script:\n    - ansible-lint playbooks/\n    - yamllint .\n  rules:\n    - if: '$CI_MERGE_REQUEST_IID'\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n\nsyntax-check:\n  stage: test\n  script:\n    - ansible-playbook playbooks/site.yml --syntax-check\n    - ansible-playbook playbooks/site.yml --check --diff -i inventories/staging\n  rules:\n    - if: '$CI_MERGE_REQUEST_IID'\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n\ndeploy-staging:\n  stage: deploy-staging\n  script:\n    - ansible-playbook -i inventories/staging playbooks/site.yml\n  rules:\n    - if: '$CI_COMMIT_BRANCH == \"develop\"'\n\ndeploy-production:\n  stage: deploy-production\n  script:\n    - ansible-playbook -i inventories/production playbooks/site.yml\n  rules:\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n      when: manual\n  environment:\n    name: production\n    url: https://production.example.com\nEOF\n```\n\n## Troubleshooting (Cross-Platform)\n\n### Common Issues and Solutions\n```bash\n# Debug connection issues\nansible all -m ping -vvv\n\n# Check SSH connectivity\nansible all -m setup --ask-pass --ask-become-pass\n\n# Verify inventory\nansible-inventory --list\nansible-inventory --graph\n\n# Test specific host\nansible target-host -m command -a \"uptime\"\n\n# Check syntax without execution\nansible-playbook playbooks/site.yml --syntax-check\n\n# Dry run with verbose output\nansible-playbook playbooks/site.yml --check --diff -vvv\n\n# Debug variable resolution\nansible-playbook playbooks/site.yml --extra-vars=\"debug=true\" --tags debug\n\n# Check facts\nansible all -m setup | grep ansible_os_family\n\n# Connection troubleshooting\nssh -vvv user@target-host\n\n# Permission issues\nansible all -m file -a \"path=/tmp/test state=touch\" --become\n\n# Vault issues\nansible-vault view group_vars/all/vault.yml\n\n# Performance debugging\nansible-playbook playbooks/site.yml --start-at-task=\"specific task name\"\nansible-playbook playbooks/site.yml --step\n\n# Module testing\nansible localhost -m debug -a \"var=hostvars\"\nansible localhost -m setup\n\n# Check for syntax errors in roles\nfind roles/ -name \"*.yml\" -exec ansible-playbook {} --syntax-check \\;\n```\n\n### Advanced Debugging\n```bash\n# Enable comprehensive logging\nexport ANSIBLE_DEBUG=1\nexport ANSIBLE_VERBOSITY=4\nansible-playbook playbooks/site.yml\n\n# Profile playbook execution\nansible-playbook playbooks/site.yml --extra-vars=\"profile_tasks_sort_order=none\"\n\n# Memory usage analysis\nansible-playbook playbooks/site.yml --extra-vars=\"ansible_python_interpreter=/usr/bin/python3\"\n\n# Network debugging\nansible all -m command -a \"ss -tulpn\"\nansible all -m command -a \"netstat -rn\"\n\n# Process debugging\nansible all -m command -a \"ps aux --sort=-%mem | head -10\"\n\n# Disk usage analysis\nansible all -m command -a \"df -h\"\nansible all -m command -a \"du -sh /var/log/*\"\n\n# Service debugging\nansible all -m systemd -a \"name=nginx\" --become\nansible all -m command -a \"systemctl status nginx\" --become\n\n# Variable debugging\nansible-playbook playbooks/site.yml --extra-vars=\"debug_vars=true\" --tags debug_vars\n```\n\n## Additional Resources\n\n- [Official Documentation](https://docs.ansible.com/)\n- [Ansible Galaxy](https://galaxy.ansible.com/)\n- [Best Practices Guide](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)\n- [Security Best Practices](https://docs.ansible.com/ansible/latest/user_guide/become.html#security-best-practices)\n- [Ansible Molecule Testing](https://molecule.readthedocs.io/)\n- [Community Collections](https://docs.ansible.com/ansible/latest/collections/index.html)\n\n---\n\n**Note:** This guide is part of the [HowToMgr](https://howtomgr.github.io) collection.","readmeHtml":"<h1 id=\"ansible-installation-guide\" class=\"mobile-header\">Ansible Installation Guide</h1>\n<p class=\"mobile-paragraph\">Agentless automation platform for configuration management, application deployment, and task automation across multiple systems. Industry standard for infrastructure automation with enterprise-grade security.</p>\n<h2 id=\"prerequisites\" class=\"mobile-header\">Prerequisites</h2>\n<li class=\"mobile-list-item\">Linux control machine (any modern distribution)</li>\n<li class=\"mobile-list-item\">Python 3.8+ on control machine</li>\n<li class=\"mobile-list-item\">SSH access to target hosts</li>\n<li class=\"mobile-list-item\">Python 2.7+ or 3.5+ on target hosts</li>\n<li class=\"mobile-list-item\">2GB RAM minimum, 4GB+ recommended for large infrastructures</li>\n<h2 id=\"installation\" class=\"mobile-header\">Installation</h2>\n<h3 id=\"using-package-manager-recommended\" class=\"mobile-header\">Using Package Manager (Recommended)</h3>\n<p class=\"mobile-paragraph\">#### Ubuntu/Debian</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Update package list\nsudo apt update\n\n# Install Ansible and dependencies\nsudo apt install -y ansible python3-pip python3-venv sshpass\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Verify installation\nansible --version\nansible-galaxy collection list</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### RHEL/CentOS/Rocky Linux/AlmaLinux</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install EPEL repository\nsudo yum install -y epel-release\n\n# Install Ansible\nsudo yum install -y ansible python3-pip\n\n# For newer distributions\nsudo dnf install -y ansible python3-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### Fedora</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Ansible\nsudo dnf install -y ansible python3-pip python3-virtualenv\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### Arch Linux</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Ansible\nsudo pacman -Syu ansible python-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\n\n# Verify installation\nansible --version</code></pre>\n      </div>\n    </div>\n<p class=\"mobile-paragraph\">#### Alpine Linux</p>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Ansible\nsudo apk update\nsudo apk add ansible python3 py3-pip openssh\n\n# Install collections\nansible-galaxy collection install community.general\n\n# Verify installation\nansible --version</code></pre>\n      </div>\n    </div>\n<h3 id=\"using-pip-latest-version\" class=\"mobile-header\">Using pip (Latest Version)</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create virtual environment (recommended)\npython3 -m venv ~/ansible-venv\nsource ~/ansible-venv/bin/activate\n\n# Install Ansible via pip\npip install --upgrade pip\npip install ansible ansible-core\n\n# Install additional packages\npip install paramiko jinja2 PyYAML cryptography\n\n# Install cloud provider SDKs\npip install boto3 botocore azure-cli google-cloud-storage\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Add to PATH permanently\necho &#039;source ~/ansible-venv/bin/activate&#039; &gt;&gt; ~/.bashrc\n\n# Verify installation\nansible --version</code></pre>\n      </div>\n    </div>\n<h3 id=\"using-docker\" class=\"mobile-header\">Using Docker</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create Ansible Docker container with mounted volumes\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  --workdir /ansible \\\n  ansible/ansible:latest\n\n# Create wrapper script for ease of use\nsudo tee /usr/local/bin/ansible-docker &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n#!/bin/bash\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  -v ~/.kube:/root/.kube:ro \\\n  --workdir /ansible \\\n  --network host \\\n  ansible/ansible:latest &quot;$@&quot;\nEOF\nsudo chmod +x /usr/local/bin/ansible-docker\n\n# Create aliases\necho &#039;alias ansible=&quot;ansible-docker ansible&quot;&#039; &gt;&gt; ~/.bashrc\necho &#039;alias ansible-playbook=&quot;ansible-docker ansible-playbook&quot;&#039; &gt;&gt; ~/.bashrc</code></pre>\n      </div>\n    </div>\n<h2 id=\"project-structure-and-configuration\" class=\"mobile-header\">Project Structure and Configuration</h2>\n<h3 id=\"professional-project-structure\" class=\"mobile-header\">Professional Project Structure</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create comprehensive Ansible project structure\nmkdir -p ~/ansible-infrastructure/{\n  inventories/{production,staging,development},\n  playbooks,\n  roles,\n  group_vars,\n  host_vars,\n  library,\n  filter_plugins,\n  callback_plugins,\n  vault,\n  collections,\n  logs\n}\n\ncd ~/ansible-infrastructure\n\n# Create ansible.cfg with security best practices\ncat &gt; ansible.cfg &lt;&lt;EOF\n[defaults]\ninventory = inventories/production/hosts.yml\nremote_user = ansible\nprivate_key_file = ~/.ssh/ansible_key\nhost_key_checking = True\ntimeout = 30\nretry_files_enabled = False\nstdout_callback = yaml\nbin_ansible_callbacks = True\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = ~/.ansible/facts_cache\nfact_caching_timeout = 86400\ninterpreter_python = auto_silent\nvault_password_file = ~/.ansible_vault_pass\n\n# Logging\nlog_path = logs/ansible.log\ndisplay_skipped_hosts = False\ndisplay_ok_hosts = False\n\n# Performance\nforks = 20\npoll_interval = 15\ninternal_poll_interval = 0.001\n\n# Security\ncommand_warnings = True\ndeprecation_warnings = True\naction_warnings = True\nlocalhost_warning = True\n\n[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=3600s -o PreferredAuthentications=publickey\npipelining = True\ncontrol_path = ~/.ansible/cp/%%h-%%p-%%r\nretries = 3\n\n[privilege_escalation]\nbecome = False\nbecome_method = sudo\nbecome_user = root\nbecome_ask_pass = False\n\n[inventory]\nenable_plugins = host_list, script, auto, yaml, ini, toml\ncache = True\ncache_plugin = jsonfile\ncache_timeout = 3600\ncache_connection = ~/.ansible/inventory_cache\n\n[galaxy]\nserver_list = automation_hub, galaxy\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"advanced-inventory-management\" class=\"mobile-header\">Advanced Inventory Management</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create production inventory with groups and variables\ncat &gt; inventories/production/hosts.yml &lt;&lt;EOF\nall:\n  children:\n    webservers:\n      hosts:\n        web-prod-01:\n          ansible_host: 10.0.1.10\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-02:\n          ansible_host: 10.0.1.11\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-03:\n          ansible_host: 10.0.1.12\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n      vars:\n        http_port: 80\n        https_port: 443\n        max_clients: 200\n        environment: production\n        monitoring_enabled: true\n\n    dbservers:\n      hosts:\n        db-prod-01:\n          ansible_host: 10.0.2.10\n          ansible_user: ansible\n          mysql_server_id: 1\n          mysql_role: master\n        db-prod-02:\n          ansible_host: 10.0.2.11\n          ansible_user: ansible\n          mysql_server_id: 2\n          mysql_role: slave\n      vars:\n        mysql_port: 3306\n        mysql_root_password: &quot;{{ vault_mysql_root_password }}&quot;\n        mysql_replication_user: &quot;{{ vault_mysql_replication_user }}&quot;\n        mysql_replication_password: &quot;{{ vault_mysql_replication_password }}&quot;\n\n    loadbalancers:\n      hosts:\n        lb-prod-01:\n          ansible_host: 10.0.3.10\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n        lb-prod-02:\n          ansible_host: 10.0.3.11\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n      vars:\n        haproxy_stats_enabled: true\n        haproxy_stats_user: admin\n        haproxy_stats_password: &quot;{{ vault_haproxy_stats_password }}&quot;\n\n    monitoring:\n      hosts:\n        monitor-prod-01:\n          ansible_host: 10.0.4.10\n          ansible_user: ansible\n          prometheus_retention: 30d\n          grafana_admin_password: &quot;{{ vault_grafana_admin_password }}&quot;\n\n    bastion:\n      hosts:\n        bastion-prod-01:\n          ansible_host: bastion.example.com\n          ansible_user: ansible\n          ansible_port: 22\n\n# Global variables for all hosts\nwebservers:\n  vars:\n    nginx_worker_processes: auto\n    nginx_worker_connections: 1024\n    ssl_certificate_path: /etc/ssl/certs\n    backup_schedule: &quot;0 2 * * *&quot;\n\ndbservers:\n  vars:\n    mysql_innodb_buffer_pool_size: 2G\n    mysql_max_connections: 200\n    backup_schedule: &quot;0 1 * * *&quot;\n    monitoring_enabled: true\nEOF\n\n# Create dynamic inventory script for cloud environments\ncat &gt; inventories/production/aws_ec2.yml &lt;&lt;EOF\nplugin: amazon.aws.aws_ec2\nregions:\n  - us-west-2\n  - us-east-1\nfilters:\n  tag:Environment: production\n  tag:Ansible: managed\n  instance-state-name: running\n\nhostnames:\n  - tag:Name\n  - dns-name\n  - private-ip-address\n\ncompose:\n  ansible_host: private_ip_address\n  ec2_state: ec2_state_name\n  ec2_arch: ec2_architecture\n\ngroups:\n  # Group by instance type\n  webservers: &quot;&#039;web&#039; in tags.Role&quot;\n  databases: &quot;&#039;db&#039; in tags.Role&quot;\n  loadbalancers: &quot;&#039;lb&#039; in tags.Role&quot;\n  \n  # Group by environment\n  production: &quot;tags.Environment == &#039;production&#039;&quot;\n  staging: &quot;tags.Environment == &#039;staging&#039;&quot;\n  \n  # Group by availability zone\n  us_west_2a: ec2_placement_availability_zone == &quot;us-west-2a&quot;\n  us_west_2b: ec2_placement_availability_zone == &quot;us-west-2b&quot;\n\nkeyed_groups:\n  # Create groups based on tags\n  - key: tags.Environment\n    prefix: env\n  - key: tags.Role  \n    prefix: role\n  - key: ec2_instance_type\n    prefix: type\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"ansible-vault-security\" class=\"mobile-header\">Ansible Vault Security</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create strong vault password\nopenssl rand -base64 32 &gt; ~/.ansible_vault_pass\nchmod 600 ~/.ansible_vault_pass\n\n# Create encrypted vault file for secrets\nansible-vault create group_vars/all/vault.yml\n# Enter secure passwords and API keys:\n# vault_mysql_root_password: your_secure_mysql_password\n# vault_grafana_admin_password: your_secure_grafana_password  \n# vault_ssl_private_key: |\n#   -----BEGIN PRIVATE KEY-----\n#   your_private_key_content\n#   -----END PRIVATE KEY-----\n\n# Create non-encrypted variables file\ncat &gt; group_vars/all/vars.yml &lt;&lt;EOF\n# Non-sensitive variables\nmysql_port: 3306\nnginx_port: 80\ngrafana_port: 3000\nprometheus_port: 9090\n\n# Reference vault variables\nmysql_root_password: &quot;{{ vault_mysql_root_password }}&quot;\ngrafana_admin_password: &quot;{{ vault_grafana_admin_password }}&quot;\n\n# SSL configuration\nssl_certificate_path: /etc/ssl/certs/server.crt\nssl_private_key_path: /etc/ssl/private/server.key\nssl_private_key_content: &quot;{{ vault_ssl_private_key }}&quot;\n\n# Security settings\nansible_ssh_common_args: &#039;-o StrictHostKeyChecking=yes -o UserKnownHostsFile=~/.ssh/known_hosts&#039;\nansible_become_method: sudo\nansible_become_user: root\nEOF\n\n# Edit vault file\nansible-vault edit group_vars/all/vault.yml\n\n# View vault file (read-only)\nansible-vault view group_vars/all/vault.yml\n\n# Change vault password\nansible-vault rekey group_vars/all/vault.yml</code></pre>\n      </div>\n    </div>\n<h2 id=\"comprehensive-playbooks\" class=\"mobile-header\">Comprehensive Playbooks</h2>\n<h3 id=\"system-hardening-playbook\" class=\"mobile-header\">System Hardening Playbook</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/system-hardening.yml &lt;&lt;EOF\n---\n- name: System Security Hardening\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    security_packages:\n      - fail2ban\n      - ufw\n      - aide\n      - chkrootkit\n      - rkhunter\n      - clamav\n      - lynis\n    \n    disabled_services:\n      - telnet\n      - rsh\n      - rlogin\n      - tftp\n      - talk\n      - finger\n\n  pre_tasks:\n    - name: Update package cache\n      package:\n        update_cache: yes\n        cache_valid_time: 3600\n      when: ansible_os_family in [&quot;Debian&quot;, &quot;RedHat&quot;]\n\n  tasks:\n    # System updates\n    - name: Upgrade all packages\n      package:\n        name: &quot;*&quot;\n        state: latest\n      when: ansible_os_family == &quot;RedHat&quot;\n\n    - name: Upgrade all packages (Debian/Ubuntu)\n      apt:\n        upgrade: dist\n        autoremove: yes\n        autoclean: yes\n      when: ansible_os_family == &quot;Debian&quot;\n\n    # Install security packages\n    - name: Install security packages\n      package:\n        name: &quot;{{ security_packages }}&quot;\n        state: present\n\n    # User security\n    - name: Create ansible user with limited privileges\n      user:\n        name: ansible\n        groups: sudo\n        shell: /bin/bash\n        create_home: yes\n        generate_ssh_key: yes\n        ssh_key_bits: 4096\n        ssh_key_type: rsa\n\n    - name: Configure sudo for ansible user\n      lineinfile:\n        path: /etc/sudoers.d/ansible\n        line: &#039;ansible ALL=(ALL) NOPASSWD:ALL&#039;\n        create: yes\n        mode: &#039;0440&#039;\n        validate: &#039;visudo -cf %s&#039;\n\n    # SSH hardening\n    - name: Configure SSH security\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: &quot;{{ item.regexp }}&quot;\n        line: &quot;{{ item.line }}&quot;\n        backup: yes\n      loop:\n        - { regexp: &#039;^#?PermitRootLogin&#039;, line: &#039;PermitRootLogin no&#039; }\n        - { regexp: &#039;^#?PasswordAuthentication&#039;, line: &#039;PasswordAuthentication no&#039; }\n        - { regexp: &#039;^#?X11Forwarding&#039;, line: &#039;X11Forwarding no&#039; }\n        - { regexp: &#039;^#?MaxAuthTries&#039;, line: &#039;MaxAuthTries 3&#039; }\n        - { regexp: &#039;^#?ClientAliveInterval&#039;, line: &#039;ClientAliveInterval 300&#039; }\n        - { regexp: &#039;^#?ClientAliveCountMax&#039;, line: &#039;ClientAliveCountMax 0&#039; }\n        - { regexp: &#039;^#?Protocol&#039;, line: &#039;Protocol 2&#039; }\n        - { regexp: &#039;^#?LogLevel&#039;, line: &#039;LogLevel VERBOSE&#039; }\n      notify: restart ssh\n\n    # Firewall configuration\n    - name: Configure UFW firewall (Debian/Ubuntu)\n      ufw:\n        state: enabled\n        policy: deny\n        direction: incoming\n      when: ansible_os_family == &quot;Debian&quot;\n\n    - name: Allow SSH through UFW\n      ufw:\n        rule: allow\n        port: 22\n        proto: tcp\n        comment: &#039;SSH access&#039;\n      when: ansible_os_family == &quot;Debian&quot;\n\n    - name: Configure firewalld (RHEL/CentOS/Fedora)\n      firewalld:\n        state: enabled\n        permanent: yes\n        immediate: yes\n      when: ansible_os_family == &quot;RedHat&quot;\n\n    - name: Allow SSH through firewalld\n      firewalld:\n        service: ssh\n        permanent: yes\n        state: enabled\n        immediate: yes\n      when: ansible_os_family == &quot;RedHat&quot;\n\n    # Disable unnecessary services\n    - name: Disable unnecessary services\n      systemd:\n        name: &quot;{{ item }}&quot;\n        enabled: no\n        state: stopped\n      loop: &quot;{{ disabled_services }}&quot;\n      ignore_errors: yes\n\n    # File system security\n    - name: Set proper permissions on sensitive files\n      file:\n        path: &quot;{{ item.path }}&quot;\n        mode: &quot;{{ item.mode }}&quot;\n        owner: root\n        group: root\n      loop:\n        - { path: &#039;/etc/passwd&#039;, mode: &#039;0644&#039; }\n        - { path: &#039;/etc/shadow&#039;, mode: &#039;0640&#039; }\n        - { path: &#039;/etc/group&#039;, mode: &#039;0644&#039; }\n        - { path: &#039;/etc/gshadow&#039;, mode: &#039;0640&#039; }\n        - { path: &#039;/etc/ssh/sshd_config&#039;, mode: &#039;0600&#039; }\n\n    # Kernel security parameters\n    - name: Configure kernel security parameters\n      sysctl:\n        name: &quot;{{ item.key }}&quot;\n        value: &quot;{{ item.value }}&quot;\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: &#039;net.ipv4.ip_forward&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.all.send_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.default.send_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.all.accept_source_route&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.default.accept_source_route&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.all.accept_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.default.accept_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.all.secure_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.default.secure_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.all.log_martians&#039;, value: &#039;1&#039; }\n        - { key: &#039;net.ipv4.conf.default.log_martians&#039;, value: &#039;1&#039; }\n        - { key: &#039;kernel.randomize_va_space&#039;, value: &#039;2&#039; }\n\n    # Configure fail2ban\n    - name: Configure fail2ban for SSH protection\n      template:\n        src: templates/fail2ban-jail.local.j2\n        dest: /etc/fail2ban/jail.local\n        backup: yes\n      notify: restart fail2ban\n\n  handlers:\n    - name: restart ssh\n      service:\n        name: &quot;{{ &#039;ssh&#039; if ansible_os_family == &#039;Debian&#039; else &#039;sshd&#039; }}&quot;\n        state: restarted\n\n    - name: restart fail2ban\n      service:\n        name: fail2ban\n        state: restarted\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"application-deployment-playbook\" class=\"mobile-header\">Application Deployment Playbook</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/web-application-deployment.yml &lt;&lt;EOF\n---\n- name: Deploy Web Application Stack\n  hosts: webservers\n  become: yes\n  serial: &quot;25%&quot;  # Rolling deployment\n  max_fail_percentage: 10\n  vars:\n    app_name: mywebapp\n    app_version: &quot;{{ app_version | default(&#039;latest&#039;) }}&quot;\n    app_port: 3000\n    nginx_workers: &quot;{{ ansible_processor_cores }}&quot;\n    \n  pre_tasks:\n    - name: Check if maintenance mode file exists\n      stat:\n        path: /var/www/html/maintenance.html\n      register: maintenance_mode\n\n    - name: Fail if in maintenance mode\n      fail:\n        msg: &quot;Server is in maintenance mode&quot;\n      when: maintenance_mode.stat.exists and not force_deployment | default(false)\n\n  tasks:\n    # Application deployment\n    - name: Create application user\n      user:\n        name: &quot;{{ app_name }}&quot;\n        system: yes\n        shell: /bin/false\n        home: &quot;/opt/{{ app_name }}&quot;\n        create_home: yes\n\n    - name: Create application directories\n      file:\n        path: &quot;{{ item }}&quot;\n        state: directory\n        owner: &quot;{{ app_name }}&quot;\n        group: &quot;{{ app_name }}&quot;\n        mode: &#039;0755&#039;\n      loop:\n        - &quot;/opt/{{ app_name }}&quot;\n        - &quot;/opt/{{ app_name }}/releases&quot;\n        - &quot;/opt/{{ app_name }}/shared&quot;\n        - &quot;/var/log/{{ app_name }}&quot;\n\n    - name: Download application release\n      get_url:\n        url: &quot;https://releases.example.com/{{ app_name }}/{{ app_version }}/{{ app_name }}-{{ app_version }}.tar.gz&quot;\n        dest: &quot;/tmp/{{ app_name }}-{{ app_version }}.tar.gz&quot;\n        mode: &#039;0644&#039;\n        timeout: 300\n      register: download_result\n\n    - name: Extract application\n      unarchive:\n        src: &quot;/tmp/{{ app_name }}-{{ app_version }}.tar.gz&quot;\n        dest: &quot;/opt/{{ app_name }}/releases/&quot;\n        owner: &quot;{{ app_name }}&quot;\n        group: &quot;{{ app_name }}&quot;\n        remote_src: yes\n        creates: &quot;/opt/{{ app_name }}/releases/{{ app_version }}&quot;\n\n    - name: Create symlink to current release\n      file:\n        src: &quot;/opt/{{ app_name }}/releases/{{ app_version }}&quot;\n        dest: &quot;/opt/{{ app_name }}/current&quot;\n        state: link\n        owner: &quot;{{ app_name }}&quot;\n        group: &quot;{{ app_name }}&quot;\n      notify:\n        - reload application\n        - reload nginx\n\n    # Configuration management\n    - name: Deploy application configuration\n      template:\n        src: &quot;templates/{{ app_name }}.conf.j2&quot;\n        dest: &quot;/opt/{{ app_name }}/shared/{{ app_name }}.conf&quot;\n        owner: &quot;{{ app_name }}&quot;\n        group: &quot;{{ app_name }}&quot;\n        mode: &#039;0640&#039;\n        backup: yes\n      notify: reload application\n\n    # Service management\n    - name: Deploy systemd service file\n      template:\n        src: &quot;templates/{{ app_name }}.service.j2&quot;\n        dest: &quot;/etc/systemd/system/{{ app_name }}.service&quot;\n        mode: &#039;0644&#039;\n      notify:\n        - daemon reload\n        - restart application\n\n    - name: Enable and start application service\n      systemd:\n        name: &quot;{{ app_name }}&quot;\n        enabled: yes\n        state: started\n        daemon_reload: yes\n\n    # Health check\n    - name: Wait for application to be ready\n      uri:\n        url: &quot;http://localhost:{{ app_port }}/health&quot;\n        method: GET\n        status_code: 200\n      retries: 30\n      delay: 10\n\n    # Cleanup old releases\n    - name: Clean up old releases (keep last 3)\n      shell: |\n        cd /opt/{{ app_name }}/releases\n        ls -t | tail -n +4 | xargs rm -rf\n      args:\n        executable: /bin/bash\n\n  post_tasks:\n    - name: Verify application is running\n      uri:\n        url: &quot;http://{{ ansible_default_ipv4.address }}:{{ app_port }}/health&quot;\n        method: GET\n        status_code: 200\n      delegate_to: localhost\n\n    - name: Log deployment success\n      lineinfile:\n        path: &quot;/var/log/{{ app_name }}/deployments.log&quot;\n        line: &quot;{{ ansible_date_time.iso8601 }} - Successfully deployed {{ app_version }} to {{ inventory_hostname }}&quot;\n        create: yes\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart application\n      systemd:\n        name: &quot;{{ app_name }}&quot;\n        state: restarted\n\n    - name: reload application\n      systemd:\n        name: &quot;{{ app_name }}&quot;\n        state: reloaded\n\n    - name: reload nginx\n      service:\n        name: nginx\n        state: reloaded\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"infrastructure-as-code-playbook\" class=\"mobile-header\">Infrastructure as Code Playbook</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/infrastructure-provisioning.yml &lt;&lt;EOF\n---\n- name: Infrastructure Provisioning and Configuration\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  vars:\n    base_packages:\n      Debian:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n      RedHat:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n        - epel-release\n\n  tasks:\n    # System preparation\n    - name: Set hostname\n      hostname:\n        name: &quot;{{ inventory_hostname }}&quot;\n\n    - name: Update /etc/hosts\n      lineinfile:\n        path: /etc/hosts\n        line: &quot;{{ ansible_default_ipv4.address }} {{ inventory_hostname }}&quot;\n        backup: yes\n\n    # Package management\n    - name: Install base packages\n      package:\n        name: &quot;{{ base_packages[ansible_os_family] | default(base_packages[&#039;Debian&#039;]) }}&quot;\n        state: present\n\n    # Time synchronization\n    - name: Install and configure NTP\n      package:\n        name: &quot;{{ &#039;ntp&#039; if ansible_os_family == &#039;Debian&#039; else &#039;chrony&#039; }}&quot;\n        state: present\n\n    - name: Start and enable time synchronization\n      service:\n        name: &quot;{{ &#039;ntp&#039; if ansible_os_family == &#039;Debian&#039; else &#039;chronyd&#039; }}&quot;\n        state: started\n        enabled: yes\n\n    # Log management\n    - name: Configure logrotate for application logs\n      template:\n        src: templates/app-logrotate.j2\n        dest: /etc/logrotate.d/applications\n        mode: &#039;0644&#039;\n\n    # Monitoring agent installation\n    - name: Install Node Exporter for Prometheus monitoring\n      get_url:\n        url: &quot;https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz&quot;\n        dest: /tmp/node_exporter.tar.gz\n        mode: &#039;0644&#039;\n\n    - name: Extract Node Exporter\n      unarchive:\n        src: /tmp/node_exporter.tar.gz\n        dest: /tmp\n        remote_src: yes\n\n    - name: Copy Node Exporter binary\n      copy:\n        src: /tmp/node_exporter-1.6.1.linux-amd64/node_exporter\n        dest: /usr/local/bin/node_exporter\n        mode: &#039;0755&#039;\n        owner: root\n        group: root\n        remote_src: yes\n\n    - name: Create node_exporter systemd service\n      template:\n        src: templates/node_exporter.service.j2\n        dest: /etc/systemd/system/node_exporter.service\n        mode: &#039;0644&#039;\n      notify:\n        - daemon reload\n        - restart node_exporter\n\n    # Security configuration\n    - name: Configure kernel parameters for security\n      sysctl:\n        name: &quot;{{ item.key }}&quot;\n        value: &quot;{{ item.value }}&quot;\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: &#039;kernel.dmesg_restrict&#039;, value: &#039;1&#039; }\n        - { key: &#039;kernel.kptr_restrict&#039;, value: &#039;2&#039; }\n        - { key: &#039;kernel.yama.ptrace_scope&#039;, value: &#039;1&#039; }\n        - { key: &#039;net.ipv4.conf.all.log_martians&#039;, value: &#039;1&#039; }\n        - { key: &#039;net.ipv4.conf.default.log_martians&#039;, value: &#039;1&#039; }\n        - { key: &#039;net.ipv4.conf.all.send_redirects&#039;, value: &#039;0&#039; }\n        - { key: &#039;net.ipv4.conf.default.send_redirects&#039;, value: &#039;0&#039; }\n\n    # File integrity monitoring\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: &quot;AIDE integrity check&quot;\n        minute: &quot;0&quot;\n        hour: &quot;3&quot;\n        job: &quot;/usr/bin/aide --check&quot;\n        user: root\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart node_exporter\n      service:\n        name: node_exporter\n        state: restarted\n        enabled: yes\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"advanced-role-development\" class=\"mobile-header\">Advanced Role Development</h2>\n<h3 id=\"comprehensive-nginx-role\" class=\"mobile-header\">Comprehensive NGINX Role</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create NGINX role structure\nansible-galaxy init roles/nginx\n\n# Main tasks\ncat &gt; roles/nginx/tasks/main.yml &lt;&lt;EOF\n---\n# NGINX Installation and Configuration Role\n- name: Include OS-specific variables\n  include_vars: &quot;{{ ansible_os_family }}.yml&quot;\n\n- name: Install NGINX\n  include_tasks: &quot;install-{{ ansible_os_family }}.yml&quot;\n\n- name: Create NGINX directories\n  file:\n    path: &quot;{{ item }}&quot;\n    state: directory\n    owner: root\n    group: root\n    mode: &#039;0755&#039;\n  loop:\n    - /etc/nginx/sites-available\n    - /etc/nginx/sites-enabled\n    - /etc/nginx/conf.d\n    - /var/log/nginx\n    - /var/cache/nginx\n\n- name: Generate DH parameters\n  openssl_dhparam:\n    path: /etc/ssl/certs/dhparam.pem\n    size: 2048\n  when: nginx_ssl_enabled | default(false)\n\n- name: Deploy NGINX main configuration\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n    backup: yes\n    validate: &#039;nginx -t -c %s&#039;\n  notify: reload nginx\n\n- name: Deploy virtual host configurations\n  template:\n    src: vhost.conf.j2\n    dest: &quot;/etc/nginx/sites-available/{{ item.name }}.conf&quot;\n    backup: yes\n  loop: &quot;{{ nginx_vhosts | default([]) }}&quot;\n  notify: reload nginx\n\n- name: Enable virtual hosts\n  file:\n    src: &quot;/etc/nginx/sites-available/{{ item.name }}.conf&quot;\n    dest: &quot;/etc/nginx/sites-enabled/{{ item.name }}.conf&quot;\n    state: link\n  loop: &quot;{{ nginx_vhosts | default([]) }}&quot;\n  when: item.enabled | default(true)\n  notify: reload nginx\n\n- name: Remove default site\n  file:\n    path: /etc/nginx/sites-enabled/default\n    state: absent\n  notify: reload nginx\n\n- name: Start and enable NGINX\n  service:\n    name: nginx\n    state: started\n    enabled: yes\n\n- name: Configure log rotation\n  template:\n    src: nginx-logrotate.j2\n    dest: /etc/logrotate.d/nginx\n    mode: &#039;0644&#039;\n\n- name: Setup NGINX monitoring\n  include_tasks: monitoring.yml\n  when: nginx_monitoring_enabled | default(false)\n\n- name: Configure SSL certificates\n  include_tasks: ssl.yml\n  when: nginx_ssl_enabled | default(false)\nEOF\n\n# OS-specific installation tasks\ncat &gt; roles/nginx/tasks/install-Debian.yml &lt;&lt;EOF\n---\n- name: Add NGINX signing key (Debian/Ubuntu)\n  apt_key:\n    url: https://nginx.org/keys/nginx_signing.key\n    state: present\n\n- name: Add NGINX repository (Debian/Ubuntu)\n  apt_repository:\n    repo: &quot;deb https://nginx.org/packages/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx&quot;\n    state: present\n\n- name: Install NGINX (Debian/Ubuntu)\n  apt:\n    name: nginx\n    state: present\n    update_cache: yes\nEOF\n\ncat &gt; roles/nginx/tasks/install-RedHat.yml &lt;&lt;EOF\n---\n- name: Add NGINX repository (RHEL/CentOS)\n  yum_repository:\n    name: nginx\n    description: NGINX Repository\n    baseurl: &quot;https://nginx.org/packages/centos/{{ ansible_distribution_major_version }}/$basearch/&quot;\n    gpgcheck: yes\n    gpgkey: https://nginx.org/keys/nginx_signing.key\n    enabled: yes\n\n- name: Install NGINX (RHEL/CentOS)\n  yum:\n    name: nginx\n    state: present\nEOF\n\n# Variables\ncat &gt; roles/nginx/vars/main.yml &lt;&lt;EOF\n---\nnginx_user: nginx\nnginx_worker_processes: auto\nnginx_worker_connections: 1024\nnginx_keepalive_timeout: 65\nnginx_ssl_enabled: false\nnginx_monitoring_enabled: true\n\nnginx_security_headers:\n  - &quot;add_header X-Frame-Options SAMEORIGIN always;&quot;\n  - &quot;add_header X-Content-Type-Options nosniff always;&quot;\n  - &quot;add_header X-XSS-Protection &#039;1; mode=block&#039; always;&quot;\n  - &quot;add_header Strict-Transport-Security &#039;max-age=31536000; includeSubDomains&#039; always;&quot;\n\nnginx_default_vhost:\n  name: default\n  listen: 80\n  server_name: &quot;_&quot;\n  root: /var/www/html\n  index: index.html\n  enabled: false\nEOF\n\n# Templates\ncat &gt; roles/nginx/templates/nginx.conf.j2 &lt;&lt;EOF\nuser {{ nginx_user }};\nworker_processes {{ nginx_worker_processes }};\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections {{ nginx_worker_connections }};\n    use epoll;\n    multi_accept on;\n}\n\nhttp {\n    # Basic settings\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout {{ nginx_keepalive_timeout }};\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # SSL configuration\n{% if nginx_ssl_enabled %}\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers off;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n{% endif %}\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types\n        application/javascript\n        application/json\n        application/xml\n        text/css\n        text/javascript\n        text/xml\n        text/plain;\n\n    # Security headers\n{% for header in nginx_security_headers %}\n    {{ header }}\n{% endfor %}\n\n    # Logging\n    log_format main &#039;\\$remote_addr - \\$remote_user [\\$time_local] &quot;\\$request&quot; &#039;\n                    &#039;\\$status \\$body_bytes_sent &quot;\\$http_referer&quot; &#039;\n                    &#039;&quot;\\$http_user_agent&quot; &quot;\\$http_x_forwarded_for&quot;&#039;;\n\n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log;\n\n    # Rate limiting\n    limit_req_zone \\$binary_remote_addr zone=login:10m rate=10r/m;\n    limit_conn_zone \\$binary_remote_addr zone=addr:10m;\n\n    # Include configurations\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\nEOF\n\n# Handlers\ncat &gt; roles/nginx/handlers/main.yml &lt;&lt;EOF\n---\n- name: restart nginx\n  service:\n    name: nginx\n    state: restarted\n\n- name: reload nginx\n  service:\n    name: nginx\n    state: reloaded\n\n- name: validate nginx config\n  command: nginx -t\n  changed_when: false\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"security-and-compliance\" class=\"mobile-header\">Security and Compliance</h2>\n<h3 id=\"ansible-security-scanner-integration\" class=\"mobile-header\">Ansible Security Scanner Integration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create security scanning playbook\ncat &gt; playbooks/security-scan.yml &lt;&lt;EOF\n---\n- name: Security Compliance Scanning\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    scan_results_dir: &quot;/tmp/security-scans&quot;\n    \n  tasks:\n    - name: Create scan results directory\n      file:\n        path: &quot;{{ scan_results_dir }}&quot;\n        state: directory\n        mode: &#039;0755&#039;\n\n    # CIS benchmark scanning\n    - name: Download CIS benchmark script\n      get_url:\n        url: &quot;https://github.com/dev-sec/cis-dil-benchmark/archive/master.zip&quot;\n        dest: &quot;/tmp/cis-benchmark.zip&quot;\n        mode: &#039;0644&#039;\n\n    - name: Run CIS benchmark scan\n      shell: |\n        cd /tmp\n        unzip -o cis-benchmark.zip\n        cd cis-dil-benchmark-master\n        bash cis_ubuntu2204.sh &gt; {{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\n      args:\n        creates: &quot;{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt&quot;\n\n    # Lynis security audit\n    - name: Install Lynis\n      package:\n        name: lynis\n        state: present\n\n    - name: Run Lynis security audit\n      command: lynis audit system --quiet --cronjob\n      register: lynis_result\n      changed_when: false\n\n    - name: Save Lynis results\n      copy:\n        content: &quot;{{ lynis_result.stdout }}&quot;\n        dest: &quot;{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt&quot;\n        mode: &#039;0644&#039;\n\n    # OpenSCAP compliance scanning\n    - name: Install OpenSCAP (RHEL/CentOS)\n      package:\n        name:\n          - openscap-scanner\n          - scap-security-guide\n        state: present\n      when: ansible_os_family == &quot;RedHat&quot;\n\n    - name: Install OpenSCAP (Debian/Ubuntu)\n      package:\n        name:\n          - libopenscap8\n          - ssg-debian\n        state: present\n      when: ansible_os_family == &quot;Debian&quot;\n\n    - name: Run OpenSCAP scan\n      shell: |\n        oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard \\\n          --results {{ scan_results_dir }}/oscap-results-{{ inventory_hostname }}.xml \\\n          --report {{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html \\\n          /usr/share/xml/scap/ssg/content/ssg-{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}-xccdf.xml\n      ignore_errors: yes\n      when: ansible_os_family in [&quot;RedHat&quot;, &quot;Debian&quot;]\n\n    # Vulnerability scanning with Trivy\n    - name: Install Trivy vulnerability scanner\n      shell: |\n        curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin\n      args:\n        creates: /usr/local/bin/trivy\n\n    - name: Run Trivy filesystem scan\n      shell: |\n        trivy fs --format json --output {{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json /\n      ignore_errors: yes\n\n    # Collect scan results\n    - name: Fetch scan results to control machine\n      fetch:\n        src: &quot;{{ item }}&quot;\n        dest: &quot;./security-reports/{{ inventory_hostname }}/&quot;\n        flat: yes\n      loop:\n        - &quot;{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt&quot;\n        - &quot;{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt&quot;\n        - &quot;{{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html&quot;\n        - &quot;{{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json&quot;\n      ignore_errors: yes\n      delegate_to: localhost\n\n  post_tasks:\n    - name: Generate compliance summary\n      template:\n        src: templates/compliance-summary.j2\n        dest: &quot;{{ scan_results_dir }}/compliance-summary-{{ inventory_hostname }}.txt&quot;\n        mode: &#039;0644&#039;\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"ansible-awxtower-integration\" class=\"mobile-header\">Ansible AWX/Tower Integration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Ansible AWX (open source)\ncat &gt; playbooks/install-awx.yml &lt;&lt;EOF\n---\n- name: Install Ansible AWX\n  hosts: localhost\n  connection: local\n  become: yes\n  vars:\n    awx_namespace: awx\n    awx_admin_user: admin\n    awx_admin_password: &quot;{{ vault_awx_admin_password }}&quot;\n\n  tasks:\n    - name: Install prerequisite packages\n      package:\n        name:\n          - git\n          - curl\n          - docker.io\n          - docker-compose\n        state: present\n\n    - name: Clone AWX repository\n      git:\n        repo: https://github.com/ansible/awx.git\n        dest: /opt/awx\n        version: devel\n\n    - name: Create AWX Docker inventory\n      template:\n        src: templates/awx-docker-inventory.j2\n        dest: /opt/awx/installer/inventory\n        mode: &#039;0644&#039;\n\n    - name: Install AWX using Ansible\n      shell: ansible-playbook -i inventory install.yml\n      args:\n        chdir: /opt/awx/installer\n      environment:\n        ANSIBLE_HOST_KEY_CHECKING: False\n\n    - name: Wait for AWX to be ready\n      uri:\n        url: &quot;http://localhost:80/api/v2/ping/&quot;\n        method: GET\n      retries: 30\n      delay: 10\n\n    - name: Configure AWX organizations and projects\n      uri:\n        url: &quot;http://localhost:80/api/v2/organizations/&quot;\n        method: POST\n        user: &quot;{{ awx_admin_user }}&quot;\n        password: &quot;{{ awx_admin_password }}&quot;\n        force_basic_auth: yes\n        body_format: json\n        body:\n          name: &quot;Production&quot;\n          description: &quot;Production environment organization&quot;\n        status_code: [200, 201, 409]\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"multi-cloud-automation\" class=\"mobile-header\">Multi-Cloud Automation</h2>\n<h3 id=\"aws-infrastructure-automation\" class=\"mobile-header\">AWS Infrastructure Automation</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/aws-infrastructure.yml &lt;&lt;EOF\n---\n- name: AWS Infrastructure Automation\n  hosts: localhost\n  connection: local\n  gather_facts: no\n  vars:\n    aws_region: &quot;{{ aws_region | default(&#039;us-west-2&#039;) }}&quot;\n    vpc_cidr: &quot;{{ vpc_cidr | default(&#039;10.0.0.0/16&#039;) }}&quot;\n    environment: &quot;{{ environment | default(&#039;production&#039;) }}&quot;\n\n  tasks:\n    # VPC Creation\n    - name: Create VPC\n      amazon.aws.ec2_vpc_info:\n        filters:\n          &quot;tag:Name&quot;: &quot;{{ environment }}-vpc&quot;\n        region: &quot;{{ aws_region }}&quot;\n      register: existing_vpc\n\n    - name: Create new VPC if not exists\n      amazon.aws.ec2_vpc_net:\n        name: &quot;{{ environment }}-vpc&quot;\n        cidr_block: &quot;{{ vpc_cidr }}&quot;\n        region: &quot;{{ aws_region }}&quot;\n        state: present\n        dns_hostnames: yes\n        dns_support: yes\n        tags:\n          Environment: &quot;{{ environment }}&quot;\n          ManagedBy: ansible\n      register: vpc\n      when: existing_vpc.vpcs | length == 0\n\n    # Security Groups\n    - name: Create web security group\n      amazon.aws.ec2_group:\n        name: &quot;{{ environment }}-web-sg&quot;\n        description: &quot;Security group for web servers&quot;\n        vpc_id: &quot;{{ vpc.vpc.id if vpc.vpc is defined else existing_vpc.vpcs[0].vpc_id }}&quot;\n        region: &quot;{{ aws_region }}&quot;\n        rules:\n          - proto: tcp\n            ports:\n              - 80\n              - 443\n            cidr_ip: 0.0.0.0/0\n            rule_desc: &quot;HTTP and HTTPS access&quot;\n          - proto: tcp\n            ports:\n              - 22\n            group_id: &quot;{{ environment }}-bastion-sg&quot;\n            rule_desc: &quot;SSH from bastion&quot;\n        tags:\n          Environment: &quot;{{ environment }}&quot;\n\n    # Launch EC2 instances\n    - name: Launch web servers\n      amazon.aws.ec2_instance:\n        name: &quot;{{ environment }}-web-{{ item }}&quot;\n        instance_type: t3.medium\n        image_id: ami-0c02fb55956c7d316  # Amazon Linux 2\n        key_name: &quot;{{ ec2_key_name }}&quot;\n        vpc_subnet_id: &quot;{{ web_subnet_id }}&quot;\n        security_groups:\n          - &quot;{{ environment }}-web-sg&quot;\n        region: &quot;{{ aws_region }}&quot;\n        state: running\n        wait: yes\n        wait_timeout: 300\n        user_data: |\n          #!/bin/bash\n          yum update -y\n          yum install -y python3\n        tags:\n          Environment: &quot;{{ environment }}&quot;\n          Role: webserver\n          Ansible: managed\n      loop: &quot;{{ range(1, web_server_count + 1) | list }}&quot;\n      register: web_instances\n\n    # Add instances to inventory\n    - name: Add web servers to inventory\n      add_host:\n        name: &quot;{{ item.instances[0].tags.Name }}&quot;\n        hostname: &quot;{{ item.instances[0].public_ip_address }}&quot;\n        groups: webservers\n        ansible_ssh_private_key_file: &quot;~/.ssh/{{ ec2_key_name }}.pem&quot;\n        ansible_user: ec2-user\n      loop: &quot;{{ web_instances.results }}&quot;\n      changed_when: false\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"kubernetes-cluster-management\" class=\"mobile-header\">Kubernetes Cluster Management</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/k8s-cluster-management.yml &lt;&lt;EOF\n---\n- name: Kubernetes Cluster Management with Ansible\n  hosts: k8s_masters\n  become: yes\n  serial: 1\n  vars:\n    k8s_version: &quot;1.28.2&quot;\n    containerd_version: &quot;1.6.24&quot;\n    cni_version: &quot;1.3.0&quot;\n\n  tasks:\n    # Pre-flight checks\n    - name: Check system requirements\n      assert:\n        that:\n          - ansible_memtotal_mb &gt;= 1700\n          - ansible_processor_cores &gt;= 2\n        fail_msg: &quot;System doesn&#039;t meet minimum requirements&quot;\n\n    - name: Verify connectivity to all nodes\n      ping:\n      delegate_to: &quot;{{ item }}&quot;\n      loop: &quot;{{ groups[&#039;k8s_all&#039;] }}&quot;\n\n    # Container runtime setup\n    - name: Install containerd\n      include_role:\n        name: containerd\n      vars:\n        containerd_version: &quot;{{ containerd_version }}&quot;\n\n    # Kubernetes installation\n    - name: Install Kubernetes components\n      include_role:\n        name: kubernetes\n      vars:\n        kubernetes_version: &quot;{{ k8s_version }}&quot;\n\n    # Cluster initialization\n    - name: Initialize Kubernetes cluster\n      shell: |\n        kubeadm init \\\n          --pod-network-cidr=10.244.0.0/16 \\\n          --service-cidr=10.96.0.0/12 \\\n          --apiserver-advertise-address={{ ansible_default_ipv4.address }} \\\n          --node-name={{ inventory_hostname }}\n      args:\n        creates: /etc/kubernetes/admin.conf\n      register: kubeadm_init\n\n    - name: Create .kube directory\n      file:\n        path: &quot;{{ ansible_env.HOME }}/.kube&quot;\n        state: directory\n        mode: &#039;0755&#039;\n\n    - name: Copy admin.conf to user&#039;s kube config\n      copy:\n        src: /etc/kubernetes/admin.conf\n        dest: &quot;{{ ansible_env.HOME }}/.kube/config&quot;\n        owner: &quot;{{ ansible_user }}&quot;\n        group: &quot;{{ ansible_user }}&quot;\n        mode: &#039;0644&#039;\n        remote_src: yes\n\n    # Network plugin installation\n    - name: Install Flannel CNI\n      shell: kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n      environment:\n        KUBECONFIG: &quot;{{ ansible_env.HOME }}/.kube/config&quot;\n\n    # Join worker nodes\n    - name: Get join command\n      shell: kubeadm token create --print-join-command\n      register: join_command\n      when: inventory_hostname in groups[&#039;k8s_masters&#039;][0]\n\n    - name: Join worker nodes to cluster\n      shell: &quot;{{ hostvars[groups[&#039;k8s_masters&#039;][0]][&#039;join_command&#039;].stdout }}&quot;\n      when: inventory_hostname in groups[&#039;k8s_workers&#039;]\n\n  post_tasks:\n    - name: Verify cluster status\n      shell: kubectl get nodes\n      environment:\n        KUBECONFIG: &quot;{{ ansible_env.HOME }}/.kube/config&quot;\n      register: cluster_status\n      when: inventory_hostname in groups[&#039;k8s_masters&#039;][0]\n\n    - name: Display cluster status\n      debug:\n        var: cluster_status.stdout_lines\n      when: inventory_hostname in groups[&#039;k8s_masters&#039;][0]\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"performance-optimization-and-scaling\" class=\"mobile-header\">Performance Optimization and Scaling</h2>\n<h3 id=\"parallel-execution-strategies\" class=\"mobile-header\">Parallel Execution Strategies</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create high-performance playbook configuration\ncat &gt; playbooks/high-performance-deployment.yml &lt;&lt;EOF\n---\n- name: High-Performance Deployment\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  serial: &quot;30%&quot;   # Process 30% of hosts at a time\n  max_fail_percentage: 10\n  gather_facts: yes\n  fact_caching: smart\n  vars:\n    deployment_batch_size: 10\n    max_concurrent_tasks: 50\n\n  pre_tasks:\n    - name: Check system load\n      shell: uptime | awk &#039;{print $(NF-2)}&#039; | sed &#039;s/,//&#039;\n      register: system_load\n      changed_when: false\n\n    - name: Skip high-load systems\n      meta: end_host\n      when: system_load.stdout | float &gt; 5.0\n\n  tasks:\n    - name: Update packages with retries\n      package:\n        name: &quot;*&quot;\n        state: latest\n      retries: 3\n      delay: 30\n      async: 300\n      poll: 10\n\n    - name: Deploy configuration files in parallel\n      template:\n        src: &quot;{{ item.src }}&quot;\n        dest: &quot;{{ item.dest }}&quot;\n        mode: &quot;{{ item.mode | default(&#039;0644&#039;) }}&quot;\n        backup: yes\n      loop:\n        - { src: &quot;nginx.conf.j2&quot;, dest: &quot;/etc/nginx/nginx.conf&quot; }\n        - { src: &quot;mysql.cnf.j2&quot;, dest: &quot;/etc/mysql/my.cnf&quot; }\n        - { src: &quot;redis.conf.j2&quot;, dest: &quot;/etc/redis/redis.conf&quot; }\n      async: 120\n      poll: 5\n      register: config_deployment\n\n    - name: Wait for all configuration deployments\n      async_status:\n        jid: &quot;{{ item.ansible_job_id }}&quot;\n      loop: &quot;{{ config_deployment.results }}&quot;\n      when: item.ansible_job_id is defined\n\n  handlers:\n    - name: restart services\n      service:\n        name: &quot;{{ item }}&quot;\n        state: restarted\n      loop:\n        - nginx\n        - mysql\n        - redis\n      listen: &quot;restart all services&quot;\nEOF\n\n# Performance monitoring playbook\ncat &gt; playbooks/performance-monitoring.yml &lt;&lt;EOF\n---\n- name: Performance Monitoring Setup\n  hosts: all\n  become: yes\n  vars:\n    monitoring_tools:\n      - htop\n      - iotop\n      - nethogs\n      - dstat\n      - sysstat\n      - perf\n\n  tasks:\n    - name: Install performance monitoring tools\n      package:\n        name: &quot;{{ monitoring_tools }}&quot;\n        state: present\n\n    - name: Configure system monitoring\n      template:\n        src: templates/sysstat.j2\n        dest: /etc/default/sysstat\n        backup: yes\n      when: ansible_os_family == &quot;Debian&quot;\n\n    - name: Enable system statistics collection\n      service:\n        name: &quot;{{ &#039;sysstat&#039; if ansible_os_family == &#039;Debian&#039; else &#039;sysstat&#039; }}&quot;\n        enabled: yes\n        state: started\n\n    - name: Create performance monitoring script\n      template:\n        src: templates/performance-monitor.sh.j2\n        dest: /usr/local/bin/performance-monitor.sh\n        mode: &#039;0755&#039;\n\n    - name: Schedule performance monitoring\n      cron:\n        name: &quot;Performance monitoring&quot;\n        minute: &quot;*/5&quot;\n        job: &quot;/usr/local/bin/performance-monitor.sh&quot;\n        user: root\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"testing-and-validation\" class=\"mobile-header\">Testing and Validation</h2>\n<h3 id=\"molecule-testing-framework\" class=\"mobile-header\">Molecule Testing Framework</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Molecule for role testing\npip install molecule[docker] molecule[vagrant] molecule[libvirt]\n\n# Initialize Molecule in role directory\ncd roles/nginx\nmolecule init scenario --driver-name docker\n\n# Create molecule configuration\ncat &gt; molecule/default/molecule.yml &lt;&lt;EOF\n---\ndependency:\n  name: galaxy\ndriver:\n  name: docker\nplatforms:\n  - name: nginx-ubuntu\n    image: ubuntu:22.04\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /lib/systemd/systemd\n    networks:\n      - name: molecule\n  - name: nginx-centos\n    image: centos:8\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /usr/sbin/init\n    networks:\n      - name: molecule\nprovisioner:\n  name: ansible\n  config_options:\n    defaults:\n      callbacks_enabled: profile_tasks,timer,yaml\n  inventory:\n    host_vars:\n      nginx-ubuntu:\n        ansible_python_interpreter: /usr/bin/python3\n      nginx-centos:\n        ansible_python_interpreter: /usr/bin/python3\nverifier:\n  name: ansible\nlint: |\n  set -e\n  yamllint .\n  ansible-lint\n  flake8\nEOF\n\n# Create test playbook\ncat &gt; molecule/default/converge.yml &lt;&lt;EOF\n---\n- name: Converge\n  hosts: all\n  become: true\n  tasks:\n    - name: &quot;Include nginx role&quot;\n      include_role:\n        name: nginx\n      vars:\n        nginx_vhosts:\n          - name: default\n            server_name: localhost\n            listen: 80\n            root: /var/www/html\n            enabled: true\nEOF\n\n# Create test verification\ncat &gt; molecule/default/verify.yml &lt;&lt;EOF\n---\n- name: Verify\n  hosts: all\n  gather_facts: false\n  tasks:\n    - name: Check if NGINX is running\n      uri:\n        url: http://localhost\n        method: GET\n      register: nginx_check\n\n    - name: Verify NGINX is responding\n      assert:\n        that:\n          - nginx_check.status == 200\n        fail_msg: &quot;NGINX is not responding correctly&quot;\n\n    - name: Check NGINX configuration\n      shell: nginx -t\n      changed_when: false\n\n    - name: Verify NGINX process\n      shell: pgrep nginx\n      changed_when: false\nEOF\n\n# Run tests\nmolecule test</code></pre>\n      </div>\n    </div>\n<h3 id=\"ansible-lint-and-security-scanning\" class=\"mobile-header\">Ansible Lint and Security Scanning</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Install Ansible Lint\npip install ansible-lint\n\n# Create .ansible-lint configuration\ncat &gt; .ansible-lint &lt;&lt;EOF\n---\nprofile: production\n\nexclude_paths:\n  - .cache/\n  - .github/\n  - molecule/\n  - .venv/\n\nskip_list:\n  - yaml[line-length]  # Allow longer lines for readability\n\nwarn_list:\n  - experimental  # Warn about experimental features\n\n# Custom rules\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments:\n    min-spaces-from-content: 1\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  trailing-spaces: enable\n  truthy:\n    allowed-values: [&#039;true&#039;, &#039;false&#039;, &#039;yes&#039;, &#039;no&#039;]\nEOF\n\n# Create security-focused playbook linting\ncat &gt; .yamllint &lt;&lt;EOF\n---\nextends: default\n\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments: disable\n  comments-indentation: disable\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n    check-multi-line-strings: false\n  key-duplicates: enable\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  octal-values:\n    forbid-implicit-octal: true\n  trailing-spaces: enable\n  truthy: disable\nEOF\n\n# Run linting\nansible-lint playbooks/\nyamllint .</code></pre>\n      </div>\n    </div>\n<h2 id=\"backup-and-disaster-recovery\" class=\"mobile-header\">Backup and Disaster Recovery</h2>\n<h3 id=\"comprehensive-backup-automation\" class=\"mobile-header\">Comprehensive Backup Automation</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/backup-automation.yml &lt;&lt;EOF\n---\n- name: Automated Backup System\n  hosts: all\n  become: yes\n  vars:\n    backup_root: /backup\n    backup_retention_days: 30\n    backup_schedule:\n      databases: &quot;0 2 * * *&quot;\n      files: &quot;0 3 * * *&quot;\n      configs: &quot;0 4 * * *&quot;\n\n  tasks:\n    - name: Create backup directories\n      file:\n        path: &quot;{{ backup_root }}/{{ item }}&quot;\n        state: directory\n        mode: &#039;0755&#039;\n        owner: root\n        group: root\n      loop:\n        - databases\n        - files\n        - configs\n        - logs\n\n    # Database backups\n    - name: Create database backup script\n      template:\n        src: templates/mysql-backup.sh.j2\n        dest: /usr/local/bin/mysql-backup.sh\n        mode: &#039;0755&#039;\n      when: &quot;&#039;dbservers&#039; in group_names&quot;\n\n    - name: Schedule database backups\n      cron:\n        name: &quot;MySQL backup&quot;\n        minute: &quot;0&quot;\n        hour: &quot;2&quot;\n        job: &quot;/usr/local/bin/mysql-backup.sh&quot;\n        user: root\n      when: &quot;&#039;dbservers&#039; in group_names&quot;\n\n    # File system backups\n    - name: Create file backup script\n      template:\n        src: templates/file-backup.sh.j2\n        dest: /usr/local/bin/file-backup.sh\n        mode: &#039;0755&#039;\n\n    - name: Schedule file backups\n      cron:\n        name: &quot;File system backup&quot;\n        minute: &quot;0&quot;\n        hour: &quot;3&quot;\n        job: &quot;/usr/local/bin/file-backup.sh&quot;\n        user: root\n\n    # Configuration backups\n    - name: Backup system configurations\n      archive:\n        path:\n          - /etc/nginx\n          - /etc/mysql\n          - /etc/systemd/system\n          - /etc/crontab\n          - /etc/hosts\n          - /etc/fstab\n        dest: &quot;{{ backup_root }}/configs/system-config-{{ ansible_date_time.epoch }}.tar.gz&quot;\n        mode: &#039;0600&#039;\n\n    # Remote backup synchronization\n    - name: Synchronize backups to remote storage\n      synchronize:\n        src: &quot;{{ backup_root }}/&quot;\n        dest: &quot;backup-server.example.com:{{ backup_root }}/{{ inventory_hostname }}/&quot;\n        delete: yes\n        rsync_opts:\n          - &quot;--exclude=*.tmp&quot;\n          - &quot;--compress&quot;\n          - &quot;--archive&quot;\n      when: backup_remote_sync | default(true)\n\n    # Cleanup old backups\n    - name: Clean up old backup files\n      find:\n        paths: &quot;{{ backup_root }}&quot;\n        age: &quot;{{ backup_retention_days }}d&quot;\n        file_type: file\n      register: old_backups\n\n    - name: Remove old backup files\n      file:\n        path: &quot;{{ item.path }}&quot;\n        state: absent\n      loop: &quot;{{ old_backups.files }}&quot;\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"verification-and-monitoring\" class=\"mobile-header\">Verification and Monitoring</h2>\n<h3 id=\"cross-platform-system-verification\" class=\"mobile-header\">Cross-Platform System Verification</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create comprehensive verification playbook\ncat &gt; playbooks/system-verification.yml &lt;&lt;EOF\n---\n- name: System Verification and Health Check\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    health_checks:\n      - service: nginx\n        port: 80\n        process: nginx\n      - service: mysql\n        port: 3306\n        process: mysqld\n      - service: redis\n        port: 6379\n        process: redis-server\n\n  tasks:\n    # System information gathering\n    - name: Gather system information\n      setup:\n        gather_subset:\n          - all\n          - !facter\n          - !ohai\n\n    # Service verification\n    - name: Check critical services status\n      service_facts:\n\n    - name: Verify services are running\n      assert:\n        that:\n          - &quot;ansible_facts.services[item.service + &#039;.service&#039;].state == &#039;running&#039;&quot;\n        fail_msg: &quot;Service {{ item.service }} is not running&quot;\n        success_msg: &quot;Service {{ item.service }} is healthy&quot;\n      loop: &quot;{{ health_checks }}&quot;\n      when: &quot;item.service + &#039;.service&#039; in ansible_facts.services&quot;\n\n    # Network connectivity tests\n    - name: Test network connectivity\n      wait_for:\n        host: &quot;{{ item.host }}&quot;\n        port: &quot;{{ item.port }}&quot;\n        timeout: 5\n      loop:\n        - { host: &quot;8.8.8.8&quot;, port: 53 }\n        - { host: &quot;1.1.1.1&quot;, port: 53 }\n      ignore_errors: yes\n\n    # Disk space monitoring\n    - name: Check disk space usage\n      shell: df -h | awk &#039;$5 &gt; &quot;85%&quot; {print $0}&#039;\n      register: disk_usage\n      changed_when: false\n      failed_when: disk_usage.stdout != &quot;&quot;\n\n    # Memory usage check\n    - name: Check memory usage\n      shell: free | grep Mem | awk &#039;{printf &quot;%.0f&quot;, $3/$2 * 100.0}&#039;\n      register: memory_usage\n      changed_when: false\n\n    - name: Alert on high memory usage\n      debug:\n        msg: &quot;WARNING: Memory usage is {{ memory_usage.stdout }}%&quot;\n      when: memory_usage.stdout | int &gt; 85\n\n    # Security verification\n    - name: Check for failed login attempts\n      shell: grep &quot;Failed password&quot; /var/log/auth.log | tail -10\n      register: failed_logins\n      changed_when: false\n      ignore_errors: yes\n      when: ansible_os_family == &quot;Debian&quot;\n\n    - name: Check firewall status\n      shell: |\n        if command -v ufw &gt;/dev/null 2&gt;&amp;1; then\n          ufw status\n        elif command -v firewall-cmd &gt;/dev/null 2&gt;&amp;1; then\n          firewall-cmd --state\n        else\n          echo &quot;No supported firewall found&quot;\n        fi\n      register: firewall_status\n      changed_when: false\n\n  post_tasks:\n    - name: Generate system health report\n      template:\n        src: templates/health-report.j2\n        dest: &quot;/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt&quot;\n        mode: &#039;0644&#039;\n\n    - name: Fetch health reports\n      fetch:\n        src: &quot;/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt&quot;\n        dest: &quot;./reports/&quot;\n        flat: yes\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"continuous-compliance-monitoring\" class=\"mobile-header\">Continuous Compliance Monitoring</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; playbooks/compliance-monitoring.yml &lt;&lt;EOF\n---\n- name: Continuous Compliance Monitoring\n  hosts: all\n  become: yes\n  vars:\n    compliance_standards:\n      - cis\n      - pci_dss\n      - soc2\n      - hipaa\n    \n    audit_log_paths:\n      - /var/log/auth.log\n      - /var/log/syslog\n      - /var/log/audit/audit.log\n\n  tasks:\n    # Install audit tools\n    - name: Install audit daemon\n      package:\n        name: &quot;{{ &#039;auditd&#039; if ansible_os_family == &#039;RedHat&#039; else &#039;auditd&#039; }}&quot;\n        state: present\n\n    - name: Configure audit rules\n      template:\n        src: templates/audit.rules.j2\n        dest: /etc/audit/rules.d/audit.rules\n        backup: yes\n      notify: restart auditd\n\n    # CIS compliance checks\n    - name: Run CIS benchmark checks\n      shell: |\n        if [ -f /opt/cis-cat/CIS-CAT.sh ]; then\n          /opt/cis-cat/CIS-CAT.sh -b /opt/cis-cat/benchmarks/\n        else\n          echo &quot;CIS-CAT not installed, skipping&quot;\n        fi\n      register: cis_results\n      ignore_errors: yes\n\n    # File integrity monitoring\n    - name: Install AIDE\n      package:\n        name: aide\n        state: present\n\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: &quot;AIDE integrity check&quot;\n        minute: &quot;0&quot;\n        hour: &quot;3&quot;\n        job: &quot;/usr/bin/aide --check | mail -s &#039;AIDE Report&#039; security@example.com&quot;\n        user: root\n\n    # Log monitoring\n    - name: Install log monitoring tools\n      package:\n        name:\n          - logwatch\n          - rsyslog\n        state: present\n\n    - name: Configure centralized logging\n      template:\n        src: templates/rsyslog.conf.j2\n        dest: /etc/rsyslog.conf\n        backup: yes\n      notify: restart rsyslog\n\n  handlers:\n    - name: restart auditd\n      service:\n        name: auditd\n        state: restarted\n\n    - name: restart rsyslog\n      service:\n        name: rsyslog\n        state: restarted\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"cicd-integration\" class=\"mobile-header\">CI/CD Integration</h2>\n<h3 id=\"jenkins-pipeline-integration\" class=\"mobile-header\">Jenkins Pipeline Integration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Create Jenkinsfile for Ansible automation\ncat &gt; Jenkinsfile &lt;&lt;EOF\npipeline {\n    agent any\n    \n    environment {\n        ANSIBLE_CONFIG = &#039;ansible.cfg&#039;\n        ANSIBLE_HOST_KEY_CHECKING = &#039;False&#039;\n    }\n    \n    stages {\n        stage(&#039;Lint&#039;) {\n            steps {\n                sh &#039;ansible-lint playbooks/&#039;\n                sh &#039;yamllint .&#039;\n            }\n        }\n        \n        stage(&#039;Syntax Check&#039;) {\n            steps {\n                sh &#039;ansible-playbook playbooks/site.yml --syntax-check&#039;\n            }\n        }\n        \n        stage(&#039;Dry Run&#039;) {\n            steps {\n                sh &#039;ansible-playbook playbooks/site.yml --check --diff&#039;\n            }\n        }\n        \n        stage(&#039;Deploy to Staging&#039;) {\n            when {\n                branch &#039;develop&#039;\n            }\n            steps {\n                sh &#039;ansible-playbook -i inventories/staging playbooks/site.yml&#039;\n            }\n        }\n        \n        stage(&#039;Deploy to Production&#039;) {\n            when {\n                branch &#039;main&#039;\n            }\n            steps {\n                input &#039;Deploy to Production?&#039;\n                sh &#039;ansible-playbook -i inventories/production playbooks/site.yml&#039;\n            }\n        }\n        \n        stage(&#039;Verify Deployment&#039;) {\n            steps {\n                sh &#039;ansible-playbook playbooks/system-verification.yml&#039;\n            }\n        }\n    }\n    \n    post {\n        always {\n            archiveArtifacts artifacts: &#039;logs/*.log&#039;, allowEmptyArchive: true\n            publishHTML([\n                allowMissing: false,\n                alwaysLinkToLastBuild: true,\n                keepAll: true,\n                reportDir: &#039;reports&#039;,\n                reportFiles: &#039;*.html&#039;,\n                reportName: &#039;Ansible Report&#039;\n            ])\n        }\n        failure {\n            emailext (\n                subject: &quot;Failed Pipeline: ${env.JOB_NAME} - ${env.BUILD_NUMBER}&quot;,\n                body: &quot;Something is wrong with ${env.BUILD_URL}&quot;,\n                to: &quot;${env.DEFAULT_RECIPIENTS}&quot;\n            )\n        }\n    }\n}\nEOF</code></pre>\n      </div>\n    </div>\n<h3 id=\"gitlab-ci-integration\" class=\"mobile-header\">GitLab CI Integration</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\">cat &gt; .gitlab-ci.yml &lt;&lt;EOF\nstages:\n  - lint\n  - test\n  - deploy-staging\n  - deploy-production\n\nvariables:\n  ANSIBLE_CONFIG: ansible.cfg\n  ANSIBLE_HOST_KEY_CHECKING: &quot;False&quot;\n\nbefore_script:\n  - pip install ansible ansible-lint yamllint\n  - ansible-galaxy install -r requirements.yml\n\nlint:\n  stage: lint\n  script:\n    - ansible-lint playbooks/\n    - yamllint .\n  rules:\n    - if: &#039;$CI_MERGE_REQUEST_IID&#039;\n    - if: &#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH&#039;\n\nsyntax-check:\n  stage: test\n  script:\n    - ansible-playbook playbooks/site.yml --syntax-check\n    - ansible-playbook playbooks/site.yml --check --diff -i inventories/staging\n  rules:\n    - if: &#039;$CI_MERGE_REQUEST_IID&#039;\n    - if: &#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH&#039;\n\ndeploy-staging:\n  stage: deploy-staging\n  script:\n    - ansible-playbook -i inventories/staging playbooks/site.yml\n  rules:\n    - if: &#039;$CI_COMMIT_BRANCH == &quot;develop&quot;&#039;\n\ndeploy-production:\n  stage: deploy-production\n  script:\n    - ansible-playbook -i inventories/production playbooks/site.yml\n  rules:\n    - if: &#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH&#039;\n      when: manual\n  environment:\n    name: production\n    url: https://production.example.com\nEOF</code></pre>\n      </div>\n    </div>\n<h2 id=\"troubleshooting-cross-platform\" class=\"mobile-header\">Troubleshooting (Cross-Platform)</h2>\n<h3 id=\"common-issues-and-solutions\" class=\"mobile-header\">Common Issues and Solutions</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Debug connection issues\nansible all -m ping -vvv\n\n# Check SSH connectivity\nansible all -m setup --ask-pass --ask-become-pass\n\n# Verify inventory\nansible-inventory --list\nansible-inventory --graph\n\n# Test specific host\nansible target-host -m command -a &quot;uptime&quot;\n\n# Check syntax without execution\nansible-playbook playbooks/site.yml --syntax-check\n\n# Dry run with verbose output\nansible-playbook playbooks/site.yml --check --diff -vvv\n\n# Debug variable resolution\nansible-playbook playbooks/site.yml --extra-vars=&quot;debug=true&quot; --tags debug\n\n# Check facts\nansible all -m setup | grep ansible_os_family\n\n# Connection troubleshooting\nssh -vvv user@target-host\n\n# Permission issues\nansible all -m file -a &quot;path=/tmp/test state=touch&quot; --become\n\n# Vault issues\nansible-vault view group_vars/all/vault.yml\n\n# Performance debugging\nansible-playbook playbooks/site.yml --start-at-task=&quot;specific task name&quot;\nansible-playbook playbooks/site.yml --step\n\n# Module testing\nansible localhost -m debug -a &quot;var=hostvars&quot;\nansible localhost -m setup\n\n# Check for syntax errors in roles\nfind roles/ -name &quot;*.yml&quot; -exec ansible-playbook {} --syntax-check \\;</code></pre>\n      </div>\n    </div>\n<h3 id=\"advanced-debugging\" class=\"mobile-header\">Advanced Debugging</h3>\n<div class=\"mobile-code-block\" data-language=\"bash\">\n      <div class=\"mobile-code-header\">\n        <span class=\"mobile-code-language\">bash</span>\n        <button class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\">\n          <span class=\"copy-icon\">📋</span>\n          <span class=\"copy-text\">Copy</span>\n        </button>\n      </div>\n      <div class=\"mobile-code-content\">\n        <pre><code class=\"language-bash\"># Enable comprehensive logging\nexport ANSIBLE_DEBUG=1\nexport ANSIBLE_VERBOSITY=4\nansible-playbook playbooks/site.yml\n\n# Profile playbook execution\nansible-playbook playbooks/site.yml --extra-vars=&quot;profile_tasks_sort_order=none&quot;\n\n# Memory usage analysis\nansible-playbook playbooks/site.yml --extra-vars=&quot;ansible_python_interpreter=/usr/bin/python3&quot;\n\n# Network debugging\nansible all -m command -a &quot;ss -tulpn&quot;\nansible all -m command -a &quot;netstat -rn&quot;\n\n# Process debugging\nansible all -m command -a &quot;ps aux --sort=-%mem | head -10&quot;\n\n# Disk usage analysis\nansible all -m command -a &quot;df -h&quot;\nansible all -m command -a &quot;du -sh /var/log/*&quot;\n\n# Service debugging\nansible all -m systemd -a &quot;name=nginx&quot; --become\nansible all -m command -a &quot;systemctl status nginx&quot; --become\n\n# Variable debugging\nansible-playbook playbooks/site.yml --extra-vars=&quot;debug_vars=true&quot; --tags debug_vars</code></pre>\n      </div>\n    </div>\n<h2 id=\"additional-resources\" class=\"mobile-header\">Additional Resources</h2>\n<li class=\"mobile-list-item\"><a href=\"https://docs.ansible.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Official Documentation</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://galaxy.ansible.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Ansible Galaxy</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Best Practices Guide</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.ansible.com/ansible/latest/user_guide/become.html#security-best-practices\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Security Best Practices</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://molecule.readthedocs.io/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Ansible Molecule Testing</a></li>\n<li class=\"mobile-list-item\"><a href=\"https://docs.ansible.com/ansible/latest/collections/index.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">Community Collections</a></li>\n<p class=\"mobile-paragraph\">---</p>\n<p class=\"mobile-paragraph\"><strong>Note:</strong> This guide is part of the <a href=\"https://howtomgr.github.io\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\">HowToMgr</a> collection.</p>","readTime":"31 min","wordCount":6191,"lastBuilt":"2025-09-14T03:45:51.595Z"}]},"__N_SSG":true}