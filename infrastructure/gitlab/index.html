<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/><meta name="theme-color" content="#bd93f9"/><link rel="icon" href="/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><title class="jsx-f92e766e9414ef16">Gitlab Installation Guide - HowToMgr</title><meta name="description" content="Repo for gitlab" class="jsx-f92e766e9414ef16"/><meta name="keywords" content="installation guides, tutorials, linux, docker, kubernetes, mobile-first, responsive" class="jsx-f92e766e9414ef16"/><meta property="og:title" content="Gitlab Installation Guide - HowToMgr" class="jsx-f92e766e9414ef16"/><meta property="og:description" content="Repo for gitlab" class="jsx-f92e766e9414ef16"/><meta property="og:type" content="website" class="jsx-f92e766e9414ef16"/><meta property="og:url" content="https://howtomgr.github.io" class="jsx-f92e766e9414ef16"/><meta property="og:image" content="https://howtomgr.github.io/social-preview.png" class="jsx-f92e766e9414ef16"/><meta property="twitter:card" content="summary_large_image" class="jsx-f92e766e9414ef16"/><meta property="twitter:title" content="Gitlab Installation Guide - HowToMgr" class="jsx-f92e766e9414ef16"/><meta property="twitter:description" content="Repo for gitlab" class="jsx-f92e766e9414ef16"/><meta name="next-head-count" content="17"/><link rel="dns-prefetch" href="//api.github.com"/><link rel="dns-prefetch" href="//github.com"/><link rel="preload" href="/favicon.ico" as="image"/><meta name="application-name" content="HowToMgr"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><meta name="apple-mobile-web-app-title" content="HowToMgr"/><meta name="format-detection" content="telephone=no"/><meta name="mobile-web-app-capable" content="yes"/><noscript><style>
            .requires-js { display: none !important; }
            .no-js-message { display: block !important; }
          </style></noscript><link rel="preload" href="/_next/static/css/eec6c1c201affe77.css" as="style"/><link rel="stylesheet" href="/_next/static/css/eec6c1c201affe77.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2b1f7a23d657eae4.js" defer=""></script><script src="/_next/static/chunks/main-6ec3f7584970eebe.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f7367f88af207b64.js" defer=""></script><script src="/_next/static/chunks/119-abfbe7c9e22798da.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcategory%5D/%5Bguide%5D-ae7274cbb918ed8b.js" defer=""></script><script src="/_next/static/FWaJNz_CPEuOjXz3AhtJ8/_buildManifest.js" defer=""></script><script src="/_next/static/FWaJNz_CPEuOjXz3AhtJ8/_ssgManifest.js" defer=""></script><style id="__jsx-8a7f0cdcf94f52ce">.breadcrumb.jsx-8a7f0cdcf94f52ce{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--space-2);margin-bottom:var(--space-6);font-size:var(--font-sm);color:var(--text-secondary);overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}.breadcrumb.jsx-8a7f0cdcf94f52ce a.jsx-8a7f0cdcf94f52ce{color:var(--accent-primary);text-decoration:none;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.breadcrumb.jsx-8a7f0cdcf94f52ce a.jsx-8a7f0cdcf94f52ce:hover{text-decoration:underline}.separator.jsx-8a7f0cdcf94f52ce{color:var(--text-muted);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.current.jsx-8a7f0cdcf94f52ce{color:var(--text-primary);font-weight:500;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.guide-header.jsx-8a7f0cdcf94f52ce{background:var(--bg-secondary);-webkit-border-radius:var(--border-radius-lg);-moz-border-radius:var(--border-radius-lg);border-radius:var(--border-radius-lg);padding:var(--space-6);margin-bottom:var(--space-8);border:1px solid var(--bg-surface)}.guide-title.jsx-8a7f0cdcf94f52ce{color:var(--accent-primary);font-size:var(--font-3xl);margin-bottom:var(--space-4);line-height:1.2;word-break:break-word}.guide-description.jsx-8a7f0cdcf94f52ce{color:var(--text-secondary);font-size:var(--font-lg);margin-bottom:var(--space-5);line-height:1.5}.guide-badges.jsx-8a7f0cdcf94f52ce{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:var(--space-3);margin-bottom:var(--space-5);-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.guide-actions.jsx-8a7f0cdcf94f52ce{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:var(--space-3);-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.guide-content.jsx-8a7f0cdcf94f52ce{background:var(--bg-secondary);-webkit-border-radius:var(--border-radius-lg);-moz-border-radius:var(--border-radius-lg);border-radius:var(--border-radius-lg);padding:var(--space-6);margin-bottom:var(--space-8);border:1px solid var(--bg-surface);overflow-x:hidden}.related-section.jsx-8a7f0cdcf94f52ce{margin-bottom:var(--space-8)}.section-title.jsx-8a7f0cdcf94f52ce{color:var(--accent-primary);font-size:var(--font-2xl);text-align:center;margin-bottom:var(--space-6)}.guide-navigation.jsx-8a7f0cdcf94f52ce{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:var(--space-4);-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-bottom:var(--space-8)}.loading-container.jsx-8a7f0cdcf94f52ce,.error-container.jsx-8a7f0cdcf94f52ce{text-align:center;padding:var(--space-8)}.error-actions.jsx-8a7f0cdcf94f52ce{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:var(--space-4);-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:var(--space-6);-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}@media(max-width:767px){.guide-header.jsx-8a7f0cdcf94f52ce{padding:var(--space-4);margin-bottom:var(--space-6)}.guide-title.jsx-8a7f0cdcf94f52ce{font-size:var(--font-2xl)}.guide-description.jsx-8a7f0cdcf94f52ce{font-size:var(--font-base)}.guide-content.jsx-8a7f0cdcf94f52ce{padding:var(--space-4);margin-bottom:var(--space-6)}.guide-badges.jsx-8a7f0cdcf94f52ce{gap:var(--space-2)}.guide-actions.jsx-8a7f0cdcf94f52ce{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.guide-navigation.jsx-8a7f0cdcf94f52ce{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.breadcrumb.jsx-8a7f0cdcf94f52ce{margin-bottom:var(--space-4)}}</style><style id="__jsx-f92e766e9414ef16">.app-container.jsx-f92e766e9414ef16{min-height:100vh;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding-top:56px}.main-content.jsx-f92e766e9414ef16{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;padding:var(--space-6)0}.mobile-footer.jsx-f92e766e9414ef16{background:var(--bg-secondary);border-top:1px solid var(--bg-surface);padding:var(--space-6)0;margin-top:auto}.footer-content.jsx-f92e766e9414ef16{text-align:center}.footer-links.jsx-f92e766e9414ef16{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:var(--space-6);margin-bottom:var(--space-4);-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.footer-links.jsx-f92e766e9414ef16 a.jsx-f92e766e9414ef16{color:var(--accent-primary);text-decoration:none;font-size:var(--font-sm)}.footer-links.jsx-f92e766e9414ef16 a.jsx-f92e766e9414ef16:hover{color:var(--accent-secondary)}.footer-separator.jsx-f92e766e9414ef16{height:1px;background:var(--bg-surface);margin:var(--space-4)auto;width:200px}.footer-text.jsx-f92e766e9414ef16,.footer-tech.jsx-f92e766e9414ef16{color:var(--text-secondary);font-size:var(--font-sm);margin-bottom:var(--space-2)}.footer-disclaimer.jsx-f92e766e9414ef16{color:var(--text-muted);font-size:var(--font-xs)}.nav-links.jsx-f92e766e9414ef16{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:var(--space-4)}.nav-link.jsx-f92e766e9414ef16{color:var(--text-primary);text-decoration:none;padding:var(--space-2)var(--space-3);-webkit-border-radius:var(--border-radius);-moz-border-radius:var(--border-radius);border-radius:var(--border-radius);font-size:var(--font-sm);font-weight:500;-webkit-transition:var(--transition);-moz-transition:var(--transition);-o-transition:var(--transition);transition:var(--transition);min-height:36px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.nav-link.jsx-f92e766e9414ef16:hover{background:var(--bg-surface);color:var(--accent-primary);text-decoration:none}[data-theme="light"].jsx-f92e766e9414ef16 .theme-icon-dark.jsx-f92e766e9414ef16{display:none}[data-theme="light"].jsx-f92e766e9414ef16 .theme-icon-light.jsx-f92e766e9414ef16{display:inline!important}@media(max-width:767px){.main-content.jsx-f92e766e9414ef16{padding:var(--space-4)0}.footer-links.jsx-f92e766e9414ef16{gap:var(--space-4)}}</style></head><body><noscript><div class="no-js-message" style="padding:1rem;background:#ff5555;color:#f8f8f2;text-align:center;font-size:0.9rem">This site requires JavaScript to function properly. Please enable JavaScript in your browser.</div></noscript><div id="__next"><div class="jsx-f92e766e9414ef16 app-container"><a href="#main-content" class="jsx-f92e766e9414ef16 skip-link">Skip to main content</a><nav class="jsx-f92e766e9414ef16 mobile-nav"><div class="jsx-f92e766e9414ef16 mobile-nav-content"><a class="mobile-brand" href="/"><span role="img" aria-label="Books" class="jsx-f92e766e9414ef16">📚</span>HowToMgr</a><div class="jsx-f92e766e9414ef16 nav-links"><a class="nav-link" href="/all/">All</a><a class="nav-link" href="/search/">Search</a></div><button aria-label="Toggle theme" title="Switch theme" class="jsx-f92e766e9414ef16 mobile-theme-toggle touch-target"><span class="jsx-f92e766e9414ef16 theme-icon-dark">🌙</span><span style="display:none" class="jsx-f92e766e9414ef16 theme-icon-light">☀️</span></button></div></nav><main id="main-content" tabindex="-1" class="jsx-f92e766e9414ef16 main-content"><div class="jsx-f92e766e9414ef16 container"><nav aria-label="Breadcrumb" class="jsx-8a7f0cdcf94f52ce breadcrumb"><a href="/">Home</a><span class="jsx-8a7f0cdcf94f52ce separator">→</span><a href="/infrastructure/">Infrastructure</a><span class="jsx-8a7f0cdcf94f52ce separator">→</span><span class="jsx-8a7f0cdcf94f52ce current">Gitlab</span></nav><header class="jsx-8a7f0cdcf94f52ce guide-header"><div class="jsx-8a7f0cdcf94f52ce guide-meta-top"><h1 class="jsx-8a7f0cdcf94f52ce guide-title">Gitlab</h1><p class="jsx-8a7f0cdcf94f52ce guide-description">Repo for gitlab</p><div class="jsx-8a7f0cdcf94f52ce guide-badges"><span class="jsx-8a7f0cdcf94f52ce mobile-badge mobile-badge-primary">Infrastructure</span><span class="jsx-8a7f0cdcf94f52ce mobile-badge mobile-badge-info">29 min</span></div><div class="jsx-8a7f0cdcf94f52ce guide-actions"><a href="https://github.com/howtomgr/gitlab" target="_blank" rel="noopener" class="jsx-8a7f0cdcf94f52ce btn btn-secondary">View on GitHub</a></div></div></header><article class="jsx-8a7f0cdcf94f52ce guide-content"><div class="jsx-8a7f0cdcf94f52ce readme-content"><h1 id="gitlab-installation-guide" class="mobile-header">GitLab Installation Guide</h1>
<p class="mobile-paragraph">Complete DevOps platform with Git repository management, CI/CD pipelines, issue tracking, and container registry. Enterprise-grade solution for modern software development lifecycle with advanced security features.</p>
<h2 id="prerequisites" class="mobile-header">Prerequisites</h2>
<li class="mobile-list-item">Linux system (any modern distribution)</li>
<li class="mobile-list-item">8GB RAM minimum, 16GB+ recommended for production</li>
<li class="mobile-list-item">4 CPU cores minimum, 8+ recommended</li>
<li class="mobile-list-item">50GB+ available disk space, SSD recommended</li>
<li class="mobile-list-item">Domain name for external access</li>
<li class="mobile-list-item">SSL certificates for production deployment</li>
<li class="mobile-list-item">SMTP server for email notifications</li>
<h2 id="installation" class="mobile-header">Installation</h2>
<h3 id="using-omnibus-package-recommended" class="mobile-header">Using Omnibus Package (Recommended)</h3>
<p class="mobile-paragraph">#### Ubuntu/Debian</p>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Install dependencies
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificates tzdata perl postfix

# Configure Postfix for email
sudo dpkg-reconfigure postfix

# Add GitLab repository
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash

# Install GitLab Enterprise Edition
sudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; apt-get install -y gitlab-ee

# For GitLab Community Edition
sudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; apt-get install -y gitlab-ce

# Initial configuration
sudo gitlab-ctl reconfigure

# Check status
sudo gitlab-ctl status</code></pre>
      </div>
    </div>
<p class="mobile-paragraph">#### RHEL/CentOS/Rocky Linux/AlmaLinux</p>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Install dependencies
sudo yum install -y curl policycoreutils-python-utils openssh-server perl postfix

# For newer versions
sudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix

# Enable and start services
sudo systemctl enable --now sshd postfix

# Configure SELinux and firewall
sudo setsebool -P httpd_can_network_connect 1
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --reload

# Add GitLab repository
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# Install GitLab
sudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; yum install -y gitlab-ee

# Configure and start
sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<p class="mobile-paragraph">#### Fedora</p>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Install dependencies
sudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix

# Enable services
sudo systemctl enable --now sshd postfix

# Configure firewall
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload

# Add GitLab repository
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# Install GitLab
sudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; dnf install -y gitlab-ee

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h3 id="docker-installation-single-container" class="mobile-header">Docker Installation (Single Container)</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Create GitLab directories
sudo mkdir -p /srv/gitlab/{config,logs,data}

# Set environment variables
export GITLAB_HOME=/srv/gitlab

# Run GitLab container with comprehensive configuration
sudo docker run --detach \
  --hostname gitlab.example.com \
  --env GITLAB_OMNIBUS_CONFIG=&quot;
    external_url &#039;https://gitlab.example.com&#039;;
    gitlab_rails[&#039;gitlab_shell_ssh_port&#039;] = 2222;
    
    # SSL configuration
    nginx[&#039;ssl_certificate&#039;] = &#039;/etc/gitlab/ssl/gitlab.crt&#039;;
    nginx[&#039;ssl_certificate_key&#039;] = &#039;/etc/gitlab/ssl/gitlab.key&#039;;
    nginx[&#039;ssl_protocols&#039;] = &#039;TLSv1.2 TLSv1.3&#039;;
    nginx[&#039;ssl_prefer_server_ciphers&#039;] = &#039;off&#039;;
    
    # Security settings
    gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {
      &#039;enabled&#039; =&gt; true,
      &#039;ip_whitelist&#039; =&gt; [&#039;127.0.0.1&#039;, &#039;192.168.1.0/24&#039;],
      &#039;maxretry&#039; =&gt; 10,
      &#039;findtime&#039; =&gt; 60,
      &#039;bantime&#039; =&gt; 3600
    };
    
    # Performance settings
    postgresql[&#039;shared_preload_libraries&#039;] = &#039;pg_stat_statements&#039;;
    postgresql[&#039;max_connections&#039;] = 200;
    postgresql[&#039;shared_buffers&#039;] = &#039;1GB&#039;;
    postgresql[&#039;effective_cache_size&#039;] = &#039;4GB&#039;;
    
    # Container Registry
    registry_external_url &#039;https://registry.example.com&#039;;
    gitlab_rails[&#039;registry_enabled&#039;] = true;
    
    # Monitoring
    prometheus_monitoring[&#039;enable&#039;] = true;
    grafana[&#039;enable&#039;] = true;
    grafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;;
    
    # Email configuration
    gitlab_rails[&#039;smtp_enable&#039;] = true;
    gitlab_rails[&#039;smtp_address&#039;] = &#039;smtp.example.com&#039;;
    gitlab_rails[&#039;smtp_port&#039;] = 587;
    gitlab_rails[&#039;smtp_user_name&#039;] = &#039;gitlab@example.com&#039;;
    gitlab_rails[&#039;smtp_password&#039;] = &#039;smtp_secure_password&#039;;
    gitlab_rails[&#039;smtp_domain&#039;] = &#039;example.com&#039;;
    gitlab_rails[&#039;smtp_authentication&#039;] = &#039;login&#039;;
    gitlab_rails[&#039;smtp_enable_starttls_auto&#039;] = true;
    gitlab_rails[&#039;smtp_tls&#039;] = false;
    gitlab_rails[&#039;smtp_openssl_verify_mode&#039;] = &#039;peer&#039;;
    
    # Email settings
    gitlab_rails[&#039;gitlab_email_from&#039;] = &#039;gitlab@example.com&#039;;
    gitlab_rails[&#039;gitlab_email_display_name&#039;] = &#039;GitLab&#039;;
    
    # Backup configuration
    gitlab_rails[&#039;backup_keep_time&#039;] = 604800;
    gitlab_rails[&#039;backup_upload_connection&#039;] = {
      &#039;provider&#039; =&gt; &#039;AWS&#039;,
      &#039;region&#039; =&gt; &#039;us-west-2&#039;,
      &#039;aws_access_key_id&#039; =&gt; &#039;backup_access_key&#039;,
      &#039;aws_secret_access_key&#039; =&gt; &#039;backup_secret_key&#039;
    };
    gitlab_rails[&#039;backup_upload_remote_directory&#039;] = &#039;gitlab-backups&#039;;
    &quot; \
  --publish 443:443 --publish 80:80 --publish 2222:22 \
  --name gitlab \
  --restart unless-stopped \
  --volume $GITLAB_HOME/config:/etc/gitlab \
  --volume $GITLAB_HOME/logs:/var/log/gitlab \
  --volume $GITLAB_HOME/data:/var/opt/gitlab \
  --shm-size 256m \
  gitlab/gitlab-ee:latest</code></pre>
      </div>
    </div>
<h3 id="docker-compose-production-setup" class="mobile-header">Docker Compose (Production Setup)</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash">mkdir -p ~/gitlab-stack
cd ~/gitlab-stack

cat &gt; docker-compose.yml &lt;&lt;EOF
version: &#039;3.8&#039;

services:
  gitlab:
    image: gitlab/gitlab-ee:latest
    container_name: gitlab
    restart: unless-stopped
    hostname: gitlab.example.com
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url &#039;https://gitlab.example.com&#039;
        
        # Performance settings
        postgresql[&#039;shared_buffers&#039;] = &quot;2GB&quot;
        postgresql[&#039;effective_cache_size&#039;] = &quot;8GB&quot;
        postgresql[&#039;max_connections&#039;] = 300
        
        # Security settings
        gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {
          &#039;enabled&#039; =&gt; true,
          &#039;ip_whitelist&#039; =&gt; [&#039;127.0.0.1&#039;, &#039;10.0.0.0/8&#039;, &#039;172.16.0.0/12&#039;, &#039;192.168.0.0/16&#039;],
          &#039;maxretry&#039; =&gt; 10,
          &#039;findtime&#039; =&gt; 60,
          &#039;bantime&#039; =&gt; 3600
        }
        
        # Container Registry
        registry_external_url &#039;https://registry.example.com&#039;
        gitlab_rails[&#039;registry_enabled&#039;] = true
        
        # Monitoring
        prometheus_monitoring[&#039;enable&#039;] = true
        grafana[&#039;enable&#039;] = true
        
        # Let&#039;s Encrypt (disable for reverse proxy setup)
        letsencrypt[&#039;enable&#039;] = false
        nginx[&#039;listen_port&#039;] = 80
        nginx[&#039;listen_https&#039;] = false
        
        # GitLab Pages
        pages_external_url &quot;https://pages.example.com&quot;
        gitlab_pages[&#039;enable&#039;] = true
    ports:
      - &#039;80:80&#039;
      - &#039;443:443&#039;
      - &#039;2222:22&#039;
    volumes:
      - &#039;./config:/etc/gitlab&#039;
      - &#039;./logs:/var/log/gitlab&#039;
      - &#039;./data:/var/opt/gitlab&#039;
    networks:
      - gitlab
    shm_size: &#039;256m&#039;
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;gitlab-healthcheck --fail --max-time 10&quot;]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 200s

  gitlab-runner:
    image: gitlab/gitlab-runner:latest
    container_name: gitlab-runner
    restart: unless-stopped
    volumes:
      - &#039;./runner-config:/etc/gitlab-runner&#039;
      - &#039;/var/run/docker.sock:/var/run/docker.sock&#039;
    networks:
      - gitlab
    depends_on:
      - gitlab

  redis:
    image: redis:7-alpine
    container_name: gitlab-redis
    restart: unless-stopped
    command: redis-server --appendonly yes --requirepass redis_secure_password
    volumes:
      - redis-data:/data
    networks:
      - gitlab

  nginx:
    image: nginx:alpine
    container_name: gitlab-nginx
    restart: unless-stopped
    ports:
      - &#039;443:443&#039;
    volumes:
      - &#039;./nginx/nginx.conf:/etc/nginx/nginx.conf:ro&#039;
      - &#039;./nginx/ssl:/etc/nginx/ssl:ro&#039;
    depends_on:
      - gitlab
    networks:
      - gitlab

networks:
  gitlab:
    driver: bridge

volumes:
  redis-data:
EOF

# Create NGINX reverse proxy configuration
mkdir -p nginx
cat &gt; nginx/nginx.conf &lt;&lt;EOF
events {
    worker_connections 1024;
}

http {
    upstream gitlab {
        server gitlab:80;
    }
    
    upstream registry {
        server gitlab:5000;
    }

    server {
        listen 443 ssl http2;
        server_name gitlab.example.com;

        ssl_certificate /etc/nginx/ssl/gitlab.crt;
        ssl_certificate_key /etc/nginx/ssl/gitlab.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;

        client_max_body_size 0;
        gzip off;

        location / {
            proxy_pass http://gitlab;
            proxy_set_header Host \$host;
            proxy_set_header X-Real-IP \$remote_addr;
            proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto \$scheme;
        }
    }

    server {
        listen 443 ssl http2;
        server_name registry.example.com;

        ssl_certificate /etc/nginx/ssl/registry.crt;
        ssl_certificate_key /etc/nginx/ssl/registry.key;

        client_max_body_size 0;

        location /v2/ {
            proxy_pass http://registry;
            proxy_set_header Host \$host;
            proxy_set_header X-Real-IP \$remote_addr;
            proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto \$scheme;
        }
    }
}
EOF

docker-compose up -d</code></pre>
      </div>
    </div>
<h2 id="enterprise-configuration" class="mobile-header">Enterprise Configuration</h2>
<h3 id="production-configuration-etcgitlabgitlabrb" class="mobile-header">Production Configuration (/etc/gitlab/gitlab.rb)</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash">sudo tee /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF
# GitLab Enterprise Production Configuration

external_url &#039;https://gitlab.example.com&#039;

# Performance and Resource Settings
unicorn[&#039;worker_timeout&#039;] = 60
unicorn[&#039;worker_processes&#039;] = 8
sidekiq[&#039;max_concurrency&#039;] = 25
sidekiq[&#039;min_concurrency&#039;] = 10

# PostgreSQL configuration
postgresql[&#039;enable&#039;] = true
postgresql[&#039;max_connections&#039;] = 300
postgresql[&#039;shared_buffers&#039;] = &quot;2GB&quot;
postgresql[&#039;effective_cache_size&#039;] = &quot;8GB&quot;
postgresql[&#039;work_mem&#039;] = &quot;16MB&quot;
postgresql[&#039;maintenance_work_mem&#039;] = &quot;256MB&quot;
postgresql[&#039;checkpoint_completion_target&#039;] = 0.9
postgresql[&#039;wal_buffers&#039;] = &quot;16MB&quot;
postgresql[&#039;default_statistics_target&#039;] = 100
postgresql[&#039;random_page_cost&#039;] = 1.1
postgresql[&#039;effective_io_concurrency&#039;] = 200

# Redis configuration
redis[&#039;enable&#039;] = true
redis[&#039;maxmemory&#039;] = &quot;1gb&quot;
redis[&#039;maxmemory_policy&#039;] = &quot;allkeys-lru&quot;
redis[&#039;save&#039;] = &#039;900 1 300 10 60 10000&#039;
redis[&#039;password&#039;] = &#039;redis_secure_password&#039;

# Gitaly configuration (Git RPC service)
gitaly[&#039;enable&#039;] = true
gitaly[&#039;auth_token&#039;] = &#039;secure_gitaly_token&#039;
gitaly[&#039;ruby_max_rss&#039;] = 300000000  # 300MB
gitaly[&#039;concurrency&#039;] = [
  {
    &#039;rpc&#039; =&gt; &quot;/gitaly.SmartHTTPService/PostReceivePack&quot;,
    &#039;max_per_repo&#039; =&gt; 3
  },
  {
    &#039;rpc&#039; =&gt; &quot;/gitaly.SSHService/SSHUploadPack&quot;, 
    &#039;max_per_repo&#039; =&gt; 3
  }
]

# NGINX configuration
nginx[&#039;enable&#039;] = true
nginx[&#039;listen_port&#039;] = 80
nginx[&#039;listen_https&#039;] = false
nginx[&#039;redirect_http_to_https&#039;] = false
nginx[&#039;ssl_certificate&#039;] = &quot;/etc/gitlab/ssl/gitlab.crt&quot;
nginx[&#039;ssl_certificate_key&#039;] = &quot;/etc/gitlab/ssl/gitlab.key&quot;
nginx[&#039;ssl_protocols&#039;] = &quot;TLSv1.2 TLSv1.3&quot;
nginx[&#039;ssl_prefer_server_ciphers&#039;] = &quot;off&quot;
nginx[&#039;ssl_ciphers&#039;] = &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&quot;

# Container Registry
registry_external_url &#039;https://registry.example.com&#039;
gitlab_rails[&#039;registry_enabled&#039;] = true
registry[&#039;enable&#039;] = true
registry[&#039;username&#039;] = &quot;registry&quot;
registry[&#039;uid&#039;] = 996
registry[&#039;gid&#039;] = 996
registry[&#039;dir&#039;] = &quot;/var/opt/gitlab/registry&quot;
registry[&#039;log_directory&#039;] = &quot;/var/log/gitlab/registry&quot;
registry[&#039;log_level&#039;] = &quot;info&quot;
registry[&#039;rootcertbundle&#039;] = &quot;/opt/gitlab/embedded/ssl/certs/cacert.pem&quot;

# GitLab Pages
pages_external_url &quot;https://pages.example.com&quot;
gitlab_pages[&#039;enable&#039;] = true
gitlab_pages[&#039;dir&#039;] = &quot;/var/opt/gitlab/gitlab-pages&quot;
gitlab_pages[&#039;log_directory&#039;] = &quot;/var/log/gitlab/gitlab-pages&quot;
gitlab_pages[&#039;access_control&#039;] = true
gitlab_pages[&#039;use_legacy_storage&#039;] = false

# Email configuration
gitlab_rails[&#039;smtp_enable&#039;] = true
gitlab_rails[&#039;smtp_address&#039;] = &quot;smtp.example.com&quot;
gitlab_rails[&#039;smtp_port&#039;] = 587
gitlab_rails[&#039;smtp_user_name&#039;] = &quot;gitlab@example.com&quot;
gitlab_rails[&#039;smtp_password&#039;] = &quot;smtp_secure_password&quot;
gitlab_rails[&#039;smtp_domain&#039;] = &quot;example.com&quot;
gitlab_rails[&#039;smtp_authentication&#039;] = &quot;login&quot;
gitlab_rails[&#039;smtp_enable_starttls_auto&#039;] = true
gitlab_rails[&#039;smtp_tls&#039;] = false
gitlab_rails[&#039;smtp_openssl_verify_mode&#039;] = &#039;peer&#039;

gitlab_rails[&#039;gitlab_email_enabled&#039;] = true
gitlab_rails[&#039;gitlab_email_from&#039;] = &#039;gitlab@example.com&#039;
gitlab_rails[&#039;gitlab_email_display_name&#039;] = &#039;GitLab&#039;
gitlab_rails[&#039;gitlab_email_reply_to&#039;] = &#039;noreply@example.com&#039;

# Security settings
gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {
  &#039;enabled&#039; =&gt; true,
  &#039;ip_whitelist&#039; =&gt; %w{127.0.0.1 192.168.1.0/24 10.0.0.0/8},
  &#039;maxretry&#039; =&gt; 10,
  &#039;findtime&#039; =&gt; 60,
  &#039;bantime&#039; =&gt; 3600
}

# Two-factor authentication
gitlab_rails[&#039;require_two_factor_authentication&#039;] = false
gitlab_rails[&#039;two_factor_grace_period&#039;] = 8  # 8 hours instead of default 48

# Session settings
gitlab_rails[&#039;session_expire_delay&#039;] = 10080  # 1 week
gitlab_rails[&#039;session_store_enabled&#039;] = true

# Backup configuration
gitlab_rails[&#039;backup_keep_time&#039;] = 604800  # 7 days
gitlab_rails[&#039;backup_upload_connection&#039;] = {
  &#039;provider&#039; =&gt; &#039;AWS&#039;,
  &#039;region&#039; =&gt; &#039;us-west-2&#039;,
  &#039;aws_access_key_id&#039; =&gt; &#039;backup_access_key&#039;,
  &#039;aws_secret_access_key&#039; =&gt; &#039;backup_secret_key&#039;
}
gitlab_rails[&#039;backup_upload_remote_directory&#039;] = &#039;gitlab-backups&#039;
gitlab_rails[&#039;backup_multipart_chunk_size&#039;] = 104857600  # 100MB

# Monitoring
prometheus_monitoring[&#039;enable&#039;] = true
prometheus[&#039;enable&#039;] = true
prometheus[&#039;listen_address&#039;] = &#039;localhost:9090&#039;
prometheus[&#039;scrape_configs&#039;] = [
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-workhorse&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:9229&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-unicorn&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:8080&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-sidekiq&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:8082&#039;] }
    ]
  }
]

grafana[&#039;enable&#039;] = true
grafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;
grafana[&#039;disable_login_form&#039;] = false

# Logging
logging[&#039;svlogd_size&#039;] = 200 * 1024 * 1024  # 200MB
logging[&#039;svlogd_num&#039;] = 30
logging[&#039;svlogd_timeout&#039;] = 24 * 60 * 60    # rotate after 24 hours
logging[&#039;logrotate_frequency&#039;] = &quot;daily&quot;
logging[&#039;logrotate_rotate&#039;] = 30
logging[&#039;logrotate_compress&#039;] = &quot;compress&quot;

# Git settings
gitlab_rails[&#039;gitlab_default_branch&#039;] = &#039;main&#039;
gitlab_rails[&#039;max_request_duration_seconds&#039;] = 60

# Rate limiting
gitlab_rails[&#039;rate_limit_requests_per_period&#039;] = 300
gitlab_rails[&#039;rate_limit_period&#039;] = 60

# Enterprise features (if using GitLab EE)
# gitlab_rails[&#039;ee_license&#039;] = File.read(&#039;/etc/gitlab/GitLab.gitlab-license&#039;)

# Security scanning
gitlab_rails[&#039;dependency_scanning_enabled&#039;] = true
gitlab_rails[&#039;container_scanning_enabled&#039;] = true
gitlab_rails[&#039;sast_enabled&#039;] = true
gitlab_rails[&#039;secret_detection_enabled&#039;] = true

# LDAP configuration (Enterprise)
gitlab_rails[&#039;ldap_enabled&#039;] = false
gitlab_rails[&#039;prevent_ldap_sign_in&#039;] = false
gitlab_rails[&#039;ldap_servers&#039;] = {
  &#039;main&#039; =&gt; {
    &#039;label&#039; =&gt; &#039;LDAP&#039;,
    &#039;host&#039; =&gt; &#039;ldap.example.com&#039;,
    &#039;port&#039; =&gt; 636,
    &#039;uid&#039; =&gt; &#039;sAMAccountName&#039;,
    &#039;bind_dn&#039; =&gt; &#039;CN=gitlab,OU=Service Accounts,DC=example,DC=com&#039;,
    &#039;password&#039; =&gt; &#039;ldap_service_password&#039;,
    &#039;encryption&#039; =&gt; &#039;ssl&#039;,
    &#039;verify_certificates&#039; =&gt; true,
    &#039;ca_file&#039; =&gt; &#039;/etc/gitlab/ssl/ldap-ca.crt&#039;,
    &#039;base&#039; =&gt; &#039;DC=example,DC=com&#039;,
    &#039;user_filter&#039; =&gt; &#039;&#039;,
    &#039;attributes&#039; =&gt; {
      &#039;username&#039; =&gt; [&#039;uid&#039;, &#039;userid&#039;, &#039;sAMAccountName&#039;],
      &#039;email&#039; =&gt; [&#039;mail&#039;, &#039;email&#039;, &#039;userPrincipalName&#039;],
      &#039;name&#039; =&gt; &#039;cn&#039;,
      &#039;first_name&#039; =&gt; &#039;givenName&#039;,
      &#039;last_name&#039; =&gt; &#039;sn&#039;
    },
    &#039;group_base&#039; =&gt; &#039;OU=Groups,DC=example,DC=com&#039;,
    &#039;admin_group&#039; =&gt; &#039;GitLab Administrators&#039;
  }
}
EOF

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h2 id="security-hardening-2024-best-practices" class="mobile-header">Security Hardening (2024 Best Practices)</h2>
<h3 id="ssltls-configuration" class="mobile-header">SSL/TLS Configuration</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Generate SSL certificates
sudo mkdir -p /etc/gitlab/ssl

# Self-signed certificate for testing
sudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 \
  -keyout /etc/gitlab/ssl/gitlab.key \
  -out /etc/gitlab/ssl/gitlab.crt \
  -subj &quot;/C=US/ST=State/L=City/O=Organization/CN=gitlab.example.com&quot;

# Production: Let&#039;s Encrypt integration
sudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF

# Let&#039;s Encrypt configuration
letsencrypt[&#039;enable&#039;] = true
letsencrypt[&#039;contact_emails&#039;] = [&#039;admin@example.com&#039;]
letsencrypt[&#039;auto_renew&#039;] = true
letsencrypt[&#039;auto_renew_hour&#039;] = 0
letsencrypt[&#039;auto_renew_minute&#039;] = 0
letsencrypt[&#039;auto_renew_day_of_month&#039;] = &quot;*/4&quot;

# Force HTTPS
nginx[&#039;redirect_http_to_https&#039;] = true
nginx[&#039;ssl_protocols&#039;] = &quot;TLSv1.2 TLSv1.3&quot;
nginx[&#039;ssl_prefer_server_ciphers&#039;] = &quot;off&quot;
nginx[&#039;ssl_ciphers&#039;] = &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&quot;

# HSTS
nginx[&#039;hsts_max_age&#039;] = 31536000
nginx[&#039;hsts_include_subdomains&#039;] = true
EOF

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h3 id="advanced-security-configuration" class="mobile-header">Advanced Security Configuration</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure security settings
sudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF

# Security hardening
gitlab_rails[&#039;webhook_timeout&#039;] = 10
gitlab_rails[&#039;webhook_max_redirects&#039;] = 3

# Disable password authentication (use SSO/LDAP)
gitlab_rails[&#039;omniauth_allow_single_sign_on&#039;] = [&#039;saml&#039;, &#039;ldapmain&#039;]
gitlab_rails[&#039;omniauth_block_auto_created_users&#039;] = false
gitlab_rails[&#039;omniauth_auto_sign_in_with_provider&#039;] = &#039;saml&#039;

# API rate limiting
gitlab_rails[&#039;rate_limit_requests_per_period&#039;] = 1000
gitlab_rails[&#039;rate_limit_period&#039;] = 60

# Git over HTTP rate limiting
gitlab_rails[&#039;rack_attack_git_basic_auth&#039;] = {
  &#039;enabled&#039; =&gt; true,
  &#039;ip_whitelist&#039; =&gt; %w{127.0.0.1 192.168.1.0/24},
  &#039;maxretry&#039; =&gt; 20,
  &#039;findtime&#039; =&gt; 60,
  &#039;bantime&#039; =&gt; 3600
}

# Protected paths
gitlab_rails[&#039;rack_attack_protected_paths&#039;] = [
  &#039;/users/password&#039;,
  &#039;/users/sign_in&#039;,
  &#039;/api/v4/session.json&#039;,
  &#039;/api/v4/session&#039;,
  &#039;/users/confirmation&#039;,
  &#039;/unsubscribes/&#039;,
  &#039;/import/github/personal_access_token&#039;,
  &#039;/admin/session&#039;
]

# SSH security
gitlab_rails[&#039;gitlab_shell_ssh_port&#039;] = 2222
gitlab_shell[&#039;auth_file&#039;] = &quot;/var/opt/gitlab/.ssh/authorized_keys&quot;

# Container Registry security
registry[&#039;notifications&#039;] = [
  {
    &#039;name&#039; =&gt; &#039;security_scan&#039;,
    &#039;url&#039; =&gt; &#039;https://security-scanner.example.com/webhook&#039;,
    &#039;timeout&#039; =&gt; &#039;2000ms&#039;,
    &#039;threshold&#039; =&gt; 3,
    &#039;backoff&#039; =&gt; &#039;1000ms&#039;
  }
]

# Secrets management
gitlab_rails[&#039;db_password&#039;] = File.read(&#039;/etc/gitlab/secrets/db_password&#039;).strip
gitlab_rails[&#039;secret_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/secret_key_base&#039;).strip
gitlab_rails[&#039;otp_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/otp_key_base&#039;).strip
gitlab_rails[&#039;encrypted_settings_key_base&#039;] = File.read(&#039;/etc/gitlab/secrets/encrypted_settings_key_base&#039;).strip

# Audit logging
gitlab_rails[&#039;audit_events_enabled&#039;] = true

# Disable features that increase attack surface
gitlab_rails[&#039;usage_ping_enabled&#039;] = false
gitlab_rails[&#039;sentry_enabled&#039;] = false
EOF

# Create secrets directory and files
sudo mkdir -p /etc/gitlab/secrets
sudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/db_password
sudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/secret_key_base
sudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/otp_key_base
sudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/encrypted_settings_key_base

# Secure permissions
sudo chmod 600 /etc/gitlab/secrets/*
sudo chown git:git /etc/gitlab/secrets/*

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h3 id="gitlab-runner-security-configuration" class="mobile-header">GitLab Runner Security Configuration</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Create secure runner configuration
sudo mkdir -p /etc/gitlab-runner

sudo tee /etc/gitlab-runner/config.toml &gt; /dev/null &lt;&lt;EOF
concurrent = 4
check_interval = 0
shutdown_timeout = 0

[session_server]
  session_timeout = 1800

[[runners]]
  name = &quot;docker-runner-secure&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;runner_registration_token&quot;
  executor = &quot;docker&quot;
  
  # Security settings
  pre_clone_script = &quot;echo &#039;Starting secure build&#039;&quot;
  pre_build_script = &quot;echo &#039;Preparing secure environment&#039;&quot;
  post_build_script = &quot;echo &#039;Cleaning up secure environment&#039;&quot;
  
  [runners.docker]
    tls_verify = false
    image = &quot;alpine:latest&quot;
    privileged = false  # Critical: Never use privileged mode
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = [&quot;/cache&quot;, &quot;/certs/client&quot;]
    shm_size = 0
    network_mode = &quot;bridge&quot;
    
    # Security restrictions
    cap_drop = [&quot;ALL&quot;]
    cap_add = [&quot;CHOWN&quot;, &quot;SETGID&quot;, &quot;SETUID&quot;]
    security_opt = [&quot;no-new-privileges:true&quot;]
    
    # Resource limits
    memory = &quot;2g&quot;
    memory_swap = &quot;2g&quot;
    memory_reservation = &quot;1g&quot;
    cpus = &quot;1.5&quot;
    
    # Network security
    dns = [&quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;]
    extra_hosts = [&quot;gitlab.example.com:192.168.1.100&quot;]
    
    # Image scanning
    pull_policy = [&quot;if-not-present&quot;]
    
  [runners.docker.tmpfs]
    &quot;/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;
    &quot;/var/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;

# Kubernetes executor (more secure)
[[runners]]
  name = &quot;k8s-runner-secure&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;k8s_runner_token&quot;
  executor = &quot;kubernetes&quot;
  
  [runners.kubernetes]
    host = &quot;https://k8s.example.com:6443&quot;
    namespace = &quot;gitlab-runner&quot;
    privileged = false  # Never use privileged
    image = &quot;alpine:latest&quot;
    
    # Security context
    run_as_user = 1000
    run_as_group = 1000
    fs_group = 1000
    
    # Resource limits
    memory_limit = &quot;2Gi&quot;
    memory_request = &quot;1Gi&quot;
    cpu_limit = &quot;1000m&quot;
    cpu_request = &quot;500m&quot;
    
    # Security policies
    [runners.kubernetes.pod_security_context]
      run_as_non_root = true
      run_as_user = 1000
      run_as_group = 1000
      fs_group = 1000
      
    [[runners.kubernetes.volumes.empty_dir]]
      name = &quot;tmp&quot;
      mount_path = &quot;/tmp&quot;
      medium = &quot;Memory&quot;
EOF

# Register runner with security tags
sudo gitlab-runner register \
  --url &quot;https://gitlab.example.com/&quot; \
  --registration-token &quot;RUNNER_TOKEN&quot; \
  --description &quot;secure-docker-runner&quot; \
  --tag-list &quot;docker,secure,production&quot; \
  --run-untagged=&quot;false&quot; \
  --locked=&quot;true&quot; \
  --access-level=&quot;ref_protected&quot; \
  --executor &quot;docker&quot; \
  --docker-image alpine:latest \
  --docker-privileged=&quot;false&quot; \
  --docker-volumes &quot;/certs/client&quot;

sudo systemctl enable --now gitlab-runner</code></pre>
      </div>
    </div>
<h2 id="cicd-pipeline-security" class="mobile-header">CI/CD Pipeline Security</h2>
<h3 id="secure-pipeline-configuration" class="mobile-header">Secure Pipeline Configuration</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Create .gitlab-ci.yml with security best practices
cat &gt; .gitlab-ci.yml &lt;&lt;EOF
# GitLab CI/CD Security Best Practices - 2024

stages:
  - security-scan
  - test
  - build
  - security-test
  - deploy

variables:
  # Security variables
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: &quot;/certs&quot;
  SECURE_LOG_LEVEL: info
  
  # Use protected variables for sensitive data
  # DEPLOY_TOKEN: (set in GitLab UI as protected variable)
  # AWS_ACCESS_KEY: (set in GitLab UI as protected variable)

# Security scanning stage
secret-detection:
  stage: security-scan
  image: registry.gitlab.com/gitlab-org/security-products/analyzers/secrets:latest
  script:
    - echo &quot;Scanning for secrets in code...&quot;
    - /analyzer run
  artifacts:
    reports:
      secret_detection: gl-secret-detection-report.json
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH&#039;
  tags:
    - secure

dependency-scanning:
  stage: security-scan  
  image: registry.gitlab.com/gitlab-org/security-products/analyzers/gemnasium:latest
  script:
    - echo &quot;Scanning dependencies for vulnerabilities...&quot;
    - /analyzer run
  artifacts:
    reports:
      dependency_scanning: gl-dependency-scanning-report.json
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH&#039;
  tags:
    - secure

sast:
  stage: security-scan
  image: registry.gitlab.com/gitlab-org/security-products/analyzers/sobelow:latest
  script:
    - echo &quot;Static application security testing...&quot;
    - /analyzer run
  artifacts:
    reports:
      sast: gl-sast-report.json
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH&#039;
  tags:
    - secure

# Container scanning
container-scanning:
  stage: security-test
  image: registry.gitlab.com/gitlab-org/security-products/analyzers/klar:latest
  script:
    - echo &quot;Scanning container image for vulnerabilities...&quot;
    - /analyzer run
  artifacts:
    reports:
      container_scanning: gl-container-scanning-report.json
  dependencies:
    - build
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH&#039;
  tags:
    - secure

# Secure build stage
build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  before_script:
    # Verify image signatures
    - echo &quot;Verifying base image integrity...&quot;
    - docker trust inspect alpine:latest
  script:
    - echo &quot;Building application with security scanning...&quot;
    - docker build -t \$CI_REGISTRY_IMAGE:\$CI_COMMIT_SHA .
    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock aquasec/trivy image \$CI_REGISTRY_IMAGE:\$CI_COMMIT_SHA
    - docker login -u \$CI_REGISTRY_USER -p \$CI_REGISTRY_PASSWORD \$CI_REGISTRY
    - docker push \$CI_REGISTRY_IMAGE:\$CI_COMMIT_SHA
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;
  tags:
    - secure

# Secure deployment
deploy-production:
  stage: deploy
  image: alpine:latest
  before_script:
    # Install kubectl and verify cluster connectivity
    - apk add --no-cache curl
    - curl -LO &quot;https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl&quot;
    - chmod +x kubectl &amp;&amp; mv kubectl /usr/local/bin/
    - kubectl config use-context production-cluster
    - kubectl auth can-i create deployments --namespace=production
  script:
    - echo &quot;Deploying to production with security validations...&quot;
    - kubectl apply -f k8s/production/ --namespace=production
    - kubectl rollout status deployment/app --namespace=production --timeout=300s
  environment:
    name: production
    url: https://app.example.com
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;
      when: manual
  only:
    variables:
      - \$CI_COMMIT_REF_PROTECTED == &quot;true&quot;
  tags:
    - secure
    - production

# Security compliance check
compliance-check:
  stage: security-test
  image: alpine:latest
  script:
    - echo &quot;Running compliance checks...&quot;
    - apk add --no-cache curl jq
    - |
      # Check for required security labels in Docker images
      if ! docker inspect \$CI_REGISTRY_IMAGE:\$CI_COMMIT_SHA | jq -r &#039;.[].Config.Labels[&quot;security.scan&quot;]&#039; | grep -q &quot;passed&quot;; then
        echo &quot;ERROR: Image failed security scan&quot;
        exit 1
      fi
    - echo &quot;Compliance check passed&quot;
  dependencies:
    - container-scanning
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH == &quot;main&quot;&#039;
  tags:
    - secure

# Infrastructure as Code scanning
iac-scanning:
  stage: security-scan
  image: bridgecrew/checkov:latest
  script:
    - checkov --framework terraform --framework kubernetes --framework dockerfile
  artifacts:
    reports:
      junit: checkov-report.xml
  rules:
    - if: &#039;\$CI_COMMIT_BRANCH&#039;
      changes:
        - &quot;**/*.tf&quot;
        - &quot;**/*.yml&quot;
        - &quot;**/*.yaml&quot;
        - &quot;**/Dockerfile*&quot;
  tags:
    - secure
EOF</code></pre>
      </div>
    </div>
<h3 id="rbac-and-access-control" class="mobile-header">RBAC and Access Control</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure GitLab RBAC via API
GITLAB_URL=&quot;https://gitlab.example.com&quot;
ADMIN_TOKEN=&quot;your_admin_token&quot;

# Create groups with specific permissions
curl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --data &quot;name=developers&amp;path=developers&amp;description=Development team&amp;visibility=private&quot; \
  &quot;${GITLAB_URL}/api/v4/groups&quot;

curl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --data &quot;name=security-team&amp;path=security-team&amp;description=Security team&amp;visibility=private&quot; \
  &quot;${GITLAB_URL}/api/v4/groups&quot;

# Create projects with security templates
curl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --data &quot;name=secure-app&amp;description=Secure application&amp;visibility=private&amp;issues_enabled=true&amp;merge_requests_enabled=true&amp;wiki_enabled=false&amp;builds_enabled=true&amp;snippets_enabled=false&amp;container_registry_enabled=true&amp;shared_runners_enabled=false&quot; \
  &quot;${GITLAB_URL}/api/v4/projects&quot;

# Configure branch protection
PROJECT_ID=&quot;1&quot;  # Replace with actual project ID
curl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --data &quot;name=main&amp;code_owner_approval_required=true&amp;push_access_level=40&amp;merge_access_level=40&amp;unprotect_access_level=40&quot; \
  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/protected_branches&quot;

# Configure push rules (Premium/Ultimate)
curl --request POST --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --data &quot;deny_delete_tag=true&amp;member_check=true&amp;prevent_secrets=true&amp;author_email_regex=.*@example.com&amp;file_extension_restriction=jar,exe&amp;max_file_size=100&quot; \
  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/push_rule&quot;</code></pre>
      </div>
    </div>
<h3 id="vulnerability-scanning-integration" class="mobile-header">Vulnerability Scanning Integration</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure dependency proxy for secure image caching
sudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF

# Dependency Proxy for secure image caching
gitlab_rails[&#039;dependency_proxy_enabled&#039;] = true
gitlab_rails[&#039;dependency_proxy_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/dependency_proxy&quot;

# Security scanning
gitlab_rails[&#039;sast_enabled&#039;] = true
gitlab_rails[&#039;dependency_scanning_enabled&#039;] = true
gitlab_rails[&#039;container_scanning_enabled&#039;] = true
gitlab_rails[&#039;secret_detection_enabled&#039;] = true
gitlab_rails[&#039;license_scanning_enabled&#039;] = true

# Secure package registry
gitlab_rails[&#039;packages_enabled&#039;] = true
gitlab_rails[&#039;packages_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/packages&quot;
EOF

# Create custom security scanning templates
mkdir -p .gitlab/ci-templates

cat &gt; .gitlab/ci-templates/Security-Scanning.gitlab-ci.yml &lt;&lt;EOF
# Custom Security Scanning Template

.security-scan-template:
  stage: security-scan
  variables:
    SECURE_LOG_LEVEL: info
  before_script:
    - echo &quot;Preparing security scan environment...&quot;
    - apk add --no-cache curl jq
  tags:
    - secure

custom-sast:
  extends: .security-scan-template
  image: registry.gitlab.com/gitlab-org/security-products/analyzers/semgrep:latest
  script:
    - echo &quot;Running custom SAST analysis...&quot;
    - /analyzer run
  artifacts:
    reports:
      sast: gl-sast-report.json
    expire_in: 1 week

custom-secrets-scan:
  extends: .security-scan-template
  image: trufflesecurity/trufflehog:latest
  script:
    - echo &quot;Scanning for secrets with TruffleHog...&quot;
    - trufflehog git file://. --json &gt; trufflehog-report.json
    - |
      if [ -s trufflehog-report.json ]; then
        echo &quot;Secrets detected!&quot;
        cat trufflehog-report.json
        exit 1
      fi
  artifacts:
    reports:
      secret_detection: trufflehog-report.json
    expire_in: 1 week

image-vulnerability-scan:
  extends: .security-scan-template
  image: aquasec/trivy:latest
  script:
    - echo &quot;Scanning Docker images for vulnerabilities...&quot;
    - trivy image --format template --template &quot;@contrib/gitlab.tpl&quot; \$CI_REGISTRY_IMAGE:\$CI_COMMIT_SHA
  artifacts:
    reports:
      container_scanning: gl-container-scanning-report.json
    expire_in: 1 week
EOF

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h2 id="backup-and-disaster-recovery" class="mobile-header">Backup and Disaster Recovery</h2>
<h3 id="enterprise-backup-strategy" class="mobile-header">Enterprise Backup Strategy</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash">sudo tee /usr/local/bin/gitlab-backup.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;
#!/bin/bash
BACKUP_DIR=&quot;/backup/gitlab&quot;
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p ${BACKUP_DIR}/{omnibus,secrets,ssl,logs}

# Create GitLab backup
gitlab-backup create STRATEGY=copy SKIP=uploads,builds,artifacts,lfs,registry,pages

# Backup configuration files
tar -czf ${BACKUP_DIR}/omnibus/gitlab-config-${DATE}.tar.gz \
    /etc/gitlab/gitlab.rb \
    /etc/gitlab/gitlab-secrets.json

# Backup SSL certificates
tar -czf ${BACKUP_DIR}/ssl/gitlab-ssl-${DATE}.tar.gz \
    /etc/gitlab/ssl/ \
    /etc/letsencrypt/

# Backup secrets
tar -czf ${BACKUP_DIR}/secrets/gitlab-secrets-${DATE}.tar.gz \
    /etc/gitlab/secrets/

# Upload to multiple cloud storage backends
aws s3 cp ${BACKUP_DIR}/ s3://gitlab-backups/ --recursive
az storage blob upload-batch --source ${BACKUP_DIR} --destination gitlab-backups
gsutil cp -r ${BACKUP_DIR}/* gs://gitlab-backups/

# Geo-replication backup (Enterprise)
if command -v gitlab-rake &gt;/dev/null 2&gt;&amp;1; then
    gitlab-rake gitlab:geo:check
    gitlab-rake geo:status
fi

# Test backup integrity
LATEST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar | head -1)
if [ -n &quot;$LATEST_BACKUP&quot; ]; then
    echo &quot;Latest backup: $LATEST_BACKUP&quot;
    tar -tf &quot;$LATEST_BACKUP&quot; &gt; /tmp/backup-contents.txt
    if [ $? -eq 0 ]; then
        echo &quot;✓ Backup integrity verified&quot;
    else
        echo &quot;✗ Backup integrity check failed&quot;
    fi
fi

# Keep only last 7 backups locally
find /var/opt/gitlab/backups/ -name &quot;*_gitlab_backup.tar&quot; -mtime +7 -delete
find ${BACKUP_DIR} -name &quot;gitlab-*&quot; -type f -mtime +7 -delete

echo &quot;GitLab backup completed: ${DATE}&quot;
EOF

sudo chmod +x /usr/local/bin/gitlab-backup.sh

# Schedule daily backups
echo &quot;0 2 * * * root /usr/local/bin/gitlab-backup.sh&quot; | sudo tee -a /etc/crontab

# Create disaster recovery script
sudo tee /usr/local/bin/gitlab-restore.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;
#!/bin/bash
BACKUP_FILE=&quot;${1}&quot;

if [ -z &quot;$BACKUP_FILE&quot; ]; then
    echo &quot;Usage: $0 &lt;backup_file&gt;&quot;
    echo &quot;Available backups:&quot;
    ls -la /var/opt/gitlab/backups/*_gitlab_backup.tar
    exit 1
fi

# Stop GitLab services
gitlab-ctl stop unicorn
gitlab-ctl stop puma
gitlab-ctl stop sidekiq

# Restore from backup
gitlab-backup restore BACKUP=$(basename $BACKUP_FILE _gitlab_backup.tar) force=yes

# Restore configuration
if [ -f &quot;/backup/gitlab/omnibus/gitlab-config-latest.tar.gz&quot; ]; then
    cd /
    tar -xzf /backup/gitlab/omnibus/gitlab-config-latest.tar.gz
fi

# Reconfigure and restart
gitlab-ctl reconfigure
gitlab-ctl restart

# Verify installation
gitlab-rake gitlab:check SANITIZE=true

echo &quot;GitLab restore completed&quot;
EOF

sudo chmod +x /usr/local/bin/gitlab-restore.sh</code></pre>
      </div>
    </div>
<h3 id="high-availability-setup" class="mobile-header">High Availability Setup</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure GitLab for HA with external services
sudo tee /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF
# GitLab High Availability Configuration

external_url &#039;https://gitlab.example.com&#039;

# Disable built-in services (use external)
postgresql[&#039;enable&#039;] = false
redis[&#039;enable&#039;] = false
nginx[&#039;enable&#039;] = true
unicorn[&#039;enable&#039;] = true
sidekiq[&#039;enable&#039;] = true
gitlab_workhorse[&#039;enable&#039;] = true
gitaly[&#039;enable&#039;] = true

# External PostgreSQL
gitlab_rails[&#039;db_adapter&#039;] = &#039;postgresql&#039;
gitlab_rails[&#039;db_encoding&#039;] = &#039;unicode&#039;
gitlab_rails[&#039;db_host&#039;] = &#039;postgres-master.example.com&#039;
gitlab_rails[&#039;db_port&#039;] = 5432
gitlab_rails[&#039;db_database&#039;] = &#039;gitlabhq_production&#039;
gitlab_rails[&#039;db_username&#039;] = &#039;gitlab&#039;
gitlab_rails[&#039;db_password&#039;] = &#039;secure_db_password&#039;
gitlab_rails[&#039;db_load_balancing&#039;] = {
  &#039;hosts&#039; =&gt; [&#039;postgres-slave1.example.com&#039;, &#039;postgres-slave2.example.com&#039;]
}

# External Redis
gitlab_rails[&#039;redis_host&#039;] = &#039;redis-master.example.com&#039;
gitlab_rails[&#039;redis_port&#039;] = 6379
gitlab_rails[&#039;redis_password&#039;] = &#039;redis_secure_password&#039;
gitlab_rails[&#039;redis_sentinels&#039;] = [
  {&#039;host&#039; =&gt; &#039;redis-sentinel1.example.com&#039;, &#039;port&#039; =&gt; 26379},
  {&#039;host&#039; =&gt; &#039;redis-sentinel2.example.com&#039;, &#039;port&#039; =&gt; 26379},
  {&#039;host&#039; =&gt; &#039;redis-sentinel3.example.com&#039;, &#039;port&#039; =&gt; 26379}
]

# Load balancing
nginx[&#039;listen_addresses&#039;] = [&#039;0.0.0.0&#039;]
nginx[&#039;real_ip_header&#039;] = &#039;X-Forwarded-For&#039;
nginx[&#039;real_ip_recursive&#039;] = &#039;on&#039;
nginx[&#039;real_ip_trusted_addresses&#039;] = [&#039;10.0.0.0/8&#039;, &#039;172.16.0.0/12&#039;, &#039;192.168.0.0/16&#039;]

# Gitaly cluster (Enterprise)
git_data_dirs({
  &#039;default&#039; =&gt; {
    &#039;gitaly_address&#039; =&gt; &#039;tcp://gitaly1.example.com:8075&#039;,
    &#039;gitaly_token&#039; =&gt; &#039;gitaly_secure_token&#039;
  },
  &#039;storage1&#039; =&gt; {
    &#039;gitaly_address&#039; =&gt; &#039;tcp://gitaly2.example.com:8075&#039;,
    &#039;gitaly_token&#039; =&gt; &#039;gitaly_secure_token&#039;
  }
})

# Object storage (S3-compatible)
gitlab_rails[&#039;object_store&#039;][&#039;enabled&#039;] = true
gitlab_rails[&#039;object_store&#039;][&#039;proxy_download&#039;] = true
gitlab_rails[&#039;object_store&#039;][&#039;connection&#039;] = {
  &#039;provider&#039; =&gt; &#039;AWS&#039;,
  &#039;region&#039; =&gt; &#039;us-west-2&#039;,
  &#039;aws_access_key_id&#039; =&gt; &#039;object_store_access_key&#039;,
  &#039;aws_secret_access_key&#039; =&gt; &#039;object_store_secret_key&#039;
}
gitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;artifacts&#039;][&#039;bucket&#039;] = &#039;gitlab-artifacts&#039;
gitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;lfs&#039;][&#039;bucket&#039;] = &#039;gitlab-lfs&#039;
gitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;uploads&#039;][&#039;bucket&#039;] = &#039;gitlab-uploads&#039;
gitlab_rails[&#039;object_store&#039;][&#039;objects&#039;][&#039;packages&#039;][&#039;bucket&#039;] = &#039;gitlab-packages&#039;

# Geo replication (Enterprise Premium)
gitlab_rails[&#039;geo_primary_role&#039;] = true  # Set to false for secondary
gitlab_rails[&#039;geo_node_name&#039;] = &#039;primary-site&#039;
gitlab_rails[&#039;geo_registry_replication_enabled&#039;] = true
EOF

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h2 id="container-registry-and-package-management" class="mobile-header">Container Registry and Package Management</h2>
<h3 id="secure-container-registry-setup" class="mobile-header">Secure Container Registry Setup</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure container registry with security scanning
sudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF

# Container Registry configuration
registry_external_url &#039;https://registry.example.com&#039;
gitlab_rails[&#039;registry_enabled&#039;] = true
registry[&#039;enable&#039;] = true

# Registry storage
registry[&#039;storage&#039;] = {
  &#039;s3&#039; =&gt; {
    &#039;accesskey&#039; =&gt; &#039;registry_s3_access_key&#039;,
    &#039;secretkey&#039; =&gt; &#039;registry_s3_secret_key&#039;,
    &#039;bucket&#039; =&gt; &#039;gitlab-registry&#039;,
    &#039;region&#039; =&gt; &#039;us-west-2&#039;,
    &#039;encrypt&#039; =&gt; true
  }
}

# Registry security
registry[&#039;auth_token_realm&#039;] = &quot;https://gitlab.example.com/jwt/auth&quot;
registry[&#039;auth_token_service&#039;] = &quot;container_registry&quot;
registry[&#039;auth_token_issuer&#039;] = &quot;gitlab-issuer&quot;
registry[&#039;auth_token_autoredirect&#039;] = false

# Health checks
registry[&#039;health_storagedriver_enabled&#039;] = true
registry[&#039;health_storagedriver_interval&#039;] = &#039;10s&#039;
registry[&#039;health_storagedriver_threshold&#039;] = 3

# Container scanning
gitlab_rails[&#039;container_registry_token_expire_delay&#039;] = 300
gitlab_rails[&#039;container_registry_cleanup_enabled&#039;] = true

# Image retention policies
registry[&#039;middleware&#039;] = {
  &#039;repository&#039; =&gt; [
    {
      &#039;name&#039; =&gt; &#039;cloudfront&#039;,
      &#039;disabled&#039; =&gt; false,
      &#039;options&#039; =&gt; {
        &#039;baseurl&#039; =&gt; &#039;https://registry-cdn.example.com&#039;,
        &#039;privatekey&#039; =&gt; &#039;/etc/gitlab/registry-cdn-private-key.pem&#039;,
        &#039;keypairid&#039; =&gt; &#039;CLOUDFRONT_KEY_PAIR_ID&#039;,
        &#039;duration&#039; =&gt; &#039;3600s&#039;
      }
    }
  ]
}

# Package registry
gitlab_rails[&#039;packages_enabled&#039;] = true
gitlab_rails[&#039;packages_storage_path&#039;] = &quot;/var/opt/gitlab/gitlab-rails/shared/packages&quot;
EOF

# Create container registry cleanup policy
cat &gt; registry-cleanup-policy.json &lt;&lt;EOF
{
  &quot;name_regex&quot;: &quot;.*&quot;,
  &quot;name_regex_keep&quot;: &quot;v\\d+\\.\\d+\\.\\d+&quot;,
  &quot;cadence&quot;: &quot;7d&quot;,
  &quot;older_than&quot;: &quot;30d&quot;,
  &quot;keep_n&quot;: 10
}
EOF

# Apply cleanup policy via API
curl --request PUT --header &quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}&quot; \
  --header &quot;Content-Type: application/json&quot; \
  --data @registry-cleanup-policy.json \
  &quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/registry/repositories/1&quot;

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h2 id="monitoring-and-observability" class="mobile-header">Monitoring and Observability</h2>
<h3 id="comprehensive-monitoring-setup" class="mobile-header">Comprehensive Monitoring Setup</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Enable built-in monitoring stack
sudo tee -a /etc/gitlab/gitlab.rb &gt; /dev/null &lt;&lt;EOF

# Prometheus monitoring
prometheus_monitoring[&#039;enable&#039;] = true
prometheus[&#039;enable&#039;] = true
prometheus[&#039;monitor_kubernetes&#039;] = true
prometheus[&#039;scrape_configs&#039;] = [
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-workhorse&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:9229&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-unicorn&#039;,  
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:8080&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-sidekiq&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:8082&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;gitlab-pages&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:8090&#039;] }
    ]
  },
  {
    &#039;job_name&#039; =&gt; &#039;docker-registry&#039;,
    &#039;static_configs&#039; =&gt; [
      { &#039;targets&#039; =&gt; [&#039;localhost:5001&#039;] }
    ]
  }
]

# Grafana configuration
grafana[&#039;enable&#039;] = true
grafana[&#039;admin_password&#039;] = &#039;secure_grafana_password&#039;
grafana[&#039;disable_login_form&#039;] = false
grafana[&#039;allow_user_sign_up&#039;] = false

# Grafana LDAP integration
grafana[&#039;ldap_enabled&#039;] = true
grafana[&#039;ldap_allow_sign_up&#039;] = false
grafana[&#039;ldap_servers&#039;] = [{
  &#039;host&#039; =&gt; &#039;ldap.example.com&#039;,
  &#039;port&#039; =&gt; 636,
  &#039;uid&#039; =&gt; &#039;sAMAccountName&#039;,
  &#039;bind_dn&#039; =&gt; &#039;CN=grafana,OU=Service Accounts,DC=example,DC=com&#039;,
  &#039;password&#039; =&gt; &#039;ldap_service_password&#039;,
  &#039;encryption&#039; =&gt; &#039;ssl&#039;,
  &#039;base&#039; =&gt; &#039;DC=example,DC=com&#039;,
  &#039;user_filter&#039; =&gt; &#039;&#039;,
  &#039;group_base&#039; =&gt; &#039;OU=Groups,DC=example,DC=com&#039;,
  &#039;admin_group&#039; =&gt; &#039;GitLab Administrators&#039;
}]

# Node Exporter
node_exporter[&#039;enable&#039;] = true
node_exporter[&#039;listen_address&#039;] = &#039;localhost:9100&#039;

# Alert Manager
alertmanager[&#039;enable&#039;] = true
alertmanager[&#039;admin_email&#039;] = &#039;alerts@example.com&#039;
alertmanager[&#039;flags&#039;] = {
  &#039;storage.path&#039; =&gt; &#039;/var/opt/gitlab/alertmanager/data&#039;,
  &#039;config.file&#039; =&gt; &#039;/var/opt/gitlab/alertmanager/alertmanager.yml&#039;
}

# Log forwarding
logging[&#039;logrotate_frequency&#039;] = &quot;daily&quot;
logging[&#039;logrotate_rotate&#039;] = 30
logging[&#039;logrotate_compress&#039;] = &quot;compress&quot;
logging[&#039;svlogd_size&#039;] = 200 * 1024 * 1024  # 200MB
logging[&#039;svlogd_num&#039;] = 30
EOF

# Create custom alerting rules
sudo mkdir -p /var/opt/gitlab/alertmanager

sudo tee /var/opt/gitlab/alertmanager/alertmanager.yml &gt; /dev/null &lt;&lt;EOF
global:
  smtp_smarthost: &#039;smtp.example.com:587&#039;
  smtp_from: &#039;gitlab-alerts@example.com&#039;
  smtp_auth_username: &#039;gitlab-alerts@example.com&#039;
  smtp_auth_password: &#039;smtp_password&#039;

route:
  group_by: [&#039;alertname&#039;, &#039;cluster&#039;, &#039;service&#039;]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  receiver: &#039;gitlab-alerts&#039;
  routes:
  - match:
      severity: critical
    receiver: &#039;critical-alerts&#039;
    group_wait: 10s
    repeat_interval: 5m

receivers:
- name: &#039;gitlab-alerts&#039;
  email_configs:
  - to: &#039;gitlab-admin@example.com&#039;
    subject: &#039;GitLab Alert: {{ .GroupLabels.alertname }}&#039;
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Instance: {{ .Labels.instance }}
      {{ end }}

- name: &#039;critical-alerts&#039;
  email_configs:
  - to: &#039;oncall@example.com&#039;
    subject: &#039;CRITICAL GitLab Alert: {{ .GroupLabels.alertname }}&#039;
  slack_configs:
  - api_url: &#039;https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK&#039;
    channel: &#039;#critical-alerts&#039;
    title: &#039;Critical GitLab Alert&#039;
EOF

sudo gitlab-ctl reconfigure</code></pre>
      </div>
    </div>
<h3 id="performance-monitoring" class="mobile-header">Performance Monitoring</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Create GitLab performance monitoring script
sudo tee /usr/local/bin/gitlab-performance-monitor.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;
#!/bin/bash
MONITOR_LOG=&quot;/var/log/gitlab-performance.log&quot;

log_message() {
    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${MONITOR_LOG}
}

# Check GitLab service health
for service in unicorn sidekiq workhorse gitaly; do
    if gitlab-ctl status $service | grep -q &quot;run:&quot;; then
        log_message &quot;✓ $service is running&quot;
    else
        log_message &quot;✗ $service is not running&quot;
    fi
done

# Check database performance
DB_CONNECTIONS=$(gitlab-psql -c &quot;SELECT count(*) FROM pg_stat_activity;&quot; -t)
log_message &quot;ℹ Database connections: ${DB_CONNECTIONS}&quot;

# Check Redis performance  
REDIS_MEMORY=$(redis-cli info memory | grep used_memory_human: | cut -d: -f2)
log_message &quot;ℹ Redis memory usage: ${REDIS_MEMORY}&quot;

# Check Git repository storage
REPO_SIZE=$(du -sh /var/opt/gitlab/git-data/repositories | cut -f1)
log_message &quot;ℹ Repository storage usage: ${REPO_SIZE}&quot;

# Check background job queue
SIDEKIQ_QUEUE=$(gitlab-rails runner &quot;puts Sidekiq::Queue.new.size&quot;)
log_message &quot;ℹ Sidekiq queue size: ${SIDEKIQ_QUEUE}&quot;

# Check GitLab metrics
GITLAB_VERSION=$(gitlab-rake gitlab:env:info | grep &quot;GitLab information&quot; -A 10 | grep &quot;Version:&quot; | awk &#039;{print $2}&#039;)
log_message &quot;ℹ GitLab version: ${GITLAB_VERSION}&quot;

# Performance metrics via API
API_RESPONSE_TIME=$(curl -w &quot;%{time_total}&quot; -s -o /dev/null https://gitlab.example.com/api/v4/projects)
log_message &quot;ℹ API response time: ${API_RESPONSE_TIME}s&quot;

# Check disk I/O
DISK_USAGE=$(df /var/opt/gitlab | awk &#039;NR==2 {print $5}&#039; | sed &#039;s/%//&#039;)
log_message &quot;ℹ Disk usage: ${DISK_USAGE}%&quot;

if [ ${DISK_USAGE} -gt 85 ]; then
    log_message &quot;⚠ High disk usage detected&quot;
fi

log_message &quot;Performance monitoring completed&quot;
EOF

sudo chmod +x /usr/local/bin/gitlab-performance-monitor.sh

# Schedule performance monitoring
echo &quot;*/15 * * * * root /usr/local/bin/gitlab-performance-monitor.sh&quot; | sudo tee -a /etc/crontab</code></pre>
      </div>
    </div>
<h2 id="gitlab-runner-advanced-configuration" class="mobile-header">GitLab Runner Advanced Configuration</h2>
<h3 id="secure-multi-platform-runner-setup" class="mobile-header">Secure Multi-Platform Runner Setup</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Create advanced runner configuration with security
sudo tee /etc/gitlab-runner/config.toml &gt; /dev/null &lt;&lt;EOF
concurrent = 10
check_interval = 0
log_level = &quot;info&quot;
log_format = &quot;runner&quot;
shutdown_timeout = 30

[session_server]
  session_timeout = 1800

# Docker executor with security hardening
[[runners]]
  name = &quot;docker-secure-runner&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;secure_runner_token&quot;
  executor = &quot;docker&quot;
  output_limit = 4096
  
  # Security scripts
  pre_clone_script = &quot;&quot;&quot;
    echo &#039;Security scan initiated&#039;
    id
    pwd
    env | grep -E &#039;^(CI_|GITLAB_)&#039; | sort
  &quot;&quot;&quot;
  
  pre_build_script = &quot;&quot;&quot;
    echo &#039;Preparing secure build environment&#039;
    # Verify no sensitive data in environment
    if env | grep -i -E &#039;(password|secret|key|token)&#039; | grep -v -E &#039;^(CI_JOB_TOKEN|GITLAB_CI|CI_SERVER)&#039;; then
      echo &#039;ERROR: Sensitive data detected in environment&#039;
      exit 1
    fi
  &quot;&quot;&quot;
  
  post_build_script = &quot;&quot;&quot;
    echo &#039;Cleaning up build artifacts&#039;
    rm -rf /tmp/* 2&gt;/dev/null || true
  &quot;&quot;&quot;
  
  [runners.docker]
    tls_verify = false
    image = &quot;alpine:latest&quot;
    privileged = false
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = [&quot;/cache&quot;, &quot;/certs/client&quot;]
    shm_size = 268435456  # 256MB
    
    # Security restrictions
    cap_drop = [&quot;ALL&quot;]
    cap_add = [&quot;CHOWN&quot;, &quot;SETGID&quot;, &quot;SETUID&quot;]
    security_opt = [&quot;no-new-privileges:true&quot;, &quot;apparmor:unconfined&quot;]
    
    # Resource limits
    memory = &quot;2g&quot;
    memory_swap = &quot;2g&quot;
    memory_reservation = &quot;1g&quot;
    cpus = &quot;2&quot;
    
    # Network security
    network_mode = &quot;bridge&quot;
    dns = [&quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;]
    
    # Disable dangerous features
    disable_entrypoint_overwrite = true
    
    # Image pull policy
    pull_policy = [&quot;if-not-present&quot;]
    
  [runners.docker.tmpfs]
    &quot;/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;
    &quot;/var/tmp&quot; = &quot;rw,noexec,nosuid,size=100m&quot;

# Kubernetes executor (Enterprise recommended)
[[runners]]
  name = &quot;k8s-secure-runner&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;k8s_runner_token&quot;
  executor = &quot;kubernetes&quot;
  
  [runners.kubernetes]
    host = &quot;https://k8s.example.com:6443&quot;
    namespace = &quot;gitlab-runner&quot;
    privileged = false
    image = &quot;alpine:latest&quot;
    
    # Security context
    run_as_user = 1000
    run_as_group = 1000
    fs_group = 1000
    
    # Resource limits
    memory_limit = &quot;4Gi&quot;
    memory_request = &quot;2Gi&quot;
    cpu_limit = &quot;2000m&quot;
    cpu_request = &quot;1000m&quot;
    
    # Security policies
    [runners.kubernetes.pod_security_context]
      run_as_non_root = true
      run_as_user = 1000
      run_as_group = 1000
      fs_group = 1000
      seccomp_profile_type = &quot;RuntimeDefault&quot;
      
    [runners.kubernetes.container_security_context]
      allow_privilege_escalation = false
      read_only_root_filesystem = true
      capabilities = { drop = [&quot;ALL&quot;] }
      
    # Volume mounts for security
    [[runners.kubernetes.volumes.empty_dir]]
      name = &quot;tmp&quot;
      mount_path = &quot;/tmp&quot;
      medium = &quot;Memory&quot;
      
    [[runners.kubernetes.volumes.empty_dir]]
      name = &quot;var-tmp&quot;
      mount_path = &quot;/var/tmp&quot;
      medium = &quot;Memory&quot;

# Shell executor for specific tasks (limited use)
[[runners]]
  name = &quot;shell-restricted-runner&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;shell_runner_token&quot;
  executor = &quot;shell&quot;
  shell = &quot;bash&quot;
  
  # Restricted tags only
  tag_list = [&quot;shell&quot;, &quot;restricted&quot;]
  run_untagged = false
  locked = true
  
  # Security environment
  environment = [
    &quot;PATH=/usr/local/bin:/usr/bin:/bin&quot;,
    &quot;HOME=/home/gitlab-runner&quot;,
    &quot;SHELL=/bin/bash&quot;
  ]
  
  # Cleanup
  builds_dir = &quot;/home/gitlab-runner/builds&quot;
  cache_dir = &quot;/home/gitlab-runner/cache&quot;
  
  [runners.cache]
    Type = &quot;s3&quot;
    [runners.cache.s3]
      ServerAddress = &quot;s3.amazonaws.com&quot;
      BucketName = &quot;gitlab-runner-cache&quot;
      BucketLocation = &quot;us-west-2&quot;
      Insecure = false
EOF

sudo systemctl restart gitlab-runner</code></pre>
      </div>
    </div>
<h3 id="gitlab-runner-auto-scaling-cloud" class="mobile-header">GitLab Runner Auto-scaling (Cloud)</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Configure GitLab Runner with Docker Machine for auto-scaling
sudo tee /etc/gitlab-runner/autoscale-config.toml &gt; /dev/null &lt;&lt;EOF
concurrent = 50
check_interval = 0

[[runners]]
  name = &quot;autoscale-runner&quot;
  url = &quot;https://gitlab.example.com/&quot;
  token = &quot;autoscale_runner_token&quot;
  executor = &quot;docker+machine&quot;
  
  [runners.docker]
    image = &quot;alpine:latest&quot;
    privileged = false
    disable_cache = false
    volumes = [&quot;/cache&quot;]
    
    # Security
    cap_drop = [&quot;ALL&quot;]
    security_opt = [&quot;no-new-privileges:true&quot;]
    
  [runners.machine]
    IdleCount = 2
    IdleTime = 1800
    MaxBuilds = 20
    MachineName = &quot;gitlab-runner-%s&quot;
    MachineDriver = &quot;amazonec2&quot;
    
    # AWS EC2 configuration
    [runners.machine.autoscaling]
      Periods = [&quot;* * 9-17 * * mon-fri *&quot;, &quot;* * 18-8 * * * *&quot;]
      IdleCount = [5, 1]
      IdleTime = [1800, 3600]
      Timezone = &quot;UTC&quot;
    
    # Machine options for security
    [runners.machine.machineoptions]
      amazonec2-access-key = &quot;aws_access_key&quot;
      amazonec2-secret-key = &quot;aws_secret_key&quot;
      amazonec2-region = &quot;us-west-2&quot;
      amazonec2-vpc-id = &quot;vpc-12345678&quot;
      amazonec2-subnet-id = &quot;subnet-87654321&quot;
      amazonec2-security-group = &quot;gitlab-runner-sg&quot;
      amazonec2-instance-type = &quot;t3.medium&quot;
      amazonec2-ami = &quot;ami-0c02fb55956c7d316&quot;  # Amazon Linux 2
      amazonec2-iam-instance-profile = &quot;GitLabRunnerInstanceProfile&quot;
      amazonec2-use-private-address = &quot;true&quot;
      amazonec2-tags = &quot;Name,gitlab-runner,Environment,production&quot;
      amazonec2-root-size = &quot;20&quot;
      amazonec2-volume-type = &quot;gp3&quot;
      amazonec2-use-ebs-optimized = &quot;true&quot;
      
  [runners.cache]
    Type = &quot;s3&quot;
    Shared = true
    [runners.cache.s3]
      ServerAddress = &quot;s3.amazonaws.com&quot;
      AccessKey = &quot;cache_access_key&quot;
      SecretKey = &quot;cache_secret_key&quot;  
      BucketName = &quot;gitlab-runner-cache&quot;
      BucketLocation = &quot;us-west-2&quot;
      Insecure = false
EOF</code></pre>
      </div>
    </div>
<h2 id="verification-and-health-checks" class="mobile-header">Verification and Health Checks</h2>
<h3 id="comprehensive-health-monitoring" class="mobile-header">Comprehensive Health Monitoring</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash">sudo tee /usr/local/bin/gitlab-health-check.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;
#!/bin/bash
HEALTH_LOG=&quot;/var/log/gitlab-health.log&quot;

log_message() {
    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${HEALTH_LOG}
}

# Check GitLab service status
if gitlab-ctl status | grep -q &quot;down:&quot;; then
    log_message &quot;⚠ Some GitLab services are down:&quot;
    gitlab-ctl status | grep &quot;down:&quot; | while read line; do
        log_message &quot;  - $line&quot;
    done
else
    log_message &quot;✓ All GitLab services are running&quot;
fi

# Check GitLab application health
if gitlab-rake gitlab:check &gt;/dev/null 2&gt;&amp;1; then
    log_message &quot;✓ GitLab application health check passed&quot;
else
    log_message &quot;✗ GitLab application health check failed&quot;
    gitlab-rake gitlab:check | tail -10 &gt;&gt; ${HEALTH_LOG}
fi

# Check GitLab Runner connectivity
RUNNERS_ONLINE=$(curl -s --header &quot;PRIVATE-TOKEN: admin_token&quot; https://gitlab.example.com/api/v4/runners | jq &#039;[.[] | select(.status==&quot;online&quot;)] | length&#039;)
TOTAL_RUNNERS=$(curl -s --header &quot;PRIVATE-TOKEN: admin_token&quot; https://gitlab.example.com/api/v4/runners | jq &#039;. | length&#039;)
log_message &quot;ℹ GitLab Runners: ${RUNNERS_ONLINE}/${TOTAL_RUNNERS} online&quot;

# Check database connectivity
if gitlab-psql -c &quot;SELECT version();&quot; &gt;/dev/null 2&gt;&amp;1; then
    log_message &quot;✓ Database connection is healthy&quot;
else
    log_message &quot;✗ Database connection issues&quot;
fi

# Check Redis connectivity
if redis-cli ping | grep -q &quot;PONG&quot;; then
    log_message &quot;✓ Redis connection is healthy&quot;
else
    log_message &quot;✗ Redis connection issues&quot;
fi

# Check container registry
REGISTRY_STATUS=$(curl -s https://registry.example.com/v2/ | jq -r .message 2&gt;/dev/null)
if [ &quot;$REGISTRY_STATUS&quot; = &quot;authentication required&quot; ] || [ &quot;$REGISTRY_STATUS&quot; = &quot;null&quot; ]; then
    log_message &quot;✓ Container registry is responding&quot;
else
    log_message &quot;⚠ Container registry issues&quot;
fi

# Check backup status
LAST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar 2&gt;/dev/null | head -1)
if [ -n &quot;$LAST_BACKUP&quot; ]; then
    BACKUP_AGE=$(stat -c %Y &quot;$LAST_BACKUP&quot;)
    CURRENT_TIME=$(date +%s)
    HOURS_SINCE_BACKUP=$(( (CURRENT_TIME - BACKUP_AGE) / 3600 ))
    
    if [ $HOURS_SINCE_BACKUP -lt 48 ]; then
        log_message &quot;✓ Recent backup available (${HOURS_SINCE_BACKUP} hours old)&quot;
    else
        log_message &quot;⚠ Last backup is ${HOURS_SINCE_BACKUP} hours old&quot;
    fi
else
    log_message &quot;✗ No backup files found&quot;
fi

# Check SSL certificate expiry
SSL_EXPIRY=$(echo | openssl s_client -servername gitlab.example.com -connect gitlab.example.com:443 2&gt;/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)
SSL_EXPIRY_EPOCH=$(date -d &quot;$SSL_EXPIRY&quot; +%s)
CURRENT_EPOCH=$(date +%s)
DAYS_TO_EXPIRY=$(( (SSL_EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))

if [ $DAYS_TO_EXPIRY -lt 30 ]; then
    log_message &quot;⚠ SSL certificate expires in ${DAYS_TO_EXPIRY} days&quot;
else
    log_message &quot;✓ SSL certificate expires in ${DAYS_TO_EXPIRY} days&quot;
fi

# Check system resources
CPU_USAGE=$(top -bn1 | grep &quot;Cpu(s)&quot; | awk &#039;{print $2}&#039; | cut -d&#039;%&#039; -f1)
MEMORY_USAGE=$(free | grep Mem | awk &#039;{printf &quot;%.0f&quot;, $3/$2 * 100.0}&#039;)
log_message &quot;ℹ System usage - CPU: ${CPU_USAGE}%, Memory: ${MEMORY_USAGE}%&quot;

log_message &quot;GitLab health check completed&quot;
EOF

sudo chmod +x /usr/local/bin/gitlab-health-check.sh

# Schedule health checks every 15 minutes
echo &quot;*/15 * * * * root /usr/local/bin/gitlab-health-check.sh&quot; | sudo tee -a /etc/crontab</code></pre>
      </div>
    </div>
<h3 id="security-audit-and-compliance" class="mobile-header">Security Audit and Compliance</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash">sudo tee /usr/local/bin/gitlab-security-audit.sh &gt; /dev/null &lt;&lt;&#039;EOF&#039;
#!/bin/bash
AUDIT_LOG=&quot;/var/log/gitlab-security-audit.log&quot;
DATE=$(date +%Y%m%d_%H%M%S)

log_message() {
    echo &quot;$(date &#039;+%Y-%m-%d %H:%M:%S&#039;) - $1&quot; | tee -a ${AUDIT_LOG}
}

log_message &quot;Starting GitLab security audit...&quot;

# Check user accounts with admin privileges
ADMIN_USERS=$(gitlab-rails runner &quot;puts User.admins.count&quot;)
log_message &quot;ℹ ${ADMIN_USERS} users with admin privileges&quot;

# Check for users without 2FA
USERS_WITHOUT_2FA=$(gitlab-rails runner &quot;puts User.where(two_factor_enabled: false).count&quot;)
log_message &quot;ℹ ${USERS_WITHOUT_2FA} users without 2FA enabled&quot;

# Check SSH key security
WEAK_SSH_KEYS=$(gitlab-rails runner &quot;puts Key.where(&#039;LENGTH(key) &lt; ?&#039;, 2048).count&quot;)
log_message &quot;ℹ ${WEAK_SSH_KEYS} SSH keys shorter than 2048 bits&quot;

# Check project visibility
PUBLIC_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 20).count&quot;)
INTERNAL_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 10).count&quot;)
PRIVATE_PROJECTS=$(gitlab-rails runner &quot;puts Project.where(visibility_level: 0).count&quot;)
log_message &quot;ℹ Projects - Public: ${PUBLIC_PROJECTS}, Internal: ${INTERNAL_PROJECTS}, Private: ${PRIVATE_PROJECTS}&quot;

# Check for projects without security scanning
PROJECTS_WITHOUT_SAST=$(gitlab-rails runner &quot;
puts Project.joins(:ci_pipelines)
  .where(&#039;ci_pipelines.created_at &gt; ?&#039;, 30.days.ago)
  .where.not(id: Ci::Build.joins(:pipeline).where(&#039;ci_builds.name ILIKE ?&#039;, &#039;%sast%&#039;).select(:project_id))
  .distinct.count
&quot;)
log_message &quot;ℹ ${PROJECTS_WITHOUT_SAST} active projects without SAST scanning&quot;

# Check external integrations
WEBHOOK_COUNT=$(gitlab-rails runner &quot;puts ProjectHook.count + SystemHook.count&quot;)
log_message &quot;ℹ ${WEBHOOK_COUNT} webhooks configured&quot;

# Check audit events (Enterprise)
if gitlab-rails runner &quot;puts defined?(AuditEvent)&quot; | grep -q &quot;constant&quot;; then
    RECENT_AUDIT_EVENTS=$(gitlab-rails runner &quot;puts AuditEvent.where(&#039;created_at &gt; ?&#039;, 24.hours.ago).count&quot;)
    log_message &quot;ℹ ${RECENT_AUDIT_EVENTS} audit events in last 24 hours&quot;
fi

# Check for suspicious activity
FAILED_LOGINS=$(grep &quot;Failed Login&quot; /var/log/gitlab/gitlab-rails/production.log | grep &quot;$(date +&#039;%Y-%m-%d&#039;)&quot; | wc -l)
if [ ${FAILED_LOGINS} -gt 20 ]; then
    log_message &quot;⚠ ${FAILED_LOGINS} failed login attempts today&quot;
else
    log_message &quot;✓ ${FAILED_LOGINS} failed login attempts today (normal)&quot;
fi

# Check for large file uploads
LARGE_UPLOADS=$(find /var/opt/gitlab/git-data/repositories -type f -size +100M -mtime -7 | wc -l)
if [ ${LARGE_UPLOADS} -gt 0 ]; then
    log_message &quot;ℹ ${LARGE_UPLOADS} large files (&gt;100MB) uploaded in last week&quot;
fi

log_message &quot;Security audit completed&quot;
EOF

sudo chmod +x /usr/local/bin/gitlab-security-audit.sh

# Schedule daily security audits
echo &quot;0 8 * * * root /usr/local/bin/gitlab-security-audit.sh&quot; | sudo tee -a /etc/crontab</code></pre>
      </div>
    </div>
<h2 id="troubleshooting-cross-platform" class="mobile-header">Troubleshooting (Cross-Platform)</h2>
<h3 id="common-issues-and-solutions" class="mobile-header">Common Issues and Solutions</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Check GitLab status
sudo gitlab-ctl status
sudo gitlab-ctl tail

# Check configuration
sudo gitlab-ctl show-config
sudo gitlab-rake gitlab:check SANITIZE=true

# Reconfigure GitLab
sudo gitlab-ctl reconfigure
sudo gitlab-ctl restart

# Database issues
sudo gitlab-psql -d gitlabhq_production
sudo gitlab-rake db:migrate:status

# Redis issues
redis-cli ping
redis-cli info

# Check logs for errors
sudo gitlab-ctl tail gitlab-workhorse
sudo gitlab-ctl tail unicorn
sudo gitlab-ctl tail sidekiq

# Performance issues
sudo gitlab-rake gitlab:env:info
sudo gitlab-ctl status | grep memory

# SSL/TLS issues
sudo gitlab-rake gitlab:check
openssl s_client -connect gitlab.example.com:443

# Container registry issues
sudo gitlab-ctl registry-garbage-collect
docker login registry.example.com

# Runner connectivity issues
sudo gitlab-runner verify
sudo gitlab-runner list

# Backup issues
gitlab-backup create STRATEGY=copy
gitlab-backup restore BACKUP=timestamp

# Reset admin password
sudo gitlab-rake &quot;gitlab:password:reset[root]&quot;

# Check disk usage
df -h /var/opt/gitlab/
sudo du -sh /var/opt/gitlab/git-data/

# Memory usage analysis
ps aux --sort=-%mem | grep gitlab
gitlab-ctl status | grep memory

# Network connectivity
curl -I https://gitlab.example.com
telnet gitlab.example.com 443

# Service restart order (if needed)
sudo gitlab-ctl stop
sudo gitlab-ctl start postgresql
sudo gitlab-ctl start redis
sudo gitlab-ctl start</code></pre>
      </div>
    </div>
<h3 id="advanced-debugging" class="mobile-header">Advanced Debugging</h3>
<div class="mobile-code-block" data-language="bash">
      <div class="mobile-code-header">
        <span class="mobile-code-language">bash</span>
        <button class="mobile-copy-button" onclick="copyCode(this)" title="Copy code">
          <span class="copy-icon">📋</span>
          <span class="copy-text">Copy</span>
        </button>
      </div>
      <div class="mobile-code-content">
        <pre><code class="language-bash"># Enable debug logging
sudo gitlab-ctl edit-config
# Add: gitlab_rails[&#039;log_level&#039;] = &#039;DEBUG&#039;

sudo gitlab-ctl reconfigure

# Debug specific services
sudo gitlab-ctl tail gitlab-workhorse
sudo gitlab-ctl tail unicorn
sudo gitlab-ctl tail sidekiq
sudo gitlab-ctl tail gitaly

# Database debugging
sudo gitlab-psql -d gitlabhq_production -c &quot;\l&quot;
sudo gitlab-rake db:migrate:status

# Git debugging
sudo -u git gitaly-debug
sudo gitlab-rake gitlab:gitaly:check

# Performance profiling
sudo gitlab-rake gitlab:setup
sudo gitlab-rake gitlab:check:repos
sudo gitlab-rake gitlab:cleanup:sessions

# Container registry debugging
sudo gitlab-ctl registry-garbage-collect -m
docker system df

# Runner debugging
sudo gitlab-runner --debug run
sudo gitlab-runner exec docker test-job

# Network debugging for distributed setup
ping -c 4 postgres-master.example.com
ping -c 4 redis-master.example.com
telnet postgres-master.example.com 5432
telnet redis-master.example.com 6379

# Memory leak detection
pmap -x $(pgrep gitlab-workhorse)
valgrind --tool=memcheck --leak-check=full gitlab-workhorse

# Strace for syscall analysis
strace -p $(pgrep gitlab-workhorse) -e trace=network,file</code></pre>
      </div>
    </div>
<h2 id="additional-resources" class="mobile-header">Additional Resources</h2>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/" target="_blank" rel="noopener" class="mobile-link">Official Documentation</a></li>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/ee/administration/" target="_blank" rel="noopener" class="mobile-link">GitLab Admin Documentation</a></li>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/security/hardening/" target="_blank" rel="noopener" class="mobile-link">Security Hardening Guide</a></li>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener" class="mobile-link">GitLab Runner Documentation</a></li>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/ee/administration/packages/container_registry.html" target="_blank" rel="noopener" class="mobile-link">Container Registry Guide</a></li>
<li class="mobile-list-item"><a href="https://docs.gitlab.com/ee/api/" target="_blank" rel="noopener" class="mobile-link">GitLab API Documentation</a></li>
<p class="mobile-paragraph">---</p>
<p class="mobile-paragraph"><strong>Note:</strong> This guide is part of the <a href="https://howtomgr.github.io" target="_blank" rel="noopener" class="mobile-link">HowToMgr</a> collection.</p></div></article><section class="jsx-8a7f0cdcf94f52ce related-section"><h2 class="jsx-8a7f0cdcf94f52ce section-title">Related <!-- -->Infrastructure<!-- --> Guides</h2><div class="jsx-8a7f0cdcf94f52ce mobile-grid"><a class="mobile-card" href="/infrastructure/adguard-home/"><div class="jsx-8a7f0cdcf94f52ce mobile-card-header"><h3 class="jsx-8a7f0cdcf94f52ce mobile-card-title">Adguard Home</h3><p class="jsx-8a7f0cdcf94f52ce mobile-card-description">Repo for adguard-home</p></div><div class="jsx-8a7f0cdcf94f52ce mobile-card-meta"><span class="jsx-8a7f0cdcf94f52ce mobile-badge mobile-badge-info">1 min</span></div></a><a class="mobile-card" href="/infrastructure/adminer/"><div class="jsx-8a7f0cdcf94f52ce mobile-card-header"><h3 class="jsx-8a7f0cdcf94f52ce mobile-card-title">Adminer</h3><p class="jsx-8a7f0cdcf94f52ce mobile-card-description">Repo for adminer</p></div><div class="jsx-8a7f0cdcf94f52ce mobile-card-meta"><span class="jsx-8a7f0cdcf94f52ce mobile-badge mobile-badge-info">1 min</span></div></a><a class="mobile-card" href="/infrastructure/ansible/"><div class="jsx-8a7f0cdcf94f52ce mobile-card-header"><h3 class="jsx-8a7f0cdcf94f52ce mobile-card-title">Ansible</h3><p class="jsx-8a7f0cdcf94f52ce mobile-card-description">Repo for ansible</p></div><div class="jsx-8a7f0cdcf94f52ce mobile-card-meta"><span class="jsx-8a7f0cdcf94f52ce mobile-badge mobile-badge-info">31 min</span></div></a></div></section><nav class="jsx-8a7f0cdcf94f52ce guide-navigation"><a class="btn btn-secondary" href="/infrastructure/">← All <!-- -->Infrastructure</a><a class="btn btn-secondary" href="/">All Categories</a></nav></div></main><footer class="jsx-f92e766e9414ef16 mobile-footer"><div class="jsx-f92e766e9414ef16 container"><div class="jsx-f92e766e9414ef16 footer-content"><div class="jsx-f92e766e9414ef16 footer-links"><a href="/">Home</a><a href="https://github.com/howtomgr" target="_blank" rel="noopener" class="jsx-f92e766e9414ef16">GitHub</a><a href="https://github.com/howtomgr/howtomgr.github.io" target="_blank" rel="noopener" class="jsx-f92e766e9414ef16">Source</a></div><div class="jsx-f92e766e9414ef16 footer-separator"></div><p class="jsx-f92e766e9414ef16 footer-text">© <!-- -->2025<!-- --> HowToMgr Organization. Open source installation guides.</p><p class="jsx-f92e766e9414ef16 footer-tech">Built with ❤️ using Next.js + GitHub Pages</p><p class="jsx-f92e766e9414ef16 footer-disclaimer"><small class="jsx-f92e766e9414ef16">All guides are provided as-is. Please review and test before production use.</small></p></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"guide":{"name":"gitlab","displayName":"Gitlab","slug":"gitlab","description":"Repo for gitlab","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/gitlab","updatedAt":"2025-09-14T01:30:01Z","createdAt":"2025-09-08T03:07:56Z","readmeRaw":"# GitLab Installation Guide\n\nComplete DevOps platform with Git repository management, CI/CD pipelines, issue tracking, and container registry. Enterprise-grade solution for modern software development lifecycle with advanced security features.\n\n## Prerequisites\n\n- Linux system (any modern distribution)\n- 8GB RAM minimum, 16GB+ recommended for production\n- 4 CPU cores minimum, 8+ recommended\n- 50GB+ available disk space, SSD recommended\n- Domain name for external access\n- SSL certificates for production deployment\n- SMTP server for email notifications\n\n## Installation\n\n### Using Omnibus Package (Recommended)\n\n#### Ubuntu/Debian\n```bash\n# Install dependencies\nsudo apt-get update\nsudo apt-get install -y curl openssh-server ca-certificates tzdata perl postfix\n\n# Configure Postfix for email\nsudo dpkg-reconfigure postfix\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash\n\n# Install GitLab Enterprise Edition\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" apt-get install -y gitlab-ee\n\n# For GitLab Community Edition\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" apt-get install -y gitlab-ce\n\n# Initial configuration\nsudo gitlab-ctl reconfigure\n\n# Check status\nsudo gitlab-ctl status\n```\n\n#### RHEL/CentOS/Rocky Linux/AlmaLinux\n```bash\n# Install dependencies\nsudo yum install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# For newer versions\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable and start services\nsudo systemctl enable --now sshd postfix\n\n# Configure SELinux and firewall\nsudo setsebool -P httpd_can_network_connect 1\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --permanent --add-service=ssh\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" yum install -y gitlab-ee\n\n# Configure and start\nsudo gitlab-ctl reconfigure\n```\n\n#### Fedora\n```bash\n# Install dependencies\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable services\nsudo systemctl enable --now sshd postfix\n\n# Configure firewall\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\"https://gitlab.example.com\" dnf install -y gitlab-ee\n\nsudo gitlab-ctl reconfigure\n```\n\n### Docker Installation (Single Container)\n```bash\n# Create GitLab directories\nsudo mkdir -p /srv/gitlab/{config,logs,data}\n\n# Set environment variables\nexport GITLAB_HOME=/srv/gitlab\n\n# Run GitLab container with comprehensive configuration\nsudo docker run --detach \\\n  --hostname gitlab.example.com \\\n  --env GITLAB_OMNIBUS_CONFIG=\"\n    external_url 'https://gitlab.example.com';\n    gitlab_rails['gitlab_shell_ssh_port'] = 2222;\n    \n    # SSL configuration\n    nginx['ssl_certificate'] = '/etc/gitlab/ssl/gitlab.crt';\n    nginx['ssl_certificate_key'] = '/etc/gitlab/ssl/gitlab.key';\n    nginx['ssl_protocols'] = 'TLSv1.2 TLSv1.3';\n    nginx['ssl_prefer_server_ciphers'] = 'off';\n    \n    # Security settings\n    gitlab_rails['rack_attack_git_basic_auth'] = {\n      'enabled' =\u003e true,\n      'ip_whitelist' =\u003e ['127.0.0.1', '192.168.1.0/24'],\n      'maxretry' =\u003e 10,\n      'findtime' =\u003e 60,\n      'bantime' =\u003e 3600\n    };\n    \n    # Performance settings\n    postgresql['shared_preload_libraries'] = 'pg_stat_statements';\n    postgresql['max_connections'] = 200;\n    postgresql['shared_buffers'] = '1GB';\n    postgresql['effective_cache_size'] = '4GB';\n    \n    # Container Registry\n    registry_external_url 'https://registry.example.com';\n    gitlab_rails['registry_enabled'] = true;\n    \n    # Monitoring\n    prometheus_monitoring['enable'] = true;\n    grafana['enable'] = true;\n    grafana['admin_password'] = 'secure_grafana_password';\n    \n    # Email configuration\n    gitlab_rails['smtp_enable'] = true;\n    gitlab_rails['smtp_address'] = 'smtp.example.com';\n    gitlab_rails['smtp_port'] = 587;\n    gitlab_rails['smtp_user_name'] = 'gitlab@example.com';\n    gitlab_rails['smtp_password'] = 'smtp_secure_password';\n    gitlab_rails['smtp_domain'] = 'example.com';\n    gitlab_rails['smtp_authentication'] = 'login';\n    gitlab_rails['smtp_enable_starttls_auto'] = true;\n    gitlab_rails['smtp_tls'] = false;\n    gitlab_rails['smtp_openssl_verify_mode'] = 'peer';\n    \n    # Email settings\n    gitlab_rails['gitlab_email_from'] = 'gitlab@example.com';\n    gitlab_rails['gitlab_email_display_name'] = 'GitLab';\n    \n    # Backup configuration\n    gitlab_rails['backup_keep_time'] = 604800;\n    gitlab_rails['backup_upload_connection'] = {\n      'provider' =\u003e 'AWS',\n      'region' =\u003e 'us-west-2',\n      'aws_access_key_id' =\u003e 'backup_access_key',\n      'aws_secret_access_key' =\u003e 'backup_secret_key'\n    };\n    gitlab_rails['backup_upload_remote_directory'] = 'gitlab-backups';\n    \" \\\n  --publish 443:443 --publish 80:80 --publish 2222:22 \\\n  --name gitlab \\\n  --restart unless-stopped \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  gitlab/gitlab-ee:latest\n```\n\n### Docker Compose (Production Setup)\n```bash\nmkdir -p ~/gitlab-stack\ncd ~/gitlab-stack\n\ncat \u003e docker-compose.yml \u003c\u003cEOF\nversion: '3.8'\n\nservices:\n  gitlab:\n    image: gitlab/gitlab-ee:latest\n    container_name: gitlab\n    restart: unless-stopped\n    hostname: gitlab.example.com\n    environment:\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url 'https://gitlab.example.com'\n        \n        # Performance settings\n        postgresql['shared_buffers'] = \"2GB\"\n        postgresql['effective_cache_size'] = \"8GB\"\n        postgresql['max_connections'] = 300\n        \n        # Security settings\n        gitlab_rails['rack_attack_git_basic_auth'] = {\n          'enabled' =\u003e true,\n          'ip_whitelist' =\u003e ['127.0.0.1', '10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16'],\n          'maxretry' =\u003e 10,\n          'findtime' =\u003e 60,\n          'bantime' =\u003e 3600\n        }\n        \n        # Container Registry\n        registry_external_url 'https://registry.example.com'\n        gitlab_rails['registry_enabled'] = true\n        \n        # Monitoring\n        prometheus_monitoring['enable'] = true\n        grafana['enable'] = true\n        \n        # Let's Encrypt (disable for reverse proxy setup)\n        letsencrypt['enable'] = false\n        nginx['listen_port'] = 80\n        nginx['listen_https'] = false\n        \n        # GitLab Pages\n        pages_external_url \"https://pages.example.com\"\n        gitlab_pages['enable'] = true\n    ports:\n      - '80:80'\n      - '443:443'\n      - '2222:22'\n    volumes:\n      - './config:/etc/gitlab'\n      - './logs:/var/log/gitlab'\n      - './data:/var/opt/gitlab'\n    networks:\n      - gitlab\n    shm_size: '256m'\n    healthcheck:\n      test: [\"CMD-SHELL\", \"gitlab-healthcheck --fail --max-time 10\"]\n      interval: 60s\n      timeout: 30s\n      retries: 5\n      start_period: 200s\n\n  gitlab-runner:\n    image: gitlab/gitlab-runner:latest\n    container_name: gitlab-runner\n    restart: unless-stopped\n    volumes:\n      - './runner-config:/etc/gitlab-runner'\n      - '/var/run/docker.sock:/var/run/docker.sock'\n    networks:\n      - gitlab\n    depends_on:\n      - gitlab\n\n  redis:\n    image: redis:7-alpine\n    container_name: gitlab-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass redis_secure_password\n    volumes:\n      - redis-data:/data\n    networks:\n      - gitlab\n\n  nginx:\n    image: nginx:alpine\n    container_name: gitlab-nginx\n    restart: unless-stopped\n    ports:\n      - '443:443'\n    volumes:\n      - './nginx/nginx.conf:/etc/nginx/nginx.conf:ro'\n      - './nginx/ssl:/etc/nginx/ssl:ro'\n    depends_on:\n      - gitlab\n    networks:\n      - gitlab\n\nnetworks:\n  gitlab:\n    driver: bridge\n\nvolumes:\n  redis-data:\nEOF\n\n# Create NGINX reverse proxy configuration\nmkdir -p nginx\ncat \u003e nginx/nginx.conf \u003c\u003cEOF\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream gitlab {\n        server gitlab:80;\n    }\n    \n    upstream registry {\n        server gitlab:5000;\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name gitlab.example.com;\n\n        ssl_certificate /etc/nginx/ssl/gitlab.crt;\n        ssl_certificate_key /etc/nginx/ssl/gitlab.key;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;\n\n        client_max_body_size 0;\n        gzip off;\n\n        location / {\n            proxy_pass http://gitlab;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name registry.example.com;\n\n        ssl_certificate /etc/nginx/ssl/registry.crt;\n        ssl_certificate_key /etc/nginx/ssl/registry.key;\n\n        client_max_body_size 0;\n\n        location /v2/ {\n            proxy_pass http://registry;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n}\nEOF\n\ndocker-compose up -d\n```\n\n## Enterprise Configuration\n\n### Production Configuration (/etc/gitlab/gitlab.rb)\n```bash\nsudo tee /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n# GitLab Enterprise Production Configuration\n\nexternal_url 'https://gitlab.example.com'\n\n# Performance and Resource Settings\nunicorn['worker_timeout'] = 60\nunicorn['worker_processes'] = 8\nsidekiq['max_concurrency'] = 25\nsidekiq['min_concurrency'] = 10\n\n# PostgreSQL configuration\npostgresql['enable'] = true\npostgresql['max_connections'] = 300\npostgresql['shared_buffers'] = \"2GB\"\npostgresql['effective_cache_size'] = \"8GB\"\npostgresql['work_mem'] = \"16MB\"\npostgresql['maintenance_work_mem'] = \"256MB\"\npostgresql['checkpoint_completion_target'] = 0.9\npostgresql['wal_buffers'] = \"16MB\"\npostgresql['default_statistics_target'] = 100\npostgresql['random_page_cost'] = 1.1\npostgresql['effective_io_concurrency'] = 200\n\n# Redis configuration\nredis['enable'] = true\nredis['maxmemory'] = \"1gb\"\nredis['maxmemory_policy'] = \"allkeys-lru\"\nredis['save'] = '900 1 300 10 60 10000'\nredis['password'] = 'redis_secure_password'\n\n# Gitaly configuration (Git RPC service)\ngitaly['enable'] = true\ngitaly['auth_token'] = 'secure_gitaly_token'\ngitaly['ruby_max_rss'] = 300000000  # 300MB\ngitaly['concurrency'] = [\n  {\n    'rpc' =\u003e \"/gitaly.SmartHTTPService/PostReceivePack\",\n    'max_per_repo' =\u003e 3\n  },\n  {\n    'rpc' =\u003e \"/gitaly.SSHService/SSHUploadPack\", \n    'max_per_repo' =\u003e 3\n  }\n]\n\n# NGINX configuration\nnginx['enable'] = true\nnginx['listen_port'] = 80\nnginx['listen_https'] = false\nnginx['redirect_http_to_https'] = false\nnginx['ssl_certificate'] = \"/etc/gitlab/ssl/gitlab.crt\"\nnginx['ssl_certificate_key'] = \"/etc/gitlab/ssl/gitlab.key\"\nnginx['ssl_protocols'] = \"TLSv1.2 TLSv1.3\"\nnginx['ssl_prefer_server_ciphers'] = \"off\"\nnginx['ssl_ciphers'] = \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\"\n\n# Container Registry\nregistry_external_url 'https://registry.example.com'\ngitlab_rails['registry_enabled'] = true\nregistry['enable'] = true\nregistry['username'] = \"registry\"\nregistry['uid'] = 996\nregistry['gid'] = 996\nregistry['dir'] = \"/var/opt/gitlab/registry\"\nregistry['log_directory'] = \"/var/log/gitlab/registry\"\nregistry['log_level'] = \"info\"\nregistry['rootcertbundle'] = \"/opt/gitlab/embedded/ssl/certs/cacert.pem\"\n\n# GitLab Pages\npages_external_url \"https://pages.example.com\"\ngitlab_pages['enable'] = true\ngitlab_pages['dir'] = \"/var/opt/gitlab/gitlab-pages\"\ngitlab_pages['log_directory'] = \"/var/log/gitlab/gitlab-pages\"\ngitlab_pages['access_control'] = true\ngitlab_pages['use_legacy_storage'] = false\n\n# Email configuration\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.example.com\"\ngitlab_rails['smtp_port'] = 587\ngitlab_rails['smtp_user_name'] = \"gitlab@example.com\"\ngitlab_rails['smtp_password'] = \"smtp_secure_password\"\ngitlab_rails['smtp_domain'] = \"example.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\ngitlab_rails['smtp_openssl_verify_mode'] = 'peer'\n\ngitlab_rails['gitlab_email_enabled'] = true\ngitlab_rails['gitlab_email_from'] = 'gitlab@example.com'\ngitlab_rails['gitlab_email_display_name'] = 'GitLab'\ngitlab_rails['gitlab_email_reply_to'] = 'noreply@example.com'\n\n# Security settings\ngitlab_rails['rack_attack_git_basic_auth'] = {\n  'enabled' =\u003e true,\n  'ip_whitelist' =\u003e %w{127.0.0.1 192.168.1.0/24 10.0.0.0/8},\n  'maxretry' =\u003e 10,\n  'findtime' =\u003e 60,\n  'bantime' =\u003e 3600\n}\n\n# Two-factor authentication\ngitlab_rails['require_two_factor_authentication'] = false\ngitlab_rails['two_factor_grace_period'] = 8  # 8 hours instead of default 48\n\n# Session settings\ngitlab_rails['session_expire_delay'] = 10080  # 1 week\ngitlab_rails['session_store_enabled'] = true\n\n# Backup configuration\ngitlab_rails['backup_keep_time'] = 604800  # 7 days\ngitlab_rails['backup_upload_connection'] = {\n  'provider' =\u003e 'AWS',\n  'region' =\u003e 'us-west-2',\n  'aws_access_key_id' =\u003e 'backup_access_key',\n  'aws_secret_access_key' =\u003e 'backup_secret_key'\n}\ngitlab_rails['backup_upload_remote_directory'] = 'gitlab-backups'\ngitlab_rails['backup_multipart_chunk_size'] = 104857600  # 100MB\n\n# Monitoring\nprometheus_monitoring['enable'] = true\nprometheus['enable'] = true\nprometheus['listen_address'] = 'localhost:9090'\nprometheus['scrape_configs'] = [\n  {\n    'job_name' =\u003e 'gitlab-workhorse',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:9229'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'gitlab-unicorn',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:8080'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'gitlab-sidekiq',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:8082'] }\n    ]\n  }\n]\n\ngrafana['enable'] = true\ngrafana['admin_password'] = 'secure_grafana_password'\ngrafana['disable_login_form'] = false\n\n# Logging\nlogging['svlogd_size'] = 200 * 1024 * 1024  # 200MB\nlogging['svlogd_num'] = 30\nlogging['svlogd_timeout'] = 24 * 60 * 60    # rotate after 24 hours\nlogging['logrotate_frequency'] = \"daily\"\nlogging['logrotate_rotate'] = 30\nlogging['logrotate_compress'] = \"compress\"\n\n# Git settings\ngitlab_rails['gitlab_default_branch'] = 'main'\ngitlab_rails['max_request_duration_seconds'] = 60\n\n# Rate limiting\ngitlab_rails['rate_limit_requests_per_period'] = 300\ngitlab_rails['rate_limit_period'] = 60\n\n# Enterprise features (if using GitLab EE)\n# gitlab_rails['ee_license'] = File.read('/etc/gitlab/GitLab.gitlab-license')\n\n# Security scanning\ngitlab_rails['dependency_scanning_enabled'] = true\ngitlab_rails['container_scanning_enabled'] = true\ngitlab_rails['sast_enabled'] = true\ngitlab_rails['secret_detection_enabled'] = true\n\n# LDAP configuration (Enterprise)\ngitlab_rails['ldap_enabled'] = false\ngitlab_rails['prevent_ldap_sign_in'] = false\ngitlab_rails['ldap_servers'] = {\n  'main' =\u003e {\n    'label' =\u003e 'LDAP',\n    'host' =\u003e 'ldap.example.com',\n    'port' =\u003e 636,\n    'uid' =\u003e 'sAMAccountName',\n    'bind_dn' =\u003e 'CN=gitlab,OU=Service Accounts,DC=example,DC=com',\n    'password' =\u003e 'ldap_service_password',\n    'encryption' =\u003e 'ssl',\n    'verify_certificates' =\u003e true,\n    'ca_file' =\u003e '/etc/gitlab/ssl/ldap-ca.crt',\n    'base' =\u003e 'DC=example,DC=com',\n    'user_filter' =\u003e '',\n    'attributes' =\u003e {\n      'username' =\u003e ['uid', 'userid', 'sAMAccountName'],\n      'email' =\u003e ['mail', 'email', 'userPrincipalName'],\n      'name' =\u003e 'cn',\n      'first_name' =\u003e 'givenName',\n      'last_name' =\u003e 'sn'\n    },\n    'group_base' =\u003e 'OU=Groups,DC=example,DC=com',\n    'admin_group' =\u003e 'GitLab Administrators'\n  }\n}\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Security Hardening (2024 Best Practices)\n\n### SSL/TLS Configuration\n```bash\n# Generate SSL certificates\nsudo mkdir -p /etc/gitlab/ssl\n\n# Self-signed certificate for testing\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 \\\n  -keyout /etc/gitlab/ssl/gitlab.key \\\n  -out /etc/gitlab/ssl/gitlab.crt \\\n  -subj \"/C=US/ST=State/L=City/O=Organization/CN=gitlab.example.com\"\n\n# Production: Let's Encrypt integration\nsudo tee -a /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n\n# Let's Encrypt configuration\nletsencrypt['enable'] = true\nletsencrypt['contact_emails'] = ['admin@example.com']\nletsencrypt['auto_renew'] = true\nletsencrypt['auto_renew_hour'] = 0\nletsencrypt['auto_renew_minute'] = 0\nletsencrypt['auto_renew_day_of_month'] = \"*/4\"\n\n# Force HTTPS\nnginx['redirect_http_to_https'] = true\nnginx['ssl_protocols'] = \"TLSv1.2 TLSv1.3\"\nnginx['ssl_prefer_server_ciphers'] = \"off\"\nnginx['ssl_ciphers'] = \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\"\n\n# HSTS\nnginx['hsts_max_age'] = 31536000\nnginx['hsts_include_subdomains'] = true\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n### Advanced Security Configuration\n```bash\n# Configure security settings\nsudo tee -a /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n\n# Security hardening\ngitlab_rails['webhook_timeout'] = 10\ngitlab_rails['webhook_max_redirects'] = 3\n\n# Disable password authentication (use SSO/LDAP)\ngitlab_rails['omniauth_allow_single_sign_on'] = ['saml', 'ldapmain']\ngitlab_rails['omniauth_block_auto_created_users'] = false\ngitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'\n\n# API rate limiting\ngitlab_rails['rate_limit_requests_per_period'] = 1000\ngitlab_rails['rate_limit_period'] = 60\n\n# Git over HTTP rate limiting\ngitlab_rails['rack_attack_git_basic_auth'] = {\n  'enabled' =\u003e true,\n  'ip_whitelist' =\u003e %w{127.0.0.1 192.168.1.0/24},\n  'maxretry' =\u003e 20,\n  'findtime' =\u003e 60,\n  'bantime' =\u003e 3600\n}\n\n# Protected paths\ngitlab_rails['rack_attack_protected_paths'] = [\n  '/users/password',\n  '/users/sign_in',\n  '/api/v4/session.json',\n  '/api/v4/session',\n  '/users/confirmation',\n  '/unsubscribes/',\n  '/import/github/personal_access_token',\n  '/admin/session'\n]\n\n# SSH security\ngitlab_rails['gitlab_shell_ssh_port'] = 2222\ngitlab_shell['auth_file'] = \"/var/opt/gitlab/.ssh/authorized_keys\"\n\n# Container Registry security\nregistry['notifications'] = [\n  {\n    'name' =\u003e 'security_scan',\n    'url' =\u003e 'https://security-scanner.example.com/webhook',\n    'timeout' =\u003e '2000ms',\n    'threshold' =\u003e 3,\n    'backoff' =\u003e '1000ms'\n  }\n]\n\n# Secrets management\ngitlab_rails['db_password'] = File.read('/etc/gitlab/secrets/db_password').strip\ngitlab_rails['secret_key_base'] = File.read('/etc/gitlab/secrets/secret_key_base').strip\ngitlab_rails['otp_key_base'] = File.read('/etc/gitlab/secrets/otp_key_base').strip\ngitlab_rails['encrypted_settings_key_base'] = File.read('/etc/gitlab/secrets/encrypted_settings_key_base').strip\n\n# Audit logging\ngitlab_rails['audit_events_enabled'] = true\n\n# Disable features that increase attack surface\ngitlab_rails['usage_ping_enabled'] = false\ngitlab_rails['sentry_enabled'] = false\nEOF\n\n# Create secrets directory and files\nsudo mkdir -p /etc/gitlab/secrets\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/db_password\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/secret_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/otp_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/encrypted_settings_key_base\n\n# Secure permissions\nsudo chmod 600 /etc/gitlab/secrets/*\nsudo chown git:git /etc/gitlab/secrets/*\n\nsudo gitlab-ctl reconfigure\n```\n\n### GitLab Runner Security Configuration\n```bash\n# Create secure runner configuration\nsudo mkdir -p /etc/gitlab-runner\n\nsudo tee /etc/gitlab-runner/config.toml \u003e /dev/null \u003c\u003cEOF\nconcurrent = 4\ncheck_interval = 0\nshutdown_timeout = 0\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = \"docker-runner-secure\"\n  url = \"https://gitlab.example.com/\"\n  token = \"runner_registration_token\"\n  executor = \"docker\"\n  \n  # Security settings\n  pre_clone_script = \"echo 'Starting secure build'\"\n  pre_build_script = \"echo 'Preparing secure environment'\"\n  post_build_script = \"echo 'Cleaning up secure environment'\"\n  \n  [runners.docker]\n    tls_verify = false\n    image = \"alpine:latest\"\n    privileged = false  # Critical: Never use privileged mode\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\"/cache\", \"/certs/client\"]\n    shm_size = 0\n    network_mode = \"bridge\"\n    \n    # Security restrictions\n    cap_drop = [\"ALL\"]\n    cap_add = [\"CHOWN\", \"SETGID\", \"SETUID\"]\n    security_opt = [\"no-new-privileges:true\"]\n    \n    # Resource limits\n    memory = \"2g\"\n    memory_swap = \"2g\"\n    memory_reservation = \"1g\"\n    cpus = \"1.5\"\n    \n    # Network security\n    dns = [\"8.8.8.8\", \"8.8.4.4\"]\n    extra_hosts = [\"gitlab.example.com:192.168.1.100\"]\n    \n    # Image scanning\n    pull_policy = [\"if-not-present\"]\n    \n  [runners.docker.tmpfs]\n    \"/tmp\" = \"rw,noexec,nosuid,size=100m\"\n    \"/var/tmp\" = \"rw,noexec,nosuid,size=100m\"\n\n# Kubernetes executor (more secure)\n[[runners]]\n  name = \"k8s-runner-secure\"\n  url = \"https://gitlab.example.com/\"\n  token = \"k8s_runner_token\"\n  executor = \"kubernetes\"\n  \n  [runners.kubernetes]\n    host = \"https://k8s.example.com:6443\"\n    namespace = \"gitlab-runner\"\n    privileged = false  # Never use privileged\n    image = \"alpine:latest\"\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \"2Gi\"\n    memory_request = \"1Gi\"\n    cpu_limit = \"1000m\"\n    cpu_request = \"500m\"\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"tmp\"\n      mount_path = \"/tmp\"\n      medium = \"Memory\"\nEOF\n\n# Register runner with security tags\nsudo gitlab-runner register \\\n  --url \"https://gitlab.example.com/\" \\\n  --registration-token \"RUNNER_TOKEN\" \\\n  --description \"secure-docker-runner\" \\\n  --tag-list \"docker,secure,production\" \\\n  --run-untagged=\"false\" \\\n  --locked=\"true\" \\\n  --access-level=\"ref_protected\" \\\n  --executor \"docker\" \\\n  --docker-image alpine:latest \\\n  --docker-privileged=\"false\" \\\n  --docker-volumes \"/certs/client\"\n\nsudo systemctl enable --now gitlab-runner\n```\n\n## CI/CD Pipeline Security\n\n### Secure Pipeline Configuration\n```bash\n# Create .gitlab-ci.yml with security best practices\ncat \u003e .gitlab-ci.yml \u003c\u003cEOF\n# GitLab CI/CD Security Best Practices - 2024\n\nstages:\n  - security-scan\n  - test\n  - build\n  - security-test\n  - deploy\n\nvariables:\n  # Security variables\n  DOCKER_DRIVER: overlay2\n  DOCKER_TLS_CERTDIR: \"/certs\"\n  SECURE_LOG_LEVEL: info\n  \n  # Use protected variables for sensitive data\n  # DEPLOY_TOKEN: (set in GitLab UI as protected variable)\n  # AWS_ACCESS_KEY: (set in GitLab UI as protected variable)\n\n# Security scanning stage\nsecret-detection:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/secrets:latest\n  script:\n    - echo \"Scanning for secrets in code...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      secret_detection: gl-secret-detection-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\ndependency-scanning:\n  stage: security-scan  \n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/gemnasium:latest\n  script:\n    - echo \"Scanning dependencies for vulnerabilities...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      dependency_scanning: gl-dependency-scanning-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\nsast:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/sobelow:latest\n  script:\n    - echo \"Static application security testing...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\n# Container scanning\ncontainer-scanning:\n  stage: security-test\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/klar:latest\n  script:\n    - echo \"Scanning container image for vulnerabilities...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n  dependencies:\n    - build\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n  tags:\n    - secure\n\n# Secure build stage\nbuild:\n  stage: build\n  image: docker:latest\n  services:\n    - docker:dind\n  before_script:\n    # Verify image signatures\n    - echo \"Verifying base image integrity...\"\n    - docker trust inspect alpine:latest\n  script:\n    - echo \"Building application with security scanning...\"\n    - docker build -t \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA .\n    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock aquasec/trivy image \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n    - docker login -u \\$CI_REGISTRY_USER -p \\$CI_REGISTRY_PASSWORD \\$CI_REGISTRY\n    - docker push \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n  tags:\n    - secure\n\n# Secure deployment\ndeploy-production:\n  stage: deploy\n  image: alpine:latest\n  before_script:\n    # Install kubectl and verify cluster connectivity\n    - apk add --no-cache curl\n    - curl -LO \"https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl\"\n    - chmod +x kubectl \u0026\u0026 mv kubectl /usr/local/bin/\n    - kubectl config use-context production-cluster\n    - kubectl auth can-i create deployments --namespace=production\n  script:\n    - echo \"Deploying to production with security validations...\"\n    - kubectl apply -f k8s/production/ --namespace=production\n    - kubectl rollout status deployment/app --namespace=production --timeout=300s\n  environment:\n    name: production\n    url: https://app.example.com\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n      when: manual\n  only:\n    variables:\n      - \\$CI_COMMIT_REF_PROTECTED == \"true\"\n  tags:\n    - secure\n    - production\n\n# Security compliance check\ncompliance-check:\n  stage: security-test\n  image: alpine:latest\n  script:\n    - echo \"Running compliance checks...\"\n    - apk add --no-cache curl jq\n    - |\n      # Check for required security labels in Docker images\n      if ! docker inspect \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA | jq -r '.[].Config.Labels[\"security.scan\"]' | grep -q \"passed\"; then\n        echo \"ERROR: Image failed security scan\"\n        exit 1\n      fi\n    - echo \"Compliance check passed\"\n  dependencies:\n    - container-scanning\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH == \"main\"'\n  tags:\n    - secure\n\n# Infrastructure as Code scanning\niac-scanning:\n  stage: security-scan\n  image: bridgecrew/checkov:latest\n  script:\n    - checkov --framework terraform --framework kubernetes --framework dockerfile\n  artifacts:\n    reports:\n      junit: checkov-report.xml\n  rules:\n    - if: '\\$CI_COMMIT_BRANCH'\n      changes:\n        - \"**/*.tf\"\n        - \"**/*.yml\"\n        - \"**/*.yaml\"\n        - \"**/Dockerfile*\"\n  tags:\n    - secure\nEOF\n```\n\n### RBAC and Access Control\n```bash\n# Configure GitLab RBAC via API\nGITLAB_URL=\"https://gitlab.example.com\"\nADMIN_TOKEN=\"your_admin_token\"\n\n# Create groups with specific permissions\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=developers\u0026path=developers\u0026description=Development team\u0026visibility=private\" \\\n  \"${GITLAB_URL}/api/v4/groups\"\n\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=security-team\u0026path=security-team\u0026description=Security team\u0026visibility=private\" \\\n  \"${GITLAB_URL}/api/v4/groups\"\n\n# Create projects with security templates\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=secure-app\u0026description=Secure application\u0026visibility=private\u0026issues_enabled=true\u0026merge_requests_enabled=true\u0026wiki_enabled=false\u0026builds_enabled=true\u0026snippets_enabled=false\u0026container_registry_enabled=true\u0026shared_runners_enabled=false\" \\\n  \"${GITLAB_URL}/api/v4/projects\"\n\n# Configure branch protection\nPROJECT_ID=\"1\"  # Replace with actual project ID\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"name=main\u0026code_owner_approval_required=true\u0026push_access_level=40\u0026merge_access_level=40\u0026unprotect_access_level=40\" \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/protected_branches\"\n\n# Configure push rules (Premium/Ultimate)\ncurl --request POST --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --data \"deny_delete_tag=true\u0026member_check=true\u0026prevent_secrets=true\u0026author_email_regex=.*@example.com\u0026file_extension_restriction=jar,exe\u0026max_file_size=100\" \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/push_rule\"\n```\n\n### Vulnerability Scanning Integration\n```bash\n# Configure dependency proxy for secure image caching\nsudo tee -a /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n\n# Dependency Proxy for secure image caching\ngitlab_rails['dependency_proxy_enabled'] = true\ngitlab_rails['dependency_proxy_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/dependency_proxy\"\n\n# Security scanning\ngitlab_rails['sast_enabled'] = true\ngitlab_rails['dependency_scanning_enabled'] = true\ngitlab_rails['container_scanning_enabled'] = true\ngitlab_rails['secret_detection_enabled'] = true\ngitlab_rails['license_scanning_enabled'] = true\n\n# Secure package registry\ngitlab_rails['packages_enabled'] = true\ngitlab_rails['packages_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/packages\"\nEOF\n\n# Create custom security scanning templates\nmkdir -p .gitlab/ci-templates\n\ncat \u003e .gitlab/ci-templates/Security-Scanning.gitlab-ci.yml \u003c\u003cEOF\n# Custom Security Scanning Template\n\n.security-scan-template:\n  stage: security-scan\n  variables:\n    SECURE_LOG_LEVEL: info\n  before_script:\n    - echo \"Preparing security scan environment...\"\n    - apk add --no-cache curl jq\n  tags:\n    - secure\n\ncustom-sast:\n  extends: .security-scan-template\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/semgrep:latest\n  script:\n    - echo \"Running custom SAST analysis...\"\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n    expire_in: 1 week\n\ncustom-secrets-scan:\n  extends: .security-scan-template\n  image: trufflesecurity/trufflehog:latest\n  script:\n    - echo \"Scanning for secrets with TruffleHog...\"\n    - trufflehog git file://. --json \u003e trufflehog-report.json\n    - |\n      if [ -s trufflehog-report.json ]; then\n        echo \"Secrets detected!\"\n        cat trufflehog-report.json\n        exit 1\n      fi\n  artifacts:\n    reports:\n      secret_detection: trufflehog-report.json\n    expire_in: 1 week\n\nimage-vulnerability-scan:\n  extends: .security-scan-template\n  image: aquasec/trivy:latest\n  script:\n    - echo \"Scanning Docker images for vulnerabilities...\"\n    - trivy image --format template --template \"@contrib/gitlab.tpl\" \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n    expire_in: 1 week\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Backup and Disaster Recovery\n\n### Enterprise Backup Strategy\n```bash\nsudo tee /usr/local/bin/gitlab-backup.sh \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\nBACKUP_DIR=\"/backup/gitlab\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p ${BACKUP_DIR}/{omnibus,secrets,ssl,logs}\n\n# Create GitLab backup\ngitlab-backup create STRATEGY=copy SKIP=uploads,builds,artifacts,lfs,registry,pages\n\n# Backup configuration files\ntar -czf ${BACKUP_DIR}/omnibus/gitlab-config-${DATE}.tar.gz \\\n    /etc/gitlab/gitlab.rb \\\n    /etc/gitlab/gitlab-secrets.json\n\n# Backup SSL certificates\ntar -czf ${BACKUP_DIR}/ssl/gitlab-ssl-${DATE}.tar.gz \\\n    /etc/gitlab/ssl/ \\\n    /etc/letsencrypt/\n\n# Backup secrets\ntar -czf ${BACKUP_DIR}/secrets/gitlab-secrets-${DATE}.tar.gz \\\n    /etc/gitlab/secrets/\n\n# Upload to multiple cloud storage backends\naws s3 cp ${BACKUP_DIR}/ s3://gitlab-backups/ --recursive\naz storage blob upload-batch --source ${BACKUP_DIR} --destination gitlab-backups\ngsutil cp -r ${BACKUP_DIR}/* gs://gitlab-backups/\n\n# Geo-replication backup (Enterprise)\nif command -v gitlab-rake \u003e/dev/null 2\u003e\u00261; then\n    gitlab-rake gitlab:geo:check\n    gitlab-rake geo:status\nfi\n\n# Test backup integrity\nLATEST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar | head -1)\nif [ -n \"$LATEST_BACKUP\" ]; then\n    echo \"Latest backup: $LATEST_BACKUP\"\n    tar -tf \"$LATEST_BACKUP\" \u003e /tmp/backup-contents.txt\n    if [ $? -eq 0 ]; then\n        echo \"✓ Backup integrity verified\"\n    else\n        echo \"✗ Backup integrity check failed\"\n    fi\nfi\n\n# Keep only last 7 backups locally\nfind /var/opt/gitlab/backups/ -name \"*_gitlab_backup.tar\" -mtime +7 -delete\nfind ${BACKUP_DIR} -name \"gitlab-*\" -type f -mtime +7 -delete\n\necho \"GitLab backup completed: ${DATE}\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-backup.sh\n\n# Schedule daily backups\necho \"0 2 * * * root /usr/local/bin/gitlab-backup.sh\" | sudo tee -a /etc/crontab\n\n# Create disaster recovery script\nsudo tee /usr/local/bin/gitlab-restore.sh \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\nBACKUP_FILE=\"${1}\"\n\nif [ -z \"$BACKUP_FILE\" ]; then\n    echo \"Usage: $0 \u003cbackup_file\u003e\"\n    echo \"Available backups:\"\n    ls -la /var/opt/gitlab/backups/*_gitlab_backup.tar\n    exit 1\nfi\n\n# Stop GitLab services\ngitlab-ctl stop unicorn\ngitlab-ctl stop puma\ngitlab-ctl stop sidekiq\n\n# Restore from backup\ngitlab-backup restore BACKUP=$(basename $BACKUP_FILE _gitlab_backup.tar) force=yes\n\n# Restore configuration\nif [ -f \"/backup/gitlab/omnibus/gitlab-config-latest.tar.gz\" ]; then\n    cd /\n    tar -xzf /backup/gitlab/omnibus/gitlab-config-latest.tar.gz\nfi\n\n# Reconfigure and restart\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n# Verify installation\ngitlab-rake gitlab:check SANITIZE=true\n\necho \"GitLab restore completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-restore.sh\n```\n\n### High Availability Setup\n```bash\n# Configure GitLab for HA with external services\nsudo tee /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n# GitLab High Availability Configuration\n\nexternal_url 'https://gitlab.example.com'\n\n# Disable built-in services (use external)\npostgresql['enable'] = false\nredis['enable'] = false\nnginx['enable'] = true\nunicorn['enable'] = true\nsidekiq['enable'] = true\ngitlab_workhorse['enable'] = true\ngitaly['enable'] = true\n\n# External PostgreSQL\ngitlab_rails['db_adapter'] = 'postgresql'\ngitlab_rails['db_encoding'] = 'unicode'\ngitlab_rails['db_host'] = 'postgres-master.example.com'\ngitlab_rails['db_port'] = 5432\ngitlab_rails['db_database'] = 'gitlabhq_production'\ngitlab_rails['db_username'] = 'gitlab'\ngitlab_rails['db_password'] = 'secure_db_password'\ngitlab_rails['db_load_balancing'] = {\n  'hosts' =\u003e ['postgres-slave1.example.com', 'postgres-slave2.example.com']\n}\n\n# External Redis\ngitlab_rails['redis_host'] = 'redis-master.example.com'\ngitlab_rails['redis_port'] = 6379\ngitlab_rails['redis_password'] = 'redis_secure_password'\ngitlab_rails['redis_sentinels'] = [\n  {'host' =\u003e 'redis-sentinel1.example.com', 'port' =\u003e 26379},\n  {'host' =\u003e 'redis-sentinel2.example.com', 'port' =\u003e 26379},\n  {'host' =\u003e 'redis-sentinel3.example.com', 'port' =\u003e 26379}\n]\n\n# Load balancing\nnginx['listen_addresses'] = ['0.0.0.0']\nnginx['real_ip_header'] = 'X-Forwarded-For'\nnginx['real_ip_recursive'] = 'on'\nnginx['real_ip_trusted_addresses'] = ['10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16']\n\n# Gitaly cluster (Enterprise)\ngit_data_dirs({\n  'default' =\u003e {\n    'gitaly_address' =\u003e 'tcp://gitaly1.example.com:8075',\n    'gitaly_token' =\u003e 'gitaly_secure_token'\n  },\n  'storage1' =\u003e {\n    'gitaly_address' =\u003e 'tcp://gitaly2.example.com:8075',\n    'gitaly_token' =\u003e 'gitaly_secure_token'\n  }\n})\n\n# Object storage (S3-compatible)\ngitlab_rails['object_store']['enabled'] = true\ngitlab_rails['object_store']['proxy_download'] = true\ngitlab_rails['object_store']['connection'] = {\n  'provider' =\u003e 'AWS',\n  'region' =\u003e 'us-west-2',\n  'aws_access_key_id' =\u003e 'object_store_access_key',\n  'aws_secret_access_key' =\u003e 'object_store_secret_key'\n}\ngitlab_rails['object_store']['objects']['artifacts']['bucket'] = 'gitlab-artifacts'\ngitlab_rails['object_store']['objects']['lfs']['bucket'] = 'gitlab-lfs'\ngitlab_rails['object_store']['objects']['uploads']['bucket'] = 'gitlab-uploads'\ngitlab_rails['object_store']['objects']['packages']['bucket'] = 'gitlab-packages'\n\n# Geo replication (Enterprise Premium)\ngitlab_rails['geo_primary_role'] = true  # Set to false for secondary\ngitlab_rails['geo_node_name'] = 'primary-site'\ngitlab_rails['geo_registry_replication_enabled'] = true\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n## Container Registry and Package Management\n\n### Secure Container Registry Setup\n```bash\n# Configure container registry with security scanning\nsudo tee -a /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n\n# Container Registry configuration\nregistry_external_url 'https://registry.example.com'\ngitlab_rails['registry_enabled'] = true\nregistry['enable'] = true\n\n# Registry storage\nregistry['storage'] = {\n  's3' =\u003e {\n    'accesskey' =\u003e 'registry_s3_access_key',\n    'secretkey' =\u003e 'registry_s3_secret_key',\n    'bucket' =\u003e 'gitlab-registry',\n    'region' =\u003e 'us-west-2',\n    'encrypt' =\u003e true\n  }\n}\n\n# Registry security\nregistry['auth_token_realm'] = \"https://gitlab.example.com/jwt/auth\"\nregistry['auth_token_service'] = \"container_registry\"\nregistry['auth_token_issuer'] = \"gitlab-issuer\"\nregistry['auth_token_autoredirect'] = false\n\n# Health checks\nregistry['health_storagedriver_enabled'] = true\nregistry['health_storagedriver_interval'] = '10s'\nregistry['health_storagedriver_threshold'] = 3\n\n# Container scanning\ngitlab_rails['container_registry_token_expire_delay'] = 300\ngitlab_rails['container_registry_cleanup_enabled'] = true\n\n# Image retention policies\nregistry['middleware'] = {\n  'repository' =\u003e [\n    {\n      'name' =\u003e 'cloudfront',\n      'disabled' =\u003e false,\n      'options' =\u003e {\n        'baseurl' =\u003e 'https://registry-cdn.example.com',\n        'privatekey' =\u003e '/etc/gitlab/registry-cdn-private-key.pem',\n        'keypairid' =\u003e 'CLOUDFRONT_KEY_PAIR_ID',\n        'duration' =\u003e '3600s'\n      }\n    }\n  ]\n}\n\n# Package registry\ngitlab_rails['packages_enabled'] = true\ngitlab_rails['packages_storage_path'] = \"/var/opt/gitlab/gitlab-rails/shared/packages\"\nEOF\n\n# Create container registry cleanup policy\ncat \u003e registry-cleanup-policy.json \u003c\u003cEOF\n{\n  \"name_regex\": \".*\",\n  \"name_regex_keep\": \"v\\\\d+\\\\.\\\\d+\\\\.\\\\d+\",\n  \"cadence\": \"7d\",\n  \"older_than\": \"30d\",\n  \"keep_n\": 10\n}\nEOF\n\n# Apply cleanup policy via API\ncurl --request PUT --header \"PRIVATE-TOKEN: ${ADMIN_TOKEN}\" \\\n  --header \"Content-Type: application/json\" \\\n  --data @registry-cleanup-policy.json \\\n  \"${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/registry/repositories/1\"\n\nsudo gitlab-ctl reconfigure\n```\n\n## Monitoring and Observability\n\n### Comprehensive Monitoring Setup\n```bash\n# Enable built-in monitoring stack\nsudo tee -a /etc/gitlab/gitlab.rb \u003e /dev/null \u003c\u003cEOF\n\n# Prometheus monitoring\nprometheus_monitoring['enable'] = true\nprometheus['enable'] = true\nprometheus['monitor_kubernetes'] = true\nprometheus['scrape_configs'] = [\n  {\n    'job_name' =\u003e 'gitlab-workhorse',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:9229'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'gitlab-unicorn',  \n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:8080'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'gitlab-sidekiq',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:8082'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'gitlab-pages',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:8090'] }\n    ]\n  },\n  {\n    'job_name' =\u003e 'docker-registry',\n    'static_configs' =\u003e [\n      { 'targets' =\u003e ['localhost:5001'] }\n    ]\n  }\n]\n\n# Grafana configuration\ngrafana['enable'] = true\ngrafana['admin_password'] = 'secure_grafana_password'\ngrafana['disable_login_form'] = false\ngrafana['allow_user_sign_up'] = false\n\n# Grafana LDAP integration\ngrafana['ldap_enabled'] = true\ngrafana['ldap_allow_sign_up'] = false\ngrafana['ldap_servers'] = [{\n  'host' =\u003e 'ldap.example.com',\n  'port' =\u003e 636,\n  'uid' =\u003e 'sAMAccountName',\n  'bind_dn' =\u003e 'CN=grafana,OU=Service Accounts,DC=example,DC=com',\n  'password' =\u003e 'ldap_service_password',\n  'encryption' =\u003e 'ssl',\n  'base' =\u003e 'DC=example,DC=com',\n  'user_filter' =\u003e '',\n  'group_base' =\u003e 'OU=Groups,DC=example,DC=com',\n  'admin_group' =\u003e 'GitLab Administrators'\n}]\n\n# Node Exporter\nnode_exporter['enable'] = true\nnode_exporter['listen_address'] = 'localhost:9100'\n\n# Alert Manager\nalertmanager['enable'] = true\nalertmanager['admin_email'] = 'alerts@example.com'\nalertmanager['flags'] = {\n  'storage.path' =\u003e '/var/opt/gitlab/alertmanager/data',\n  'config.file' =\u003e '/var/opt/gitlab/alertmanager/alertmanager.yml'\n}\n\n# Log forwarding\nlogging['logrotate_frequency'] = \"daily\"\nlogging['logrotate_rotate'] = 30\nlogging['logrotate_compress'] = \"compress\"\nlogging['svlogd_size'] = 200 * 1024 * 1024  # 200MB\nlogging['svlogd_num'] = 30\nEOF\n\n# Create custom alerting rules\nsudo mkdir -p /var/opt/gitlab/alertmanager\n\nsudo tee /var/opt/gitlab/alertmanager/alertmanager.yml \u003e /dev/null \u003c\u003cEOF\nglobal:\n  smtp_smarthost: 'smtp.example.com:587'\n  smtp_from: 'gitlab-alerts@example.com'\n  smtp_auth_username: 'gitlab-alerts@example.com'\n  smtp_auth_password: 'smtp_password'\n\nroute:\n  group_by: ['alertname', 'cluster', 'service']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\n  receiver: 'gitlab-alerts'\n  routes:\n  - match:\n      severity: critical\n    receiver: 'critical-alerts'\n    group_wait: 10s\n    repeat_interval: 5m\n\nreceivers:\n- name: 'gitlab-alerts'\n  email_configs:\n  - to: 'gitlab-admin@example.com'\n    subject: 'GitLab Alert: {{ .GroupLabels.alertname }}'\n    body: |\n      {{ range .Alerts }}\n      Alert: {{ .Annotations.summary }}\n      Description: {{ .Annotations.description }}\n      Instance: {{ .Labels.instance }}\n      {{ end }}\n\n- name: 'critical-alerts'\n  email_configs:\n  - to: 'oncall@example.com'\n    subject: 'CRITICAL GitLab Alert: {{ .GroupLabels.alertname }}'\n  slack_configs:\n  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'\n    channel: '#critical-alerts'\n    title: 'Critical GitLab Alert'\nEOF\n\nsudo gitlab-ctl reconfigure\n```\n\n### Performance Monitoring\n```bash\n# Create GitLab performance monitoring script\nsudo tee /usr/local/bin/gitlab-performance-monitor.sh \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\nMONITOR_LOG=\"/var/log/gitlab-performance.log\"\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${MONITOR_LOG}\n}\n\n# Check GitLab service health\nfor service in unicorn sidekiq workhorse gitaly; do\n    if gitlab-ctl status $service | grep -q \"run:\"; then\n        log_message \"✓ $service is running\"\n    else\n        log_message \"✗ $service is not running\"\n    fi\ndone\n\n# Check database performance\nDB_CONNECTIONS=$(gitlab-psql -c \"SELECT count(*) FROM pg_stat_activity;\" -t)\nlog_message \"ℹ Database connections: ${DB_CONNECTIONS}\"\n\n# Check Redis performance  \nREDIS_MEMORY=$(redis-cli info memory | grep used_memory_human: | cut -d: -f2)\nlog_message \"ℹ Redis memory usage: ${REDIS_MEMORY}\"\n\n# Check Git repository storage\nREPO_SIZE=$(du -sh /var/opt/gitlab/git-data/repositories | cut -f1)\nlog_message \"ℹ Repository storage usage: ${REPO_SIZE}\"\n\n# Check background job queue\nSIDEKIQ_QUEUE=$(gitlab-rails runner \"puts Sidekiq::Queue.new.size\")\nlog_message \"ℹ Sidekiq queue size: ${SIDEKIQ_QUEUE}\"\n\n# Check GitLab metrics\nGITLAB_VERSION=$(gitlab-rake gitlab:env:info | grep \"GitLab information\" -A 10 | grep \"Version:\" | awk '{print $2}')\nlog_message \"ℹ GitLab version: ${GITLAB_VERSION}\"\n\n# Performance metrics via API\nAPI_RESPONSE_TIME=$(curl -w \"%{time_total}\" -s -o /dev/null https://gitlab.example.com/api/v4/projects)\nlog_message \"ℹ API response time: ${API_RESPONSE_TIME}s\"\n\n# Check disk I/O\nDISK_USAGE=$(df /var/opt/gitlab | awk 'NR==2 {print $5}' | sed 's/%//')\nlog_message \"ℹ Disk usage: ${DISK_USAGE}%\"\n\nif [ ${DISK_USAGE} -gt 85 ]; then\n    log_message \"⚠ High disk usage detected\"\nfi\n\nlog_message \"Performance monitoring completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-performance-monitor.sh\n\n# Schedule performance monitoring\necho \"*/15 * * * * root /usr/local/bin/gitlab-performance-monitor.sh\" | sudo tee -a /etc/crontab\n```\n\n## GitLab Runner Advanced Configuration\n\n### Secure Multi-Platform Runner Setup\n```bash\n# Create advanced runner configuration with security\nsudo tee /etc/gitlab-runner/config.toml \u003e /dev/null \u003c\u003cEOF\nconcurrent = 10\ncheck_interval = 0\nlog_level = \"info\"\nlog_format = \"runner\"\nshutdown_timeout = 30\n\n[session_server]\n  session_timeout = 1800\n\n# Docker executor with security hardening\n[[runners]]\n  name = \"docker-secure-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"secure_runner_token\"\n  executor = \"docker\"\n  output_limit = 4096\n  \n  # Security scripts\n  pre_clone_script = \"\"\"\n    echo 'Security scan initiated'\n    id\n    pwd\n    env | grep -E '^(CI_|GITLAB_)' | sort\n  \"\"\"\n  \n  pre_build_script = \"\"\"\n    echo 'Preparing secure build environment'\n    # Verify no sensitive data in environment\n    if env | grep -i -E '(password|secret|key|token)' | grep -v -E '^(CI_JOB_TOKEN|GITLAB_CI|CI_SERVER)'; then\n      echo 'ERROR: Sensitive data detected in environment'\n      exit 1\n    fi\n  \"\"\"\n  \n  post_build_script = \"\"\"\n    echo 'Cleaning up build artifacts'\n    rm -rf /tmp/* 2\u003e/dev/null || true\n  \"\"\"\n  \n  [runners.docker]\n    tls_verify = false\n    image = \"alpine:latest\"\n    privileged = false\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\"/cache\", \"/certs/client\"]\n    shm_size = 268435456  # 256MB\n    \n    # Security restrictions\n    cap_drop = [\"ALL\"]\n    cap_add = [\"CHOWN\", \"SETGID\", \"SETUID\"]\n    security_opt = [\"no-new-privileges:true\", \"apparmor:unconfined\"]\n    \n    # Resource limits\n    memory = \"2g\"\n    memory_swap = \"2g\"\n    memory_reservation = \"1g\"\n    cpus = \"2\"\n    \n    # Network security\n    network_mode = \"bridge\"\n    dns = [\"8.8.8.8\", \"8.8.4.4\"]\n    \n    # Disable dangerous features\n    disable_entrypoint_overwrite = true\n    \n    # Image pull policy\n    pull_policy = [\"if-not-present\"]\n    \n  [runners.docker.tmpfs]\n    \"/tmp\" = \"rw,noexec,nosuid,size=100m\"\n    \"/var/tmp\" = \"rw,noexec,nosuid,size=100m\"\n\n# Kubernetes executor (Enterprise recommended)\n[[runners]]\n  name = \"k8s-secure-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"k8s_runner_token\"\n  executor = \"kubernetes\"\n  \n  [runners.kubernetes]\n    host = \"https://k8s.example.com:6443\"\n    namespace = \"gitlab-runner\"\n    privileged = false\n    image = \"alpine:latest\"\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \"4Gi\"\n    memory_request = \"2Gi\"\n    cpu_limit = \"2000m\"\n    cpu_request = \"1000m\"\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      seccomp_profile_type = \"RuntimeDefault\"\n      \n    [runners.kubernetes.container_security_context]\n      allow_privilege_escalation = false\n      read_only_root_filesystem = true\n      capabilities = { drop = [\"ALL\"] }\n      \n    # Volume mounts for security\n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"tmp\"\n      mount_path = \"/tmp\"\n      medium = \"Memory\"\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \"var-tmp\"\n      mount_path = \"/var/tmp\"\n      medium = \"Memory\"\n\n# Shell executor for specific tasks (limited use)\n[[runners]]\n  name = \"shell-restricted-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"shell_runner_token\"\n  executor = \"shell\"\n  shell = \"bash\"\n  \n  # Restricted tags only\n  tag_list = [\"shell\", \"restricted\"]\n  run_untagged = false\n  locked = true\n  \n  # Security environment\n  environment = [\n    \"PATH=/usr/local/bin:/usr/bin:/bin\",\n    \"HOME=/home/gitlab-runner\",\n    \"SHELL=/bin/bash\"\n  ]\n  \n  # Cleanup\n  builds_dir = \"/home/gitlab-runner/builds\"\n  cache_dir = \"/home/gitlab-runner/cache\"\n  \n  [runners.cache]\n    Type = \"s3\"\n    [runners.cache.s3]\n      ServerAddress = \"s3.amazonaws.com\"\n      BucketName = \"gitlab-runner-cache\"\n      BucketLocation = \"us-west-2\"\n      Insecure = false\nEOF\n\nsudo systemctl restart gitlab-runner\n```\n\n### GitLab Runner Auto-scaling (Cloud)\n```bash\n# Configure GitLab Runner with Docker Machine for auto-scaling\nsudo tee /etc/gitlab-runner/autoscale-config.toml \u003e /dev/null \u003c\u003cEOF\nconcurrent = 50\ncheck_interval = 0\n\n[[runners]]\n  name = \"autoscale-runner\"\n  url = \"https://gitlab.example.com/\"\n  token = \"autoscale_runner_token\"\n  executor = \"docker+machine\"\n  \n  [runners.docker]\n    image = \"alpine:latest\"\n    privileged = false\n    disable_cache = false\n    volumes = [\"/cache\"]\n    \n    # Security\n    cap_drop = [\"ALL\"]\n    security_opt = [\"no-new-privileges:true\"]\n    \n  [runners.machine]\n    IdleCount = 2\n    IdleTime = 1800\n    MaxBuilds = 20\n    MachineName = \"gitlab-runner-%s\"\n    MachineDriver = \"amazonec2\"\n    \n    # AWS EC2 configuration\n    [runners.machine.autoscaling]\n      Periods = [\"* * 9-17 * * mon-fri *\", \"* * 18-8 * * * *\"]\n      IdleCount = [5, 1]\n      IdleTime = [1800, 3600]\n      Timezone = \"UTC\"\n    \n    # Machine options for security\n    [runners.machine.machineoptions]\n      amazonec2-access-key = \"aws_access_key\"\n      amazonec2-secret-key = \"aws_secret_key\"\n      amazonec2-region = \"us-west-2\"\n      amazonec2-vpc-id = \"vpc-12345678\"\n      amazonec2-subnet-id = \"subnet-87654321\"\n      amazonec2-security-group = \"gitlab-runner-sg\"\n      amazonec2-instance-type = \"t3.medium\"\n      amazonec2-ami = \"ami-0c02fb55956c7d316\"  # Amazon Linux 2\n      amazonec2-iam-instance-profile = \"GitLabRunnerInstanceProfile\"\n      amazonec2-use-private-address = \"true\"\n      amazonec2-tags = \"Name,gitlab-runner,Environment,production\"\n      amazonec2-root-size = \"20\"\n      amazonec2-volume-type = \"gp3\"\n      amazonec2-use-ebs-optimized = \"true\"\n      \n  [runners.cache]\n    Type = \"s3\"\n    Shared = true\n    [runners.cache.s3]\n      ServerAddress = \"s3.amazonaws.com\"\n      AccessKey = \"cache_access_key\"\n      SecretKey = \"cache_secret_key\"  \n      BucketName = \"gitlab-runner-cache\"\n      BucketLocation = \"us-west-2\"\n      Insecure = false\nEOF\n```\n\n## Verification and Health Checks\n\n### Comprehensive Health Monitoring\n```bash\nsudo tee /usr/local/bin/gitlab-health-check.sh \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\nHEALTH_LOG=\"/var/log/gitlab-health.log\"\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${HEALTH_LOG}\n}\n\n# Check GitLab service status\nif gitlab-ctl status | grep -q \"down:\"; then\n    log_message \"⚠ Some GitLab services are down:\"\n    gitlab-ctl status | grep \"down:\" | while read line; do\n        log_message \"  - $line\"\n    done\nelse\n    log_message \"✓ All GitLab services are running\"\nfi\n\n# Check GitLab application health\nif gitlab-rake gitlab:check \u003e/dev/null 2\u003e\u00261; then\n    log_message \"✓ GitLab application health check passed\"\nelse\n    log_message \"✗ GitLab application health check failed\"\n    gitlab-rake gitlab:check | tail -10 \u003e\u003e ${HEALTH_LOG}\nfi\n\n# Check GitLab Runner connectivity\nRUNNERS_ONLINE=$(curl -s --header \"PRIVATE-TOKEN: admin_token\" https://gitlab.example.com/api/v4/runners | jq '[.[] | select(.status==\"online\")] | length')\nTOTAL_RUNNERS=$(curl -s --header \"PRIVATE-TOKEN: admin_token\" https://gitlab.example.com/api/v4/runners | jq '. | length')\nlog_message \"ℹ GitLab Runners: ${RUNNERS_ONLINE}/${TOTAL_RUNNERS} online\"\n\n# Check database connectivity\nif gitlab-psql -c \"SELECT version();\" \u003e/dev/null 2\u003e\u00261; then\n    log_message \"✓ Database connection is healthy\"\nelse\n    log_message \"✗ Database connection issues\"\nfi\n\n# Check Redis connectivity\nif redis-cli ping | grep -q \"PONG\"; then\n    log_message \"✓ Redis connection is healthy\"\nelse\n    log_message \"✗ Redis connection issues\"\nfi\n\n# Check container registry\nREGISTRY_STATUS=$(curl -s https://registry.example.com/v2/ | jq -r .message 2\u003e/dev/null)\nif [ \"$REGISTRY_STATUS\" = \"authentication required\" ] || [ \"$REGISTRY_STATUS\" = \"null\" ]; then\n    log_message \"✓ Container registry is responding\"\nelse\n    log_message \"⚠ Container registry issues\"\nfi\n\n# Check backup status\nLAST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar 2\u003e/dev/null | head -1)\nif [ -n \"$LAST_BACKUP\" ]; then\n    BACKUP_AGE=$(stat -c %Y \"$LAST_BACKUP\")\n    CURRENT_TIME=$(date +%s)\n    HOURS_SINCE_BACKUP=$(( (CURRENT_TIME - BACKUP_AGE) / 3600 ))\n    \n    if [ $HOURS_SINCE_BACKUP -lt 48 ]; then\n        log_message \"✓ Recent backup available (${HOURS_SINCE_BACKUP} hours old)\"\n    else\n        log_message \"⚠ Last backup is ${HOURS_SINCE_BACKUP} hours old\"\n    fi\nelse\n    log_message \"✗ No backup files found\"\nfi\n\n# Check SSL certificate expiry\nSSL_EXPIRY=$(echo | openssl s_client -servername gitlab.example.com -connect gitlab.example.com:443 2\u003e/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)\nSSL_EXPIRY_EPOCH=$(date -d \"$SSL_EXPIRY\" +%s)\nCURRENT_EPOCH=$(date +%s)\nDAYS_TO_EXPIRY=$(( (SSL_EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))\n\nif [ $DAYS_TO_EXPIRY -lt 30 ]; then\n    log_message \"⚠ SSL certificate expires in ${DAYS_TO_EXPIRY} days\"\nelse\n    log_message \"✓ SSL certificate expires in ${DAYS_TO_EXPIRY} days\"\nfi\n\n# Check system resources\nCPU_USAGE=$(top -bn1 | grep \"Cpu(s)\" | awk '{print $2}' | cut -d'%' -f1)\nMEMORY_USAGE=$(free | grep Mem | awk '{printf \"%.0f\", $3/$2 * 100.0}')\nlog_message \"ℹ System usage - CPU: ${CPU_USAGE}%, Memory: ${MEMORY_USAGE}%\"\n\nlog_message \"GitLab health check completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-health-check.sh\n\n# Schedule health checks every 15 minutes\necho \"*/15 * * * * root /usr/local/bin/gitlab-health-check.sh\" | sudo tee -a /etc/crontab\n```\n\n### Security Audit and Compliance\n```bash\nsudo tee /usr/local/bin/gitlab-security-audit.sh \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\nAUDIT_LOG=\"/var/log/gitlab-security-audit.log\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\nlog_message() {\n    echo \"$(date '+%Y-%m-%d %H:%M:%S') - $1\" | tee -a ${AUDIT_LOG}\n}\n\nlog_message \"Starting GitLab security audit...\"\n\n# Check user accounts with admin privileges\nADMIN_USERS=$(gitlab-rails runner \"puts User.admins.count\")\nlog_message \"ℹ ${ADMIN_USERS} users with admin privileges\"\n\n# Check for users without 2FA\nUSERS_WITHOUT_2FA=$(gitlab-rails runner \"puts User.where(two_factor_enabled: false).count\")\nlog_message \"ℹ ${USERS_WITHOUT_2FA} users without 2FA enabled\"\n\n# Check SSH key security\nWEAK_SSH_KEYS=$(gitlab-rails runner \"puts Key.where('LENGTH(key) \u003c ?', 2048).count\")\nlog_message \"ℹ ${WEAK_SSH_KEYS} SSH keys shorter than 2048 bits\"\n\n# Check project visibility\nPUBLIC_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 20).count\")\nINTERNAL_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 10).count\")\nPRIVATE_PROJECTS=$(gitlab-rails runner \"puts Project.where(visibility_level: 0).count\")\nlog_message \"ℹ Projects - Public: ${PUBLIC_PROJECTS}, Internal: ${INTERNAL_PROJECTS}, Private: ${PRIVATE_PROJECTS}\"\n\n# Check for projects without security scanning\nPROJECTS_WITHOUT_SAST=$(gitlab-rails runner \"\nputs Project.joins(:ci_pipelines)\n  .where('ci_pipelines.created_at \u003e ?', 30.days.ago)\n  .where.not(id: Ci::Build.joins(:pipeline).where('ci_builds.name ILIKE ?', '%sast%').select(:project_id))\n  .distinct.count\n\")\nlog_message \"ℹ ${PROJECTS_WITHOUT_SAST} active projects without SAST scanning\"\n\n# Check external integrations\nWEBHOOK_COUNT=$(gitlab-rails runner \"puts ProjectHook.count + SystemHook.count\")\nlog_message \"ℹ ${WEBHOOK_COUNT} webhooks configured\"\n\n# Check audit events (Enterprise)\nif gitlab-rails runner \"puts defined?(AuditEvent)\" | grep -q \"constant\"; then\n    RECENT_AUDIT_EVENTS=$(gitlab-rails runner \"puts AuditEvent.where('created_at \u003e ?', 24.hours.ago).count\")\n    log_message \"ℹ ${RECENT_AUDIT_EVENTS} audit events in last 24 hours\"\nfi\n\n# Check for suspicious activity\nFAILED_LOGINS=$(grep \"Failed Login\" /var/log/gitlab/gitlab-rails/production.log | grep \"$(date +'%Y-%m-%d')\" | wc -l)\nif [ ${FAILED_LOGINS} -gt 20 ]; then\n    log_message \"⚠ ${FAILED_LOGINS} failed login attempts today\"\nelse\n    log_message \"✓ ${FAILED_LOGINS} failed login attempts today (normal)\"\nfi\n\n# Check for large file uploads\nLARGE_UPLOADS=$(find /var/opt/gitlab/git-data/repositories -type f -size +100M -mtime -7 | wc -l)\nif [ ${LARGE_UPLOADS} -gt 0 ]; then\n    log_message \"ℹ ${LARGE_UPLOADS} large files (\u003e100MB) uploaded in last week\"\nfi\n\nlog_message \"Security audit completed\"\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-security-audit.sh\n\n# Schedule daily security audits\necho \"0 8 * * * root /usr/local/bin/gitlab-security-audit.sh\" | sudo tee -a /etc/crontab\n```\n\n## Troubleshooting (Cross-Platform)\n\n### Common Issues and Solutions\n```bash\n# Check GitLab status\nsudo gitlab-ctl status\nsudo gitlab-ctl tail\n\n# Check configuration\nsudo gitlab-ctl show-config\nsudo gitlab-rake gitlab:check SANITIZE=true\n\n# Reconfigure GitLab\nsudo gitlab-ctl reconfigure\nsudo gitlab-ctl restart\n\n# Database issues\nsudo gitlab-psql -d gitlabhq_production\nsudo gitlab-rake db:migrate:status\n\n# Redis issues\nredis-cli ping\nredis-cli info\n\n# Check logs for errors\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\n\n# Performance issues\nsudo gitlab-rake gitlab:env:info\nsudo gitlab-ctl status | grep memory\n\n# SSL/TLS issues\nsudo gitlab-rake gitlab:check\nopenssl s_client -connect gitlab.example.com:443\n\n# Container registry issues\nsudo gitlab-ctl registry-garbage-collect\ndocker login registry.example.com\n\n# Runner connectivity issues\nsudo gitlab-runner verify\nsudo gitlab-runner list\n\n# Backup issues\ngitlab-backup create STRATEGY=copy\ngitlab-backup restore BACKUP=timestamp\n\n# Reset admin password\nsudo gitlab-rake \"gitlab:password:reset[root]\"\n\n# Check disk usage\ndf -h /var/opt/gitlab/\nsudo du -sh /var/opt/gitlab/git-data/\n\n# Memory usage analysis\nps aux --sort=-%mem | grep gitlab\ngitlab-ctl status | grep memory\n\n# Network connectivity\ncurl -I https://gitlab.example.com\ntelnet gitlab.example.com 443\n\n# Service restart order (if needed)\nsudo gitlab-ctl stop\nsudo gitlab-ctl start postgresql\nsudo gitlab-ctl start redis\nsudo gitlab-ctl start\n```\n\n### Advanced Debugging\n```bash\n# Enable debug logging\nsudo gitlab-ctl edit-config\n# Add: gitlab_rails['log_level'] = 'DEBUG'\n\nsudo gitlab-ctl reconfigure\n\n# Debug specific services\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\nsudo gitlab-ctl tail gitaly\n\n# Database debugging\nsudo gitlab-psql -d gitlabhq_production -c \"\\l\"\nsudo gitlab-rake db:migrate:status\n\n# Git debugging\nsudo -u git gitaly-debug\nsudo gitlab-rake gitlab:gitaly:check\n\n# Performance profiling\nsudo gitlab-rake gitlab:setup\nsudo gitlab-rake gitlab:check:repos\nsudo gitlab-rake gitlab:cleanup:sessions\n\n# Container registry debugging\nsudo gitlab-ctl registry-garbage-collect -m\ndocker system df\n\n# Runner debugging\nsudo gitlab-runner --debug run\nsudo gitlab-runner exec docker test-job\n\n# Network debugging for distributed setup\nping -c 4 postgres-master.example.com\nping -c 4 redis-master.example.com\ntelnet postgres-master.example.com 5432\ntelnet redis-master.example.com 6379\n\n# Memory leak detection\npmap -x $(pgrep gitlab-workhorse)\nvalgrind --tool=memcheck --leak-check=full gitlab-workhorse\n\n# Strace for syscall analysis\nstrace -p $(pgrep gitlab-workhorse) -e trace=network,file\n```\n\n## Additional Resources\n\n- [Official Documentation](https://docs.gitlab.com/)\n- [GitLab Admin Documentation](https://docs.gitlab.com/ee/administration/)\n- [Security Hardening Guide](https://docs.gitlab.com/security/hardening/)\n- [GitLab Runner Documentation](https://docs.gitlab.com/runner/)\n- [Container Registry Guide](https://docs.gitlab.com/ee/administration/packages/container_registry.html)\n- [GitLab API Documentation](https://docs.gitlab.com/ee/api/)\n\n---\n\n**Note:** This guide is part of the [HowToMgr](https://howtomgr.github.io) collection.","readmeHtml":"\u003ch1 id=\"gitlab-installation-guide\" class=\"mobile-header\"\u003eGitLab Installation Guide\u003c/h1\u003e\n\u003cp class=\"mobile-paragraph\"\u003eComplete DevOps platform with Git repository management, CI/CD pipelines, issue tracking, and container registry. Enterprise-grade solution for modern software development lifecycle with advanced security features.\u003c/p\u003e\n\u003ch2 id=\"prerequisites\" class=\"mobile-header\"\u003ePrerequisites\u003c/h2\u003e\n\u003cli class=\"mobile-list-item\"\u003eLinux system (any modern distribution)\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e8GB RAM minimum, 16GB+ recommended for production\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e4 CPU cores minimum, 8+ recommended\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e50GB+ available disk space, SSD recommended\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003eDomain name for external access\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003eSSL certificates for production deployment\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003eSMTP server for email notifications\u003c/li\u003e\n\u003ch2 id=\"installation\" class=\"mobile-header\"\u003eInstallation\u003c/h2\u003e\n\u003ch3 id=\"using-omnibus-package-recommended\" class=\"mobile-header\"\u003eUsing Omnibus Package (Recommended)\u003c/h3\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Ubuntu/Debian\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install dependencies\nsudo apt-get update\nsudo apt-get install -y curl openssh-server ca-certificates tzdata perl postfix\n\n# Configure Postfix for email\nsudo dpkg-reconfigure postfix\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash\n\n# Install GitLab Enterprise Edition\nsudo EXTERNAL_URL=\u0026quot;https://gitlab.example.com\u0026quot; apt-get install -y gitlab-ee\n\n# For GitLab Community Edition\nsudo EXTERNAL_URL=\u0026quot;https://gitlab.example.com\u0026quot; apt-get install -y gitlab-ce\n\n# Initial configuration\nsudo gitlab-ctl reconfigure\n\n# Check status\nsudo gitlab-ctl status\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### RHEL/CentOS/Rocky Linux/AlmaLinux\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install dependencies\nsudo yum install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# For newer versions\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable and start services\nsudo systemctl enable --now sshd postfix\n\n# Configure SELinux and firewall\nsudo setsebool -P httpd_can_network_connect 1\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --permanent --add-service=ssh\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\u0026quot;https://gitlab.example.com\u0026quot; yum install -y gitlab-ee\n\n# Configure and start\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Fedora\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install dependencies\nsudo dnf install -y curl policycoreutils-python-utils openssh-server perl postfix\n\n# Enable services\nsudo systemctl enable --now sshd postfix\n\n# Configure firewall\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n\n# Add GitLab repository\ncurl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n\n# Install GitLab\nsudo EXTERNAL_URL=\u0026quot;https://gitlab.example.com\u0026quot; dnf install -y gitlab-ee\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"docker-installation-single-container\" class=\"mobile-header\"\u003eDocker Installation (Single Container)\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create GitLab directories\nsudo mkdir -p /srv/gitlab/{config,logs,data}\n\n# Set environment variables\nexport GITLAB_HOME=/srv/gitlab\n\n# Run GitLab container with comprehensive configuration\nsudo docker run --detach \\\n  --hostname gitlab.example.com \\\n  --env GITLAB_OMNIBUS_CONFIG=\u0026quot;\n    external_url \u0026#039;https://gitlab.example.com\u0026#039;;\n    gitlab_rails[\u0026#039;gitlab_shell_ssh_port\u0026#039;] = 2222;\n    \n    # SSL configuration\n    nginx[\u0026#039;ssl_certificate\u0026#039;] = \u0026#039;/etc/gitlab/ssl/gitlab.crt\u0026#039;;\n    nginx[\u0026#039;ssl_certificate_key\u0026#039;] = \u0026#039;/etc/gitlab/ssl/gitlab.key\u0026#039;;\n    nginx[\u0026#039;ssl_protocols\u0026#039;] = \u0026#039;TLSv1.2 TLSv1.3\u0026#039;;\n    nginx[\u0026#039;ssl_prefer_server_ciphers\u0026#039;] = \u0026#039;off\u0026#039;;\n    \n    # Security settings\n    gitlab_rails[\u0026#039;rack_attack_git_basic_auth\u0026#039;] = {\n      \u0026#039;enabled\u0026#039; =\u0026gt; true,\n      \u0026#039;ip_whitelist\u0026#039; =\u0026gt; [\u0026#039;127.0.0.1\u0026#039;, \u0026#039;192.168.1.0/24\u0026#039;],\n      \u0026#039;maxretry\u0026#039; =\u0026gt; 10,\n      \u0026#039;findtime\u0026#039; =\u0026gt; 60,\n      \u0026#039;bantime\u0026#039; =\u0026gt; 3600\n    };\n    \n    # Performance settings\n    postgresql[\u0026#039;shared_preload_libraries\u0026#039;] = \u0026#039;pg_stat_statements\u0026#039;;\n    postgresql[\u0026#039;max_connections\u0026#039;] = 200;\n    postgresql[\u0026#039;shared_buffers\u0026#039;] = \u0026#039;1GB\u0026#039;;\n    postgresql[\u0026#039;effective_cache_size\u0026#039;] = \u0026#039;4GB\u0026#039;;\n    \n    # Container Registry\n    registry_external_url \u0026#039;https://registry.example.com\u0026#039;;\n    gitlab_rails[\u0026#039;registry_enabled\u0026#039;] = true;\n    \n    # Monitoring\n    prometheus_monitoring[\u0026#039;enable\u0026#039;] = true;\n    grafana[\u0026#039;enable\u0026#039;] = true;\n    grafana[\u0026#039;admin_password\u0026#039;] = \u0026#039;secure_grafana_password\u0026#039;;\n    \n    # Email configuration\n    gitlab_rails[\u0026#039;smtp_enable\u0026#039;] = true;\n    gitlab_rails[\u0026#039;smtp_address\u0026#039;] = \u0026#039;smtp.example.com\u0026#039;;\n    gitlab_rails[\u0026#039;smtp_port\u0026#039;] = 587;\n    gitlab_rails[\u0026#039;smtp_user_name\u0026#039;] = \u0026#039;gitlab@example.com\u0026#039;;\n    gitlab_rails[\u0026#039;smtp_password\u0026#039;] = \u0026#039;smtp_secure_password\u0026#039;;\n    gitlab_rails[\u0026#039;smtp_domain\u0026#039;] = \u0026#039;example.com\u0026#039;;\n    gitlab_rails[\u0026#039;smtp_authentication\u0026#039;] = \u0026#039;login\u0026#039;;\n    gitlab_rails[\u0026#039;smtp_enable_starttls_auto\u0026#039;] = true;\n    gitlab_rails[\u0026#039;smtp_tls\u0026#039;] = false;\n    gitlab_rails[\u0026#039;smtp_openssl_verify_mode\u0026#039;] = \u0026#039;peer\u0026#039;;\n    \n    # Email settings\n    gitlab_rails[\u0026#039;gitlab_email_from\u0026#039;] = \u0026#039;gitlab@example.com\u0026#039;;\n    gitlab_rails[\u0026#039;gitlab_email_display_name\u0026#039;] = \u0026#039;GitLab\u0026#039;;\n    \n    # Backup configuration\n    gitlab_rails[\u0026#039;backup_keep_time\u0026#039;] = 604800;\n    gitlab_rails[\u0026#039;backup_upload_connection\u0026#039;] = {\n      \u0026#039;provider\u0026#039; =\u0026gt; \u0026#039;AWS\u0026#039;,\n      \u0026#039;region\u0026#039; =\u0026gt; \u0026#039;us-west-2\u0026#039;,\n      \u0026#039;aws_access_key_id\u0026#039; =\u0026gt; \u0026#039;backup_access_key\u0026#039;,\n      \u0026#039;aws_secret_access_key\u0026#039; =\u0026gt; \u0026#039;backup_secret_key\u0026#039;\n    };\n    gitlab_rails[\u0026#039;backup_upload_remote_directory\u0026#039;] = \u0026#039;gitlab-backups\u0026#039;;\n    \u0026quot; \\\n  --publish 443:443 --publish 80:80 --publish 2222:22 \\\n  --name gitlab \\\n  --restart unless-stopped \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  gitlab/gitlab-ee:latest\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"docker-compose-production-setup\" class=\"mobile-header\"\u003eDocker Compose (Production Setup)\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003emkdir -p ~/gitlab-stack\ncd ~/gitlab-stack\n\ncat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;EOF\nversion: \u0026#039;3.8\u0026#039;\n\nservices:\n  gitlab:\n    image: gitlab/gitlab-ee:latest\n    container_name: gitlab\n    restart: unless-stopped\n    hostname: gitlab.example.com\n    environment:\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url \u0026#039;https://gitlab.example.com\u0026#039;\n        \n        # Performance settings\n        postgresql[\u0026#039;shared_buffers\u0026#039;] = \u0026quot;2GB\u0026quot;\n        postgresql[\u0026#039;effective_cache_size\u0026#039;] = \u0026quot;8GB\u0026quot;\n        postgresql[\u0026#039;max_connections\u0026#039;] = 300\n        \n        # Security settings\n        gitlab_rails[\u0026#039;rack_attack_git_basic_auth\u0026#039;] = {\n          \u0026#039;enabled\u0026#039; =\u0026gt; true,\n          \u0026#039;ip_whitelist\u0026#039; =\u0026gt; [\u0026#039;127.0.0.1\u0026#039;, \u0026#039;10.0.0.0/8\u0026#039;, \u0026#039;172.16.0.0/12\u0026#039;, \u0026#039;192.168.0.0/16\u0026#039;],\n          \u0026#039;maxretry\u0026#039; =\u0026gt; 10,\n          \u0026#039;findtime\u0026#039; =\u0026gt; 60,\n          \u0026#039;bantime\u0026#039; =\u0026gt; 3600\n        }\n        \n        # Container Registry\n        registry_external_url \u0026#039;https://registry.example.com\u0026#039;\n        gitlab_rails[\u0026#039;registry_enabled\u0026#039;] = true\n        \n        # Monitoring\n        prometheus_monitoring[\u0026#039;enable\u0026#039;] = true\n        grafana[\u0026#039;enable\u0026#039;] = true\n        \n        # Let\u0026#039;s Encrypt (disable for reverse proxy setup)\n        letsencrypt[\u0026#039;enable\u0026#039;] = false\n        nginx[\u0026#039;listen_port\u0026#039;] = 80\n        nginx[\u0026#039;listen_https\u0026#039;] = false\n        \n        # GitLab Pages\n        pages_external_url \u0026quot;https://pages.example.com\u0026quot;\n        gitlab_pages[\u0026#039;enable\u0026#039;] = true\n    ports:\n      - \u0026#039;80:80\u0026#039;\n      - \u0026#039;443:443\u0026#039;\n      - \u0026#039;2222:22\u0026#039;\n    volumes:\n      - \u0026#039;./config:/etc/gitlab\u0026#039;\n      - \u0026#039;./logs:/var/log/gitlab\u0026#039;\n      - \u0026#039;./data:/var/opt/gitlab\u0026#039;\n    networks:\n      - gitlab\n    shm_size: \u0026#039;256m\u0026#039;\n    healthcheck:\n      test: [\u0026quot;CMD-SHELL\u0026quot;, \u0026quot;gitlab-healthcheck --fail --max-time 10\u0026quot;]\n      interval: 60s\n      timeout: 30s\n      retries: 5\n      start_period: 200s\n\n  gitlab-runner:\n    image: gitlab/gitlab-runner:latest\n    container_name: gitlab-runner\n    restart: unless-stopped\n    volumes:\n      - \u0026#039;./runner-config:/etc/gitlab-runner\u0026#039;\n      - \u0026#039;/var/run/docker.sock:/var/run/docker.sock\u0026#039;\n    networks:\n      - gitlab\n    depends_on:\n      - gitlab\n\n  redis:\n    image: redis:7-alpine\n    container_name: gitlab-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass redis_secure_password\n    volumes:\n      - redis-data:/data\n    networks:\n      - gitlab\n\n  nginx:\n    image: nginx:alpine\n    container_name: gitlab-nginx\n    restart: unless-stopped\n    ports:\n      - \u0026#039;443:443\u0026#039;\n    volumes:\n      - \u0026#039;./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\u0026#039;\n      - \u0026#039;./nginx/ssl:/etc/nginx/ssl:ro\u0026#039;\n    depends_on:\n      - gitlab\n    networks:\n      - gitlab\n\nnetworks:\n  gitlab:\n    driver: bridge\n\nvolumes:\n  redis-data:\nEOF\n\n# Create NGINX reverse proxy configuration\nmkdir -p nginx\ncat \u0026gt; nginx/nginx.conf \u0026lt;\u0026lt;EOF\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream gitlab {\n        server gitlab:80;\n    }\n    \n    upstream registry {\n        server gitlab:5000;\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name gitlab.example.com;\n\n        ssl_certificate /etc/nginx/ssl/gitlab.crt;\n        ssl_certificate_key /etc/nginx/ssl/gitlab.key;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;\n\n        client_max_body_size 0;\n        gzip off;\n\n        location / {\n            proxy_pass http://gitlab;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n\n    server {\n        listen 443 ssl http2;\n        server_name registry.example.com;\n\n        ssl_certificate /etc/nginx/ssl/registry.crt;\n        ssl_certificate_key /etc/nginx/ssl/registry.key;\n\n        client_max_body_size 0;\n\n        location /v2/ {\n            proxy_pass http://registry;\n            proxy_set_header Host \\$host;\n            proxy_set_header X-Real-IP \\$remote_addr;\n            proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto \\$scheme;\n        }\n    }\n}\nEOF\n\ndocker-compose up -d\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"enterprise-configuration\" class=\"mobile-header\"\u003eEnterprise Configuration\u003c/h2\u003e\n\u003ch3 id=\"production-configuration-etcgitlabgitlabrb\" class=\"mobile-header\"\u003eProduction Configuration (/etc/gitlab/gitlab.rb)\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo tee /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n# GitLab Enterprise Production Configuration\n\nexternal_url \u0026#039;https://gitlab.example.com\u0026#039;\n\n# Performance and Resource Settings\nunicorn[\u0026#039;worker_timeout\u0026#039;] = 60\nunicorn[\u0026#039;worker_processes\u0026#039;] = 8\nsidekiq[\u0026#039;max_concurrency\u0026#039;] = 25\nsidekiq[\u0026#039;min_concurrency\u0026#039;] = 10\n\n# PostgreSQL configuration\npostgresql[\u0026#039;enable\u0026#039;] = true\npostgresql[\u0026#039;max_connections\u0026#039;] = 300\npostgresql[\u0026#039;shared_buffers\u0026#039;] = \u0026quot;2GB\u0026quot;\npostgresql[\u0026#039;effective_cache_size\u0026#039;] = \u0026quot;8GB\u0026quot;\npostgresql[\u0026#039;work_mem\u0026#039;] = \u0026quot;16MB\u0026quot;\npostgresql[\u0026#039;maintenance_work_mem\u0026#039;] = \u0026quot;256MB\u0026quot;\npostgresql[\u0026#039;checkpoint_completion_target\u0026#039;] = 0.9\npostgresql[\u0026#039;wal_buffers\u0026#039;] = \u0026quot;16MB\u0026quot;\npostgresql[\u0026#039;default_statistics_target\u0026#039;] = 100\npostgresql[\u0026#039;random_page_cost\u0026#039;] = 1.1\npostgresql[\u0026#039;effective_io_concurrency\u0026#039;] = 200\n\n# Redis configuration\nredis[\u0026#039;enable\u0026#039;] = true\nredis[\u0026#039;maxmemory\u0026#039;] = \u0026quot;1gb\u0026quot;\nredis[\u0026#039;maxmemory_policy\u0026#039;] = \u0026quot;allkeys-lru\u0026quot;\nredis[\u0026#039;save\u0026#039;] = \u0026#039;900 1 300 10 60 10000\u0026#039;\nredis[\u0026#039;password\u0026#039;] = \u0026#039;redis_secure_password\u0026#039;\n\n# Gitaly configuration (Git RPC service)\ngitaly[\u0026#039;enable\u0026#039;] = true\ngitaly[\u0026#039;auth_token\u0026#039;] = \u0026#039;secure_gitaly_token\u0026#039;\ngitaly[\u0026#039;ruby_max_rss\u0026#039;] = 300000000  # 300MB\ngitaly[\u0026#039;concurrency\u0026#039;] = [\n  {\n    \u0026#039;rpc\u0026#039; =\u0026gt; \u0026quot;/gitaly.SmartHTTPService/PostReceivePack\u0026quot;,\n    \u0026#039;max_per_repo\u0026#039; =\u0026gt; 3\n  },\n  {\n    \u0026#039;rpc\u0026#039; =\u0026gt; \u0026quot;/gitaly.SSHService/SSHUploadPack\u0026quot;, \n    \u0026#039;max_per_repo\u0026#039; =\u0026gt; 3\n  }\n]\n\n# NGINX configuration\nnginx[\u0026#039;enable\u0026#039;] = true\nnginx[\u0026#039;listen_port\u0026#039;] = 80\nnginx[\u0026#039;listen_https\u0026#039;] = false\nnginx[\u0026#039;redirect_http_to_https\u0026#039;] = false\nnginx[\u0026#039;ssl_certificate\u0026#039;] = \u0026quot;/etc/gitlab/ssl/gitlab.crt\u0026quot;\nnginx[\u0026#039;ssl_certificate_key\u0026#039;] = \u0026quot;/etc/gitlab/ssl/gitlab.key\u0026quot;\nnginx[\u0026#039;ssl_protocols\u0026#039;] = \u0026quot;TLSv1.2 TLSv1.3\u0026quot;\nnginx[\u0026#039;ssl_prefer_server_ciphers\u0026#039;] = \u0026quot;off\u0026quot;\nnginx[\u0026#039;ssl_ciphers\u0026#039;] = \u0026quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\u0026quot;\n\n# Container Registry\nregistry_external_url \u0026#039;https://registry.example.com\u0026#039;\ngitlab_rails[\u0026#039;registry_enabled\u0026#039;] = true\nregistry[\u0026#039;enable\u0026#039;] = true\nregistry[\u0026#039;username\u0026#039;] = \u0026quot;registry\u0026quot;\nregistry[\u0026#039;uid\u0026#039;] = 996\nregistry[\u0026#039;gid\u0026#039;] = 996\nregistry[\u0026#039;dir\u0026#039;] = \u0026quot;/var/opt/gitlab/registry\u0026quot;\nregistry[\u0026#039;log_directory\u0026#039;] = \u0026quot;/var/log/gitlab/registry\u0026quot;\nregistry[\u0026#039;log_level\u0026#039;] = \u0026quot;info\u0026quot;\nregistry[\u0026#039;rootcertbundle\u0026#039;] = \u0026quot;/opt/gitlab/embedded/ssl/certs/cacert.pem\u0026quot;\n\n# GitLab Pages\npages_external_url \u0026quot;https://pages.example.com\u0026quot;\ngitlab_pages[\u0026#039;enable\u0026#039;] = true\ngitlab_pages[\u0026#039;dir\u0026#039;] = \u0026quot;/var/opt/gitlab/gitlab-pages\u0026quot;\ngitlab_pages[\u0026#039;log_directory\u0026#039;] = \u0026quot;/var/log/gitlab/gitlab-pages\u0026quot;\ngitlab_pages[\u0026#039;access_control\u0026#039;] = true\ngitlab_pages[\u0026#039;use_legacy_storage\u0026#039;] = false\n\n# Email configuration\ngitlab_rails[\u0026#039;smtp_enable\u0026#039;] = true\ngitlab_rails[\u0026#039;smtp_address\u0026#039;] = \u0026quot;smtp.example.com\u0026quot;\ngitlab_rails[\u0026#039;smtp_port\u0026#039;] = 587\ngitlab_rails[\u0026#039;smtp_user_name\u0026#039;] = \u0026quot;gitlab@example.com\u0026quot;\ngitlab_rails[\u0026#039;smtp_password\u0026#039;] = \u0026quot;smtp_secure_password\u0026quot;\ngitlab_rails[\u0026#039;smtp_domain\u0026#039;] = \u0026quot;example.com\u0026quot;\ngitlab_rails[\u0026#039;smtp_authentication\u0026#039;] = \u0026quot;login\u0026quot;\ngitlab_rails[\u0026#039;smtp_enable_starttls_auto\u0026#039;] = true\ngitlab_rails[\u0026#039;smtp_tls\u0026#039;] = false\ngitlab_rails[\u0026#039;smtp_openssl_verify_mode\u0026#039;] = \u0026#039;peer\u0026#039;\n\ngitlab_rails[\u0026#039;gitlab_email_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;gitlab_email_from\u0026#039;] = \u0026#039;gitlab@example.com\u0026#039;\ngitlab_rails[\u0026#039;gitlab_email_display_name\u0026#039;] = \u0026#039;GitLab\u0026#039;\ngitlab_rails[\u0026#039;gitlab_email_reply_to\u0026#039;] = \u0026#039;noreply@example.com\u0026#039;\n\n# Security settings\ngitlab_rails[\u0026#039;rack_attack_git_basic_auth\u0026#039;] = {\n  \u0026#039;enabled\u0026#039; =\u0026gt; true,\n  \u0026#039;ip_whitelist\u0026#039; =\u0026gt; %w{127.0.0.1 192.168.1.0/24 10.0.0.0/8},\n  \u0026#039;maxretry\u0026#039; =\u0026gt; 10,\n  \u0026#039;findtime\u0026#039; =\u0026gt; 60,\n  \u0026#039;bantime\u0026#039; =\u0026gt; 3600\n}\n\n# Two-factor authentication\ngitlab_rails[\u0026#039;require_two_factor_authentication\u0026#039;] = false\ngitlab_rails[\u0026#039;two_factor_grace_period\u0026#039;] = 8  # 8 hours instead of default 48\n\n# Session settings\ngitlab_rails[\u0026#039;session_expire_delay\u0026#039;] = 10080  # 1 week\ngitlab_rails[\u0026#039;session_store_enabled\u0026#039;] = true\n\n# Backup configuration\ngitlab_rails[\u0026#039;backup_keep_time\u0026#039;] = 604800  # 7 days\ngitlab_rails[\u0026#039;backup_upload_connection\u0026#039;] = {\n  \u0026#039;provider\u0026#039; =\u0026gt; \u0026#039;AWS\u0026#039;,\n  \u0026#039;region\u0026#039; =\u0026gt; \u0026#039;us-west-2\u0026#039;,\n  \u0026#039;aws_access_key_id\u0026#039; =\u0026gt; \u0026#039;backup_access_key\u0026#039;,\n  \u0026#039;aws_secret_access_key\u0026#039; =\u0026gt; \u0026#039;backup_secret_key\u0026#039;\n}\ngitlab_rails[\u0026#039;backup_upload_remote_directory\u0026#039;] = \u0026#039;gitlab-backups\u0026#039;\ngitlab_rails[\u0026#039;backup_multipart_chunk_size\u0026#039;] = 104857600  # 100MB\n\n# Monitoring\nprometheus_monitoring[\u0026#039;enable\u0026#039;] = true\nprometheus[\u0026#039;enable\u0026#039;] = true\nprometheus[\u0026#039;listen_address\u0026#039;] = \u0026#039;localhost:9090\u0026#039;\nprometheus[\u0026#039;scrape_configs\u0026#039;] = [\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-workhorse\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:9229\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-unicorn\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:8080\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-sidekiq\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:8082\u0026#039;] }\n    ]\n  }\n]\n\ngrafana[\u0026#039;enable\u0026#039;] = true\ngrafana[\u0026#039;admin_password\u0026#039;] = \u0026#039;secure_grafana_password\u0026#039;\ngrafana[\u0026#039;disable_login_form\u0026#039;] = false\n\n# Logging\nlogging[\u0026#039;svlogd_size\u0026#039;] = 200 * 1024 * 1024  # 200MB\nlogging[\u0026#039;svlogd_num\u0026#039;] = 30\nlogging[\u0026#039;svlogd_timeout\u0026#039;] = 24 * 60 * 60    # rotate after 24 hours\nlogging[\u0026#039;logrotate_frequency\u0026#039;] = \u0026quot;daily\u0026quot;\nlogging[\u0026#039;logrotate_rotate\u0026#039;] = 30\nlogging[\u0026#039;logrotate_compress\u0026#039;] = \u0026quot;compress\u0026quot;\n\n# Git settings\ngitlab_rails[\u0026#039;gitlab_default_branch\u0026#039;] = \u0026#039;main\u0026#039;\ngitlab_rails[\u0026#039;max_request_duration_seconds\u0026#039;] = 60\n\n# Rate limiting\ngitlab_rails[\u0026#039;rate_limit_requests_per_period\u0026#039;] = 300\ngitlab_rails[\u0026#039;rate_limit_period\u0026#039;] = 60\n\n# Enterprise features (if using GitLab EE)\n# gitlab_rails[\u0026#039;ee_license\u0026#039;] = File.read(\u0026#039;/etc/gitlab/GitLab.gitlab-license\u0026#039;)\n\n# Security scanning\ngitlab_rails[\u0026#039;dependency_scanning_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;container_scanning_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;sast_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;secret_detection_enabled\u0026#039;] = true\n\n# LDAP configuration (Enterprise)\ngitlab_rails[\u0026#039;ldap_enabled\u0026#039;] = false\ngitlab_rails[\u0026#039;prevent_ldap_sign_in\u0026#039;] = false\ngitlab_rails[\u0026#039;ldap_servers\u0026#039;] = {\n  \u0026#039;main\u0026#039; =\u0026gt; {\n    \u0026#039;label\u0026#039; =\u0026gt; \u0026#039;LDAP\u0026#039;,\n    \u0026#039;host\u0026#039; =\u0026gt; \u0026#039;ldap.example.com\u0026#039;,\n    \u0026#039;port\u0026#039; =\u0026gt; 636,\n    \u0026#039;uid\u0026#039; =\u0026gt; \u0026#039;sAMAccountName\u0026#039;,\n    \u0026#039;bind_dn\u0026#039; =\u0026gt; \u0026#039;CN=gitlab,OU=Service Accounts,DC=example,DC=com\u0026#039;,\n    \u0026#039;password\u0026#039; =\u0026gt; \u0026#039;ldap_service_password\u0026#039;,\n    \u0026#039;encryption\u0026#039; =\u0026gt; \u0026#039;ssl\u0026#039;,\n    \u0026#039;verify_certificates\u0026#039; =\u0026gt; true,\n    \u0026#039;ca_file\u0026#039; =\u0026gt; \u0026#039;/etc/gitlab/ssl/ldap-ca.crt\u0026#039;,\n    \u0026#039;base\u0026#039; =\u0026gt; \u0026#039;DC=example,DC=com\u0026#039;,\n    \u0026#039;user_filter\u0026#039; =\u0026gt; \u0026#039;\u0026#039;,\n    \u0026#039;attributes\u0026#039; =\u0026gt; {\n      \u0026#039;username\u0026#039; =\u0026gt; [\u0026#039;uid\u0026#039;, \u0026#039;userid\u0026#039;, \u0026#039;sAMAccountName\u0026#039;],\n      \u0026#039;email\u0026#039; =\u0026gt; [\u0026#039;mail\u0026#039;, \u0026#039;email\u0026#039;, \u0026#039;userPrincipalName\u0026#039;],\n      \u0026#039;name\u0026#039; =\u0026gt; \u0026#039;cn\u0026#039;,\n      \u0026#039;first_name\u0026#039; =\u0026gt; \u0026#039;givenName\u0026#039;,\n      \u0026#039;last_name\u0026#039; =\u0026gt; \u0026#039;sn\u0026#039;\n    },\n    \u0026#039;group_base\u0026#039; =\u0026gt; \u0026#039;OU=Groups,DC=example,DC=com\u0026#039;,\n    \u0026#039;admin_group\u0026#039; =\u0026gt; \u0026#039;GitLab Administrators\u0026#039;\n  }\n}\nEOF\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"security-hardening-2024-best-practices\" class=\"mobile-header\"\u003eSecurity Hardening (2024 Best Practices)\u003c/h2\u003e\n\u003ch3 id=\"ssltls-configuration\" class=\"mobile-header\"\u003eSSL/TLS Configuration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Generate SSL certificates\nsudo mkdir -p /etc/gitlab/ssl\n\n# Self-signed certificate for testing\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 \\\n  -keyout /etc/gitlab/ssl/gitlab.key \\\n  -out /etc/gitlab/ssl/gitlab.crt \\\n  -subj \u0026quot;/C=US/ST=State/L=City/O=Organization/CN=gitlab.example.com\u0026quot;\n\n# Production: Let\u0026#039;s Encrypt integration\nsudo tee -a /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n\n# Let\u0026#039;s Encrypt configuration\nletsencrypt[\u0026#039;enable\u0026#039;] = true\nletsencrypt[\u0026#039;contact_emails\u0026#039;] = [\u0026#039;admin@example.com\u0026#039;]\nletsencrypt[\u0026#039;auto_renew\u0026#039;] = true\nletsencrypt[\u0026#039;auto_renew_hour\u0026#039;] = 0\nletsencrypt[\u0026#039;auto_renew_minute\u0026#039;] = 0\nletsencrypt[\u0026#039;auto_renew_day_of_month\u0026#039;] = \u0026quot;*/4\u0026quot;\n\n# Force HTTPS\nnginx[\u0026#039;redirect_http_to_https\u0026#039;] = true\nnginx[\u0026#039;ssl_protocols\u0026#039;] = \u0026quot;TLSv1.2 TLSv1.3\u0026quot;\nnginx[\u0026#039;ssl_prefer_server_ciphers\u0026#039;] = \u0026quot;off\u0026quot;\nnginx[\u0026#039;ssl_ciphers\u0026#039;] = \u0026quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\u0026quot;\n\n# HSTS\nnginx[\u0026#039;hsts_max_age\u0026#039;] = 31536000\nnginx[\u0026#039;hsts_include_subdomains\u0026#039;] = true\nEOF\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"advanced-security-configuration\" class=\"mobile-header\"\u003eAdvanced Security Configuration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure security settings\nsudo tee -a /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n\n# Security hardening\ngitlab_rails[\u0026#039;webhook_timeout\u0026#039;] = 10\ngitlab_rails[\u0026#039;webhook_max_redirects\u0026#039;] = 3\n\n# Disable password authentication (use SSO/LDAP)\ngitlab_rails[\u0026#039;omniauth_allow_single_sign_on\u0026#039;] = [\u0026#039;saml\u0026#039;, \u0026#039;ldapmain\u0026#039;]\ngitlab_rails[\u0026#039;omniauth_block_auto_created_users\u0026#039;] = false\ngitlab_rails[\u0026#039;omniauth_auto_sign_in_with_provider\u0026#039;] = \u0026#039;saml\u0026#039;\n\n# API rate limiting\ngitlab_rails[\u0026#039;rate_limit_requests_per_period\u0026#039;] = 1000\ngitlab_rails[\u0026#039;rate_limit_period\u0026#039;] = 60\n\n# Git over HTTP rate limiting\ngitlab_rails[\u0026#039;rack_attack_git_basic_auth\u0026#039;] = {\n  \u0026#039;enabled\u0026#039; =\u0026gt; true,\n  \u0026#039;ip_whitelist\u0026#039; =\u0026gt; %w{127.0.0.1 192.168.1.0/24},\n  \u0026#039;maxretry\u0026#039; =\u0026gt; 20,\n  \u0026#039;findtime\u0026#039; =\u0026gt; 60,\n  \u0026#039;bantime\u0026#039; =\u0026gt; 3600\n}\n\n# Protected paths\ngitlab_rails[\u0026#039;rack_attack_protected_paths\u0026#039;] = [\n  \u0026#039;/users/password\u0026#039;,\n  \u0026#039;/users/sign_in\u0026#039;,\n  \u0026#039;/api/v4/session.json\u0026#039;,\n  \u0026#039;/api/v4/session\u0026#039;,\n  \u0026#039;/users/confirmation\u0026#039;,\n  \u0026#039;/unsubscribes/\u0026#039;,\n  \u0026#039;/import/github/personal_access_token\u0026#039;,\n  \u0026#039;/admin/session\u0026#039;\n]\n\n# SSH security\ngitlab_rails[\u0026#039;gitlab_shell_ssh_port\u0026#039;] = 2222\ngitlab_shell[\u0026#039;auth_file\u0026#039;] = \u0026quot;/var/opt/gitlab/.ssh/authorized_keys\u0026quot;\n\n# Container Registry security\nregistry[\u0026#039;notifications\u0026#039;] = [\n  {\n    \u0026#039;name\u0026#039; =\u0026gt; \u0026#039;security_scan\u0026#039;,\n    \u0026#039;url\u0026#039; =\u0026gt; \u0026#039;https://security-scanner.example.com/webhook\u0026#039;,\n    \u0026#039;timeout\u0026#039; =\u0026gt; \u0026#039;2000ms\u0026#039;,\n    \u0026#039;threshold\u0026#039; =\u0026gt; 3,\n    \u0026#039;backoff\u0026#039; =\u0026gt; \u0026#039;1000ms\u0026#039;\n  }\n]\n\n# Secrets management\ngitlab_rails[\u0026#039;db_password\u0026#039;] = File.read(\u0026#039;/etc/gitlab/secrets/db_password\u0026#039;).strip\ngitlab_rails[\u0026#039;secret_key_base\u0026#039;] = File.read(\u0026#039;/etc/gitlab/secrets/secret_key_base\u0026#039;).strip\ngitlab_rails[\u0026#039;otp_key_base\u0026#039;] = File.read(\u0026#039;/etc/gitlab/secrets/otp_key_base\u0026#039;).strip\ngitlab_rails[\u0026#039;encrypted_settings_key_base\u0026#039;] = File.read(\u0026#039;/etc/gitlab/secrets/encrypted_settings_key_base\u0026#039;).strip\n\n# Audit logging\ngitlab_rails[\u0026#039;audit_events_enabled\u0026#039;] = true\n\n# Disable features that increase attack surface\ngitlab_rails[\u0026#039;usage_ping_enabled\u0026#039;] = false\ngitlab_rails[\u0026#039;sentry_enabled\u0026#039;] = false\nEOF\n\n# Create secrets directory and files\nsudo mkdir -p /etc/gitlab/secrets\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/db_password\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/secret_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/otp_key_base\nsudo openssl rand -base64 64 | sudo tee /etc/gitlab/secrets/encrypted_settings_key_base\n\n# Secure permissions\nsudo chmod 600 /etc/gitlab/secrets/*\nsudo chown git:git /etc/gitlab/secrets/*\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"gitlab-runner-security-configuration\" class=\"mobile-header\"\u003eGitLab Runner Security Configuration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create secure runner configuration\nsudo mkdir -p /etc/gitlab-runner\n\nsudo tee /etc/gitlab-runner/config.toml \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\nconcurrent = 4\ncheck_interval = 0\nshutdown_timeout = 0\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = \u0026quot;docker-runner-secure\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;runner_registration_token\u0026quot;\n  executor = \u0026quot;docker\u0026quot;\n  \n  # Security settings\n  pre_clone_script = \u0026quot;echo \u0026#039;Starting secure build\u0026#039;\u0026quot;\n  pre_build_script = \u0026quot;echo \u0026#039;Preparing secure environment\u0026#039;\u0026quot;\n  post_build_script = \u0026quot;echo \u0026#039;Cleaning up secure environment\u0026#039;\u0026quot;\n  \n  [runners.docker]\n    tls_verify = false\n    image = \u0026quot;alpine:latest\u0026quot;\n    privileged = false  # Critical: Never use privileged mode\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\u0026quot;/cache\u0026quot;, \u0026quot;/certs/client\u0026quot;]\n    shm_size = 0\n    network_mode = \u0026quot;bridge\u0026quot;\n    \n    # Security restrictions\n    cap_drop = [\u0026quot;ALL\u0026quot;]\n    cap_add = [\u0026quot;CHOWN\u0026quot;, \u0026quot;SETGID\u0026quot;, \u0026quot;SETUID\u0026quot;]\n    security_opt = [\u0026quot;no-new-privileges:true\u0026quot;]\n    \n    # Resource limits\n    memory = \u0026quot;2g\u0026quot;\n    memory_swap = \u0026quot;2g\u0026quot;\n    memory_reservation = \u0026quot;1g\u0026quot;\n    cpus = \u0026quot;1.5\u0026quot;\n    \n    # Network security\n    dns = [\u0026quot;8.8.8.8\u0026quot;, \u0026quot;8.8.4.4\u0026quot;]\n    extra_hosts = [\u0026quot;gitlab.example.com:192.168.1.100\u0026quot;]\n    \n    # Image scanning\n    pull_policy = [\u0026quot;if-not-present\u0026quot;]\n    \n  [runners.docker.tmpfs]\n    \u0026quot;/tmp\u0026quot; = \u0026quot;rw,noexec,nosuid,size=100m\u0026quot;\n    \u0026quot;/var/tmp\u0026quot; = \u0026quot;rw,noexec,nosuid,size=100m\u0026quot;\n\n# Kubernetes executor (more secure)\n[[runners]]\n  name = \u0026quot;k8s-runner-secure\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;k8s_runner_token\u0026quot;\n  executor = \u0026quot;kubernetes\u0026quot;\n  \n  [runners.kubernetes]\n    host = \u0026quot;https://k8s.example.com:6443\u0026quot;\n    namespace = \u0026quot;gitlab-runner\u0026quot;\n    privileged = false  # Never use privileged\n    image = \u0026quot;alpine:latest\u0026quot;\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \u0026quot;2Gi\u0026quot;\n    memory_request = \u0026quot;1Gi\u0026quot;\n    cpu_limit = \u0026quot;1000m\u0026quot;\n    cpu_request = \u0026quot;500m\u0026quot;\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \u0026quot;tmp\u0026quot;\n      mount_path = \u0026quot;/tmp\u0026quot;\n      medium = \u0026quot;Memory\u0026quot;\nEOF\n\n# Register runner with security tags\nsudo gitlab-runner register \\\n  --url \u0026quot;https://gitlab.example.com/\u0026quot; \\\n  --registration-token \u0026quot;RUNNER_TOKEN\u0026quot; \\\n  --description \u0026quot;secure-docker-runner\u0026quot; \\\n  --tag-list \u0026quot;docker,secure,production\u0026quot; \\\n  --run-untagged=\u0026quot;false\u0026quot; \\\n  --locked=\u0026quot;true\u0026quot; \\\n  --access-level=\u0026quot;ref_protected\u0026quot; \\\n  --executor \u0026quot;docker\u0026quot; \\\n  --docker-image alpine:latest \\\n  --docker-privileged=\u0026quot;false\u0026quot; \\\n  --docker-volumes \u0026quot;/certs/client\u0026quot;\n\nsudo systemctl enable --now gitlab-runner\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"cicd-pipeline-security\" class=\"mobile-header\"\u003eCI/CD Pipeline Security\u003c/h2\u003e\n\u003ch3 id=\"secure-pipeline-configuration\" class=\"mobile-header\"\u003eSecure Pipeline Configuration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create .gitlab-ci.yml with security best practices\ncat \u0026gt; .gitlab-ci.yml \u0026lt;\u0026lt;EOF\n# GitLab CI/CD Security Best Practices - 2024\n\nstages:\n  - security-scan\n  - test\n  - build\n  - security-test\n  - deploy\n\nvariables:\n  # Security variables\n  DOCKER_DRIVER: overlay2\n  DOCKER_TLS_CERTDIR: \u0026quot;/certs\u0026quot;\n  SECURE_LOG_LEVEL: info\n  \n  # Use protected variables for sensitive data\n  # DEPLOY_TOKEN: (set in GitLab UI as protected variable)\n  # AWS_ACCESS_KEY: (set in GitLab UI as protected variable)\n\n# Security scanning stage\nsecret-detection:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/secrets:latest\n  script:\n    - echo \u0026quot;Scanning for secrets in code...\u0026quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      secret_detection: gl-secret-detection-report.json\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH\u0026#039;\n  tags:\n    - secure\n\ndependency-scanning:\n  stage: security-scan  \n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/gemnasium:latest\n  script:\n    - echo \u0026quot;Scanning dependencies for vulnerabilities...\u0026quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      dependency_scanning: gl-dependency-scanning-report.json\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH\u0026#039;\n  tags:\n    - secure\n\nsast:\n  stage: security-scan\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/sobelow:latest\n  script:\n    - echo \u0026quot;Static application security testing...\u0026quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH\u0026#039;\n  tags:\n    - secure\n\n# Container scanning\ncontainer-scanning:\n  stage: security-test\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/klar:latest\n  script:\n    - echo \u0026quot;Scanning container image for vulnerabilities...\u0026quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n  dependencies:\n    - build\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH\u0026#039;\n  tags:\n    - secure\n\n# Secure build stage\nbuild:\n  stage: build\n  image: docker:latest\n  services:\n    - docker:dind\n  before_script:\n    # Verify image signatures\n    - echo \u0026quot;Verifying base image integrity...\u0026quot;\n    - docker trust inspect alpine:latest\n  script:\n    - echo \u0026quot;Building application with security scanning...\u0026quot;\n    - docker build -t \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA .\n    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock aquasec/trivy image \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n    - docker login -u \\$CI_REGISTRY_USER -p \\$CI_REGISTRY_PASSWORD \\$CI_REGISTRY\n    - docker push \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH == \u0026quot;main\u0026quot;\u0026#039;\n  tags:\n    - secure\n\n# Secure deployment\ndeploy-production:\n  stage: deploy\n  image: alpine:latest\n  before_script:\n    # Install kubectl and verify cluster connectivity\n    - apk add --no-cache curl\n    - curl -LO \u0026quot;https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl\u0026quot;\n    - chmod +x kubectl \u0026amp;\u0026amp; mv kubectl /usr/local/bin/\n    - kubectl config use-context production-cluster\n    - kubectl auth can-i create deployments --namespace=production\n  script:\n    - echo \u0026quot;Deploying to production with security validations...\u0026quot;\n    - kubectl apply -f k8s/production/ --namespace=production\n    - kubectl rollout status deployment/app --namespace=production --timeout=300s\n  environment:\n    name: production\n    url: https://app.example.com\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH == \u0026quot;main\u0026quot;\u0026#039;\n      when: manual\n  only:\n    variables:\n      - \\$CI_COMMIT_REF_PROTECTED == \u0026quot;true\u0026quot;\n  tags:\n    - secure\n    - production\n\n# Security compliance check\ncompliance-check:\n  stage: security-test\n  image: alpine:latest\n  script:\n    - echo \u0026quot;Running compliance checks...\u0026quot;\n    - apk add --no-cache curl jq\n    - |\n      # Check for required security labels in Docker images\n      if ! docker inspect \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA | jq -r \u0026#039;.[].Config.Labels[\u0026quot;security.scan\u0026quot;]\u0026#039; | grep -q \u0026quot;passed\u0026quot;; then\n        echo \u0026quot;ERROR: Image failed security scan\u0026quot;\n        exit 1\n      fi\n    - echo \u0026quot;Compliance check passed\u0026quot;\n  dependencies:\n    - container-scanning\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH == \u0026quot;main\u0026quot;\u0026#039;\n  tags:\n    - secure\n\n# Infrastructure as Code scanning\niac-scanning:\n  stage: security-scan\n  image: bridgecrew/checkov:latest\n  script:\n    - checkov --framework terraform --framework kubernetes --framework dockerfile\n  artifacts:\n    reports:\n      junit: checkov-report.xml\n  rules:\n    - if: \u0026#039;\\$CI_COMMIT_BRANCH\u0026#039;\n      changes:\n        - \u0026quot;**/*.tf\u0026quot;\n        - \u0026quot;**/*.yml\u0026quot;\n        - \u0026quot;**/*.yaml\u0026quot;\n        - \u0026quot;**/Dockerfile*\u0026quot;\n  tags:\n    - secure\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"rbac-and-access-control\" class=\"mobile-header\"\u003eRBAC and Access Control\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure GitLab RBAC via API\nGITLAB_URL=\u0026quot;https://gitlab.example.com\u0026quot;\nADMIN_TOKEN=\u0026quot;your_admin_token\u0026quot;\n\n# Create groups with specific permissions\ncurl --request POST --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --data \u0026quot;name=developers\u0026amp;path=developers\u0026amp;description=Development team\u0026amp;visibility=private\u0026quot; \\\n  \u0026quot;${GITLAB_URL}/api/v4/groups\u0026quot;\n\ncurl --request POST --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --data \u0026quot;name=security-team\u0026amp;path=security-team\u0026amp;description=Security team\u0026amp;visibility=private\u0026quot; \\\n  \u0026quot;${GITLAB_URL}/api/v4/groups\u0026quot;\n\n# Create projects with security templates\ncurl --request POST --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --data \u0026quot;name=secure-app\u0026amp;description=Secure application\u0026amp;visibility=private\u0026amp;issues_enabled=true\u0026amp;merge_requests_enabled=true\u0026amp;wiki_enabled=false\u0026amp;builds_enabled=true\u0026amp;snippets_enabled=false\u0026amp;container_registry_enabled=true\u0026amp;shared_runners_enabled=false\u0026quot; \\\n  \u0026quot;${GITLAB_URL}/api/v4/projects\u0026quot;\n\n# Configure branch protection\nPROJECT_ID=\u0026quot;1\u0026quot;  # Replace with actual project ID\ncurl --request POST --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --data \u0026quot;name=main\u0026amp;code_owner_approval_required=true\u0026amp;push_access_level=40\u0026amp;merge_access_level=40\u0026amp;unprotect_access_level=40\u0026quot; \\\n  \u0026quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/protected_branches\u0026quot;\n\n# Configure push rules (Premium/Ultimate)\ncurl --request POST --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --data \u0026quot;deny_delete_tag=true\u0026amp;member_check=true\u0026amp;prevent_secrets=true\u0026amp;author_email_regex=.*@example.com\u0026amp;file_extension_restriction=jar,exe\u0026amp;max_file_size=100\u0026quot; \\\n  \u0026quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/push_rule\u0026quot;\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"vulnerability-scanning-integration\" class=\"mobile-header\"\u003eVulnerability Scanning Integration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure dependency proxy for secure image caching\nsudo tee -a /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n\n# Dependency Proxy for secure image caching\ngitlab_rails[\u0026#039;dependency_proxy_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;dependency_proxy_storage_path\u0026#039;] = \u0026quot;/var/opt/gitlab/gitlab-rails/shared/dependency_proxy\u0026quot;\n\n# Security scanning\ngitlab_rails[\u0026#039;sast_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;dependency_scanning_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;container_scanning_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;secret_detection_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;license_scanning_enabled\u0026#039;] = true\n\n# Secure package registry\ngitlab_rails[\u0026#039;packages_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;packages_storage_path\u0026#039;] = \u0026quot;/var/opt/gitlab/gitlab-rails/shared/packages\u0026quot;\nEOF\n\n# Create custom security scanning templates\nmkdir -p .gitlab/ci-templates\n\ncat \u0026gt; .gitlab/ci-templates/Security-Scanning.gitlab-ci.yml \u0026lt;\u0026lt;EOF\n# Custom Security Scanning Template\n\n.security-scan-template:\n  stage: security-scan\n  variables:\n    SECURE_LOG_LEVEL: info\n  before_script:\n    - echo \u0026quot;Preparing security scan environment...\u0026quot;\n    - apk add --no-cache curl jq\n  tags:\n    - secure\n\ncustom-sast:\n  extends: .security-scan-template\n  image: registry.gitlab.com/gitlab-org/security-products/analyzers/semgrep:latest\n  script:\n    - echo \u0026quot;Running custom SAST analysis...\u0026quot;\n    - /analyzer run\n  artifacts:\n    reports:\n      sast: gl-sast-report.json\n    expire_in: 1 week\n\ncustom-secrets-scan:\n  extends: .security-scan-template\n  image: trufflesecurity/trufflehog:latest\n  script:\n    - echo \u0026quot;Scanning for secrets with TruffleHog...\u0026quot;\n    - trufflehog git file://. --json \u0026gt; trufflehog-report.json\n    - |\n      if [ -s trufflehog-report.json ]; then\n        echo \u0026quot;Secrets detected!\u0026quot;\n        cat trufflehog-report.json\n        exit 1\n      fi\n  artifacts:\n    reports:\n      secret_detection: trufflehog-report.json\n    expire_in: 1 week\n\nimage-vulnerability-scan:\n  extends: .security-scan-template\n  image: aquasec/trivy:latest\n  script:\n    - echo \u0026quot;Scanning Docker images for vulnerabilities...\u0026quot;\n    - trivy image --format template --template \u0026quot;@contrib/gitlab.tpl\u0026quot; \\$CI_REGISTRY_IMAGE:\\$CI_COMMIT_SHA\n  artifacts:\n    reports:\n      container_scanning: gl-container-scanning-report.json\n    expire_in: 1 week\nEOF\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"backup-and-disaster-recovery\" class=\"mobile-header\"\u003eBackup and Disaster Recovery\u003c/h2\u003e\n\u003ch3 id=\"enterprise-backup-strategy\" class=\"mobile-header\"\u003eEnterprise Backup Strategy\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo tee /usr/local/bin/gitlab-backup.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\nBACKUP_DIR=\u0026quot;/backup/gitlab\u0026quot;\nDATE=$(date +%Y%m%d_%H%M%S)\n\nmkdir -p ${BACKUP_DIR}/{omnibus,secrets,ssl,logs}\n\n# Create GitLab backup\ngitlab-backup create STRATEGY=copy SKIP=uploads,builds,artifacts,lfs,registry,pages\n\n# Backup configuration files\ntar -czf ${BACKUP_DIR}/omnibus/gitlab-config-${DATE}.tar.gz \\\n    /etc/gitlab/gitlab.rb \\\n    /etc/gitlab/gitlab-secrets.json\n\n# Backup SSL certificates\ntar -czf ${BACKUP_DIR}/ssl/gitlab-ssl-${DATE}.tar.gz \\\n    /etc/gitlab/ssl/ \\\n    /etc/letsencrypt/\n\n# Backup secrets\ntar -czf ${BACKUP_DIR}/secrets/gitlab-secrets-${DATE}.tar.gz \\\n    /etc/gitlab/secrets/\n\n# Upload to multiple cloud storage backends\naws s3 cp ${BACKUP_DIR}/ s3://gitlab-backups/ --recursive\naz storage blob upload-batch --source ${BACKUP_DIR} --destination gitlab-backups\ngsutil cp -r ${BACKUP_DIR}/* gs://gitlab-backups/\n\n# Geo-replication backup (Enterprise)\nif command -v gitlab-rake \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then\n    gitlab-rake gitlab:geo:check\n    gitlab-rake geo:status\nfi\n\n# Test backup integrity\nLATEST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar | head -1)\nif [ -n \u0026quot;$LATEST_BACKUP\u0026quot; ]; then\n    echo \u0026quot;Latest backup: $LATEST_BACKUP\u0026quot;\n    tar -tf \u0026quot;$LATEST_BACKUP\u0026quot; \u0026gt; /tmp/backup-contents.txt\n    if [ $? -eq 0 ]; then\n        echo \u0026quot;✓ Backup integrity verified\u0026quot;\n    else\n        echo \u0026quot;✗ Backup integrity check failed\u0026quot;\n    fi\nfi\n\n# Keep only last 7 backups locally\nfind /var/opt/gitlab/backups/ -name \u0026quot;*_gitlab_backup.tar\u0026quot; -mtime +7 -delete\nfind ${BACKUP_DIR} -name \u0026quot;gitlab-*\u0026quot; -type f -mtime +7 -delete\n\necho \u0026quot;GitLab backup completed: ${DATE}\u0026quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-backup.sh\n\n# Schedule daily backups\necho \u0026quot;0 2 * * * root /usr/local/bin/gitlab-backup.sh\u0026quot; | sudo tee -a /etc/crontab\n\n# Create disaster recovery script\nsudo tee /usr/local/bin/gitlab-restore.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\nBACKUP_FILE=\u0026quot;${1}\u0026quot;\n\nif [ -z \u0026quot;$BACKUP_FILE\u0026quot; ]; then\n    echo \u0026quot;Usage: $0 \u0026lt;backup_file\u0026gt;\u0026quot;\n    echo \u0026quot;Available backups:\u0026quot;\n    ls -la /var/opt/gitlab/backups/*_gitlab_backup.tar\n    exit 1\nfi\n\n# Stop GitLab services\ngitlab-ctl stop unicorn\ngitlab-ctl stop puma\ngitlab-ctl stop sidekiq\n\n# Restore from backup\ngitlab-backup restore BACKUP=$(basename $BACKUP_FILE _gitlab_backup.tar) force=yes\n\n# Restore configuration\nif [ -f \u0026quot;/backup/gitlab/omnibus/gitlab-config-latest.tar.gz\u0026quot; ]; then\n    cd /\n    tar -xzf /backup/gitlab/omnibus/gitlab-config-latest.tar.gz\nfi\n\n# Reconfigure and restart\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n# Verify installation\ngitlab-rake gitlab:check SANITIZE=true\n\necho \u0026quot;GitLab restore completed\u0026quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-restore.sh\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"high-availability-setup\" class=\"mobile-header\"\u003eHigh Availability Setup\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure GitLab for HA with external services\nsudo tee /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n# GitLab High Availability Configuration\n\nexternal_url \u0026#039;https://gitlab.example.com\u0026#039;\n\n# Disable built-in services (use external)\npostgresql[\u0026#039;enable\u0026#039;] = false\nredis[\u0026#039;enable\u0026#039;] = false\nnginx[\u0026#039;enable\u0026#039;] = true\nunicorn[\u0026#039;enable\u0026#039;] = true\nsidekiq[\u0026#039;enable\u0026#039;] = true\ngitlab_workhorse[\u0026#039;enable\u0026#039;] = true\ngitaly[\u0026#039;enable\u0026#039;] = true\n\n# External PostgreSQL\ngitlab_rails[\u0026#039;db_adapter\u0026#039;] = \u0026#039;postgresql\u0026#039;\ngitlab_rails[\u0026#039;db_encoding\u0026#039;] = \u0026#039;unicode\u0026#039;\ngitlab_rails[\u0026#039;db_host\u0026#039;] = \u0026#039;postgres-master.example.com\u0026#039;\ngitlab_rails[\u0026#039;db_port\u0026#039;] = 5432\ngitlab_rails[\u0026#039;db_database\u0026#039;] = \u0026#039;gitlabhq_production\u0026#039;\ngitlab_rails[\u0026#039;db_username\u0026#039;] = \u0026#039;gitlab\u0026#039;\ngitlab_rails[\u0026#039;db_password\u0026#039;] = \u0026#039;secure_db_password\u0026#039;\ngitlab_rails[\u0026#039;db_load_balancing\u0026#039;] = {\n  \u0026#039;hosts\u0026#039; =\u0026gt; [\u0026#039;postgres-slave1.example.com\u0026#039;, \u0026#039;postgres-slave2.example.com\u0026#039;]\n}\n\n# External Redis\ngitlab_rails[\u0026#039;redis_host\u0026#039;] = \u0026#039;redis-master.example.com\u0026#039;\ngitlab_rails[\u0026#039;redis_port\u0026#039;] = 6379\ngitlab_rails[\u0026#039;redis_password\u0026#039;] = \u0026#039;redis_secure_password\u0026#039;\ngitlab_rails[\u0026#039;redis_sentinels\u0026#039;] = [\n  {\u0026#039;host\u0026#039; =\u0026gt; \u0026#039;redis-sentinel1.example.com\u0026#039;, \u0026#039;port\u0026#039; =\u0026gt; 26379},\n  {\u0026#039;host\u0026#039; =\u0026gt; \u0026#039;redis-sentinel2.example.com\u0026#039;, \u0026#039;port\u0026#039; =\u0026gt; 26379},\n  {\u0026#039;host\u0026#039; =\u0026gt; \u0026#039;redis-sentinel3.example.com\u0026#039;, \u0026#039;port\u0026#039; =\u0026gt; 26379}\n]\n\n# Load balancing\nnginx[\u0026#039;listen_addresses\u0026#039;] = [\u0026#039;0.0.0.0\u0026#039;]\nnginx[\u0026#039;real_ip_header\u0026#039;] = \u0026#039;X-Forwarded-For\u0026#039;\nnginx[\u0026#039;real_ip_recursive\u0026#039;] = \u0026#039;on\u0026#039;\nnginx[\u0026#039;real_ip_trusted_addresses\u0026#039;] = [\u0026#039;10.0.0.0/8\u0026#039;, \u0026#039;172.16.0.0/12\u0026#039;, \u0026#039;192.168.0.0/16\u0026#039;]\n\n# Gitaly cluster (Enterprise)\ngit_data_dirs({\n  \u0026#039;default\u0026#039; =\u0026gt; {\n    \u0026#039;gitaly_address\u0026#039; =\u0026gt; \u0026#039;tcp://gitaly1.example.com:8075\u0026#039;,\n    \u0026#039;gitaly_token\u0026#039; =\u0026gt; \u0026#039;gitaly_secure_token\u0026#039;\n  },\n  \u0026#039;storage1\u0026#039; =\u0026gt; {\n    \u0026#039;gitaly_address\u0026#039; =\u0026gt; \u0026#039;tcp://gitaly2.example.com:8075\u0026#039;,\n    \u0026#039;gitaly_token\u0026#039; =\u0026gt; \u0026#039;gitaly_secure_token\u0026#039;\n  }\n})\n\n# Object storage (S3-compatible)\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;proxy_download\u0026#039;] = true\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;connection\u0026#039;] = {\n  \u0026#039;provider\u0026#039; =\u0026gt; \u0026#039;AWS\u0026#039;,\n  \u0026#039;region\u0026#039; =\u0026gt; \u0026#039;us-west-2\u0026#039;,\n  \u0026#039;aws_access_key_id\u0026#039; =\u0026gt; \u0026#039;object_store_access_key\u0026#039;,\n  \u0026#039;aws_secret_access_key\u0026#039; =\u0026gt; \u0026#039;object_store_secret_key\u0026#039;\n}\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;objects\u0026#039;][\u0026#039;artifacts\u0026#039;][\u0026#039;bucket\u0026#039;] = \u0026#039;gitlab-artifacts\u0026#039;\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;objects\u0026#039;][\u0026#039;lfs\u0026#039;][\u0026#039;bucket\u0026#039;] = \u0026#039;gitlab-lfs\u0026#039;\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;objects\u0026#039;][\u0026#039;uploads\u0026#039;][\u0026#039;bucket\u0026#039;] = \u0026#039;gitlab-uploads\u0026#039;\ngitlab_rails[\u0026#039;object_store\u0026#039;][\u0026#039;objects\u0026#039;][\u0026#039;packages\u0026#039;][\u0026#039;bucket\u0026#039;] = \u0026#039;gitlab-packages\u0026#039;\n\n# Geo replication (Enterprise Premium)\ngitlab_rails[\u0026#039;geo_primary_role\u0026#039;] = true  # Set to false for secondary\ngitlab_rails[\u0026#039;geo_node_name\u0026#039;] = \u0026#039;primary-site\u0026#039;\ngitlab_rails[\u0026#039;geo_registry_replication_enabled\u0026#039;] = true\nEOF\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"container-registry-and-package-management\" class=\"mobile-header\"\u003eContainer Registry and Package Management\u003c/h2\u003e\n\u003ch3 id=\"secure-container-registry-setup\" class=\"mobile-header\"\u003eSecure Container Registry Setup\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure container registry with security scanning\nsudo tee -a /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n\n# Container Registry configuration\nregistry_external_url \u0026#039;https://registry.example.com\u0026#039;\ngitlab_rails[\u0026#039;registry_enabled\u0026#039;] = true\nregistry[\u0026#039;enable\u0026#039;] = true\n\n# Registry storage\nregistry[\u0026#039;storage\u0026#039;] = {\n  \u0026#039;s3\u0026#039; =\u0026gt; {\n    \u0026#039;accesskey\u0026#039; =\u0026gt; \u0026#039;registry_s3_access_key\u0026#039;,\n    \u0026#039;secretkey\u0026#039; =\u0026gt; \u0026#039;registry_s3_secret_key\u0026#039;,\n    \u0026#039;bucket\u0026#039; =\u0026gt; \u0026#039;gitlab-registry\u0026#039;,\n    \u0026#039;region\u0026#039; =\u0026gt; \u0026#039;us-west-2\u0026#039;,\n    \u0026#039;encrypt\u0026#039; =\u0026gt; true\n  }\n}\n\n# Registry security\nregistry[\u0026#039;auth_token_realm\u0026#039;] = \u0026quot;https://gitlab.example.com/jwt/auth\u0026quot;\nregistry[\u0026#039;auth_token_service\u0026#039;] = \u0026quot;container_registry\u0026quot;\nregistry[\u0026#039;auth_token_issuer\u0026#039;] = \u0026quot;gitlab-issuer\u0026quot;\nregistry[\u0026#039;auth_token_autoredirect\u0026#039;] = false\n\n# Health checks\nregistry[\u0026#039;health_storagedriver_enabled\u0026#039;] = true\nregistry[\u0026#039;health_storagedriver_interval\u0026#039;] = \u0026#039;10s\u0026#039;\nregistry[\u0026#039;health_storagedriver_threshold\u0026#039;] = 3\n\n# Container scanning\ngitlab_rails[\u0026#039;container_registry_token_expire_delay\u0026#039;] = 300\ngitlab_rails[\u0026#039;container_registry_cleanup_enabled\u0026#039;] = true\n\n# Image retention policies\nregistry[\u0026#039;middleware\u0026#039;] = {\n  \u0026#039;repository\u0026#039; =\u0026gt; [\n    {\n      \u0026#039;name\u0026#039; =\u0026gt; \u0026#039;cloudfront\u0026#039;,\n      \u0026#039;disabled\u0026#039; =\u0026gt; false,\n      \u0026#039;options\u0026#039; =\u0026gt; {\n        \u0026#039;baseurl\u0026#039; =\u0026gt; \u0026#039;https://registry-cdn.example.com\u0026#039;,\n        \u0026#039;privatekey\u0026#039; =\u0026gt; \u0026#039;/etc/gitlab/registry-cdn-private-key.pem\u0026#039;,\n        \u0026#039;keypairid\u0026#039; =\u0026gt; \u0026#039;CLOUDFRONT_KEY_PAIR_ID\u0026#039;,\n        \u0026#039;duration\u0026#039; =\u0026gt; \u0026#039;3600s\u0026#039;\n      }\n    }\n  ]\n}\n\n# Package registry\ngitlab_rails[\u0026#039;packages_enabled\u0026#039;] = true\ngitlab_rails[\u0026#039;packages_storage_path\u0026#039;] = \u0026quot;/var/opt/gitlab/gitlab-rails/shared/packages\u0026quot;\nEOF\n\n# Create container registry cleanup policy\ncat \u0026gt; registry-cleanup-policy.json \u0026lt;\u0026lt;EOF\n{\n  \u0026quot;name_regex\u0026quot;: \u0026quot;.*\u0026quot;,\n  \u0026quot;name_regex_keep\u0026quot;: \u0026quot;v\\\\d+\\\\.\\\\d+\\\\.\\\\d+\u0026quot;,\n  \u0026quot;cadence\u0026quot;: \u0026quot;7d\u0026quot;,\n  \u0026quot;older_than\u0026quot;: \u0026quot;30d\u0026quot;,\n  \u0026quot;keep_n\u0026quot;: 10\n}\nEOF\n\n# Apply cleanup policy via API\ncurl --request PUT --header \u0026quot;PRIVATE-TOKEN: ${ADMIN_TOKEN}\u0026quot; \\\n  --header \u0026quot;Content-Type: application/json\u0026quot; \\\n  --data @registry-cleanup-policy.json \\\n  \u0026quot;${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/registry/repositories/1\u0026quot;\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"monitoring-and-observability\" class=\"mobile-header\"\u003eMonitoring and Observability\u003c/h2\u003e\n\u003ch3 id=\"comprehensive-monitoring-setup\" class=\"mobile-header\"\u003eComprehensive Monitoring Setup\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Enable built-in monitoring stack\nsudo tee -a /etc/gitlab/gitlab.rb \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\n\n# Prometheus monitoring\nprometheus_monitoring[\u0026#039;enable\u0026#039;] = true\nprometheus[\u0026#039;enable\u0026#039;] = true\nprometheus[\u0026#039;monitor_kubernetes\u0026#039;] = true\nprometheus[\u0026#039;scrape_configs\u0026#039;] = [\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-workhorse\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:9229\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-unicorn\u0026#039;,  \n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:8080\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-sidekiq\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:8082\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;gitlab-pages\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:8090\u0026#039;] }\n    ]\n  },\n  {\n    \u0026#039;job_name\u0026#039; =\u0026gt; \u0026#039;docker-registry\u0026#039;,\n    \u0026#039;static_configs\u0026#039; =\u0026gt; [\n      { \u0026#039;targets\u0026#039; =\u0026gt; [\u0026#039;localhost:5001\u0026#039;] }\n    ]\n  }\n]\n\n# Grafana configuration\ngrafana[\u0026#039;enable\u0026#039;] = true\ngrafana[\u0026#039;admin_password\u0026#039;] = \u0026#039;secure_grafana_password\u0026#039;\ngrafana[\u0026#039;disable_login_form\u0026#039;] = false\ngrafana[\u0026#039;allow_user_sign_up\u0026#039;] = false\n\n# Grafana LDAP integration\ngrafana[\u0026#039;ldap_enabled\u0026#039;] = true\ngrafana[\u0026#039;ldap_allow_sign_up\u0026#039;] = false\ngrafana[\u0026#039;ldap_servers\u0026#039;] = [{\n  \u0026#039;host\u0026#039; =\u0026gt; \u0026#039;ldap.example.com\u0026#039;,\n  \u0026#039;port\u0026#039; =\u0026gt; 636,\n  \u0026#039;uid\u0026#039; =\u0026gt; \u0026#039;sAMAccountName\u0026#039;,\n  \u0026#039;bind_dn\u0026#039; =\u0026gt; \u0026#039;CN=grafana,OU=Service Accounts,DC=example,DC=com\u0026#039;,\n  \u0026#039;password\u0026#039; =\u0026gt; \u0026#039;ldap_service_password\u0026#039;,\n  \u0026#039;encryption\u0026#039; =\u0026gt; \u0026#039;ssl\u0026#039;,\n  \u0026#039;base\u0026#039; =\u0026gt; \u0026#039;DC=example,DC=com\u0026#039;,\n  \u0026#039;user_filter\u0026#039; =\u0026gt; \u0026#039;\u0026#039;,\n  \u0026#039;group_base\u0026#039; =\u0026gt; \u0026#039;OU=Groups,DC=example,DC=com\u0026#039;,\n  \u0026#039;admin_group\u0026#039; =\u0026gt; \u0026#039;GitLab Administrators\u0026#039;\n}]\n\n# Node Exporter\nnode_exporter[\u0026#039;enable\u0026#039;] = true\nnode_exporter[\u0026#039;listen_address\u0026#039;] = \u0026#039;localhost:9100\u0026#039;\n\n# Alert Manager\nalertmanager[\u0026#039;enable\u0026#039;] = true\nalertmanager[\u0026#039;admin_email\u0026#039;] = \u0026#039;alerts@example.com\u0026#039;\nalertmanager[\u0026#039;flags\u0026#039;] = {\n  \u0026#039;storage.path\u0026#039; =\u0026gt; \u0026#039;/var/opt/gitlab/alertmanager/data\u0026#039;,\n  \u0026#039;config.file\u0026#039; =\u0026gt; \u0026#039;/var/opt/gitlab/alertmanager/alertmanager.yml\u0026#039;\n}\n\n# Log forwarding\nlogging[\u0026#039;logrotate_frequency\u0026#039;] = \u0026quot;daily\u0026quot;\nlogging[\u0026#039;logrotate_rotate\u0026#039;] = 30\nlogging[\u0026#039;logrotate_compress\u0026#039;] = \u0026quot;compress\u0026quot;\nlogging[\u0026#039;svlogd_size\u0026#039;] = 200 * 1024 * 1024  # 200MB\nlogging[\u0026#039;svlogd_num\u0026#039;] = 30\nEOF\n\n# Create custom alerting rules\nsudo mkdir -p /var/opt/gitlab/alertmanager\n\nsudo tee /var/opt/gitlab/alertmanager/alertmanager.yml \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\nglobal:\n  smtp_smarthost: \u0026#039;smtp.example.com:587\u0026#039;\n  smtp_from: \u0026#039;gitlab-alerts@example.com\u0026#039;\n  smtp_auth_username: \u0026#039;gitlab-alerts@example.com\u0026#039;\n  smtp_auth_password: \u0026#039;smtp_password\u0026#039;\n\nroute:\n  group_by: [\u0026#039;alertname\u0026#039;, \u0026#039;cluster\u0026#039;, \u0026#039;service\u0026#039;]\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\n  receiver: \u0026#039;gitlab-alerts\u0026#039;\n  routes:\n  - match:\n      severity: critical\n    receiver: \u0026#039;critical-alerts\u0026#039;\n    group_wait: 10s\n    repeat_interval: 5m\n\nreceivers:\n- name: \u0026#039;gitlab-alerts\u0026#039;\n  email_configs:\n  - to: \u0026#039;gitlab-admin@example.com\u0026#039;\n    subject: \u0026#039;GitLab Alert: {{ .GroupLabels.alertname }}\u0026#039;\n    body: |\n      {{ range .Alerts }}\n      Alert: {{ .Annotations.summary }}\n      Description: {{ .Annotations.description }}\n      Instance: {{ .Labels.instance }}\n      {{ end }}\n\n- name: \u0026#039;critical-alerts\u0026#039;\n  email_configs:\n  - to: \u0026#039;oncall@example.com\u0026#039;\n    subject: \u0026#039;CRITICAL GitLab Alert: {{ .GroupLabels.alertname }}\u0026#039;\n  slack_configs:\n  - api_url: \u0026#039;https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK\u0026#039;\n    channel: \u0026#039;#critical-alerts\u0026#039;\n    title: \u0026#039;Critical GitLab Alert\u0026#039;\nEOF\n\nsudo gitlab-ctl reconfigure\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"performance-monitoring\" class=\"mobile-header\"\u003ePerformance Monitoring\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create GitLab performance monitoring script\nsudo tee /usr/local/bin/gitlab-performance-monitor.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\nMONITOR_LOG=\u0026quot;/var/log/gitlab-performance.log\u0026quot;\n\nlog_message() {\n    echo \u0026quot;$(date \u0026#039;+%Y-%m-%d %H:%M:%S\u0026#039;) - $1\u0026quot; | tee -a ${MONITOR_LOG}\n}\n\n# Check GitLab service health\nfor service in unicorn sidekiq workhorse gitaly; do\n    if gitlab-ctl status $service | grep -q \u0026quot;run:\u0026quot;; then\n        log_message \u0026quot;✓ $service is running\u0026quot;\n    else\n        log_message \u0026quot;✗ $service is not running\u0026quot;\n    fi\ndone\n\n# Check database performance\nDB_CONNECTIONS=$(gitlab-psql -c \u0026quot;SELECT count(*) FROM pg_stat_activity;\u0026quot; -t)\nlog_message \u0026quot;ℹ Database connections: ${DB_CONNECTIONS}\u0026quot;\n\n# Check Redis performance  \nREDIS_MEMORY=$(redis-cli info memory | grep used_memory_human: | cut -d: -f2)\nlog_message \u0026quot;ℹ Redis memory usage: ${REDIS_MEMORY}\u0026quot;\n\n# Check Git repository storage\nREPO_SIZE=$(du -sh /var/opt/gitlab/git-data/repositories | cut -f1)\nlog_message \u0026quot;ℹ Repository storage usage: ${REPO_SIZE}\u0026quot;\n\n# Check background job queue\nSIDEKIQ_QUEUE=$(gitlab-rails runner \u0026quot;puts Sidekiq::Queue.new.size\u0026quot;)\nlog_message \u0026quot;ℹ Sidekiq queue size: ${SIDEKIQ_QUEUE}\u0026quot;\n\n# Check GitLab metrics\nGITLAB_VERSION=$(gitlab-rake gitlab:env:info | grep \u0026quot;GitLab information\u0026quot; -A 10 | grep \u0026quot;Version:\u0026quot; | awk \u0026#039;{print $2}\u0026#039;)\nlog_message \u0026quot;ℹ GitLab version: ${GITLAB_VERSION}\u0026quot;\n\n# Performance metrics via API\nAPI_RESPONSE_TIME=$(curl -w \u0026quot;%{time_total}\u0026quot; -s -o /dev/null https://gitlab.example.com/api/v4/projects)\nlog_message \u0026quot;ℹ API response time: ${API_RESPONSE_TIME}s\u0026quot;\n\n# Check disk I/O\nDISK_USAGE=$(df /var/opt/gitlab | awk \u0026#039;NR==2 {print $5}\u0026#039; | sed \u0026#039;s/%//\u0026#039;)\nlog_message \u0026quot;ℹ Disk usage: ${DISK_USAGE}%\u0026quot;\n\nif [ ${DISK_USAGE} -gt 85 ]; then\n    log_message \u0026quot;⚠ High disk usage detected\u0026quot;\nfi\n\nlog_message \u0026quot;Performance monitoring completed\u0026quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-performance-monitor.sh\n\n# Schedule performance monitoring\necho \u0026quot;*/15 * * * * root /usr/local/bin/gitlab-performance-monitor.sh\u0026quot; | sudo tee -a /etc/crontab\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"gitlab-runner-advanced-configuration\" class=\"mobile-header\"\u003eGitLab Runner Advanced Configuration\u003c/h2\u003e\n\u003ch3 id=\"secure-multi-platform-runner-setup\" class=\"mobile-header\"\u003eSecure Multi-Platform Runner Setup\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create advanced runner configuration with security\nsudo tee /etc/gitlab-runner/config.toml \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\nconcurrent = 10\ncheck_interval = 0\nlog_level = \u0026quot;info\u0026quot;\nlog_format = \u0026quot;runner\u0026quot;\nshutdown_timeout = 30\n\n[session_server]\n  session_timeout = 1800\n\n# Docker executor with security hardening\n[[runners]]\n  name = \u0026quot;docker-secure-runner\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;secure_runner_token\u0026quot;\n  executor = \u0026quot;docker\u0026quot;\n  output_limit = 4096\n  \n  # Security scripts\n  pre_clone_script = \u0026quot;\u0026quot;\u0026quot;\n    echo \u0026#039;Security scan initiated\u0026#039;\n    id\n    pwd\n    env | grep -E \u0026#039;^(CI_|GITLAB_)\u0026#039; | sort\n  \u0026quot;\u0026quot;\u0026quot;\n  \n  pre_build_script = \u0026quot;\u0026quot;\u0026quot;\n    echo \u0026#039;Preparing secure build environment\u0026#039;\n    # Verify no sensitive data in environment\n    if env | grep -i -E \u0026#039;(password|secret|key|token)\u0026#039; | grep -v -E \u0026#039;^(CI_JOB_TOKEN|GITLAB_CI|CI_SERVER)\u0026#039;; then\n      echo \u0026#039;ERROR: Sensitive data detected in environment\u0026#039;\n      exit 1\n    fi\n  \u0026quot;\u0026quot;\u0026quot;\n  \n  post_build_script = \u0026quot;\u0026quot;\u0026quot;\n    echo \u0026#039;Cleaning up build artifacts\u0026#039;\n    rm -rf /tmp/* 2\u0026gt;/dev/null || true\n  \u0026quot;\u0026quot;\u0026quot;\n  \n  [runners.docker]\n    tls_verify = false\n    image = \u0026quot;alpine:latest\u0026quot;\n    privileged = false\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\u0026quot;/cache\u0026quot;, \u0026quot;/certs/client\u0026quot;]\n    shm_size = 268435456  # 256MB\n    \n    # Security restrictions\n    cap_drop = [\u0026quot;ALL\u0026quot;]\n    cap_add = [\u0026quot;CHOWN\u0026quot;, \u0026quot;SETGID\u0026quot;, \u0026quot;SETUID\u0026quot;]\n    security_opt = [\u0026quot;no-new-privileges:true\u0026quot;, \u0026quot;apparmor:unconfined\u0026quot;]\n    \n    # Resource limits\n    memory = \u0026quot;2g\u0026quot;\n    memory_swap = \u0026quot;2g\u0026quot;\n    memory_reservation = \u0026quot;1g\u0026quot;\n    cpus = \u0026quot;2\u0026quot;\n    \n    # Network security\n    network_mode = \u0026quot;bridge\u0026quot;\n    dns = [\u0026quot;8.8.8.8\u0026quot;, \u0026quot;8.8.4.4\u0026quot;]\n    \n    # Disable dangerous features\n    disable_entrypoint_overwrite = true\n    \n    # Image pull policy\n    pull_policy = [\u0026quot;if-not-present\u0026quot;]\n    \n  [runners.docker.tmpfs]\n    \u0026quot;/tmp\u0026quot; = \u0026quot;rw,noexec,nosuid,size=100m\u0026quot;\n    \u0026quot;/var/tmp\u0026quot; = \u0026quot;rw,noexec,nosuid,size=100m\u0026quot;\n\n# Kubernetes executor (Enterprise recommended)\n[[runners]]\n  name = \u0026quot;k8s-secure-runner\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;k8s_runner_token\u0026quot;\n  executor = \u0026quot;kubernetes\u0026quot;\n  \n  [runners.kubernetes]\n    host = \u0026quot;https://k8s.example.com:6443\u0026quot;\n    namespace = \u0026quot;gitlab-runner\u0026quot;\n    privileged = false\n    image = \u0026quot;alpine:latest\u0026quot;\n    \n    # Security context\n    run_as_user = 1000\n    run_as_group = 1000\n    fs_group = 1000\n    \n    # Resource limits\n    memory_limit = \u0026quot;4Gi\u0026quot;\n    memory_request = \u0026quot;2Gi\u0026quot;\n    cpu_limit = \u0026quot;2000m\u0026quot;\n    cpu_request = \u0026quot;1000m\u0026quot;\n    \n    # Security policies\n    [runners.kubernetes.pod_security_context]\n      run_as_non_root = true\n      run_as_user = 1000\n      run_as_group = 1000\n      fs_group = 1000\n      seccomp_profile_type = \u0026quot;RuntimeDefault\u0026quot;\n      \n    [runners.kubernetes.container_security_context]\n      allow_privilege_escalation = false\n      read_only_root_filesystem = true\n      capabilities = { drop = [\u0026quot;ALL\u0026quot;] }\n      \n    # Volume mounts for security\n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \u0026quot;tmp\u0026quot;\n      mount_path = \u0026quot;/tmp\u0026quot;\n      medium = \u0026quot;Memory\u0026quot;\n      \n    [[runners.kubernetes.volumes.empty_dir]]\n      name = \u0026quot;var-tmp\u0026quot;\n      mount_path = \u0026quot;/var/tmp\u0026quot;\n      medium = \u0026quot;Memory\u0026quot;\n\n# Shell executor for specific tasks (limited use)\n[[runners]]\n  name = \u0026quot;shell-restricted-runner\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;shell_runner_token\u0026quot;\n  executor = \u0026quot;shell\u0026quot;\n  shell = \u0026quot;bash\u0026quot;\n  \n  # Restricted tags only\n  tag_list = [\u0026quot;shell\u0026quot;, \u0026quot;restricted\u0026quot;]\n  run_untagged = false\n  locked = true\n  \n  # Security environment\n  environment = [\n    \u0026quot;PATH=/usr/local/bin:/usr/bin:/bin\u0026quot;,\n    \u0026quot;HOME=/home/gitlab-runner\u0026quot;,\n    \u0026quot;SHELL=/bin/bash\u0026quot;\n  ]\n  \n  # Cleanup\n  builds_dir = \u0026quot;/home/gitlab-runner/builds\u0026quot;\n  cache_dir = \u0026quot;/home/gitlab-runner/cache\u0026quot;\n  \n  [runners.cache]\n    Type = \u0026quot;s3\u0026quot;\n    [runners.cache.s3]\n      ServerAddress = \u0026quot;s3.amazonaws.com\u0026quot;\n      BucketName = \u0026quot;gitlab-runner-cache\u0026quot;\n      BucketLocation = \u0026quot;us-west-2\u0026quot;\n      Insecure = false\nEOF\n\nsudo systemctl restart gitlab-runner\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"gitlab-runner-auto-scaling-cloud\" class=\"mobile-header\"\u003eGitLab Runner Auto-scaling (Cloud)\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Configure GitLab Runner with Docker Machine for auto-scaling\nsudo tee /etc/gitlab-runner/autoscale-config.toml \u0026gt; /dev/null \u0026lt;\u0026lt;EOF\nconcurrent = 50\ncheck_interval = 0\n\n[[runners]]\n  name = \u0026quot;autoscale-runner\u0026quot;\n  url = \u0026quot;https://gitlab.example.com/\u0026quot;\n  token = \u0026quot;autoscale_runner_token\u0026quot;\n  executor = \u0026quot;docker+machine\u0026quot;\n  \n  [runners.docker]\n    image = \u0026quot;alpine:latest\u0026quot;\n    privileged = false\n    disable_cache = false\n    volumes = [\u0026quot;/cache\u0026quot;]\n    \n    # Security\n    cap_drop = [\u0026quot;ALL\u0026quot;]\n    security_opt = [\u0026quot;no-new-privileges:true\u0026quot;]\n    \n  [runners.machine]\n    IdleCount = 2\n    IdleTime = 1800\n    MaxBuilds = 20\n    MachineName = \u0026quot;gitlab-runner-%s\u0026quot;\n    MachineDriver = \u0026quot;amazonec2\u0026quot;\n    \n    # AWS EC2 configuration\n    [runners.machine.autoscaling]\n      Periods = [\u0026quot;* * 9-17 * * mon-fri *\u0026quot;, \u0026quot;* * 18-8 * * * *\u0026quot;]\n      IdleCount = [5, 1]\n      IdleTime = [1800, 3600]\n      Timezone = \u0026quot;UTC\u0026quot;\n    \n    # Machine options for security\n    [runners.machine.machineoptions]\n      amazonec2-access-key = \u0026quot;aws_access_key\u0026quot;\n      amazonec2-secret-key = \u0026quot;aws_secret_key\u0026quot;\n      amazonec2-region = \u0026quot;us-west-2\u0026quot;\n      amazonec2-vpc-id = \u0026quot;vpc-12345678\u0026quot;\n      amazonec2-subnet-id = \u0026quot;subnet-87654321\u0026quot;\n      amazonec2-security-group = \u0026quot;gitlab-runner-sg\u0026quot;\n      amazonec2-instance-type = \u0026quot;t3.medium\u0026quot;\n      amazonec2-ami = \u0026quot;ami-0c02fb55956c7d316\u0026quot;  # Amazon Linux 2\n      amazonec2-iam-instance-profile = \u0026quot;GitLabRunnerInstanceProfile\u0026quot;\n      amazonec2-use-private-address = \u0026quot;true\u0026quot;\n      amazonec2-tags = \u0026quot;Name,gitlab-runner,Environment,production\u0026quot;\n      amazonec2-root-size = \u0026quot;20\u0026quot;\n      amazonec2-volume-type = \u0026quot;gp3\u0026quot;\n      amazonec2-use-ebs-optimized = \u0026quot;true\u0026quot;\n      \n  [runners.cache]\n    Type = \u0026quot;s3\u0026quot;\n    Shared = true\n    [runners.cache.s3]\n      ServerAddress = \u0026quot;s3.amazonaws.com\u0026quot;\n      AccessKey = \u0026quot;cache_access_key\u0026quot;\n      SecretKey = \u0026quot;cache_secret_key\u0026quot;  \n      BucketName = \u0026quot;gitlab-runner-cache\u0026quot;\n      BucketLocation = \u0026quot;us-west-2\u0026quot;\n      Insecure = false\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"verification-and-health-checks\" class=\"mobile-header\"\u003eVerification and Health Checks\u003c/h2\u003e\n\u003ch3 id=\"comprehensive-health-monitoring\" class=\"mobile-header\"\u003eComprehensive Health Monitoring\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo tee /usr/local/bin/gitlab-health-check.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\nHEALTH_LOG=\u0026quot;/var/log/gitlab-health.log\u0026quot;\n\nlog_message() {\n    echo \u0026quot;$(date \u0026#039;+%Y-%m-%d %H:%M:%S\u0026#039;) - $1\u0026quot; | tee -a ${HEALTH_LOG}\n}\n\n# Check GitLab service status\nif gitlab-ctl status | grep -q \u0026quot;down:\u0026quot;; then\n    log_message \u0026quot;⚠ Some GitLab services are down:\u0026quot;\n    gitlab-ctl status | grep \u0026quot;down:\u0026quot; | while read line; do\n        log_message \u0026quot;  - $line\u0026quot;\n    done\nelse\n    log_message \u0026quot;✓ All GitLab services are running\u0026quot;\nfi\n\n# Check GitLab application health\nif gitlab-rake gitlab:check \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then\n    log_message \u0026quot;✓ GitLab application health check passed\u0026quot;\nelse\n    log_message \u0026quot;✗ GitLab application health check failed\u0026quot;\n    gitlab-rake gitlab:check | tail -10 \u0026gt;\u0026gt; ${HEALTH_LOG}\nfi\n\n# Check GitLab Runner connectivity\nRUNNERS_ONLINE=$(curl -s --header \u0026quot;PRIVATE-TOKEN: admin_token\u0026quot; https://gitlab.example.com/api/v4/runners | jq \u0026#039;[.[] | select(.status==\u0026quot;online\u0026quot;)] | length\u0026#039;)\nTOTAL_RUNNERS=$(curl -s --header \u0026quot;PRIVATE-TOKEN: admin_token\u0026quot; https://gitlab.example.com/api/v4/runners | jq \u0026#039;. | length\u0026#039;)\nlog_message \u0026quot;ℹ GitLab Runners: ${RUNNERS_ONLINE}/${TOTAL_RUNNERS} online\u0026quot;\n\n# Check database connectivity\nif gitlab-psql -c \u0026quot;SELECT version();\u0026quot; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then\n    log_message \u0026quot;✓ Database connection is healthy\u0026quot;\nelse\n    log_message \u0026quot;✗ Database connection issues\u0026quot;\nfi\n\n# Check Redis connectivity\nif redis-cli ping | grep -q \u0026quot;PONG\u0026quot;; then\n    log_message \u0026quot;✓ Redis connection is healthy\u0026quot;\nelse\n    log_message \u0026quot;✗ Redis connection issues\u0026quot;\nfi\n\n# Check container registry\nREGISTRY_STATUS=$(curl -s https://registry.example.com/v2/ | jq -r .message 2\u0026gt;/dev/null)\nif [ \u0026quot;$REGISTRY_STATUS\u0026quot; = \u0026quot;authentication required\u0026quot; ] || [ \u0026quot;$REGISTRY_STATUS\u0026quot; = \u0026quot;null\u0026quot; ]; then\n    log_message \u0026quot;✓ Container registry is responding\u0026quot;\nelse\n    log_message \u0026quot;⚠ Container registry issues\u0026quot;\nfi\n\n# Check backup status\nLAST_BACKUP=$(ls -t /var/opt/gitlab/backups/*_gitlab_backup.tar 2\u0026gt;/dev/null | head -1)\nif [ -n \u0026quot;$LAST_BACKUP\u0026quot; ]; then\n    BACKUP_AGE=$(stat -c %Y \u0026quot;$LAST_BACKUP\u0026quot;)\n    CURRENT_TIME=$(date +%s)\n    HOURS_SINCE_BACKUP=$(( (CURRENT_TIME - BACKUP_AGE) / 3600 ))\n    \n    if [ $HOURS_SINCE_BACKUP -lt 48 ]; then\n        log_message \u0026quot;✓ Recent backup available (${HOURS_SINCE_BACKUP} hours old)\u0026quot;\n    else\n        log_message \u0026quot;⚠ Last backup is ${HOURS_SINCE_BACKUP} hours old\u0026quot;\n    fi\nelse\n    log_message \u0026quot;✗ No backup files found\u0026quot;\nfi\n\n# Check SSL certificate expiry\nSSL_EXPIRY=$(echo | openssl s_client -servername gitlab.example.com -connect gitlab.example.com:443 2\u0026gt;/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)\nSSL_EXPIRY_EPOCH=$(date -d \u0026quot;$SSL_EXPIRY\u0026quot; +%s)\nCURRENT_EPOCH=$(date +%s)\nDAYS_TO_EXPIRY=$(( (SSL_EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))\n\nif [ $DAYS_TO_EXPIRY -lt 30 ]; then\n    log_message \u0026quot;⚠ SSL certificate expires in ${DAYS_TO_EXPIRY} days\u0026quot;\nelse\n    log_message \u0026quot;✓ SSL certificate expires in ${DAYS_TO_EXPIRY} days\u0026quot;\nfi\n\n# Check system resources\nCPU_USAGE=$(top -bn1 | grep \u0026quot;Cpu(s)\u0026quot; | awk \u0026#039;{print $2}\u0026#039; | cut -d\u0026#039;%\u0026#039; -f1)\nMEMORY_USAGE=$(free | grep Mem | awk \u0026#039;{printf \u0026quot;%.0f\u0026quot;, $3/$2 * 100.0}\u0026#039;)\nlog_message \u0026quot;ℹ System usage - CPU: ${CPU_USAGE}%, Memory: ${MEMORY_USAGE}%\u0026quot;\n\nlog_message \u0026quot;GitLab health check completed\u0026quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-health-check.sh\n\n# Schedule health checks every 15 minutes\necho \u0026quot;*/15 * * * * root /usr/local/bin/gitlab-health-check.sh\u0026quot; | sudo tee -a /etc/crontab\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"security-audit-and-compliance\" class=\"mobile-header\"\u003eSecurity Audit and Compliance\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo tee /usr/local/bin/gitlab-security-audit.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\nAUDIT_LOG=\u0026quot;/var/log/gitlab-security-audit.log\u0026quot;\nDATE=$(date +%Y%m%d_%H%M%S)\n\nlog_message() {\n    echo \u0026quot;$(date \u0026#039;+%Y-%m-%d %H:%M:%S\u0026#039;) - $1\u0026quot; | tee -a ${AUDIT_LOG}\n}\n\nlog_message \u0026quot;Starting GitLab security audit...\u0026quot;\n\n# Check user accounts with admin privileges\nADMIN_USERS=$(gitlab-rails runner \u0026quot;puts User.admins.count\u0026quot;)\nlog_message \u0026quot;ℹ ${ADMIN_USERS} users with admin privileges\u0026quot;\n\n# Check for users without 2FA\nUSERS_WITHOUT_2FA=$(gitlab-rails runner \u0026quot;puts User.where(two_factor_enabled: false).count\u0026quot;)\nlog_message \u0026quot;ℹ ${USERS_WITHOUT_2FA} users without 2FA enabled\u0026quot;\n\n# Check SSH key security\nWEAK_SSH_KEYS=$(gitlab-rails runner \u0026quot;puts Key.where(\u0026#039;LENGTH(key) \u0026lt; ?\u0026#039;, 2048).count\u0026quot;)\nlog_message \u0026quot;ℹ ${WEAK_SSH_KEYS} SSH keys shorter than 2048 bits\u0026quot;\n\n# Check project visibility\nPUBLIC_PROJECTS=$(gitlab-rails runner \u0026quot;puts Project.where(visibility_level: 20).count\u0026quot;)\nINTERNAL_PROJECTS=$(gitlab-rails runner \u0026quot;puts Project.where(visibility_level: 10).count\u0026quot;)\nPRIVATE_PROJECTS=$(gitlab-rails runner \u0026quot;puts Project.where(visibility_level: 0).count\u0026quot;)\nlog_message \u0026quot;ℹ Projects - Public: ${PUBLIC_PROJECTS}, Internal: ${INTERNAL_PROJECTS}, Private: ${PRIVATE_PROJECTS}\u0026quot;\n\n# Check for projects without security scanning\nPROJECTS_WITHOUT_SAST=$(gitlab-rails runner \u0026quot;\nputs Project.joins(:ci_pipelines)\n  .where(\u0026#039;ci_pipelines.created_at \u0026gt; ?\u0026#039;, 30.days.ago)\n  .where.not(id: Ci::Build.joins(:pipeline).where(\u0026#039;ci_builds.name ILIKE ?\u0026#039;, \u0026#039;%sast%\u0026#039;).select(:project_id))\n  .distinct.count\n\u0026quot;)\nlog_message \u0026quot;ℹ ${PROJECTS_WITHOUT_SAST} active projects without SAST scanning\u0026quot;\n\n# Check external integrations\nWEBHOOK_COUNT=$(gitlab-rails runner \u0026quot;puts ProjectHook.count + SystemHook.count\u0026quot;)\nlog_message \u0026quot;ℹ ${WEBHOOK_COUNT} webhooks configured\u0026quot;\n\n# Check audit events (Enterprise)\nif gitlab-rails runner \u0026quot;puts defined?(AuditEvent)\u0026quot; | grep -q \u0026quot;constant\u0026quot;; then\n    RECENT_AUDIT_EVENTS=$(gitlab-rails runner \u0026quot;puts AuditEvent.where(\u0026#039;created_at \u0026gt; ?\u0026#039;, 24.hours.ago).count\u0026quot;)\n    log_message \u0026quot;ℹ ${RECENT_AUDIT_EVENTS} audit events in last 24 hours\u0026quot;\nfi\n\n# Check for suspicious activity\nFAILED_LOGINS=$(grep \u0026quot;Failed Login\u0026quot; /var/log/gitlab/gitlab-rails/production.log | grep \u0026quot;$(date +\u0026#039;%Y-%m-%d\u0026#039;)\u0026quot; | wc -l)\nif [ ${FAILED_LOGINS} -gt 20 ]; then\n    log_message \u0026quot;⚠ ${FAILED_LOGINS} failed login attempts today\u0026quot;\nelse\n    log_message \u0026quot;✓ ${FAILED_LOGINS} failed login attempts today (normal)\u0026quot;\nfi\n\n# Check for large file uploads\nLARGE_UPLOADS=$(find /var/opt/gitlab/git-data/repositories -type f -size +100M -mtime -7 | wc -l)\nif [ ${LARGE_UPLOADS} -gt 0 ]; then\n    log_message \u0026quot;ℹ ${LARGE_UPLOADS} large files (\u0026gt;100MB) uploaded in last week\u0026quot;\nfi\n\nlog_message \u0026quot;Security audit completed\u0026quot;\nEOF\n\nsudo chmod +x /usr/local/bin/gitlab-security-audit.sh\n\n# Schedule daily security audits\necho \u0026quot;0 8 * * * root /usr/local/bin/gitlab-security-audit.sh\u0026quot; | sudo tee -a /etc/crontab\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"troubleshooting-cross-platform\" class=\"mobile-header\"\u003eTroubleshooting (Cross-Platform)\u003c/h2\u003e\n\u003ch3 id=\"common-issues-and-solutions\" class=\"mobile-header\"\u003eCommon Issues and Solutions\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Check GitLab status\nsudo gitlab-ctl status\nsudo gitlab-ctl tail\n\n# Check configuration\nsudo gitlab-ctl show-config\nsudo gitlab-rake gitlab:check SANITIZE=true\n\n# Reconfigure GitLab\nsudo gitlab-ctl reconfigure\nsudo gitlab-ctl restart\n\n# Database issues\nsudo gitlab-psql -d gitlabhq_production\nsudo gitlab-rake db:migrate:status\n\n# Redis issues\nredis-cli ping\nredis-cli info\n\n# Check logs for errors\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\n\n# Performance issues\nsudo gitlab-rake gitlab:env:info\nsudo gitlab-ctl status | grep memory\n\n# SSL/TLS issues\nsudo gitlab-rake gitlab:check\nopenssl s_client -connect gitlab.example.com:443\n\n# Container registry issues\nsudo gitlab-ctl registry-garbage-collect\ndocker login registry.example.com\n\n# Runner connectivity issues\nsudo gitlab-runner verify\nsudo gitlab-runner list\n\n# Backup issues\ngitlab-backup create STRATEGY=copy\ngitlab-backup restore BACKUP=timestamp\n\n# Reset admin password\nsudo gitlab-rake \u0026quot;gitlab:password:reset[root]\u0026quot;\n\n# Check disk usage\ndf -h /var/opt/gitlab/\nsudo du -sh /var/opt/gitlab/git-data/\n\n# Memory usage analysis\nps aux --sort=-%mem | grep gitlab\ngitlab-ctl status | grep memory\n\n# Network connectivity\ncurl -I https://gitlab.example.com\ntelnet gitlab.example.com 443\n\n# Service restart order (if needed)\nsudo gitlab-ctl stop\nsudo gitlab-ctl start postgresql\nsudo gitlab-ctl start redis\nsudo gitlab-ctl start\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"advanced-debugging\" class=\"mobile-header\"\u003eAdvanced Debugging\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Enable debug logging\nsudo gitlab-ctl edit-config\n# Add: gitlab_rails[\u0026#039;log_level\u0026#039;] = \u0026#039;DEBUG\u0026#039;\n\nsudo gitlab-ctl reconfigure\n\n# Debug specific services\nsudo gitlab-ctl tail gitlab-workhorse\nsudo gitlab-ctl tail unicorn\nsudo gitlab-ctl tail sidekiq\nsudo gitlab-ctl tail gitaly\n\n# Database debugging\nsudo gitlab-psql -d gitlabhq_production -c \u0026quot;\\l\u0026quot;\nsudo gitlab-rake db:migrate:status\n\n# Git debugging\nsudo -u git gitaly-debug\nsudo gitlab-rake gitlab:gitaly:check\n\n# Performance profiling\nsudo gitlab-rake gitlab:setup\nsudo gitlab-rake gitlab:check:repos\nsudo gitlab-rake gitlab:cleanup:sessions\n\n# Container registry debugging\nsudo gitlab-ctl registry-garbage-collect -m\ndocker system df\n\n# Runner debugging\nsudo gitlab-runner --debug run\nsudo gitlab-runner exec docker test-job\n\n# Network debugging for distributed setup\nping -c 4 postgres-master.example.com\nping -c 4 redis-master.example.com\ntelnet postgres-master.example.com 5432\ntelnet redis-master.example.com 6379\n\n# Memory leak detection\npmap -x $(pgrep gitlab-workhorse)\nvalgrind --tool=memcheck --leak-check=full gitlab-workhorse\n\n# Strace for syscall analysis\nstrace -p $(pgrep gitlab-workhorse) -e trace=network,file\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"additional-resources\" class=\"mobile-header\"\u003eAdditional Resources\u003c/h2\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eOfficial Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/ee/administration/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eGitLab Admin Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/security/hardening/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eSecurity Hardening Guide\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/runner/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eGitLab Runner Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/ee/administration/packages/container_registry.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eContainer Registry Guide\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.gitlab.com/ee/api/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eGitLab API Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cp class=\"mobile-paragraph\"\u003e---\u003c/p\u003e\n\u003cp class=\"mobile-paragraph\"\u003e\u003cstrong\u003eNote:\u003c/strong\u003e This guide is part of the \u003ca href=\"https://howtomgr.github.io\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eHowToMgr\u003c/a\u003e collection.\u003c/p\u003e","readTime":"29 min","wordCount":5786,"lastBuilt":"2025-09-15T18:14:36.391Z"},"category":{"key":"infrastructure","name":"Infrastructure","description":"DevOps and infrastructure automation tools","icon":"🏗️","color":"#44475a","keywords":["ansible","terraform","gitlab","jenkins","consul","etcd"]},"relatedGuides":[{"name":"adguard-home","displayName":"Adguard Home","slug":"adguard-home","description":"Repo for adguard-home","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/adguard-home","updatedAt":"2025-09-08T03:04:18Z","createdAt":"2025-09-08T03:04:08Z","readmeRaw":"## 👋 Welcome to adguard-home 🚀  \n\nadguard-home README  \n  \n  \n## Author  \n\n🤖 casjay: [Github](https://github.com/casjay) 🤖  \n","readmeHtml":"\u003ch2 id=\"welcome-to-adguard-home\" class=\"mobile-header\"\u003e👋 Welcome to adguard-home 🚀  \u003c/h2\u003e\n\u003cp class=\"mobile-paragraph\"\u003eadguard-home README  \u003c/p\u003e\n\u003ch2 id=\"author\" class=\"mobile-header\"\u003eAuthor  \u003c/h2\u003e\n\u003cp class=\"mobile-paragraph\"\u003e🤖 casjay: \u003ca href=\"https://github.com/casjay\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eGithub\u003c/a\u003e 🤖  \u003c/p\u003e","readTime":"1 min","wordCount":15,"lastBuilt":"2025-09-15T18:14:58.581Z"},{"name":"adminer","displayName":"Adminer","slug":"adminer","description":"Repo for adminer","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/adminer","updatedAt":"2025-09-08T03:04:32Z","createdAt":"2025-09-08T03:04:22Z","readmeRaw":"## 👋 Welcome to adminer 🚀  \n\nadminer README  \n  \n  \n## Author  \n\n🤖 casjay: [Github](https://github.com/casjay) 🤖  \n","readmeHtml":"\u003ch2 id=\"welcome-to-adminer\" class=\"mobile-header\"\u003e👋 Welcome to adminer 🚀  \u003c/h2\u003e\n\u003cp class=\"mobile-paragraph\"\u003eadminer README  \u003c/p\u003e\n\u003ch2 id=\"author\" class=\"mobile-header\"\u003eAuthor  \u003c/h2\u003e\n\u003cp class=\"mobile-paragraph\"\u003e🤖 casjay: \u003ca href=\"https://github.com/casjay\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eGithub\u003c/a\u003e 🤖  \u003c/p\u003e","readTime":"1 min","wordCount":15,"lastBuilt":"2025-09-15T18:14:58.168Z"},{"name":"ansible","displayName":"Ansible","slug":"ansible","description":"Repo for ansible","category":"infrastructure","language":null,"stars":0,"forks":0,"topics":[],"githubUrl":"https://github.com/howtomgr/ansible","updatedAt":"2025-09-14T01:29:39Z","createdAt":"2025-09-08T03:04:35Z","readmeRaw":"# Ansible Installation Guide\n\nAgentless automation platform for configuration management, application deployment, and task automation across multiple systems. Industry standard for infrastructure automation with enterprise-grade security.\n\n## Prerequisites\n\n- Linux control machine (any modern distribution)\n- Python 3.8+ on control machine\n- SSH access to target hosts\n- Python 2.7+ or 3.5+ on target hosts\n- 2GB RAM minimum, 4GB+ recommended for large infrastructures\n\n## Installation\n\n### Using Package Manager (Recommended)\n\n#### Ubuntu/Debian\n```bash\n# Update package list\nsudo apt update\n\n# Install Ansible and dependencies\nsudo apt install -y ansible python3-pip python3-venv sshpass\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Verify installation\nansible --version\nansible-galaxy collection list\n```\n\n#### RHEL/CentOS/Rocky Linux/AlmaLinux\n```bash\n# Install EPEL repository\nsudo yum install -y epel-release\n\n# Install Ansible\nsudo yum install -y ansible python3-pip\n\n# For newer distributions\nsudo dnf install -y ansible python3-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\n```\n\n#### Fedora\n```bash\n# Install Ansible\nsudo dnf install -y ansible python3-pip python3-virtualenv\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\n```\n\n#### Arch Linux\n```bash\n# Install Ansible\nsudo pacman -Syu ansible python-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\n\n# Verify installation\nansible --version\n```\n\n#### Alpine Linux\n```bash\n# Install Ansible\nsudo apk update\nsudo apk add ansible python3 py3-pip openssh\n\n# Install collections\nansible-galaxy collection install community.general\n\n# Verify installation\nansible --version\n```\n\n### Using pip (Latest Version)\n```bash\n# Create virtual environment (recommended)\npython3 -m venv ~/ansible-venv\nsource ~/ansible-venv/bin/activate\n\n# Install Ansible via pip\npip install --upgrade pip\npip install ansible ansible-core\n\n# Install additional packages\npip install paramiko jinja2 PyYAML cryptography\n\n# Install cloud provider SDKs\npip install boto3 botocore azure-cli google-cloud-storage\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Add to PATH permanently\necho 'source ~/ansible-venv/bin/activate' \u003e\u003e ~/.bashrc\n\n# Verify installation\nansible --version\n```\n\n### Using Docker\n```bash\n# Create Ansible Docker container with mounted volumes\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  --workdir /ansible \\\n  ansible/ansible:latest\n\n# Create wrapper script for ease of use\nsudo tee /usr/local/bin/ansible-docker \u003e /dev/null \u003c\u003c'EOF'\n#!/bin/bash\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  -v ~/.kube:/root/.kube:ro \\\n  --workdir /ansible \\\n  --network host \\\n  ansible/ansible:latest \"$@\"\nEOF\nsudo chmod +x /usr/local/bin/ansible-docker\n\n# Create aliases\necho 'alias ansible=\"ansible-docker ansible\"' \u003e\u003e ~/.bashrc\necho 'alias ansible-playbook=\"ansible-docker ansible-playbook\"' \u003e\u003e ~/.bashrc\n```\n\n## Project Structure and Configuration\n\n### Professional Project Structure\n```bash\n# Create comprehensive Ansible project structure\nmkdir -p ~/ansible-infrastructure/{\n  inventories/{production,staging,development},\n  playbooks,\n  roles,\n  group_vars,\n  host_vars,\n  library,\n  filter_plugins,\n  callback_plugins,\n  vault,\n  collections,\n  logs\n}\n\ncd ~/ansible-infrastructure\n\n# Create ansible.cfg with security best practices\ncat \u003e ansible.cfg \u003c\u003cEOF\n[defaults]\ninventory = inventories/production/hosts.yml\nremote_user = ansible\nprivate_key_file = ~/.ssh/ansible_key\nhost_key_checking = True\ntimeout = 30\nretry_files_enabled = False\nstdout_callback = yaml\nbin_ansible_callbacks = True\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = ~/.ansible/facts_cache\nfact_caching_timeout = 86400\ninterpreter_python = auto_silent\nvault_password_file = ~/.ansible_vault_pass\n\n# Logging\nlog_path = logs/ansible.log\ndisplay_skipped_hosts = False\ndisplay_ok_hosts = False\n\n# Performance\nforks = 20\npoll_interval = 15\ninternal_poll_interval = 0.001\n\n# Security\ncommand_warnings = True\ndeprecation_warnings = True\naction_warnings = True\nlocalhost_warning = True\n\n[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=3600s -o PreferredAuthentications=publickey\npipelining = True\ncontrol_path = ~/.ansible/cp/%%h-%%p-%%r\nretries = 3\n\n[privilege_escalation]\nbecome = False\nbecome_method = sudo\nbecome_user = root\nbecome_ask_pass = False\n\n[inventory]\nenable_plugins = host_list, script, auto, yaml, ini, toml\ncache = True\ncache_plugin = jsonfile\ncache_timeout = 3600\ncache_connection = ~/.ansible/inventory_cache\n\n[galaxy]\nserver_list = automation_hub, galaxy\nEOF\n```\n\n### Advanced Inventory Management\n```bash\n# Create production inventory with groups and variables\ncat \u003e inventories/production/hosts.yml \u003c\u003cEOF\nall:\n  children:\n    webservers:\n      hosts:\n        web-prod-01:\n          ansible_host: 10.0.1.10\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-02:\n          ansible_host: 10.0.1.11\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-03:\n          ansible_host: 10.0.1.12\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n      vars:\n        http_port: 80\n        https_port: 443\n        max_clients: 200\n        environment: production\n        monitoring_enabled: true\n\n    dbservers:\n      hosts:\n        db-prod-01:\n          ansible_host: 10.0.2.10\n          ansible_user: ansible\n          mysql_server_id: 1\n          mysql_role: master\n        db-prod-02:\n          ansible_host: 10.0.2.11\n          ansible_user: ansible\n          mysql_server_id: 2\n          mysql_role: slave\n      vars:\n        mysql_port: 3306\n        mysql_root_password: \"{{ vault_mysql_root_password }}\"\n        mysql_replication_user: \"{{ vault_mysql_replication_user }}\"\n        mysql_replication_password: \"{{ vault_mysql_replication_password }}\"\n\n    loadbalancers:\n      hosts:\n        lb-prod-01:\n          ansible_host: 10.0.3.10\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n        lb-prod-02:\n          ansible_host: 10.0.3.11\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n      vars:\n        haproxy_stats_enabled: true\n        haproxy_stats_user: admin\n        haproxy_stats_password: \"{{ vault_haproxy_stats_password }}\"\n\n    monitoring:\n      hosts:\n        monitor-prod-01:\n          ansible_host: 10.0.4.10\n          ansible_user: ansible\n          prometheus_retention: 30d\n          grafana_admin_password: \"{{ vault_grafana_admin_password }}\"\n\n    bastion:\n      hosts:\n        bastion-prod-01:\n          ansible_host: bastion.example.com\n          ansible_user: ansible\n          ansible_port: 22\n\n# Global variables for all hosts\nwebservers:\n  vars:\n    nginx_worker_processes: auto\n    nginx_worker_connections: 1024\n    ssl_certificate_path: /etc/ssl/certs\n    backup_schedule: \"0 2 * * *\"\n\ndbservers:\n  vars:\n    mysql_innodb_buffer_pool_size: 2G\n    mysql_max_connections: 200\n    backup_schedule: \"0 1 * * *\"\n    monitoring_enabled: true\nEOF\n\n# Create dynamic inventory script for cloud environments\ncat \u003e inventories/production/aws_ec2.yml \u003c\u003cEOF\nplugin: amazon.aws.aws_ec2\nregions:\n  - us-west-2\n  - us-east-1\nfilters:\n  tag:Environment: production\n  tag:Ansible: managed\n  instance-state-name: running\n\nhostnames:\n  - tag:Name\n  - dns-name\n  - private-ip-address\n\ncompose:\n  ansible_host: private_ip_address\n  ec2_state: ec2_state_name\n  ec2_arch: ec2_architecture\n\ngroups:\n  # Group by instance type\n  webservers: \"'web' in tags.Role\"\n  databases: \"'db' in tags.Role\"\n  loadbalancers: \"'lb' in tags.Role\"\n  \n  # Group by environment\n  production: \"tags.Environment == 'production'\"\n  staging: \"tags.Environment == 'staging'\"\n  \n  # Group by availability zone\n  us_west_2a: ec2_placement_availability_zone == \"us-west-2a\"\n  us_west_2b: ec2_placement_availability_zone == \"us-west-2b\"\n\nkeyed_groups:\n  # Create groups based on tags\n  - key: tags.Environment\n    prefix: env\n  - key: tags.Role  \n    prefix: role\n  - key: ec2_instance_type\n    prefix: type\nEOF\n```\n\n### Ansible Vault Security\n```bash\n# Create strong vault password\nopenssl rand -base64 32 \u003e ~/.ansible_vault_pass\nchmod 600 ~/.ansible_vault_pass\n\n# Create encrypted vault file for secrets\nansible-vault create group_vars/all/vault.yml\n# Enter secure passwords and API keys:\n# vault_mysql_root_password: your_secure_mysql_password\n# vault_grafana_admin_password: your_secure_grafana_password  \n# vault_ssl_private_key: |\n#   -----BEGIN PRIVATE KEY-----\n#   your_private_key_content\n#   -----END PRIVATE KEY-----\n\n# Create non-encrypted variables file\ncat \u003e group_vars/all/vars.yml \u003c\u003cEOF\n# Non-sensitive variables\nmysql_port: 3306\nnginx_port: 80\ngrafana_port: 3000\nprometheus_port: 9090\n\n# Reference vault variables\nmysql_root_password: \"{{ vault_mysql_root_password }}\"\ngrafana_admin_password: \"{{ vault_grafana_admin_password }}\"\n\n# SSL configuration\nssl_certificate_path: /etc/ssl/certs/server.crt\nssl_private_key_path: /etc/ssl/private/server.key\nssl_private_key_content: \"{{ vault_ssl_private_key }}\"\n\n# Security settings\nansible_ssh_common_args: '-o StrictHostKeyChecking=yes -o UserKnownHostsFile=~/.ssh/known_hosts'\nansible_become_method: sudo\nansible_become_user: root\nEOF\n\n# Edit vault file\nansible-vault edit group_vars/all/vault.yml\n\n# View vault file (read-only)\nansible-vault view group_vars/all/vault.yml\n\n# Change vault password\nansible-vault rekey group_vars/all/vault.yml\n```\n\n## Comprehensive Playbooks\n\n### System Hardening Playbook\n```bash\ncat \u003e playbooks/system-hardening.yml \u003c\u003cEOF\n---\n- name: System Security Hardening\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    security_packages:\n      - fail2ban\n      - ufw\n      - aide\n      - chkrootkit\n      - rkhunter\n      - clamav\n      - lynis\n    \n    disabled_services:\n      - telnet\n      - rsh\n      - rlogin\n      - tftp\n      - talk\n      - finger\n\n  pre_tasks:\n    - name: Update package cache\n      package:\n        update_cache: yes\n        cache_valid_time: 3600\n      when: ansible_os_family in [\"Debian\", \"RedHat\"]\n\n  tasks:\n    # System updates\n    - name: Upgrade all packages\n      package:\n        name: \"*\"\n        state: latest\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Upgrade all packages (Debian/Ubuntu)\n      apt:\n        upgrade: dist\n        autoremove: yes\n        autoclean: yes\n      when: ansible_os_family == \"Debian\"\n\n    # Install security packages\n    - name: Install security packages\n      package:\n        name: \"{{ security_packages }}\"\n        state: present\n\n    # User security\n    - name: Create ansible user with limited privileges\n      user:\n        name: ansible\n        groups: sudo\n        shell: /bin/bash\n        create_home: yes\n        generate_ssh_key: yes\n        ssh_key_bits: 4096\n        ssh_key_type: rsa\n\n    - name: Configure sudo for ansible user\n      lineinfile:\n        path: /etc/sudoers.d/ansible\n        line: 'ansible ALL=(ALL) NOPASSWD:ALL'\n        create: yes\n        mode: '0440'\n        validate: 'visudo -cf %s'\n\n    # SSH hardening\n    - name: Configure SSH security\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: \"{{ item.regexp }}\"\n        line: \"{{ item.line }}\"\n        backup: yes\n      loop:\n        - { regexp: '^#?PermitRootLogin', line: 'PermitRootLogin no' }\n        - { regexp: '^#?PasswordAuthentication', line: 'PasswordAuthentication no' }\n        - { regexp: '^#?X11Forwarding', line: 'X11Forwarding no' }\n        - { regexp: '^#?MaxAuthTries', line: 'MaxAuthTries 3' }\n        - { regexp: '^#?ClientAliveInterval', line: 'ClientAliveInterval 300' }\n        - { regexp: '^#?ClientAliveCountMax', line: 'ClientAliveCountMax 0' }\n        - { regexp: '^#?Protocol', line: 'Protocol 2' }\n        - { regexp: '^#?LogLevel', line: 'LogLevel VERBOSE' }\n      notify: restart ssh\n\n    # Firewall configuration\n    - name: Configure UFW firewall (Debian/Ubuntu)\n      ufw:\n        state: enabled\n        policy: deny\n        direction: incoming\n      when: ansible_os_family == \"Debian\"\n\n    - name: Allow SSH through UFW\n      ufw:\n        rule: allow\n        port: 22\n        proto: tcp\n        comment: 'SSH access'\n      when: ansible_os_family == \"Debian\"\n\n    - name: Configure firewalld (RHEL/CentOS/Fedora)\n      firewalld:\n        state: enabled\n        permanent: yes\n        immediate: yes\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Allow SSH through firewalld\n      firewalld:\n        service: ssh\n        permanent: yes\n        state: enabled\n        immediate: yes\n      when: ansible_os_family == \"RedHat\"\n\n    # Disable unnecessary services\n    - name: Disable unnecessary services\n      systemd:\n        name: \"{{ item }}\"\n        enabled: no\n        state: stopped\n      loop: \"{{ disabled_services }}\"\n      ignore_errors: yes\n\n    # File system security\n    - name: Set proper permissions on sensitive files\n      file:\n        path: \"{{ item.path }}\"\n        mode: \"{{ item.mode }}\"\n        owner: root\n        group: root\n      loop:\n        - { path: '/etc/passwd', mode: '0644' }\n        - { path: '/etc/shadow', mode: '0640' }\n        - { path: '/etc/group', mode: '0644' }\n        - { path: '/etc/gshadow', mode: '0640' }\n        - { path: '/etc/ssh/sshd_config', mode: '0600' }\n\n    # Kernel security parameters\n    - name: Configure kernel security parameters\n      sysctl:\n        name: \"{{ item.key }}\"\n        value: \"{{ item.value }}\"\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: 'net.ipv4.ip_forward', value: '0' }\n        - { key: 'net.ipv4.conf.all.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.accept_source_route', value: '0' }\n        - { key: 'net.ipv4.conf.default.accept_source_route', value: '0' }\n        - { key: 'net.ipv4.conf.all.accept_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.accept_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.secure_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.secure_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.all.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.default.log_martians', value: '1' }\n        - { key: 'kernel.randomize_va_space', value: '2' }\n\n    # Configure fail2ban\n    - name: Configure fail2ban for SSH protection\n      template:\n        src: templates/fail2ban-jail.local.j2\n        dest: /etc/fail2ban/jail.local\n        backup: yes\n      notify: restart fail2ban\n\n  handlers:\n    - name: restart ssh\n      service:\n        name: \"{{ 'ssh' if ansible_os_family == 'Debian' else 'sshd' }}\"\n        state: restarted\n\n    - name: restart fail2ban\n      service:\n        name: fail2ban\n        state: restarted\nEOF\n```\n\n### Application Deployment Playbook\n```bash\ncat \u003e playbooks/web-application-deployment.yml \u003c\u003cEOF\n---\n- name: Deploy Web Application Stack\n  hosts: webservers\n  become: yes\n  serial: \"25%\"  # Rolling deployment\n  max_fail_percentage: 10\n  vars:\n    app_name: mywebapp\n    app_version: \"{{ app_version | default('latest') }}\"\n    app_port: 3000\n    nginx_workers: \"{{ ansible_processor_cores }}\"\n    \n  pre_tasks:\n    - name: Check if maintenance mode file exists\n      stat:\n        path: /var/www/html/maintenance.html\n      register: maintenance_mode\n\n    - name: Fail if in maintenance mode\n      fail:\n        msg: \"Server is in maintenance mode\"\n      when: maintenance_mode.stat.exists and not force_deployment | default(false)\n\n  tasks:\n    # Application deployment\n    - name: Create application user\n      user:\n        name: \"{{ app_name }}\"\n        system: yes\n        shell: /bin/false\n        home: \"/opt/{{ app_name }}\"\n        create_home: yes\n\n    - name: Create application directories\n      file:\n        path: \"{{ item }}\"\n        state: directory\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        mode: '0755'\n      loop:\n        - \"/opt/{{ app_name }}\"\n        - \"/opt/{{ app_name }}/releases\"\n        - \"/opt/{{ app_name }}/shared\"\n        - \"/var/log/{{ app_name }}\"\n\n    - name: Download application release\n      get_url:\n        url: \"https://releases.example.com/{{ app_name }}/{{ app_version }}/{{ app_name }}-{{ app_version }}.tar.gz\"\n        dest: \"/tmp/{{ app_name }}-{{ app_version }}.tar.gz\"\n        mode: '0644'\n        timeout: 300\n      register: download_result\n\n    - name: Extract application\n      unarchive:\n        src: \"/tmp/{{ app_name }}-{{ app_version }}.tar.gz\"\n        dest: \"/opt/{{ app_name }}/releases/\"\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        remote_src: yes\n        creates: \"/opt/{{ app_name }}/releases/{{ app_version }}\"\n\n    - name: Create symlink to current release\n      file:\n        src: \"/opt/{{ app_name }}/releases/{{ app_version }}\"\n        dest: \"/opt/{{ app_name }}/current\"\n        state: link\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n      notify:\n        - reload application\n        - reload nginx\n\n    # Configuration management\n    - name: Deploy application configuration\n      template:\n        src: \"templates/{{ app_name }}.conf.j2\"\n        dest: \"/opt/{{ app_name }}/shared/{{ app_name }}.conf\"\n        owner: \"{{ app_name }}\"\n        group: \"{{ app_name }}\"\n        mode: '0640'\n        backup: yes\n      notify: reload application\n\n    # Service management\n    - name: Deploy systemd service file\n      template:\n        src: \"templates/{{ app_name }}.service.j2\"\n        dest: \"/etc/systemd/system/{{ app_name }}.service\"\n        mode: '0644'\n      notify:\n        - daemon reload\n        - restart application\n\n    - name: Enable and start application service\n      systemd:\n        name: \"{{ app_name }}\"\n        enabled: yes\n        state: started\n        daemon_reload: yes\n\n    # Health check\n    - name: Wait for application to be ready\n      uri:\n        url: \"http://localhost:{{ app_port }}/health\"\n        method: GET\n        status_code: 200\n      retries: 30\n      delay: 10\n\n    # Cleanup old releases\n    - name: Clean up old releases (keep last 3)\n      shell: |\n        cd /opt/{{ app_name }}/releases\n        ls -t | tail -n +4 | xargs rm -rf\n      args:\n        executable: /bin/bash\n\n  post_tasks:\n    - name: Verify application is running\n      uri:\n        url: \"http://{{ ansible_default_ipv4.address }}:{{ app_port }}/health\"\n        method: GET\n        status_code: 200\n      delegate_to: localhost\n\n    - name: Log deployment success\n      lineinfile:\n        path: \"/var/log/{{ app_name }}/deployments.log\"\n        line: \"{{ ansible_date_time.iso8601 }} - Successfully deployed {{ app_version }} to {{ inventory_hostname }}\"\n        create: yes\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart application\n      systemd:\n        name: \"{{ app_name }}\"\n        state: restarted\n\n    - name: reload application\n      systemd:\n        name: \"{{ app_name }}\"\n        state: reloaded\n\n    - name: reload nginx\n      service:\n        name: nginx\n        state: reloaded\nEOF\n```\n\n### Infrastructure as Code Playbook\n```bash\ncat \u003e playbooks/infrastructure-provisioning.yml \u003c\u003cEOF\n---\n- name: Infrastructure Provisioning and Configuration\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  vars:\n    base_packages:\n      Debian:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n      RedHat:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n        - epel-release\n\n  tasks:\n    # System preparation\n    - name: Set hostname\n      hostname:\n        name: \"{{ inventory_hostname }}\"\n\n    - name: Update /etc/hosts\n      lineinfile:\n        path: /etc/hosts\n        line: \"{{ ansible_default_ipv4.address }} {{ inventory_hostname }}\"\n        backup: yes\n\n    # Package management\n    - name: Install base packages\n      package:\n        name: \"{{ base_packages[ansible_os_family] | default(base_packages['Debian']) }}\"\n        state: present\n\n    # Time synchronization\n    - name: Install and configure NTP\n      package:\n        name: \"{{ 'ntp' if ansible_os_family == 'Debian' else 'chrony' }}\"\n        state: present\n\n    - name: Start and enable time synchronization\n      service:\n        name: \"{{ 'ntp' if ansible_os_family == 'Debian' else 'chronyd' }}\"\n        state: started\n        enabled: yes\n\n    # Log management\n    - name: Configure logrotate for application logs\n      template:\n        src: templates/app-logrotate.j2\n        dest: /etc/logrotate.d/applications\n        mode: '0644'\n\n    # Monitoring agent installation\n    - name: Install Node Exporter for Prometheus monitoring\n      get_url:\n        url: \"https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz\"\n        dest: /tmp/node_exporter.tar.gz\n        mode: '0644'\n\n    - name: Extract Node Exporter\n      unarchive:\n        src: /tmp/node_exporter.tar.gz\n        dest: /tmp\n        remote_src: yes\n\n    - name: Copy Node Exporter binary\n      copy:\n        src: /tmp/node_exporter-1.6.1.linux-amd64/node_exporter\n        dest: /usr/local/bin/node_exporter\n        mode: '0755'\n        owner: root\n        group: root\n        remote_src: yes\n\n    - name: Create node_exporter systemd service\n      template:\n        src: templates/node_exporter.service.j2\n        dest: /etc/systemd/system/node_exporter.service\n        mode: '0644'\n      notify:\n        - daemon reload\n        - restart node_exporter\n\n    # Security configuration\n    - name: Configure kernel parameters for security\n      sysctl:\n        name: \"{{ item.key }}\"\n        value: \"{{ item.value }}\"\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: 'kernel.dmesg_restrict', value: '1' }\n        - { key: 'kernel.kptr_restrict', value: '2' }\n        - { key: 'kernel.yama.ptrace_scope', value: '1' }\n        - { key: 'net.ipv4.conf.all.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.default.log_martians', value: '1' }\n        - { key: 'net.ipv4.conf.all.send_redirects', value: '0' }\n        - { key: 'net.ipv4.conf.default.send_redirects', value: '0' }\n\n    # File integrity monitoring\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \"AIDE integrity check\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/bin/aide --check\"\n        user: root\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart node_exporter\n      service:\n        name: node_exporter\n        state: restarted\n        enabled: yes\nEOF\n```\n\n## Advanced Role Development\n\n### Comprehensive NGINX Role\n```bash\n# Create NGINX role structure\nansible-galaxy init roles/nginx\n\n# Main tasks\ncat \u003e roles/nginx/tasks/main.yml \u003c\u003cEOF\n---\n# NGINX Installation and Configuration Role\n- name: Include OS-specific variables\n  include_vars: \"{{ ansible_os_family }}.yml\"\n\n- name: Install NGINX\n  include_tasks: \"install-{{ ansible_os_family }}.yml\"\n\n- name: Create NGINX directories\n  file:\n    path: \"{{ item }}\"\n    state: directory\n    owner: root\n    group: root\n    mode: '0755'\n  loop:\n    - /etc/nginx/sites-available\n    - /etc/nginx/sites-enabled\n    - /etc/nginx/conf.d\n    - /var/log/nginx\n    - /var/cache/nginx\n\n- name: Generate DH parameters\n  openssl_dhparam:\n    path: /etc/ssl/certs/dhparam.pem\n    size: 2048\n  when: nginx_ssl_enabled | default(false)\n\n- name: Deploy NGINX main configuration\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n    backup: yes\n    validate: 'nginx -t -c %s'\n  notify: reload nginx\n\n- name: Deploy virtual host configurations\n  template:\n    src: vhost.conf.j2\n    dest: \"/etc/nginx/sites-available/{{ item.name }}.conf\"\n    backup: yes\n  loop: \"{{ nginx_vhosts | default([]) }}\"\n  notify: reload nginx\n\n- name: Enable virtual hosts\n  file:\n    src: \"/etc/nginx/sites-available/{{ item.name }}.conf\"\n    dest: \"/etc/nginx/sites-enabled/{{ item.name }}.conf\"\n    state: link\n  loop: \"{{ nginx_vhosts | default([]) }}\"\n  when: item.enabled | default(true)\n  notify: reload nginx\n\n- name: Remove default site\n  file:\n    path: /etc/nginx/sites-enabled/default\n    state: absent\n  notify: reload nginx\n\n- name: Start and enable NGINX\n  service:\n    name: nginx\n    state: started\n    enabled: yes\n\n- name: Configure log rotation\n  template:\n    src: nginx-logrotate.j2\n    dest: /etc/logrotate.d/nginx\n    mode: '0644'\n\n- name: Setup NGINX monitoring\n  include_tasks: monitoring.yml\n  when: nginx_monitoring_enabled | default(false)\n\n- name: Configure SSL certificates\n  include_tasks: ssl.yml\n  when: nginx_ssl_enabled | default(false)\nEOF\n\n# OS-specific installation tasks\ncat \u003e roles/nginx/tasks/install-Debian.yml \u003c\u003cEOF\n---\n- name: Add NGINX signing key (Debian/Ubuntu)\n  apt_key:\n    url: https://nginx.org/keys/nginx_signing.key\n    state: present\n\n- name: Add NGINX repository (Debian/Ubuntu)\n  apt_repository:\n    repo: \"deb https://nginx.org/packages/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx\"\n    state: present\n\n- name: Install NGINX (Debian/Ubuntu)\n  apt:\n    name: nginx\n    state: present\n    update_cache: yes\nEOF\n\ncat \u003e roles/nginx/tasks/install-RedHat.yml \u003c\u003cEOF\n---\n- name: Add NGINX repository (RHEL/CentOS)\n  yum_repository:\n    name: nginx\n    description: NGINX Repository\n    baseurl: \"https://nginx.org/packages/centos/{{ ansible_distribution_major_version }}/$basearch/\"\n    gpgcheck: yes\n    gpgkey: https://nginx.org/keys/nginx_signing.key\n    enabled: yes\n\n- name: Install NGINX (RHEL/CentOS)\n  yum:\n    name: nginx\n    state: present\nEOF\n\n# Variables\ncat \u003e roles/nginx/vars/main.yml \u003c\u003cEOF\n---\nnginx_user: nginx\nnginx_worker_processes: auto\nnginx_worker_connections: 1024\nnginx_keepalive_timeout: 65\nnginx_ssl_enabled: false\nnginx_monitoring_enabled: true\n\nnginx_security_headers:\n  - \"add_header X-Frame-Options SAMEORIGIN always;\"\n  - \"add_header X-Content-Type-Options nosniff always;\"\n  - \"add_header X-XSS-Protection '1; mode=block' always;\"\n  - \"add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains' always;\"\n\nnginx_default_vhost:\n  name: default\n  listen: 80\n  server_name: \"_\"\n  root: /var/www/html\n  index: index.html\n  enabled: false\nEOF\n\n# Templates\ncat \u003e roles/nginx/templates/nginx.conf.j2 \u003c\u003cEOF\nuser {{ nginx_user }};\nworker_processes {{ nginx_worker_processes }};\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections {{ nginx_worker_connections }};\n    use epoll;\n    multi_accept on;\n}\n\nhttp {\n    # Basic settings\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout {{ nginx_keepalive_timeout }};\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # SSL configuration\n{% if nginx_ssl_enabled %}\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers off;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n{% endif %}\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types\n        application/javascript\n        application/json\n        application/xml\n        text/css\n        text/javascript\n        text/xml\n        text/plain;\n\n    # Security headers\n{% for header in nginx_security_headers %}\n    {{ header }}\n{% endfor %}\n\n    # Logging\n    log_format main '\\$remote_addr - \\$remote_user [\\$time_local] \"\\$request\" '\n                    '\\$status \\$body_bytes_sent \"\\$http_referer\" '\n                    '\"\\$http_user_agent\" \"\\$http_x_forwarded_for\"';\n\n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log;\n\n    # Rate limiting\n    limit_req_zone \\$binary_remote_addr zone=login:10m rate=10r/m;\n    limit_conn_zone \\$binary_remote_addr zone=addr:10m;\n\n    # Include configurations\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\nEOF\n\n# Handlers\ncat \u003e roles/nginx/handlers/main.yml \u003c\u003cEOF\n---\n- name: restart nginx\n  service:\n    name: nginx\n    state: restarted\n\n- name: reload nginx\n  service:\n    name: nginx\n    state: reloaded\n\n- name: validate nginx config\n  command: nginx -t\n  changed_when: false\nEOF\n```\n\n## Security and Compliance\n\n### Ansible Security Scanner Integration\n```bash\n# Create security scanning playbook\ncat \u003e playbooks/security-scan.yml \u003c\u003cEOF\n---\n- name: Security Compliance Scanning\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    scan_results_dir: \"/tmp/security-scans\"\n    \n  tasks:\n    - name: Create scan results directory\n      file:\n        path: \"{{ scan_results_dir }}\"\n        state: directory\n        mode: '0755'\n\n    # CIS benchmark scanning\n    - name: Download CIS benchmark script\n      get_url:\n        url: \"https://github.com/dev-sec/cis-dil-benchmark/archive/master.zip\"\n        dest: \"/tmp/cis-benchmark.zip\"\n        mode: '0644'\n\n    - name: Run CIS benchmark scan\n      shell: |\n        cd /tmp\n        unzip -o cis-benchmark.zip\n        cd cis-dil-benchmark-master\n        bash cis_ubuntu2204.sh \u003e {{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\n      args:\n        creates: \"{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\"\n\n    # Lynis security audit\n    - name: Install Lynis\n      package:\n        name: lynis\n        state: present\n\n    - name: Run Lynis security audit\n      command: lynis audit system --quiet --cronjob\n      register: lynis_result\n      changed_when: false\n\n    - name: Save Lynis results\n      copy:\n        content: \"{{ lynis_result.stdout }}\"\n        dest: \"{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\"\n        mode: '0644'\n\n    # OpenSCAP compliance scanning\n    - name: Install OpenSCAP (RHEL/CentOS)\n      package:\n        name:\n          - openscap-scanner\n          - scap-security-guide\n        state: present\n      when: ansible_os_family == \"RedHat\"\n\n    - name: Install OpenSCAP (Debian/Ubuntu)\n      package:\n        name:\n          - libopenscap8\n          - ssg-debian\n        state: present\n      when: ansible_os_family == \"Debian\"\n\n    - name: Run OpenSCAP scan\n      shell: |\n        oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard \\\n          --results {{ scan_results_dir }}/oscap-results-{{ inventory_hostname }}.xml \\\n          --report {{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html \\\n          /usr/share/xml/scap/ssg/content/ssg-{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}-xccdf.xml\n      ignore_errors: yes\n      when: ansible_os_family in [\"RedHat\", \"Debian\"]\n\n    # Vulnerability scanning with Trivy\n    - name: Install Trivy vulnerability scanner\n      shell: |\n        curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin\n      args:\n        creates: /usr/local/bin/trivy\n\n    - name: Run Trivy filesystem scan\n      shell: |\n        trivy fs --format json --output {{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json /\n      ignore_errors: yes\n\n    # Collect scan results\n    - name: Fetch scan results to control machine\n      fetch:\n        src: \"{{ item }}\"\n        dest: \"./security-reports/{{ inventory_hostname }}/\"\n        flat: yes\n      loop:\n        - \"{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\"\n        - \"{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\"\n        - \"{{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html\"\n        - \"{{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json\"\n      ignore_errors: yes\n      delegate_to: localhost\n\n  post_tasks:\n    - name: Generate compliance summary\n      template:\n        src: templates/compliance-summary.j2\n        dest: \"{{ scan_results_dir }}/compliance-summary-{{ inventory_hostname }}.txt\"\n        mode: '0644'\nEOF\n```\n\n### Ansible AWX/Tower Integration\n```bash\n# Install Ansible AWX (open source)\ncat \u003e playbooks/install-awx.yml \u003c\u003cEOF\n---\n- name: Install Ansible AWX\n  hosts: localhost\n  connection: local\n  become: yes\n  vars:\n    awx_namespace: awx\n    awx_admin_user: admin\n    awx_admin_password: \"{{ vault_awx_admin_password }}\"\n\n  tasks:\n    - name: Install prerequisite packages\n      package:\n        name:\n          - git\n          - curl\n          - docker.io\n          - docker-compose\n        state: present\n\n    - name: Clone AWX repository\n      git:\n        repo: https://github.com/ansible/awx.git\n        dest: /opt/awx\n        version: devel\n\n    - name: Create AWX Docker inventory\n      template:\n        src: templates/awx-docker-inventory.j2\n        dest: /opt/awx/installer/inventory\n        mode: '0644'\n\n    - name: Install AWX using Ansible\n      shell: ansible-playbook -i inventory install.yml\n      args:\n        chdir: /opt/awx/installer\n      environment:\n        ANSIBLE_HOST_KEY_CHECKING: False\n\n    - name: Wait for AWX to be ready\n      uri:\n        url: \"http://localhost:80/api/v2/ping/\"\n        method: GET\n      retries: 30\n      delay: 10\n\n    - name: Configure AWX organizations and projects\n      uri:\n        url: \"http://localhost:80/api/v2/organizations/\"\n        method: POST\n        user: \"{{ awx_admin_user }}\"\n        password: \"{{ awx_admin_password }}\"\n        force_basic_auth: yes\n        body_format: json\n        body:\n          name: \"Production\"\n          description: \"Production environment organization\"\n        status_code: [200, 201, 409]\nEOF\n```\n\n## Multi-Cloud Automation\n\n### AWS Infrastructure Automation\n```bash\ncat \u003e playbooks/aws-infrastructure.yml \u003c\u003cEOF\n---\n- name: AWS Infrastructure Automation\n  hosts: localhost\n  connection: local\n  gather_facts: no\n  vars:\n    aws_region: \"{{ aws_region | default('us-west-2') }}\"\n    vpc_cidr: \"{{ vpc_cidr | default('10.0.0.0/16') }}\"\n    environment: \"{{ environment | default('production') }}\"\n\n  tasks:\n    # VPC Creation\n    - name: Create VPC\n      amazon.aws.ec2_vpc_info:\n        filters:\n          \"tag:Name\": \"{{ environment }}-vpc\"\n        region: \"{{ aws_region }}\"\n      register: existing_vpc\n\n    - name: Create new VPC if not exists\n      amazon.aws.ec2_vpc_net:\n        name: \"{{ environment }}-vpc\"\n        cidr_block: \"{{ vpc_cidr }}\"\n        region: \"{{ aws_region }}\"\n        state: present\n        dns_hostnames: yes\n        dns_support: yes\n        tags:\n          Environment: \"{{ environment }}\"\n          ManagedBy: ansible\n      register: vpc\n      when: existing_vpc.vpcs | length == 0\n\n    # Security Groups\n    - name: Create web security group\n      amazon.aws.ec2_group:\n        name: \"{{ environment }}-web-sg\"\n        description: \"Security group for web servers\"\n        vpc_id: \"{{ vpc.vpc.id if vpc.vpc is defined else existing_vpc.vpcs[0].vpc_id }}\"\n        region: \"{{ aws_region }}\"\n        rules:\n          - proto: tcp\n            ports:\n              - 80\n              - 443\n            cidr_ip: 0.0.0.0/0\n            rule_desc: \"HTTP and HTTPS access\"\n          - proto: tcp\n            ports:\n              - 22\n            group_id: \"{{ environment }}-bastion-sg\"\n            rule_desc: \"SSH from bastion\"\n        tags:\n          Environment: \"{{ environment }}\"\n\n    # Launch EC2 instances\n    - name: Launch web servers\n      amazon.aws.ec2_instance:\n        name: \"{{ environment }}-web-{{ item }}\"\n        instance_type: t3.medium\n        image_id: ami-0c02fb55956c7d316  # Amazon Linux 2\n        key_name: \"{{ ec2_key_name }}\"\n        vpc_subnet_id: \"{{ web_subnet_id }}\"\n        security_groups:\n          - \"{{ environment }}-web-sg\"\n        region: \"{{ aws_region }}\"\n        state: running\n        wait: yes\n        wait_timeout: 300\n        user_data: |\n          #!/bin/bash\n          yum update -y\n          yum install -y python3\n        tags:\n          Environment: \"{{ environment }}\"\n          Role: webserver\n          Ansible: managed\n      loop: \"{{ range(1, web_server_count + 1) | list }}\"\n      register: web_instances\n\n    # Add instances to inventory\n    - name: Add web servers to inventory\n      add_host:\n        name: \"{{ item.instances[0].tags.Name }}\"\n        hostname: \"{{ item.instances[0].public_ip_address }}\"\n        groups: webservers\n        ansible_ssh_private_key_file: \"~/.ssh/{{ ec2_key_name }}.pem\"\n        ansible_user: ec2-user\n      loop: \"{{ web_instances.results }}\"\n      changed_when: false\nEOF\n```\n\n### Kubernetes Cluster Management\n```bash\ncat \u003e playbooks/k8s-cluster-management.yml \u003c\u003cEOF\n---\n- name: Kubernetes Cluster Management with Ansible\n  hosts: k8s_masters\n  become: yes\n  serial: 1\n  vars:\n    k8s_version: \"1.28.2\"\n    containerd_version: \"1.6.24\"\n    cni_version: \"1.3.0\"\n\n  tasks:\n    # Pre-flight checks\n    - name: Check system requirements\n      assert:\n        that:\n          - ansible_memtotal_mb \u003e= 1700\n          - ansible_processor_cores \u003e= 2\n        fail_msg: \"System doesn't meet minimum requirements\"\n\n    - name: Verify connectivity to all nodes\n      ping:\n      delegate_to: \"{{ item }}\"\n      loop: \"{{ groups['k8s_all'] }}\"\n\n    # Container runtime setup\n    - name: Install containerd\n      include_role:\n        name: containerd\n      vars:\n        containerd_version: \"{{ containerd_version }}\"\n\n    # Kubernetes installation\n    - name: Install Kubernetes components\n      include_role:\n        name: kubernetes\n      vars:\n        kubernetes_version: \"{{ k8s_version }}\"\n\n    # Cluster initialization\n    - name: Initialize Kubernetes cluster\n      shell: |\n        kubeadm init \\\n          --pod-network-cidr=10.244.0.0/16 \\\n          --service-cidr=10.96.0.0/12 \\\n          --apiserver-advertise-address={{ ansible_default_ipv4.address }} \\\n          --node-name={{ inventory_hostname }}\n      args:\n        creates: /etc/kubernetes/admin.conf\n      register: kubeadm_init\n\n    - name: Create .kube directory\n      file:\n        path: \"{{ ansible_env.HOME }}/.kube\"\n        state: directory\n        mode: '0755'\n\n    - name: Copy admin.conf to user's kube config\n      copy:\n        src: /etc/kubernetes/admin.conf\n        dest: \"{{ ansible_env.HOME }}/.kube/config\"\n        owner: \"{{ ansible_user }}\"\n        group: \"{{ ansible_user }}\"\n        mode: '0644'\n        remote_src: yes\n\n    # Network plugin installation\n    - name: Install Flannel CNI\n      shell: kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n      environment:\n        KUBECONFIG: \"{{ ansible_env.HOME }}/.kube/config\"\n\n    # Join worker nodes\n    - name: Get join command\n      shell: kubeadm token create --print-join-command\n      register: join_command\n      when: inventory_hostname in groups['k8s_masters'][0]\n\n    - name: Join worker nodes to cluster\n      shell: \"{{ hostvars[groups['k8s_masters'][0]]['join_command'].stdout }}\"\n      when: inventory_hostname in groups['k8s_workers']\n\n  post_tasks:\n    - name: Verify cluster status\n      shell: kubectl get nodes\n      environment:\n        KUBECONFIG: \"{{ ansible_env.HOME }}/.kube/config\"\n      register: cluster_status\n      when: inventory_hostname in groups['k8s_masters'][0]\n\n    - name: Display cluster status\n      debug:\n        var: cluster_status.stdout_lines\n      when: inventory_hostname in groups['k8s_masters'][0]\nEOF\n```\n\n## Performance Optimization and Scaling\n\n### Parallel Execution Strategies\n```bash\n# Create high-performance playbook configuration\ncat \u003e playbooks/high-performance-deployment.yml \u003c\u003cEOF\n---\n- name: High-Performance Deployment\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  serial: \"30%\"   # Process 30% of hosts at a time\n  max_fail_percentage: 10\n  gather_facts: yes\n  fact_caching: smart\n  vars:\n    deployment_batch_size: 10\n    max_concurrent_tasks: 50\n\n  pre_tasks:\n    - name: Check system load\n      shell: uptime | awk '{print $(NF-2)}' | sed 's/,//'\n      register: system_load\n      changed_when: false\n\n    - name: Skip high-load systems\n      meta: end_host\n      when: system_load.stdout | float \u003e 5.0\n\n  tasks:\n    - name: Update packages with retries\n      package:\n        name: \"*\"\n        state: latest\n      retries: 3\n      delay: 30\n      async: 300\n      poll: 10\n\n    - name: Deploy configuration files in parallel\n      template:\n        src: \"{{ item.src }}\"\n        dest: \"{{ item.dest }}\"\n        mode: \"{{ item.mode | default('0644') }}\"\n        backup: yes\n      loop:\n        - { src: \"nginx.conf.j2\", dest: \"/etc/nginx/nginx.conf\" }\n        - { src: \"mysql.cnf.j2\", dest: \"/etc/mysql/my.cnf\" }\n        - { src: \"redis.conf.j2\", dest: \"/etc/redis/redis.conf\" }\n      async: 120\n      poll: 5\n      register: config_deployment\n\n    - name: Wait for all configuration deployments\n      async_status:\n        jid: \"{{ item.ansible_job_id }}\"\n      loop: \"{{ config_deployment.results }}\"\n      when: item.ansible_job_id is defined\n\n  handlers:\n    - name: restart services\n      service:\n        name: \"{{ item }}\"\n        state: restarted\n      loop:\n        - nginx\n        - mysql\n        - redis\n      listen: \"restart all services\"\nEOF\n\n# Performance monitoring playbook\ncat \u003e playbooks/performance-monitoring.yml \u003c\u003cEOF\n---\n- name: Performance Monitoring Setup\n  hosts: all\n  become: yes\n  vars:\n    monitoring_tools:\n      - htop\n      - iotop\n      - nethogs\n      - dstat\n      - sysstat\n      - perf\n\n  tasks:\n    - name: Install performance monitoring tools\n      package:\n        name: \"{{ monitoring_tools }}\"\n        state: present\n\n    - name: Configure system monitoring\n      template:\n        src: templates/sysstat.j2\n        dest: /etc/default/sysstat\n        backup: yes\n      when: ansible_os_family == \"Debian\"\n\n    - name: Enable system statistics collection\n      service:\n        name: \"{{ 'sysstat' if ansible_os_family == 'Debian' else 'sysstat' }}\"\n        enabled: yes\n        state: started\n\n    - name: Create performance monitoring script\n      template:\n        src: templates/performance-monitor.sh.j2\n        dest: /usr/local/bin/performance-monitor.sh\n        mode: '0755'\n\n    - name: Schedule performance monitoring\n      cron:\n        name: \"Performance monitoring\"\n        minute: \"*/5\"\n        job: \"/usr/local/bin/performance-monitor.sh\"\n        user: root\nEOF\n```\n\n## Testing and Validation\n\n### Molecule Testing Framework\n```bash\n# Install Molecule for role testing\npip install molecule[docker] molecule[vagrant] molecule[libvirt]\n\n# Initialize Molecule in role directory\ncd roles/nginx\nmolecule init scenario --driver-name docker\n\n# Create molecule configuration\ncat \u003e molecule/default/molecule.yml \u003c\u003cEOF\n---\ndependency:\n  name: galaxy\ndriver:\n  name: docker\nplatforms:\n  - name: nginx-ubuntu\n    image: ubuntu:22.04\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /lib/systemd/systemd\n    networks:\n      - name: molecule\n  - name: nginx-centos\n    image: centos:8\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /usr/sbin/init\n    networks:\n      - name: molecule\nprovisioner:\n  name: ansible\n  config_options:\n    defaults:\n      callbacks_enabled: profile_tasks,timer,yaml\n  inventory:\n    host_vars:\n      nginx-ubuntu:\n        ansible_python_interpreter: /usr/bin/python3\n      nginx-centos:\n        ansible_python_interpreter: /usr/bin/python3\nverifier:\n  name: ansible\nlint: |\n  set -e\n  yamllint .\n  ansible-lint\n  flake8\nEOF\n\n# Create test playbook\ncat \u003e molecule/default/converge.yml \u003c\u003cEOF\n---\n- name: Converge\n  hosts: all\n  become: true\n  tasks:\n    - name: \"Include nginx role\"\n      include_role:\n        name: nginx\n      vars:\n        nginx_vhosts:\n          - name: default\n            server_name: localhost\n            listen: 80\n            root: /var/www/html\n            enabled: true\nEOF\n\n# Create test verification\ncat \u003e molecule/default/verify.yml \u003c\u003cEOF\n---\n- name: Verify\n  hosts: all\n  gather_facts: false\n  tasks:\n    - name: Check if NGINX is running\n      uri:\n        url: http://localhost\n        method: GET\n      register: nginx_check\n\n    - name: Verify NGINX is responding\n      assert:\n        that:\n          - nginx_check.status == 200\n        fail_msg: \"NGINX is not responding correctly\"\n\n    - name: Check NGINX configuration\n      shell: nginx -t\n      changed_when: false\n\n    - name: Verify NGINX process\n      shell: pgrep nginx\n      changed_when: false\nEOF\n\n# Run tests\nmolecule test\n```\n\n### Ansible Lint and Security Scanning\n```bash\n# Install Ansible Lint\npip install ansible-lint\n\n# Create .ansible-lint configuration\ncat \u003e .ansible-lint \u003c\u003cEOF\n---\nprofile: production\n\nexclude_paths:\n  - .cache/\n  - .github/\n  - molecule/\n  - .venv/\n\nskip_list:\n  - yaml[line-length]  # Allow longer lines for readability\n\nwarn_list:\n  - experimental  # Warn about experimental features\n\n# Custom rules\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments:\n    min-spaces-from-content: 1\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  trailing-spaces: enable\n  truthy:\n    allowed-values: ['true', 'false', 'yes', 'no']\nEOF\n\n# Create security-focused playbook linting\ncat \u003e .yamllint \u003c\u003cEOF\n---\nextends: default\n\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments: disable\n  comments-indentation: disable\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n    check-multi-line-strings: false\n  key-duplicates: enable\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  octal-values:\n    forbid-implicit-octal: true\n  trailing-spaces: enable\n  truthy: disable\nEOF\n\n# Run linting\nansible-lint playbooks/\nyamllint .\n```\n\n## Backup and Disaster Recovery\n\n### Comprehensive Backup Automation\n```bash\ncat \u003e playbooks/backup-automation.yml \u003c\u003cEOF\n---\n- name: Automated Backup System\n  hosts: all\n  become: yes\n  vars:\n    backup_root: /backup\n    backup_retention_days: 30\n    backup_schedule:\n      databases: \"0 2 * * *\"\n      files: \"0 3 * * *\"\n      configs: \"0 4 * * *\"\n\n  tasks:\n    - name: Create backup directories\n      file:\n        path: \"{{ backup_root }}/{{ item }}\"\n        state: directory\n        mode: '0755'\n        owner: root\n        group: root\n      loop:\n        - databases\n        - files\n        - configs\n        - logs\n\n    # Database backups\n    - name: Create database backup script\n      template:\n        src: templates/mysql-backup.sh.j2\n        dest: /usr/local/bin/mysql-backup.sh\n        mode: '0755'\n      when: \"'dbservers' in group_names\"\n\n    - name: Schedule database backups\n      cron:\n        name: \"MySQL backup\"\n        minute: \"0\"\n        hour: \"2\"\n        job: \"/usr/local/bin/mysql-backup.sh\"\n        user: root\n      when: \"'dbservers' in group_names\"\n\n    # File system backups\n    - name: Create file backup script\n      template:\n        src: templates/file-backup.sh.j2\n        dest: /usr/local/bin/file-backup.sh\n        mode: '0755'\n\n    - name: Schedule file backups\n      cron:\n        name: \"File system backup\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/local/bin/file-backup.sh\"\n        user: root\n\n    # Configuration backups\n    - name: Backup system configurations\n      archive:\n        path:\n          - /etc/nginx\n          - /etc/mysql\n          - /etc/systemd/system\n          - /etc/crontab\n          - /etc/hosts\n          - /etc/fstab\n        dest: \"{{ backup_root }}/configs/system-config-{{ ansible_date_time.epoch }}.tar.gz\"\n        mode: '0600'\n\n    # Remote backup synchronization\n    - name: Synchronize backups to remote storage\n      synchronize:\n        src: \"{{ backup_root }}/\"\n        dest: \"backup-server.example.com:{{ backup_root }}/{{ inventory_hostname }}/\"\n        delete: yes\n        rsync_opts:\n          - \"--exclude=*.tmp\"\n          - \"--compress\"\n          - \"--archive\"\n      when: backup_remote_sync | default(true)\n\n    # Cleanup old backups\n    - name: Clean up old backup files\n      find:\n        paths: \"{{ backup_root }}\"\n        age: \"{{ backup_retention_days }}d\"\n        file_type: file\n      register: old_backups\n\n    - name: Remove old backup files\n      file:\n        path: \"{{ item.path }}\"\n        state: absent\n      loop: \"{{ old_backups.files }}\"\nEOF\n```\n\n## Verification and Monitoring\n\n### Cross-Platform System Verification\n```bash\n# Create comprehensive verification playbook\ncat \u003e playbooks/system-verification.yml \u003c\u003cEOF\n---\n- name: System Verification and Health Check\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    health_checks:\n      - service: nginx\n        port: 80\n        process: nginx\n      - service: mysql\n        port: 3306\n        process: mysqld\n      - service: redis\n        port: 6379\n        process: redis-server\n\n  tasks:\n    # System information gathering\n    - name: Gather system information\n      setup:\n        gather_subset:\n          - all\n          - !facter\n          - !ohai\n\n    # Service verification\n    - name: Check critical services status\n      service_facts:\n\n    - name: Verify services are running\n      assert:\n        that:\n          - \"ansible_facts.services[item.service + '.service'].state == 'running'\"\n        fail_msg: \"Service {{ item.service }} is not running\"\n        success_msg: \"Service {{ item.service }} is healthy\"\n      loop: \"{{ health_checks }}\"\n      when: \"item.service + '.service' in ansible_facts.services\"\n\n    # Network connectivity tests\n    - name: Test network connectivity\n      wait_for:\n        host: \"{{ item.host }}\"\n        port: \"{{ item.port }}\"\n        timeout: 5\n      loop:\n        - { host: \"8.8.8.8\", port: 53 }\n        - { host: \"1.1.1.1\", port: 53 }\n      ignore_errors: yes\n\n    # Disk space monitoring\n    - name: Check disk space usage\n      shell: df -h | awk '$5 \u003e \"85%\" {print $0}'\n      register: disk_usage\n      changed_when: false\n      failed_when: disk_usage.stdout != \"\"\n\n    # Memory usage check\n    - name: Check memory usage\n      shell: free | grep Mem | awk '{printf \"%.0f\", $3/$2 * 100.0}'\n      register: memory_usage\n      changed_when: false\n\n    - name: Alert on high memory usage\n      debug:\n        msg: \"WARNING: Memory usage is {{ memory_usage.stdout }}%\"\n      when: memory_usage.stdout | int \u003e 85\n\n    # Security verification\n    - name: Check for failed login attempts\n      shell: grep \"Failed password\" /var/log/auth.log | tail -10\n      register: failed_logins\n      changed_when: false\n      ignore_errors: yes\n      when: ansible_os_family == \"Debian\"\n\n    - name: Check firewall status\n      shell: |\n        if command -v ufw \u003e/dev/null 2\u003e\u00261; then\n          ufw status\n        elif command -v firewall-cmd \u003e/dev/null 2\u003e\u00261; then\n          firewall-cmd --state\n        else\n          echo \"No supported firewall found\"\n        fi\n      register: firewall_status\n      changed_when: false\n\n  post_tasks:\n    - name: Generate system health report\n      template:\n        src: templates/health-report.j2\n        dest: \"/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\"\n        mode: '0644'\n\n    - name: Fetch health reports\n      fetch:\n        src: \"/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\"\n        dest: \"./reports/\"\n        flat: yes\nEOF\n```\n\n### Continuous Compliance Monitoring\n```bash\ncat \u003e playbooks/compliance-monitoring.yml \u003c\u003cEOF\n---\n- name: Continuous Compliance Monitoring\n  hosts: all\n  become: yes\n  vars:\n    compliance_standards:\n      - cis\n      - pci_dss\n      - soc2\n      - hipaa\n    \n    audit_log_paths:\n      - /var/log/auth.log\n      - /var/log/syslog\n      - /var/log/audit/audit.log\n\n  tasks:\n    # Install audit tools\n    - name: Install audit daemon\n      package:\n        name: \"{{ 'auditd' if ansible_os_family == 'RedHat' else 'auditd' }}\"\n        state: present\n\n    - name: Configure audit rules\n      template:\n        src: templates/audit.rules.j2\n        dest: /etc/audit/rules.d/audit.rules\n        backup: yes\n      notify: restart auditd\n\n    # CIS compliance checks\n    - name: Run CIS benchmark checks\n      shell: |\n        if [ -f /opt/cis-cat/CIS-CAT.sh ]; then\n          /opt/cis-cat/CIS-CAT.sh -b /opt/cis-cat/benchmarks/\n        else\n          echo \"CIS-CAT not installed, skipping\"\n        fi\n      register: cis_results\n      ignore_errors: yes\n\n    # File integrity monitoring\n    - name: Install AIDE\n      package:\n        name: aide\n        state: present\n\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \"AIDE integrity check\"\n        minute: \"0\"\n        hour: \"3\"\n        job: \"/usr/bin/aide --check | mail -s 'AIDE Report' security@example.com\"\n        user: root\n\n    # Log monitoring\n    - name: Install log monitoring tools\n      package:\n        name:\n          - logwatch\n          - rsyslog\n        state: present\n\n    - name: Configure centralized logging\n      template:\n        src: templates/rsyslog.conf.j2\n        dest: /etc/rsyslog.conf\n        backup: yes\n      notify: restart rsyslog\n\n  handlers:\n    - name: restart auditd\n      service:\n        name: auditd\n        state: restarted\n\n    - name: restart rsyslog\n      service:\n        name: rsyslog\n        state: restarted\nEOF\n```\n\n## CI/CD Integration\n\n### Jenkins Pipeline Integration\n```bash\n# Create Jenkinsfile for Ansible automation\ncat \u003e Jenkinsfile \u003c\u003cEOF\npipeline {\n    agent any\n    \n    environment {\n        ANSIBLE_CONFIG = 'ansible.cfg'\n        ANSIBLE_HOST_KEY_CHECKING = 'False'\n    }\n    \n    stages {\n        stage('Lint') {\n            steps {\n                sh 'ansible-lint playbooks/'\n                sh 'yamllint .'\n            }\n        }\n        \n        stage('Syntax Check') {\n            steps {\n                sh 'ansible-playbook playbooks/site.yml --syntax-check'\n            }\n        }\n        \n        stage('Dry Run') {\n            steps {\n                sh 'ansible-playbook playbooks/site.yml --check --diff'\n            }\n        }\n        \n        stage('Deploy to Staging') {\n            when {\n                branch 'develop'\n            }\n            steps {\n                sh 'ansible-playbook -i inventories/staging playbooks/site.yml'\n            }\n        }\n        \n        stage('Deploy to Production') {\n            when {\n                branch 'main'\n            }\n            steps {\n                input 'Deploy to Production?'\n                sh 'ansible-playbook -i inventories/production playbooks/site.yml'\n            }\n        }\n        \n        stage('Verify Deployment') {\n            steps {\n                sh 'ansible-playbook playbooks/system-verification.yml'\n            }\n        }\n    }\n    \n    post {\n        always {\n            archiveArtifacts artifacts: 'logs/*.log', allowEmptyArchive: true\n            publishHTML([\n                allowMissing: false,\n                alwaysLinkToLastBuild: true,\n                keepAll: true,\n                reportDir: 'reports',\n                reportFiles: '*.html',\n                reportName: 'Ansible Report'\n            ])\n        }\n        failure {\n            emailext (\n                subject: \"Failed Pipeline: ${env.JOB_NAME} - ${env.BUILD_NUMBER}\",\n                body: \"Something is wrong with ${env.BUILD_URL}\",\n                to: \"${env.DEFAULT_RECIPIENTS}\"\n            )\n        }\n    }\n}\nEOF\n```\n\n### GitLab CI Integration\n```bash\ncat \u003e .gitlab-ci.yml \u003c\u003cEOF\nstages:\n  - lint\n  - test\n  - deploy-staging\n  - deploy-production\n\nvariables:\n  ANSIBLE_CONFIG: ansible.cfg\n  ANSIBLE_HOST_KEY_CHECKING: \"False\"\n\nbefore_script:\n  - pip install ansible ansible-lint yamllint\n  - ansible-galaxy install -r requirements.yml\n\nlint:\n  stage: lint\n  script:\n    - ansible-lint playbooks/\n    - yamllint .\n  rules:\n    - if: '$CI_MERGE_REQUEST_IID'\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n\nsyntax-check:\n  stage: test\n  script:\n    - ansible-playbook playbooks/site.yml --syntax-check\n    - ansible-playbook playbooks/site.yml --check --diff -i inventories/staging\n  rules:\n    - if: '$CI_MERGE_REQUEST_IID'\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n\ndeploy-staging:\n  stage: deploy-staging\n  script:\n    - ansible-playbook -i inventories/staging playbooks/site.yml\n  rules:\n    - if: '$CI_COMMIT_BRANCH == \"develop\"'\n\ndeploy-production:\n  stage: deploy-production\n  script:\n    - ansible-playbook -i inventories/production playbooks/site.yml\n  rules:\n    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'\n      when: manual\n  environment:\n    name: production\n    url: https://production.example.com\nEOF\n```\n\n## Troubleshooting (Cross-Platform)\n\n### Common Issues and Solutions\n```bash\n# Debug connection issues\nansible all -m ping -vvv\n\n# Check SSH connectivity\nansible all -m setup --ask-pass --ask-become-pass\n\n# Verify inventory\nansible-inventory --list\nansible-inventory --graph\n\n# Test specific host\nansible target-host -m command -a \"uptime\"\n\n# Check syntax without execution\nansible-playbook playbooks/site.yml --syntax-check\n\n# Dry run with verbose output\nansible-playbook playbooks/site.yml --check --diff -vvv\n\n# Debug variable resolution\nansible-playbook playbooks/site.yml --extra-vars=\"debug=true\" --tags debug\n\n# Check facts\nansible all -m setup | grep ansible_os_family\n\n# Connection troubleshooting\nssh -vvv user@target-host\n\n# Permission issues\nansible all -m file -a \"path=/tmp/test state=touch\" --become\n\n# Vault issues\nansible-vault view group_vars/all/vault.yml\n\n# Performance debugging\nansible-playbook playbooks/site.yml --start-at-task=\"specific task name\"\nansible-playbook playbooks/site.yml --step\n\n# Module testing\nansible localhost -m debug -a \"var=hostvars\"\nansible localhost -m setup\n\n# Check for syntax errors in roles\nfind roles/ -name \"*.yml\" -exec ansible-playbook {} --syntax-check \\;\n```\n\n### Advanced Debugging\n```bash\n# Enable comprehensive logging\nexport ANSIBLE_DEBUG=1\nexport ANSIBLE_VERBOSITY=4\nansible-playbook playbooks/site.yml\n\n# Profile playbook execution\nansible-playbook playbooks/site.yml --extra-vars=\"profile_tasks_sort_order=none\"\n\n# Memory usage analysis\nansible-playbook playbooks/site.yml --extra-vars=\"ansible_python_interpreter=/usr/bin/python3\"\n\n# Network debugging\nansible all -m command -a \"ss -tulpn\"\nansible all -m command -a \"netstat -rn\"\n\n# Process debugging\nansible all -m command -a \"ps aux --sort=-%mem | head -10\"\n\n# Disk usage analysis\nansible all -m command -a \"df -h\"\nansible all -m command -a \"du -sh /var/log/*\"\n\n# Service debugging\nansible all -m systemd -a \"name=nginx\" --become\nansible all -m command -a \"systemctl status nginx\" --become\n\n# Variable debugging\nansible-playbook playbooks/site.yml --extra-vars=\"debug_vars=true\" --tags debug_vars\n```\n\n## Additional Resources\n\n- [Official Documentation](https://docs.ansible.com/)\n- [Ansible Galaxy](https://galaxy.ansible.com/)\n- [Best Practices Guide](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)\n- [Security Best Practices](https://docs.ansible.com/ansible/latest/user_guide/become.html#security-best-practices)\n- [Ansible Molecule Testing](https://molecule.readthedocs.io/)\n- [Community Collections](https://docs.ansible.com/ansible/latest/collections/index.html)\n\n---\n\n**Note:** This guide is part of the [HowToMgr](https://howtomgr.github.io) collection.","readmeHtml":"\u003ch1 id=\"ansible-installation-guide\" class=\"mobile-header\"\u003eAnsible Installation Guide\u003c/h1\u003e\n\u003cp class=\"mobile-paragraph\"\u003eAgentless automation platform for configuration management, application deployment, and task automation across multiple systems. Industry standard for infrastructure automation with enterprise-grade security.\u003c/p\u003e\n\u003ch2 id=\"prerequisites\" class=\"mobile-header\"\u003ePrerequisites\u003c/h2\u003e\n\u003cli class=\"mobile-list-item\"\u003eLinux control machine (any modern distribution)\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003ePython 3.8+ on control machine\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003eSSH access to target hosts\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003ePython 2.7+ or 3.5+ on target hosts\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e2GB RAM minimum, 4GB+ recommended for large infrastructures\u003c/li\u003e\n\u003ch2 id=\"installation\" class=\"mobile-header\"\u003eInstallation\u003c/h2\u003e\n\u003ch3 id=\"using-package-manager-recommended\" class=\"mobile-header\"\u003eUsing Package Manager (Recommended)\u003c/h3\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Ubuntu/Debian\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Update package list\nsudo apt update\n\n# Install Ansible and dependencies\nsudo apt install -y ansible python3-pip python3-venv sshpass\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Verify installation\nansible --version\nansible-galaxy collection list\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### RHEL/CentOS/Rocky Linux/AlmaLinux\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install EPEL repository\nsudo yum install -y epel-release\n\n# Install Ansible\nsudo yum install -y ansible python3-pip\n\n# For newer distributions\nsudo dnf install -y ansible python3-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Fedora\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Ansible\nsudo dnf install -y ansible python3-pip python3-virtualenv\n\n# Install additional collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\n\n# Verify installation\nansible --version\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Arch Linux\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Ansible\nsudo pacman -Syu ansible python-pip\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\n\n# Verify installation\nansible --version\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003cp class=\"mobile-paragraph\"\u003e#### Alpine Linux\u003c/p\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Ansible\nsudo apk update\nsudo apk add ansible python3 py3-pip openssh\n\n# Install collections\nansible-galaxy collection install community.general\n\n# Verify installation\nansible --version\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"using-pip-latest-version\" class=\"mobile-header\"\u003eUsing pip (Latest Version)\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create virtual environment (recommended)\npython3 -m venv ~/ansible-venv\nsource ~/ansible-venv/bin/activate\n\n# Install Ansible via pip\npip install --upgrade pip\npip install ansible ansible-core\n\n# Install additional packages\npip install paramiko jinja2 PyYAML cryptography\n\n# Install cloud provider SDKs\npip install boto3 botocore azure-cli google-cloud-storage\n\n# Install collections\nansible-galaxy collection install community.general\nansible-galaxy collection install ansible.posix\nansible-galaxy collection install kubernetes.core\nansible-galaxy collection install amazon.aws\nansible-galaxy collection install azure.azcollection\nansible-galaxy collection install google.cloud\n\n# Add to PATH permanently\necho \u0026#039;source ~/ansible-venv/bin/activate\u0026#039; \u0026gt;\u0026gt; ~/.bashrc\n\n# Verify installation\nansible --version\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"using-docker\" class=\"mobile-header\"\u003eUsing Docker\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create Ansible Docker container with mounted volumes\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  --workdir /ansible \\\n  ansible/ansible:latest\n\n# Create wrapper script for ease of use\nsudo tee /usr/local/bin/ansible-docker \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#039;EOF\u0026#039;\n#!/bin/bash\ndocker run --rm -it \\\n  -v $(pwd):/ansible \\\n  -v ~/.ssh:/root/.ssh:ro \\\n  -v ~/.aws:/root/.aws:ro \\\n  -v ~/.azure:/root/.azure:ro \\\n  -v ~/.kube:/root/.kube:ro \\\n  --workdir /ansible \\\n  --network host \\\n  ansible/ansible:latest \u0026quot;$@\u0026quot;\nEOF\nsudo chmod +x /usr/local/bin/ansible-docker\n\n# Create aliases\necho \u0026#039;alias ansible=\u0026quot;ansible-docker ansible\u0026quot;\u0026#039; \u0026gt;\u0026gt; ~/.bashrc\necho \u0026#039;alias ansible-playbook=\u0026quot;ansible-docker ansible-playbook\u0026quot;\u0026#039; \u0026gt;\u0026gt; ~/.bashrc\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"project-structure-and-configuration\" class=\"mobile-header\"\u003eProject Structure and Configuration\u003c/h2\u003e\n\u003ch3 id=\"professional-project-structure\" class=\"mobile-header\"\u003eProfessional Project Structure\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create comprehensive Ansible project structure\nmkdir -p ~/ansible-infrastructure/{\n  inventories/{production,staging,development},\n  playbooks,\n  roles,\n  group_vars,\n  host_vars,\n  library,\n  filter_plugins,\n  callback_plugins,\n  vault,\n  collections,\n  logs\n}\n\ncd ~/ansible-infrastructure\n\n# Create ansible.cfg with security best practices\ncat \u0026gt; ansible.cfg \u0026lt;\u0026lt;EOF\n[defaults]\ninventory = inventories/production/hosts.yml\nremote_user = ansible\nprivate_key_file = ~/.ssh/ansible_key\nhost_key_checking = True\ntimeout = 30\nretry_files_enabled = False\nstdout_callback = yaml\nbin_ansible_callbacks = True\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = ~/.ansible/facts_cache\nfact_caching_timeout = 86400\ninterpreter_python = auto_silent\nvault_password_file = ~/.ansible_vault_pass\n\n# Logging\nlog_path = logs/ansible.log\ndisplay_skipped_hosts = False\ndisplay_ok_hosts = False\n\n# Performance\nforks = 20\npoll_interval = 15\ninternal_poll_interval = 0.001\n\n# Security\ncommand_warnings = True\ndeprecation_warnings = True\naction_warnings = True\nlocalhost_warning = True\n\n[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=3600s -o PreferredAuthentications=publickey\npipelining = True\ncontrol_path = ~/.ansible/cp/%%h-%%p-%%r\nretries = 3\n\n[privilege_escalation]\nbecome = False\nbecome_method = sudo\nbecome_user = root\nbecome_ask_pass = False\n\n[inventory]\nenable_plugins = host_list, script, auto, yaml, ini, toml\ncache = True\ncache_plugin = jsonfile\ncache_timeout = 3600\ncache_connection = ~/.ansible/inventory_cache\n\n[galaxy]\nserver_list = automation_hub, galaxy\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"advanced-inventory-management\" class=\"mobile-header\"\u003eAdvanced Inventory Management\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create production inventory with groups and variables\ncat \u0026gt; inventories/production/hosts.yml \u0026lt;\u0026lt;EOF\nall:\n  children:\n    webservers:\n      hosts:\n        web-prod-01:\n          ansible_host: 10.0.1.10\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-02:\n          ansible_host: 10.0.1.11\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n        web-prod-03:\n          ansible_host: 10.0.1.12\n          ansible_user: ansible\n          server_role: frontend\n          backup_enabled: true\n      vars:\n        http_port: 80\n        https_port: 443\n        max_clients: 200\n        environment: production\n        monitoring_enabled: true\n\n    dbservers:\n      hosts:\n        db-prod-01:\n          ansible_host: 10.0.2.10\n          ansible_user: ansible\n          mysql_server_id: 1\n          mysql_role: master\n        db-prod-02:\n          ansible_host: 10.0.2.11\n          ansible_user: ansible\n          mysql_server_id: 2\n          mysql_role: slave\n      vars:\n        mysql_port: 3306\n        mysql_root_password: \u0026quot;{{ vault_mysql_root_password }}\u0026quot;\n        mysql_replication_user: \u0026quot;{{ vault_mysql_replication_user }}\u0026quot;\n        mysql_replication_password: \u0026quot;{{ vault_mysql_replication_password }}\u0026quot;\n\n    loadbalancers:\n      hosts:\n        lb-prod-01:\n          ansible_host: 10.0.3.10\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n        lb-prod-02:\n          ansible_host: 10.0.3.11\n          ansible_user: ansible\n          lb_algorithm: roundrobin\n      vars:\n        haproxy_stats_enabled: true\n        haproxy_stats_user: admin\n        haproxy_stats_password: \u0026quot;{{ vault_haproxy_stats_password }}\u0026quot;\n\n    monitoring:\n      hosts:\n        monitor-prod-01:\n          ansible_host: 10.0.4.10\n          ansible_user: ansible\n          prometheus_retention: 30d\n          grafana_admin_password: \u0026quot;{{ vault_grafana_admin_password }}\u0026quot;\n\n    bastion:\n      hosts:\n        bastion-prod-01:\n          ansible_host: bastion.example.com\n          ansible_user: ansible\n          ansible_port: 22\n\n# Global variables for all hosts\nwebservers:\n  vars:\n    nginx_worker_processes: auto\n    nginx_worker_connections: 1024\n    ssl_certificate_path: /etc/ssl/certs\n    backup_schedule: \u0026quot;0 2 * * *\u0026quot;\n\ndbservers:\n  vars:\n    mysql_innodb_buffer_pool_size: 2G\n    mysql_max_connections: 200\n    backup_schedule: \u0026quot;0 1 * * *\u0026quot;\n    monitoring_enabled: true\nEOF\n\n# Create dynamic inventory script for cloud environments\ncat \u0026gt; inventories/production/aws_ec2.yml \u0026lt;\u0026lt;EOF\nplugin: amazon.aws.aws_ec2\nregions:\n  - us-west-2\n  - us-east-1\nfilters:\n  tag:Environment: production\n  tag:Ansible: managed\n  instance-state-name: running\n\nhostnames:\n  - tag:Name\n  - dns-name\n  - private-ip-address\n\ncompose:\n  ansible_host: private_ip_address\n  ec2_state: ec2_state_name\n  ec2_arch: ec2_architecture\n\ngroups:\n  # Group by instance type\n  webservers: \u0026quot;\u0026#039;web\u0026#039; in tags.Role\u0026quot;\n  databases: \u0026quot;\u0026#039;db\u0026#039; in tags.Role\u0026quot;\n  loadbalancers: \u0026quot;\u0026#039;lb\u0026#039; in tags.Role\u0026quot;\n  \n  # Group by environment\n  production: \u0026quot;tags.Environment == \u0026#039;production\u0026#039;\u0026quot;\n  staging: \u0026quot;tags.Environment == \u0026#039;staging\u0026#039;\u0026quot;\n  \n  # Group by availability zone\n  us_west_2a: ec2_placement_availability_zone == \u0026quot;us-west-2a\u0026quot;\n  us_west_2b: ec2_placement_availability_zone == \u0026quot;us-west-2b\u0026quot;\n\nkeyed_groups:\n  # Create groups based on tags\n  - key: tags.Environment\n    prefix: env\n  - key: tags.Role  \n    prefix: role\n  - key: ec2_instance_type\n    prefix: type\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"ansible-vault-security\" class=\"mobile-header\"\u003eAnsible Vault Security\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create strong vault password\nopenssl rand -base64 32 \u0026gt; ~/.ansible_vault_pass\nchmod 600 ~/.ansible_vault_pass\n\n# Create encrypted vault file for secrets\nansible-vault create group_vars/all/vault.yml\n# Enter secure passwords and API keys:\n# vault_mysql_root_password: your_secure_mysql_password\n# vault_grafana_admin_password: your_secure_grafana_password  \n# vault_ssl_private_key: |\n#   -----BEGIN PRIVATE KEY-----\n#   your_private_key_content\n#   -----END PRIVATE KEY-----\n\n# Create non-encrypted variables file\ncat \u0026gt; group_vars/all/vars.yml \u0026lt;\u0026lt;EOF\n# Non-sensitive variables\nmysql_port: 3306\nnginx_port: 80\ngrafana_port: 3000\nprometheus_port: 9090\n\n# Reference vault variables\nmysql_root_password: \u0026quot;{{ vault_mysql_root_password }}\u0026quot;\ngrafana_admin_password: \u0026quot;{{ vault_grafana_admin_password }}\u0026quot;\n\n# SSL configuration\nssl_certificate_path: /etc/ssl/certs/server.crt\nssl_private_key_path: /etc/ssl/private/server.key\nssl_private_key_content: \u0026quot;{{ vault_ssl_private_key }}\u0026quot;\n\n# Security settings\nansible_ssh_common_args: \u0026#039;-o StrictHostKeyChecking=yes -o UserKnownHostsFile=~/.ssh/known_hosts\u0026#039;\nansible_become_method: sudo\nansible_become_user: root\nEOF\n\n# Edit vault file\nansible-vault edit group_vars/all/vault.yml\n\n# View vault file (read-only)\nansible-vault view group_vars/all/vault.yml\n\n# Change vault password\nansible-vault rekey group_vars/all/vault.yml\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"comprehensive-playbooks\" class=\"mobile-header\"\u003eComprehensive Playbooks\u003c/h2\u003e\n\u003ch3 id=\"system-hardening-playbook\" class=\"mobile-header\"\u003eSystem Hardening Playbook\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/system-hardening.yml \u0026lt;\u0026lt;EOF\n---\n- name: System Security Hardening\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    security_packages:\n      - fail2ban\n      - ufw\n      - aide\n      - chkrootkit\n      - rkhunter\n      - clamav\n      - lynis\n    \n    disabled_services:\n      - telnet\n      - rsh\n      - rlogin\n      - tftp\n      - talk\n      - finger\n\n  pre_tasks:\n    - name: Update package cache\n      package:\n        update_cache: yes\n        cache_valid_time: 3600\n      when: ansible_os_family in [\u0026quot;Debian\u0026quot;, \u0026quot;RedHat\u0026quot;]\n\n  tasks:\n    # System updates\n    - name: Upgrade all packages\n      package:\n        name: \u0026quot;*\u0026quot;\n        state: latest\n      when: ansible_os_family == \u0026quot;RedHat\u0026quot;\n\n    - name: Upgrade all packages (Debian/Ubuntu)\n      apt:\n        upgrade: dist\n        autoremove: yes\n        autoclean: yes\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    # Install security packages\n    - name: Install security packages\n      package:\n        name: \u0026quot;{{ security_packages }}\u0026quot;\n        state: present\n\n    # User security\n    - name: Create ansible user with limited privileges\n      user:\n        name: ansible\n        groups: sudo\n        shell: /bin/bash\n        create_home: yes\n        generate_ssh_key: yes\n        ssh_key_bits: 4096\n        ssh_key_type: rsa\n\n    - name: Configure sudo for ansible user\n      lineinfile:\n        path: /etc/sudoers.d/ansible\n        line: \u0026#039;ansible ALL=(ALL) NOPASSWD:ALL\u0026#039;\n        create: yes\n        mode: \u0026#039;0440\u0026#039;\n        validate: \u0026#039;visudo -cf %s\u0026#039;\n\n    # SSH hardening\n    - name: Configure SSH security\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: \u0026quot;{{ item.regexp }}\u0026quot;\n        line: \u0026quot;{{ item.line }}\u0026quot;\n        backup: yes\n      loop:\n        - { regexp: \u0026#039;^#?PermitRootLogin\u0026#039;, line: \u0026#039;PermitRootLogin no\u0026#039; }\n        - { regexp: \u0026#039;^#?PasswordAuthentication\u0026#039;, line: \u0026#039;PasswordAuthentication no\u0026#039; }\n        - { regexp: \u0026#039;^#?X11Forwarding\u0026#039;, line: \u0026#039;X11Forwarding no\u0026#039; }\n        - { regexp: \u0026#039;^#?MaxAuthTries\u0026#039;, line: \u0026#039;MaxAuthTries 3\u0026#039; }\n        - { regexp: \u0026#039;^#?ClientAliveInterval\u0026#039;, line: \u0026#039;ClientAliveInterval 300\u0026#039; }\n        - { regexp: \u0026#039;^#?ClientAliveCountMax\u0026#039;, line: \u0026#039;ClientAliveCountMax 0\u0026#039; }\n        - { regexp: \u0026#039;^#?Protocol\u0026#039;, line: \u0026#039;Protocol 2\u0026#039; }\n        - { regexp: \u0026#039;^#?LogLevel\u0026#039;, line: \u0026#039;LogLevel VERBOSE\u0026#039; }\n      notify: restart ssh\n\n    # Firewall configuration\n    - name: Configure UFW firewall (Debian/Ubuntu)\n      ufw:\n        state: enabled\n        policy: deny\n        direction: incoming\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    - name: Allow SSH through UFW\n      ufw:\n        rule: allow\n        port: 22\n        proto: tcp\n        comment: \u0026#039;SSH access\u0026#039;\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    - name: Configure firewalld (RHEL/CentOS/Fedora)\n      firewalld:\n        state: enabled\n        permanent: yes\n        immediate: yes\n      when: ansible_os_family == \u0026quot;RedHat\u0026quot;\n\n    - name: Allow SSH through firewalld\n      firewalld:\n        service: ssh\n        permanent: yes\n        state: enabled\n        immediate: yes\n      when: ansible_os_family == \u0026quot;RedHat\u0026quot;\n\n    # Disable unnecessary services\n    - name: Disable unnecessary services\n      systemd:\n        name: \u0026quot;{{ item }}\u0026quot;\n        enabled: no\n        state: stopped\n      loop: \u0026quot;{{ disabled_services }}\u0026quot;\n      ignore_errors: yes\n\n    # File system security\n    - name: Set proper permissions on sensitive files\n      file:\n        path: \u0026quot;{{ item.path }}\u0026quot;\n        mode: \u0026quot;{{ item.mode }}\u0026quot;\n        owner: root\n        group: root\n      loop:\n        - { path: \u0026#039;/etc/passwd\u0026#039;, mode: \u0026#039;0644\u0026#039; }\n        - { path: \u0026#039;/etc/shadow\u0026#039;, mode: \u0026#039;0640\u0026#039; }\n        - { path: \u0026#039;/etc/group\u0026#039;, mode: \u0026#039;0644\u0026#039; }\n        - { path: \u0026#039;/etc/gshadow\u0026#039;, mode: \u0026#039;0640\u0026#039; }\n        - { path: \u0026#039;/etc/ssh/sshd_config\u0026#039;, mode: \u0026#039;0600\u0026#039; }\n\n    # Kernel security parameters\n    - name: Configure kernel security parameters\n      sysctl:\n        name: \u0026quot;{{ item.key }}\u0026quot;\n        value: \u0026quot;{{ item.value }}\u0026quot;\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: \u0026#039;net.ipv4.ip_forward\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.send_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.send_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.accept_source_route\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.accept_source_route\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.accept_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.accept_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.secure_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.secure_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.log_martians\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.log_martians\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;kernel.randomize_va_space\u0026#039;, value: \u0026#039;2\u0026#039; }\n\n    # Configure fail2ban\n    - name: Configure fail2ban for SSH protection\n      template:\n        src: templates/fail2ban-jail.local.j2\n        dest: /etc/fail2ban/jail.local\n        backup: yes\n      notify: restart fail2ban\n\n  handlers:\n    - name: restart ssh\n      service:\n        name: \u0026quot;{{ \u0026#039;ssh\u0026#039; if ansible_os_family == \u0026#039;Debian\u0026#039; else \u0026#039;sshd\u0026#039; }}\u0026quot;\n        state: restarted\n\n    - name: restart fail2ban\n      service:\n        name: fail2ban\n        state: restarted\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"application-deployment-playbook\" class=\"mobile-header\"\u003eApplication Deployment Playbook\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/web-application-deployment.yml \u0026lt;\u0026lt;EOF\n---\n- name: Deploy Web Application Stack\n  hosts: webservers\n  become: yes\n  serial: \u0026quot;25%\u0026quot;  # Rolling deployment\n  max_fail_percentage: 10\n  vars:\n    app_name: mywebapp\n    app_version: \u0026quot;{{ app_version | default(\u0026#039;latest\u0026#039;) }}\u0026quot;\n    app_port: 3000\n    nginx_workers: \u0026quot;{{ ansible_processor_cores }}\u0026quot;\n    \n  pre_tasks:\n    - name: Check if maintenance mode file exists\n      stat:\n        path: /var/www/html/maintenance.html\n      register: maintenance_mode\n\n    - name: Fail if in maintenance mode\n      fail:\n        msg: \u0026quot;Server is in maintenance mode\u0026quot;\n      when: maintenance_mode.stat.exists and not force_deployment | default(false)\n\n  tasks:\n    # Application deployment\n    - name: Create application user\n      user:\n        name: \u0026quot;{{ app_name }}\u0026quot;\n        system: yes\n        shell: /bin/false\n        home: \u0026quot;/opt/{{ app_name }}\u0026quot;\n        create_home: yes\n\n    - name: Create application directories\n      file:\n        path: \u0026quot;{{ item }}\u0026quot;\n        state: directory\n        owner: \u0026quot;{{ app_name }}\u0026quot;\n        group: \u0026quot;{{ app_name }}\u0026quot;\n        mode: \u0026#039;0755\u0026#039;\n      loop:\n        - \u0026quot;/opt/{{ app_name }}\u0026quot;\n        - \u0026quot;/opt/{{ app_name }}/releases\u0026quot;\n        - \u0026quot;/opt/{{ app_name }}/shared\u0026quot;\n        - \u0026quot;/var/log/{{ app_name }}\u0026quot;\n\n    - name: Download application release\n      get_url:\n        url: \u0026quot;https://releases.example.com/{{ app_name }}/{{ app_version }}/{{ app_name }}-{{ app_version }}.tar.gz\u0026quot;\n        dest: \u0026quot;/tmp/{{ app_name }}-{{ app_version }}.tar.gz\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n        timeout: 300\n      register: download_result\n\n    - name: Extract application\n      unarchive:\n        src: \u0026quot;/tmp/{{ app_name }}-{{ app_version }}.tar.gz\u0026quot;\n        dest: \u0026quot;/opt/{{ app_name }}/releases/\u0026quot;\n        owner: \u0026quot;{{ app_name }}\u0026quot;\n        group: \u0026quot;{{ app_name }}\u0026quot;\n        remote_src: yes\n        creates: \u0026quot;/opt/{{ app_name }}/releases/{{ app_version }}\u0026quot;\n\n    - name: Create symlink to current release\n      file:\n        src: \u0026quot;/opt/{{ app_name }}/releases/{{ app_version }}\u0026quot;\n        dest: \u0026quot;/opt/{{ app_name }}/current\u0026quot;\n        state: link\n        owner: \u0026quot;{{ app_name }}\u0026quot;\n        group: \u0026quot;{{ app_name }}\u0026quot;\n      notify:\n        - reload application\n        - reload nginx\n\n    # Configuration management\n    - name: Deploy application configuration\n      template:\n        src: \u0026quot;templates/{{ app_name }}.conf.j2\u0026quot;\n        dest: \u0026quot;/opt/{{ app_name }}/shared/{{ app_name }}.conf\u0026quot;\n        owner: \u0026quot;{{ app_name }}\u0026quot;\n        group: \u0026quot;{{ app_name }}\u0026quot;\n        mode: \u0026#039;0640\u0026#039;\n        backup: yes\n      notify: reload application\n\n    # Service management\n    - name: Deploy systemd service file\n      template:\n        src: \u0026quot;templates/{{ app_name }}.service.j2\u0026quot;\n        dest: \u0026quot;/etc/systemd/system/{{ app_name }}.service\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n      notify:\n        - daemon reload\n        - restart application\n\n    - name: Enable and start application service\n      systemd:\n        name: \u0026quot;{{ app_name }}\u0026quot;\n        enabled: yes\n        state: started\n        daemon_reload: yes\n\n    # Health check\n    - name: Wait for application to be ready\n      uri:\n        url: \u0026quot;http://localhost:{{ app_port }}/health\u0026quot;\n        method: GET\n        status_code: 200\n      retries: 30\n      delay: 10\n\n    # Cleanup old releases\n    - name: Clean up old releases (keep last 3)\n      shell: |\n        cd /opt/{{ app_name }}/releases\n        ls -t | tail -n +4 | xargs rm -rf\n      args:\n        executable: /bin/bash\n\n  post_tasks:\n    - name: Verify application is running\n      uri:\n        url: \u0026quot;http://{{ ansible_default_ipv4.address }}:{{ app_port }}/health\u0026quot;\n        method: GET\n        status_code: 200\n      delegate_to: localhost\n\n    - name: Log deployment success\n      lineinfile:\n        path: \u0026quot;/var/log/{{ app_name }}/deployments.log\u0026quot;\n        line: \u0026quot;{{ ansible_date_time.iso8601 }} - Successfully deployed {{ app_version }} to {{ inventory_hostname }}\u0026quot;\n        create: yes\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart application\n      systemd:\n        name: \u0026quot;{{ app_name }}\u0026quot;\n        state: restarted\n\n    - name: reload application\n      systemd:\n        name: \u0026quot;{{ app_name }}\u0026quot;\n        state: reloaded\n\n    - name: reload nginx\n      service:\n        name: nginx\n        state: reloaded\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"infrastructure-as-code-playbook\" class=\"mobile-header\"\u003eInfrastructure as Code Playbook\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/infrastructure-provisioning.yml \u0026lt;\u0026lt;EOF\n---\n- name: Infrastructure Provisioning and Configuration\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  vars:\n    base_packages:\n      Debian:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n      RedHat:\n        - curl\n        - wget\n        - vim\n        - htop\n        - git\n        - python3\n        - python3-pip\n        - unzip\n        - tree\n        - epel-release\n\n  tasks:\n    # System preparation\n    - name: Set hostname\n      hostname:\n        name: \u0026quot;{{ inventory_hostname }}\u0026quot;\n\n    - name: Update /etc/hosts\n      lineinfile:\n        path: /etc/hosts\n        line: \u0026quot;{{ ansible_default_ipv4.address }} {{ inventory_hostname }}\u0026quot;\n        backup: yes\n\n    # Package management\n    - name: Install base packages\n      package:\n        name: \u0026quot;{{ base_packages[ansible_os_family] | default(base_packages[\u0026#039;Debian\u0026#039;]) }}\u0026quot;\n        state: present\n\n    # Time synchronization\n    - name: Install and configure NTP\n      package:\n        name: \u0026quot;{{ \u0026#039;ntp\u0026#039; if ansible_os_family == \u0026#039;Debian\u0026#039; else \u0026#039;chrony\u0026#039; }}\u0026quot;\n        state: present\n\n    - name: Start and enable time synchronization\n      service:\n        name: \u0026quot;{{ \u0026#039;ntp\u0026#039; if ansible_os_family == \u0026#039;Debian\u0026#039; else \u0026#039;chronyd\u0026#039; }}\u0026quot;\n        state: started\n        enabled: yes\n\n    # Log management\n    - name: Configure logrotate for application logs\n      template:\n        src: templates/app-logrotate.j2\n        dest: /etc/logrotate.d/applications\n        mode: \u0026#039;0644\u0026#039;\n\n    # Monitoring agent installation\n    - name: Install Node Exporter for Prometheus monitoring\n      get_url:\n        url: \u0026quot;https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz\u0026quot;\n        dest: /tmp/node_exporter.tar.gz\n        mode: \u0026#039;0644\u0026#039;\n\n    - name: Extract Node Exporter\n      unarchive:\n        src: /tmp/node_exporter.tar.gz\n        dest: /tmp\n        remote_src: yes\n\n    - name: Copy Node Exporter binary\n      copy:\n        src: /tmp/node_exporter-1.6.1.linux-amd64/node_exporter\n        dest: /usr/local/bin/node_exporter\n        mode: \u0026#039;0755\u0026#039;\n        owner: root\n        group: root\n        remote_src: yes\n\n    - name: Create node_exporter systemd service\n      template:\n        src: templates/node_exporter.service.j2\n        dest: /etc/systemd/system/node_exporter.service\n        mode: \u0026#039;0644\u0026#039;\n      notify:\n        - daemon reload\n        - restart node_exporter\n\n    # Security configuration\n    - name: Configure kernel parameters for security\n      sysctl:\n        name: \u0026quot;{{ item.key }}\u0026quot;\n        value: \u0026quot;{{ item.value }}\u0026quot;\n        sysctl_set: yes\n        state: present\n        reload: yes\n      loop:\n        - { key: \u0026#039;kernel.dmesg_restrict\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;kernel.kptr_restrict\u0026#039;, value: \u0026#039;2\u0026#039; }\n        - { key: \u0026#039;kernel.yama.ptrace_scope\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.log_martians\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.log_martians\u0026#039;, value: \u0026#039;1\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.all.send_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n        - { key: \u0026#039;net.ipv4.conf.default.send_redirects\u0026#039;, value: \u0026#039;0\u0026#039; }\n\n    # File integrity monitoring\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \u0026quot;AIDE integrity check\u0026quot;\n        minute: \u0026quot;0\u0026quot;\n        hour: \u0026quot;3\u0026quot;\n        job: \u0026quot;/usr/bin/aide --check\u0026quot;\n        user: root\n\n  handlers:\n    - name: daemon reload\n      systemd:\n        daemon_reload: yes\n\n    - name: restart node_exporter\n      service:\n        name: node_exporter\n        state: restarted\n        enabled: yes\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"advanced-role-development\" class=\"mobile-header\"\u003eAdvanced Role Development\u003c/h2\u003e\n\u003ch3 id=\"comprehensive-nginx-role\" class=\"mobile-header\"\u003eComprehensive NGINX Role\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create NGINX role structure\nansible-galaxy init roles/nginx\n\n# Main tasks\ncat \u0026gt; roles/nginx/tasks/main.yml \u0026lt;\u0026lt;EOF\n---\n# NGINX Installation and Configuration Role\n- name: Include OS-specific variables\n  include_vars: \u0026quot;{{ ansible_os_family }}.yml\u0026quot;\n\n- name: Install NGINX\n  include_tasks: \u0026quot;install-{{ ansible_os_family }}.yml\u0026quot;\n\n- name: Create NGINX directories\n  file:\n    path: \u0026quot;{{ item }}\u0026quot;\n    state: directory\n    owner: root\n    group: root\n    mode: \u0026#039;0755\u0026#039;\n  loop:\n    - /etc/nginx/sites-available\n    - /etc/nginx/sites-enabled\n    - /etc/nginx/conf.d\n    - /var/log/nginx\n    - /var/cache/nginx\n\n- name: Generate DH parameters\n  openssl_dhparam:\n    path: /etc/ssl/certs/dhparam.pem\n    size: 2048\n  when: nginx_ssl_enabled | default(false)\n\n- name: Deploy NGINX main configuration\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n    backup: yes\n    validate: \u0026#039;nginx -t -c %s\u0026#039;\n  notify: reload nginx\n\n- name: Deploy virtual host configurations\n  template:\n    src: vhost.conf.j2\n    dest: \u0026quot;/etc/nginx/sites-available/{{ item.name }}.conf\u0026quot;\n    backup: yes\n  loop: \u0026quot;{{ nginx_vhosts | default([]) }}\u0026quot;\n  notify: reload nginx\n\n- name: Enable virtual hosts\n  file:\n    src: \u0026quot;/etc/nginx/sites-available/{{ item.name }}.conf\u0026quot;\n    dest: \u0026quot;/etc/nginx/sites-enabled/{{ item.name }}.conf\u0026quot;\n    state: link\n  loop: \u0026quot;{{ nginx_vhosts | default([]) }}\u0026quot;\n  when: item.enabled | default(true)\n  notify: reload nginx\n\n- name: Remove default site\n  file:\n    path: /etc/nginx/sites-enabled/default\n    state: absent\n  notify: reload nginx\n\n- name: Start and enable NGINX\n  service:\n    name: nginx\n    state: started\n    enabled: yes\n\n- name: Configure log rotation\n  template:\n    src: nginx-logrotate.j2\n    dest: /etc/logrotate.d/nginx\n    mode: \u0026#039;0644\u0026#039;\n\n- name: Setup NGINX monitoring\n  include_tasks: monitoring.yml\n  when: nginx_monitoring_enabled | default(false)\n\n- name: Configure SSL certificates\n  include_tasks: ssl.yml\n  when: nginx_ssl_enabled | default(false)\nEOF\n\n# OS-specific installation tasks\ncat \u0026gt; roles/nginx/tasks/install-Debian.yml \u0026lt;\u0026lt;EOF\n---\n- name: Add NGINX signing key (Debian/Ubuntu)\n  apt_key:\n    url: https://nginx.org/keys/nginx_signing.key\n    state: present\n\n- name: Add NGINX repository (Debian/Ubuntu)\n  apt_repository:\n    repo: \u0026quot;deb https://nginx.org/packages/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx\u0026quot;\n    state: present\n\n- name: Install NGINX (Debian/Ubuntu)\n  apt:\n    name: nginx\n    state: present\n    update_cache: yes\nEOF\n\ncat \u0026gt; roles/nginx/tasks/install-RedHat.yml \u0026lt;\u0026lt;EOF\n---\n- name: Add NGINX repository (RHEL/CentOS)\n  yum_repository:\n    name: nginx\n    description: NGINX Repository\n    baseurl: \u0026quot;https://nginx.org/packages/centos/{{ ansible_distribution_major_version }}/$basearch/\u0026quot;\n    gpgcheck: yes\n    gpgkey: https://nginx.org/keys/nginx_signing.key\n    enabled: yes\n\n- name: Install NGINX (RHEL/CentOS)\n  yum:\n    name: nginx\n    state: present\nEOF\n\n# Variables\ncat \u0026gt; roles/nginx/vars/main.yml \u0026lt;\u0026lt;EOF\n---\nnginx_user: nginx\nnginx_worker_processes: auto\nnginx_worker_connections: 1024\nnginx_keepalive_timeout: 65\nnginx_ssl_enabled: false\nnginx_monitoring_enabled: true\n\nnginx_security_headers:\n  - \u0026quot;add_header X-Frame-Options SAMEORIGIN always;\u0026quot;\n  - \u0026quot;add_header X-Content-Type-Options nosniff always;\u0026quot;\n  - \u0026quot;add_header X-XSS-Protection \u0026#039;1; mode=block\u0026#039; always;\u0026quot;\n  - \u0026quot;add_header Strict-Transport-Security \u0026#039;max-age=31536000; includeSubDomains\u0026#039; always;\u0026quot;\n\nnginx_default_vhost:\n  name: default\n  listen: 80\n  server_name: \u0026quot;_\u0026quot;\n  root: /var/www/html\n  index: index.html\n  enabled: false\nEOF\n\n# Templates\ncat \u0026gt; roles/nginx/templates/nginx.conf.j2 \u0026lt;\u0026lt;EOF\nuser {{ nginx_user }};\nworker_processes {{ nginx_worker_processes }};\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections {{ nginx_worker_connections }};\n    use epoll;\n    multi_accept on;\n}\n\nhttp {\n    # Basic settings\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout {{ nginx_keepalive_timeout }};\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # SSL configuration\n{% if nginx_ssl_enabled %}\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers off;\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n{% endif %}\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types\n        application/javascript\n        application/json\n        application/xml\n        text/css\n        text/javascript\n        text/xml\n        text/plain;\n\n    # Security headers\n{% for header in nginx_security_headers %}\n    {{ header }}\n{% endfor %}\n\n    # Logging\n    log_format main \u0026#039;\\$remote_addr - \\$remote_user [\\$time_local] \u0026quot;\\$request\u0026quot; \u0026#039;\n                    \u0026#039;\\$status \\$body_bytes_sent \u0026quot;\\$http_referer\u0026quot; \u0026#039;\n                    \u0026#039;\u0026quot;\\$http_user_agent\u0026quot; \u0026quot;\\$http_x_forwarded_for\u0026quot;\u0026#039;;\n\n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log;\n\n    # Rate limiting\n    limit_req_zone \\$binary_remote_addr zone=login:10m rate=10r/m;\n    limit_conn_zone \\$binary_remote_addr zone=addr:10m;\n\n    # Include configurations\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\nEOF\n\n# Handlers\ncat \u0026gt; roles/nginx/handlers/main.yml \u0026lt;\u0026lt;EOF\n---\n- name: restart nginx\n  service:\n    name: nginx\n    state: restarted\n\n- name: reload nginx\n  service:\n    name: nginx\n    state: reloaded\n\n- name: validate nginx config\n  command: nginx -t\n  changed_when: false\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"security-and-compliance\" class=\"mobile-header\"\u003eSecurity and Compliance\u003c/h2\u003e\n\u003ch3 id=\"ansible-security-scanner-integration\" class=\"mobile-header\"\u003eAnsible Security Scanner Integration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create security scanning playbook\ncat \u0026gt; playbooks/security-scan.yml \u0026lt;\u0026lt;EOF\n---\n- name: Security Compliance Scanning\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    scan_results_dir: \u0026quot;/tmp/security-scans\u0026quot;\n    \n  tasks:\n    - name: Create scan results directory\n      file:\n        path: \u0026quot;{{ scan_results_dir }}\u0026quot;\n        state: directory\n        mode: \u0026#039;0755\u0026#039;\n\n    # CIS benchmark scanning\n    - name: Download CIS benchmark script\n      get_url:\n        url: \u0026quot;https://github.com/dev-sec/cis-dil-benchmark/archive/master.zip\u0026quot;\n        dest: \u0026quot;/tmp/cis-benchmark.zip\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n\n    - name: Run CIS benchmark scan\n      shell: |\n        cd /tmp\n        unzip -o cis-benchmark.zip\n        cd cis-dil-benchmark-master\n        bash cis_ubuntu2204.sh \u0026gt; {{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\n      args:\n        creates: \u0026quot;{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\u0026quot;\n\n    # Lynis security audit\n    - name: Install Lynis\n      package:\n        name: lynis\n        state: present\n\n    - name: Run Lynis security audit\n      command: lynis audit system --quiet --cronjob\n      register: lynis_result\n      changed_when: false\n\n    - name: Save Lynis results\n      copy:\n        content: \u0026quot;{{ lynis_result.stdout }}\u0026quot;\n        dest: \u0026quot;{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n\n    # OpenSCAP compliance scanning\n    - name: Install OpenSCAP (RHEL/CentOS)\n      package:\n        name:\n          - openscap-scanner\n          - scap-security-guide\n        state: present\n      when: ansible_os_family == \u0026quot;RedHat\u0026quot;\n\n    - name: Install OpenSCAP (Debian/Ubuntu)\n      package:\n        name:\n          - libopenscap8\n          - ssg-debian\n        state: present\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    - name: Run OpenSCAP scan\n      shell: |\n        oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard \\\n          --results {{ scan_results_dir }}/oscap-results-{{ inventory_hostname }}.xml \\\n          --report {{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html \\\n          /usr/share/xml/scap/ssg/content/ssg-{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}-xccdf.xml\n      ignore_errors: yes\n      when: ansible_os_family in [\u0026quot;RedHat\u0026quot;, \u0026quot;Debian\u0026quot;]\n\n    # Vulnerability scanning with Trivy\n    - name: Install Trivy vulnerability scanner\n      shell: |\n        curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin\n      args:\n        creates: /usr/local/bin/trivy\n\n    - name: Run Trivy filesystem scan\n      shell: |\n        trivy fs --format json --output {{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json /\n      ignore_errors: yes\n\n    # Collect scan results\n    - name: Fetch scan results to control machine\n      fetch:\n        src: \u0026quot;{{ item }}\u0026quot;\n        dest: \u0026quot;./security-reports/{{ inventory_hostname }}/\u0026quot;\n        flat: yes\n      loop:\n        - \u0026quot;{{ scan_results_dir }}/cis-scan-{{ inventory_hostname }}.txt\u0026quot;\n        - \u0026quot;{{ scan_results_dir }}/lynis-scan-{{ inventory_hostname }}.txt\u0026quot;\n        - \u0026quot;{{ scan_results_dir }}/oscap-report-{{ inventory_hostname }}.html\u0026quot;\n        - \u0026quot;{{ scan_results_dir }}/trivy-scan-{{ inventory_hostname }}.json\u0026quot;\n      ignore_errors: yes\n      delegate_to: localhost\n\n  post_tasks:\n    - name: Generate compliance summary\n      template:\n        src: templates/compliance-summary.j2\n        dest: \u0026quot;{{ scan_results_dir }}/compliance-summary-{{ inventory_hostname }}.txt\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"ansible-awxtower-integration\" class=\"mobile-header\"\u003eAnsible AWX/Tower Integration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Ansible AWX (open source)\ncat \u0026gt; playbooks/install-awx.yml \u0026lt;\u0026lt;EOF\n---\n- name: Install Ansible AWX\n  hosts: localhost\n  connection: local\n  become: yes\n  vars:\n    awx_namespace: awx\n    awx_admin_user: admin\n    awx_admin_password: \u0026quot;{{ vault_awx_admin_password }}\u0026quot;\n\n  tasks:\n    - name: Install prerequisite packages\n      package:\n        name:\n          - git\n          - curl\n          - docker.io\n          - docker-compose\n        state: present\n\n    - name: Clone AWX repository\n      git:\n        repo: https://github.com/ansible/awx.git\n        dest: /opt/awx\n        version: devel\n\n    - name: Create AWX Docker inventory\n      template:\n        src: templates/awx-docker-inventory.j2\n        dest: /opt/awx/installer/inventory\n        mode: \u0026#039;0644\u0026#039;\n\n    - name: Install AWX using Ansible\n      shell: ansible-playbook -i inventory install.yml\n      args:\n        chdir: /opt/awx/installer\n      environment:\n        ANSIBLE_HOST_KEY_CHECKING: False\n\n    - name: Wait for AWX to be ready\n      uri:\n        url: \u0026quot;http://localhost:80/api/v2/ping/\u0026quot;\n        method: GET\n      retries: 30\n      delay: 10\n\n    - name: Configure AWX organizations and projects\n      uri:\n        url: \u0026quot;http://localhost:80/api/v2/organizations/\u0026quot;\n        method: POST\n        user: \u0026quot;{{ awx_admin_user }}\u0026quot;\n        password: \u0026quot;{{ awx_admin_password }}\u0026quot;\n        force_basic_auth: yes\n        body_format: json\n        body:\n          name: \u0026quot;Production\u0026quot;\n          description: \u0026quot;Production environment organization\u0026quot;\n        status_code: [200, 201, 409]\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"multi-cloud-automation\" class=\"mobile-header\"\u003eMulti-Cloud Automation\u003c/h2\u003e\n\u003ch3 id=\"aws-infrastructure-automation\" class=\"mobile-header\"\u003eAWS Infrastructure Automation\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/aws-infrastructure.yml \u0026lt;\u0026lt;EOF\n---\n- name: AWS Infrastructure Automation\n  hosts: localhost\n  connection: local\n  gather_facts: no\n  vars:\n    aws_region: \u0026quot;{{ aws_region | default(\u0026#039;us-west-2\u0026#039;) }}\u0026quot;\n    vpc_cidr: \u0026quot;{{ vpc_cidr | default(\u0026#039;10.0.0.0/16\u0026#039;) }}\u0026quot;\n    environment: \u0026quot;{{ environment | default(\u0026#039;production\u0026#039;) }}\u0026quot;\n\n  tasks:\n    # VPC Creation\n    - name: Create VPC\n      amazon.aws.ec2_vpc_info:\n        filters:\n          \u0026quot;tag:Name\u0026quot;: \u0026quot;{{ environment }}-vpc\u0026quot;\n        region: \u0026quot;{{ aws_region }}\u0026quot;\n      register: existing_vpc\n\n    - name: Create new VPC if not exists\n      amazon.aws.ec2_vpc_net:\n        name: \u0026quot;{{ environment }}-vpc\u0026quot;\n        cidr_block: \u0026quot;{{ vpc_cidr }}\u0026quot;\n        region: \u0026quot;{{ aws_region }}\u0026quot;\n        state: present\n        dns_hostnames: yes\n        dns_support: yes\n        tags:\n          Environment: \u0026quot;{{ environment }}\u0026quot;\n          ManagedBy: ansible\n      register: vpc\n      when: existing_vpc.vpcs | length == 0\n\n    # Security Groups\n    - name: Create web security group\n      amazon.aws.ec2_group:\n        name: \u0026quot;{{ environment }}-web-sg\u0026quot;\n        description: \u0026quot;Security group for web servers\u0026quot;\n        vpc_id: \u0026quot;{{ vpc.vpc.id if vpc.vpc is defined else existing_vpc.vpcs[0].vpc_id }}\u0026quot;\n        region: \u0026quot;{{ aws_region }}\u0026quot;\n        rules:\n          - proto: tcp\n            ports:\n              - 80\n              - 443\n            cidr_ip: 0.0.0.0/0\n            rule_desc: \u0026quot;HTTP and HTTPS access\u0026quot;\n          - proto: tcp\n            ports:\n              - 22\n            group_id: \u0026quot;{{ environment }}-bastion-sg\u0026quot;\n            rule_desc: \u0026quot;SSH from bastion\u0026quot;\n        tags:\n          Environment: \u0026quot;{{ environment }}\u0026quot;\n\n    # Launch EC2 instances\n    - name: Launch web servers\n      amazon.aws.ec2_instance:\n        name: \u0026quot;{{ environment }}-web-{{ item }}\u0026quot;\n        instance_type: t3.medium\n        image_id: ami-0c02fb55956c7d316  # Amazon Linux 2\n        key_name: \u0026quot;{{ ec2_key_name }}\u0026quot;\n        vpc_subnet_id: \u0026quot;{{ web_subnet_id }}\u0026quot;\n        security_groups:\n          - \u0026quot;{{ environment }}-web-sg\u0026quot;\n        region: \u0026quot;{{ aws_region }}\u0026quot;\n        state: running\n        wait: yes\n        wait_timeout: 300\n        user_data: |\n          #!/bin/bash\n          yum update -y\n          yum install -y python3\n        tags:\n          Environment: \u0026quot;{{ environment }}\u0026quot;\n          Role: webserver\n          Ansible: managed\n      loop: \u0026quot;{{ range(1, web_server_count + 1) | list }}\u0026quot;\n      register: web_instances\n\n    # Add instances to inventory\n    - name: Add web servers to inventory\n      add_host:\n        name: \u0026quot;{{ item.instances[0].tags.Name }}\u0026quot;\n        hostname: \u0026quot;{{ item.instances[0].public_ip_address }}\u0026quot;\n        groups: webservers\n        ansible_ssh_private_key_file: \u0026quot;~/.ssh/{{ ec2_key_name }}.pem\u0026quot;\n        ansible_user: ec2-user\n      loop: \u0026quot;{{ web_instances.results }}\u0026quot;\n      changed_when: false\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"kubernetes-cluster-management\" class=\"mobile-header\"\u003eKubernetes Cluster Management\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/k8s-cluster-management.yml \u0026lt;\u0026lt;EOF\n---\n- name: Kubernetes Cluster Management with Ansible\n  hosts: k8s_masters\n  become: yes\n  serial: 1\n  vars:\n    k8s_version: \u0026quot;1.28.2\u0026quot;\n    containerd_version: \u0026quot;1.6.24\u0026quot;\n    cni_version: \u0026quot;1.3.0\u0026quot;\n\n  tasks:\n    # Pre-flight checks\n    - name: Check system requirements\n      assert:\n        that:\n          - ansible_memtotal_mb \u0026gt;= 1700\n          - ansible_processor_cores \u0026gt;= 2\n        fail_msg: \u0026quot;System doesn\u0026#039;t meet minimum requirements\u0026quot;\n\n    - name: Verify connectivity to all nodes\n      ping:\n      delegate_to: \u0026quot;{{ item }}\u0026quot;\n      loop: \u0026quot;{{ groups[\u0026#039;k8s_all\u0026#039;] }}\u0026quot;\n\n    # Container runtime setup\n    - name: Install containerd\n      include_role:\n        name: containerd\n      vars:\n        containerd_version: \u0026quot;{{ containerd_version }}\u0026quot;\n\n    # Kubernetes installation\n    - name: Install Kubernetes components\n      include_role:\n        name: kubernetes\n      vars:\n        kubernetes_version: \u0026quot;{{ k8s_version }}\u0026quot;\n\n    # Cluster initialization\n    - name: Initialize Kubernetes cluster\n      shell: |\n        kubeadm init \\\n          --pod-network-cidr=10.244.0.0/16 \\\n          --service-cidr=10.96.0.0/12 \\\n          --apiserver-advertise-address={{ ansible_default_ipv4.address }} \\\n          --node-name={{ inventory_hostname }}\n      args:\n        creates: /etc/kubernetes/admin.conf\n      register: kubeadm_init\n\n    - name: Create .kube directory\n      file:\n        path: \u0026quot;{{ ansible_env.HOME }}/.kube\u0026quot;\n        state: directory\n        mode: \u0026#039;0755\u0026#039;\n\n    - name: Copy admin.conf to user\u0026#039;s kube config\n      copy:\n        src: /etc/kubernetes/admin.conf\n        dest: \u0026quot;{{ ansible_env.HOME }}/.kube/config\u0026quot;\n        owner: \u0026quot;{{ ansible_user }}\u0026quot;\n        group: \u0026quot;{{ ansible_user }}\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n        remote_src: yes\n\n    # Network plugin installation\n    - name: Install Flannel CNI\n      shell: kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n      environment:\n        KUBECONFIG: \u0026quot;{{ ansible_env.HOME }}/.kube/config\u0026quot;\n\n    # Join worker nodes\n    - name: Get join command\n      shell: kubeadm token create --print-join-command\n      register: join_command\n      when: inventory_hostname in groups[\u0026#039;k8s_masters\u0026#039;][0]\n\n    - name: Join worker nodes to cluster\n      shell: \u0026quot;{{ hostvars[groups[\u0026#039;k8s_masters\u0026#039;][0]][\u0026#039;join_command\u0026#039;].stdout }}\u0026quot;\n      when: inventory_hostname in groups[\u0026#039;k8s_workers\u0026#039;]\n\n  post_tasks:\n    - name: Verify cluster status\n      shell: kubectl get nodes\n      environment:\n        KUBECONFIG: \u0026quot;{{ ansible_env.HOME }}/.kube/config\u0026quot;\n      register: cluster_status\n      when: inventory_hostname in groups[\u0026#039;k8s_masters\u0026#039;][0]\n\n    - name: Display cluster status\n      debug:\n        var: cluster_status.stdout_lines\n      when: inventory_hostname in groups[\u0026#039;k8s_masters\u0026#039;][0]\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"performance-optimization-and-scaling\" class=\"mobile-header\"\u003ePerformance Optimization and Scaling\u003c/h2\u003e\n\u003ch3 id=\"parallel-execution-strategies\" class=\"mobile-header\"\u003eParallel Execution Strategies\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create high-performance playbook configuration\ncat \u0026gt; playbooks/high-performance-deployment.yml \u0026lt;\u0026lt;EOF\n---\n- name: High-Performance Deployment\n  hosts: all\n  become: yes\n  strategy: free  # Parallel execution\n  serial: \u0026quot;30%\u0026quot;   # Process 30% of hosts at a time\n  max_fail_percentage: 10\n  gather_facts: yes\n  fact_caching: smart\n  vars:\n    deployment_batch_size: 10\n    max_concurrent_tasks: 50\n\n  pre_tasks:\n    - name: Check system load\n      shell: uptime | awk \u0026#039;{print $(NF-2)}\u0026#039; | sed \u0026#039;s/,//\u0026#039;\n      register: system_load\n      changed_when: false\n\n    - name: Skip high-load systems\n      meta: end_host\n      when: system_load.stdout | float \u0026gt; 5.0\n\n  tasks:\n    - name: Update packages with retries\n      package:\n        name: \u0026quot;*\u0026quot;\n        state: latest\n      retries: 3\n      delay: 30\n      async: 300\n      poll: 10\n\n    - name: Deploy configuration files in parallel\n      template:\n        src: \u0026quot;{{ item.src }}\u0026quot;\n        dest: \u0026quot;{{ item.dest }}\u0026quot;\n        mode: \u0026quot;{{ item.mode | default(\u0026#039;0644\u0026#039;) }}\u0026quot;\n        backup: yes\n      loop:\n        - { src: \u0026quot;nginx.conf.j2\u0026quot;, dest: \u0026quot;/etc/nginx/nginx.conf\u0026quot; }\n        - { src: \u0026quot;mysql.cnf.j2\u0026quot;, dest: \u0026quot;/etc/mysql/my.cnf\u0026quot; }\n        - { src: \u0026quot;redis.conf.j2\u0026quot;, dest: \u0026quot;/etc/redis/redis.conf\u0026quot; }\n      async: 120\n      poll: 5\n      register: config_deployment\n\n    - name: Wait for all configuration deployments\n      async_status:\n        jid: \u0026quot;{{ item.ansible_job_id }}\u0026quot;\n      loop: \u0026quot;{{ config_deployment.results }}\u0026quot;\n      when: item.ansible_job_id is defined\n\n  handlers:\n    - name: restart services\n      service:\n        name: \u0026quot;{{ item }}\u0026quot;\n        state: restarted\n      loop:\n        - nginx\n        - mysql\n        - redis\n      listen: \u0026quot;restart all services\u0026quot;\nEOF\n\n# Performance monitoring playbook\ncat \u0026gt; playbooks/performance-monitoring.yml \u0026lt;\u0026lt;EOF\n---\n- name: Performance Monitoring Setup\n  hosts: all\n  become: yes\n  vars:\n    monitoring_tools:\n      - htop\n      - iotop\n      - nethogs\n      - dstat\n      - sysstat\n      - perf\n\n  tasks:\n    - name: Install performance monitoring tools\n      package:\n        name: \u0026quot;{{ monitoring_tools }}\u0026quot;\n        state: present\n\n    - name: Configure system monitoring\n      template:\n        src: templates/sysstat.j2\n        dest: /etc/default/sysstat\n        backup: yes\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    - name: Enable system statistics collection\n      service:\n        name: \u0026quot;{{ \u0026#039;sysstat\u0026#039; if ansible_os_family == \u0026#039;Debian\u0026#039; else \u0026#039;sysstat\u0026#039; }}\u0026quot;\n        enabled: yes\n        state: started\n\n    - name: Create performance monitoring script\n      template:\n        src: templates/performance-monitor.sh.j2\n        dest: /usr/local/bin/performance-monitor.sh\n        mode: \u0026#039;0755\u0026#039;\n\n    - name: Schedule performance monitoring\n      cron:\n        name: \u0026quot;Performance monitoring\u0026quot;\n        minute: \u0026quot;*/5\u0026quot;\n        job: \u0026quot;/usr/local/bin/performance-monitor.sh\u0026quot;\n        user: root\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"testing-and-validation\" class=\"mobile-header\"\u003eTesting and Validation\u003c/h2\u003e\n\u003ch3 id=\"molecule-testing-framework\" class=\"mobile-header\"\u003eMolecule Testing Framework\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Molecule for role testing\npip install molecule[docker] molecule[vagrant] molecule[libvirt]\n\n# Initialize Molecule in role directory\ncd roles/nginx\nmolecule init scenario --driver-name docker\n\n# Create molecule configuration\ncat \u0026gt; molecule/default/molecule.yml \u0026lt;\u0026lt;EOF\n---\ndependency:\n  name: galaxy\ndriver:\n  name: docker\nplatforms:\n  - name: nginx-ubuntu\n    image: ubuntu:22.04\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /lib/systemd/systemd\n    networks:\n      - name: molecule\n  - name: nginx-centos\n    image: centos:8\n    pre_build_image: true\n    privileged: true\n    volumes:\n      - /sys/fs/cgroup:/sys/fs/cgroup:ro\n    command: /usr/sbin/init\n    networks:\n      - name: molecule\nprovisioner:\n  name: ansible\n  config_options:\n    defaults:\n      callbacks_enabled: profile_tasks,timer,yaml\n  inventory:\n    host_vars:\n      nginx-ubuntu:\n        ansible_python_interpreter: /usr/bin/python3\n      nginx-centos:\n        ansible_python_interpreter: /usr/bin/python3\nverifier:\n  name: ansible\nlint: |\n  set -e\n  yamllint .\n  ansible-lint\n  flake8\nEOF\n\n# Create test playbook\ncat \u0026gt; molecule/default/converge.yml \u0026lt;\u0026lt;EOF\n---\n- name: Converge\n  hosts: all\n  become: true\n  tasks:\n    - name: \u0026quot;Include nginx role\u0026quot;\n      include_role:\n        name: nginx\n      vars:\n        nginx_vhosts:\n          - name: default\n            server_name: localhost\n            listen: 80\n            root: /var/www/html\n            enabled: true\nEOF\n\n# Create test verification\ncat \u0026gt; molecule/default/verify.yml \u0026lt;\u0026lt;EOF\n---\n- name: Verify\n  hosts: all\n  gather_facts: false\n  tasks:\n    - name: Check if NGINX is running\n      uri:\n        url: http://localhost\n        method: GET\n      register: nginx_check\n\n    - name: Verify NGINX is responding\n      assert:\n        that:\n          - nginx_check.status == 200\n        fail_msg: \u0026quot;NGINX is not responding correctly\u0026quot;\n\n    - name: Check NGINX configuration\n      shell: nginx -t\n      changed_when: false\n\n    - name: Verify NGINX process\n      shell: pgrep nginx\n      changed_when: false\nEOF\n\n# Run tests\nmolecule test\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"ansible-lint-and-security-scanning\" class=\"mobile-header\"\u003eAnsible Lint and Security Scanning\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Install Ansible Lint\npip install ansible-lint\n\n# Create .ansible-lint configuration\ncat \u0026gt; .ansible-lint \u0026lt;\u0026lt;EOF\n---\nprofile: production\n\nexclude_paths:\n  - .cache/\n  - .github/\n  - molecule/\n  - .venv/\n\nskip_list:\n  - yaml[line-length]  # Allow longer lines for readability\n\nwarn_list:\n  - experimental  # Warn about experimental features\n\n# Custom rules\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments:\n    min-spaces-from-content: 1\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  trailing-spaces: enable\n  truthy:\n    allowed-values: [\u0026#039;true\u0026#039;, \u0026#039;false\u0026#039;, \u0026#039;yes\u0026#039;, \u0026#039;no\u0026#039;]\nEOF\n\n# Create security-focused playbook linting\ncat \u0026gt; .yamllint \u0026lt;\u0026lt;EOF\n---\nextends: default\n\nrules:\n  braces:\n    min-spaces-inside: 0\n    max-spaces-inside: 1\n  brackets:\n    min-spaces-inside: 0\n    max-spaces-inside: 0\n  colons:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  commas:\n    max-spaces-before: 0\n    min-spaces-after: 1\n    max-spaces-after: 1\n  comments: disable\n  comments-indentation: disable\n  document-start: disable\n  empty-lines:\n    max: 2\n    max-start: 0\n    max-end: 1\n  hyphens:\n    max-spaces-after: 1\n  indentation:\n    spaces: 2\n    indent-sequences: true\n    check-multi-line-strings: false\n  key-duplicates: enable\n  line-length:\n    max: 120\n  new-line-at-end-of-file: enable\n  octal-values:\n    forbid-implicit-octal: true\n  trailing-spaces: enable\n  truthy: disable\nEOF\n\n# Run linting\nansible-lint playbooks/\nyamllint .\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"backup-and-disaster-recovery\" class=\"mobile-header\"\u003eBackup and Disaster Recovery\u003c/h2\u003e\n\u003ch3 id=\"comprehensive-backup-automation\" class=\"mobile-header\"\u003eComprehensive Backup Automation\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/backup-automation.yml \u0026lt;\u0026lt;EOF\n---\n- name: Automated Backup System\n  hosts: all\n  become: yes\n  vars:\n    backup_root: /backup\n    backup_retention_days: 30\n    backup_schedule:\n      databases: \u0026quot;0 2 * * *\u0026quot;\n      files: \u0026quot;0 3 * * *\u0026quot;\n      configs: \u0026quot;0 4 * * *\u0026quot;\n\n  tasks:\n    - name: Create backup directories\n      file:\n        path: \u0026quot;{{ backup_root }}/{{ item }}\u0026quot;\n        state: directory\n        mode: \u0026#039;0755\u0026#039;\n        owner: root\n        group: root\n      loop:\n        - databases\n        - files\n        - configs\n        - logs\n\n    # Database backups\n    - name: Create database backup script\n      template:\n        src: templates/mysql-backup.sh.j2\n        dest: /usr/local/bin/mysql-backup.sh\n        mode: \u0026#039;0755\u0026#039;\n      when: \u0026quot;\u0026#039;dbservers\u0026#039; in group_names\u0026quot;\n\n    - name: Schedule database backups\n      cron:\n        name: \u0026quot;MySQL backup\u0026quot;\n        minute: \u0026quot;0\u0026quot;\n        hour: \u0026quot;2\u0026quot;\n        job: \u0026quot;/usr/local/bin/mysql-backup.sh\u0026quot;\n        user: root\n      when: \u0026quot;\u0026#039;dbservers\u0026#039; in group_names\u0026quot;\n\n    # File system backups\n    - name: Create file backup script\n      template:\n        src: templates/file-backup.sh.j2\n        dest: /usr/local/bin/file-backup.sh\n        mode: \u0026#039;0755\u0026#039;\n\n    - name: Schedule file backups\n      cron:\n        name: \u0026quot;File system backup\u0026quot;\n        minute: \u0026quot;0\u0026quot;\n        hour: \u0026quot;3\u0026quot;\n        job: \u0026quot;/usr/local/bin/file-backup.sh\u0026quot;\n        user: root\n\n    # Configuration backups\n    - name: Backup system configurations\n      archive:\n        path:\n          - /etc/nginx\n          - /etc/mysql\n          - /etc/systemd/system\n          - /etc/crontab\n          - /etc/hosts\n          - /etc/fstab\n        dest: \u0026quot;{{ backup_root }}/configs/system-config-{{ ansible_date_time.epoch }}.tar.gz\u0026quot;\n        mode: \u0026#039;0600\u0026#039;\n\n    # Remote backup synchronization\n    - name: Synchronize backups to remote storage\n      synchronize:\n        src: \u0026quot;{{ backup_root }}/\u0026quot;\n        dest: \u0026quot;backup-server.example.com:{{ backup_root }}/{{ inventory_hostname }}/\u0026quot;\n        delete: yes\n        rsync_opts:\n          - \u0026quot;--exclude=*.tmp\u0026quot;\n          - \u0026quot;--compress\u0026quot;\n          - \u0026quot;--archive\u0026quot;\n      when: backup_remote_sync | default(true)\n\n    # Cleanup old backups\n    - name: Clean up old backup files\n      find:\n        paths: \u0026quot;{{ backup_root }}\u0026quot;\n        age: \u0026quot;{{ backup_retention_days }}d\u0026quot;\n        file_type: file\n      register: old_backups\n\n    - name: Remove old backup files\n      file:\n        path: \u0026quot;{{ item.path }}\u0026quot;\n        state: absent\n      loop: \u0026quot;{{ old_backups.files }}\u0026quot;\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"verification-and-monitoring\" class=\"mobile-header\"\u003eVerification and Monitoring\u003c/h2\u003e\n\u003ch3 id=\"cross-platform-system-verification\" class=\"mobile-header\"\u003eCross-Platform System Verification\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create comprehensive verification playbook\ncat \u0026gt; playbooks/system-verification.yml \u0026lt;\u0026lt;EOF\n---\n- name: System Verification and Health Check\n  hosts: all\n  become: yes\n  gather_facts: yes\n  vars:\n    health_checks:\n      - service: nginx\n        port: 80\n        process: nginx\n      - service: mysql\n        port: 3306\n        process: mysqld\n      - service: redis\n        port: 6379\n        process: redis-server\n\n  tasks:\n    # System information gathering\n    - name: Gather system information\n      setup:\n        gather_subset:\n          - all\n          - !facter\n          - !ohai\n\n    # Service verification\n    - name: Check critical services status\n      service_facts:\n\n    - name: Verify services are running\n      assert:\n        that:\n          - \u0026quot;ansible_facts.services[item.service + \u0026#039;.service\u0026#039;].state == \u0026#039;running\u0026#039;\u0026quot;\n        fail_msg: \u0026quot;Service {{ item.service }} is not running\u0026quot;\n        success_msg: \u0026quot;Service {{ item.service }} is healthy\u0026quot;\n      loop: \u0026quot;{{ health_checks }}\u0026quot;\n      when: \u0026quot;item.service + \u0026#039;.service\u0026#039; in ansible_facts.services\u0026quot;\n\n    # Network connectivity tests\n    - name: Test network connectivity\n      wait_for:\n        host: \u0026quot;{{ item.host }}\u0026quot;\n        port: \u0026quot;{{ item.port }}\u0026quot;\n        timeout: 5\n      loop:\n        - { host: \u0026quot;8.8.8.8\u0026quot;, port: 53 }\n        - { host: \u0026quot;1.1.1.1\u0026quot;, port: 53 }\n      ignore_errors: yes\n\n    # Disk space monitoring\n    - name: Check disk space usage\n      shell: df -h | awk \u0026#039;$5 \u0026gt; \u0026quot;85%\u0026quot; {print $0}\u0026#039;\n      register: disk_usage\n      changed_when: false\n      failed_when: disk_usage.stdout != \u0026quot;\u0026quot;\n\n    # Memory usage check\n    - name: Check memory usage\n      shell: free | grep Mem | awk \u0026#039;{printf \u0026quot;%.0f\u0026quot;, $3/$2 * 100.0}\u0026#039;\n      register: memory_usage\n      changed_when: false\n\n    - name: Alert on high memory usage\n      debug:\n        msg: \u0026quot;WARNING: Memory usage is {{ memory_usage.stdout }}%\u0026quot;\n      when: memory_usage.stdout | int \u0026gt; 85\n\n    # Security verification\n    - name: Check for failed login attempts\n      shell: grep \u0026quot;Failed password\u0026quot; /var/log/auth.log | tail -10\n      register: failed_logins\n      changed_when: false\n      ignore_errors: yes\n      when: ansible_os_family == \u0026quot;Debian\u0026quot;\n\n    - name: Check firewall status\n      shell: |\n        if command -v ufw \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then\n          ufw status\n        elif command -v firewall-cmd \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then\n          firewall-cmd --state\n        else\n          echo \u0026quot;No supported firewall found\u0026quot;\n        fi\n      register: firewall_status\n      changed_when: false\n\n  post_tasks:\n    - name: Generate system health report\n      template:\n        src: templates/health-report.j2\n        dest: \u0026quot;/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\u0026quot;\n        mode: \u0026#039;0644\u0026#039;\n\n    - name: Fetch health reports\n      fetch:\n        src: \u0026quot;/tmp/health-report-{{ inventory_hostname }}-{{ ansible_date_time.epoch }}.txt\u0026quot;\n        dest: \u0026quot;./reports/\u0026quot;\n        flat: yes\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"continuous-compliance-monitoring\" class=\"mobile-header\"\u003eContinuous Compliance Monitoring\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; playbooks/compliance-monitoring.yml \u0026lt;\u0026lt;EOF\n---\n- name: Continuous Compliance Monitoring\n  hosts: all\n  become: yes\n  vars:\n    compliance_standards:\n      - cis\n      - pci_dss\n      - soc2\n      - hipaa\n    \n    audit_log_paths:\n      - /var/log/auth.log\n      - /var/log/syslog\n      - /var/log/audit/audit.log\n\n  tasks:\n    # Install audit tools\n    - name: Install audit daemon\n      package:\n        name: \u0026quot;{{ \u0026#039;auditd\u0026#039; if ansible_os_family == \u0026#039;RedHat\u0026#039; else \u0026#039;auditd\u0026#039; }}\u0026quot;\n        state: present\n\n    - name: Configure audit rules\n      template:\n        src: templates/audit.rules.j2\n        dest: /etc/audit/rules.d/audit.rules\n        backup: yes\n      notify: restart auditd\n\n    # CIS compliance checks\n    - name: Run CIS benchmark checks\n      shell: |\n        if [ -f /opt/cis-cat/CIS-CAT.sh ]; then\n          /opt/cis-cat/CIS-CAT.sh -b /opt/cis-cat/benchmarks/\n        else\n          echo \u0026quot;CIS-CAT not installed, skipping\u0026quot;\n        fi\n      register: cis_results\n      ignore_errors: yes\n\n    # File integrity monitoring\n    - name: Install AIDE\n      package:\n        name: aide\n        state: present\n\n    - name: Initialize AIDE database\n      shell: |\n        aide --init\n        mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n      args:\n        creates: /var/lib/aide/aide.db\n\n    - name: Schedule AIDE integrity checks\n      cron:\n        name: \u0026quot;AIDE integrity check\u0026quot;\n        minute: \u0026quot;0\u0026quot;\n        hour: \u0026quot;3\u0026quot;\n        job: \u0026quot;/usr/bin/aide --check | mail -s \u0026#039;AIDE Report\u0026#039; security@example.com\u0026quot;\n        user: root\n\n    # Log monitoring\n    - name: Install log monitoring tools\n      package:\n        name:\n          - logwatch\n          - rsyslog\n        state: present\n\n    - name: Configure centralized logging\n      template:\n        src: templates/rsyslog.conf.j2\n        dest: /etc/rsyslog.conf\n        backup: yes\n      notify: restart rsyslog\n\n  handlers:\n    - name: restart auditd\n      service:\n        name: auditd\n        state: restarted\n\n    - name: restart rsyslog\n      service:\n        name: rsyslog\n        state: restarted\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"cicd-integration\" class=\"mobile-header\"\u003eCI/CD Integration\u003c/h2\u003e\n\u003ch3 id=\"jenkins-pipeline-integration\" class=\"mobile-header\"\u003eJenkins Pipeline Integration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Create Jenkinsfile for Ansible automation\ncat \u0026gt; Jenkinsfile \u0026lt;\u0026lt;EOF\npipeline {\n    agent any\n    \n    environment {\n        ANSIBLE_CONFIG = \u0026#039;ansible.cfg\u0026#039;\n        ANSIBLE_HOST_KEY_CHECKING = \u0026#039;False\u0026#039;\n    }\n    \n    stages {\n        stage(\u0026#039;Lint\u0026#039;) {\n            steps {\n                sh \u0026#039;ansible-lint playbooks/\u0026#039;\n                sh \u0026#039;yamllint .\u0026#039;\n            }\n        }\n        \n        stage(\u0026#039;Syntax Check\u0026#039;) {\n            steps {\n                sh \u0026#039;ansible-playbook playbooks/site.yml --syntax-check\u0026#039;\n            }\n        }\n        \n        stage(\u0026#039;Dry Run\u0026#039;) {\n            steps {\n                sh \u0026#039;ansible-playbook playbooks/site.yml --check --diff\u0026#039;\n            }\n        }\n        \n        stage(\u0026#039;Deploy to Staging\u0026#039;) {\n            when {\n                branch \u0026#039;develop\u0026#039;\n            }\n            steps {\n                sh \u0026#039;ansible-playbook -i inventories/staging playbooks/site.yml\u0026#039;\n            }\n        }\n        \n        stage(\u0026#039;Deploy to Production\u0026#039;) {\n            when {\n                branch \u0026#039;main\u0026#039;\n            }\n            steps {\n                input \u0026#039;Deploy to Production?\u0026#039;\n                sh \u0026#039;ansible-playbook -i inventories/production playbooks/site.yml\u0026#039;\n            }\n        }\n        \n        stage(\u0026#039;Verify Deployment\u0026#039;) {\n            steps {\n                sh \u0026#039;ansible-playbook playbooks/system-verification.yml\u0026#039;\n            }\n        }\n    }\n    \n    post {\n        always {\n            archiveArtifacts artifacts: \u0026#039;logs/*.log\u0026#039;, allowEmptyArchive: true\n            publishHTML([\n                allowMissing: false,\n                alwaysLinkToLastBuild: true,\n                keepAll: true,\n                reportDir: \u0026#039;reports\u0026#039;,\n                reportFiles: \u0026#039;*.html\u0026#039;,\n                reportName: \u0026#039;Ansible Report\u0026#039;\n            ])\n        }\n        failure {\n            emailext (\n                subject: \u0026quot;Failed Pipeline: ${env.JOB_NAME} - ${env.BUILD_NUMBER}\u0026quot;,\n                body: \u0026quot;Something is wrong with ${env.BUILD_URL}\u0026quot;,\n                to: \u0026quot;${env.DEFAULT_RECIPIENTS}\u0026quot;\n            )\n        }\n    }\n}\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"gitlab-ci-integration\" class=\"mobile-header\"\u003eGitLab CI Integration\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat \u0026gt; .gitlab-ci.yml \u0026lt;\u0026lt;EOF\nstages:\n  - lint\n  - test\n  - deploy-staging\n  - deploy-production\n\nvariables:\n  ANSIBLE_CONFIG: ansible.cfg\n  ANSIBLE_HOST_KEY_CHECKING: \u0026quot;False\u0026quot;\n\nbefore_script:\n  - pip install ansible ansible-lint yamllint\n  - ansible-galaxy install -r requirements.yml\n\nlint:\n  stage: lint\n  script:\n    - ansible-lint playbooks/\n    - yamllint .\n  rules:\n    - if: \u0026#039;$CI_MERGE_REQUEST_IID\u0026#039;\n    - if: \u0026#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\u0026#039;\n\nsyntax-check:\n  stage: test\n  script:\n    - ansible-playbook playbooks/site.yml --syntax-check\n    - ansible-playbook playbooks/site.yml --check --diff -i inventories/staging\n  rules:\n    - if: \u0026#039;$CI_MERGE_REQUEST_IID\u0026#039;\n    - if: \u0026#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\u0026#039;\n\ndeploy-staging:\n  stage: deploy-staging\n  script:\n    - ansible-playbook -i inventories/staging playbooks/site.yml\n  rules:\n    - if: \u0026#039;$CI_COMMIT_BRANCH == \u0026quot;develop\u0026quot;\u0026#039;\n\ndeploy-production:\n  stage: deploy-production\n  script:\n    - ansible-playbook -i inventories/production playbooks/site.yml\n  rules:\n    - if: \u0026#039;$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\u0026#039;\n      when: manual\n  environment:\n    name: production\n    url: https://production.example.com\nEOF\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"troubleshooting-cross-platform\" class=\"mobile-header\"\u003eTroubleshooting (Cross-Platform)\u003c/h2\u003e\n\u003ch3 id=\"common-issues-and-solutions\" class=\"mobile-header\"\u003eCommon Issues and Solutions\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Debug connection issues\nansible all -m ping -vvv\n\n# Check SSH connectivity\nansible all -m setup --ask-pass --ask-become-pass\n\n# Verify inventory\nansible-inventory --list\nansible-inventory --graph\n\n# Test specific host\nansible target-host -m command -a \u0026quot;uptime\u0026quot;\n\n# Check syntax without execution\nansible-playbook playbooks/site.yml --syntax-check\n\n# Dry run with verbose output\nansible-playbook playbooks/site.yml --check --diff -vvv\n\n# Debug variable resolution\nansible-playbook playbooks/site.yml --extra-vars=\u0026quot;debug=true\u0026quot; --tags debug\n\n# Check facts\nansible all -m setup | grep ansible_os_family\n\n# Connection troubleshooting\nssh -vvv user@target-host\n\n# Permission issues\nansible all -m file -a \u0026quot;path=/tmp/test state=touch\u0026quot; --become\n\n# Vault issues\nansible-vault view group_vars/all/vault.yml\n\n# Performance debugging\nansible-playbook playbooks/site.yml --start-at-task=\u0026quot;specific task name\u0026quot;\nansible-playbook playbooks/site.yml --step\n\n# Module testing\nansible localhost -m debug -a \u0026quot;var=hostvars\u0026quot;\nansible localhost -m setup\n\n# Check for syntax errors in roles\nfind roles/ -name \u0026quot;*.yml\u0026quot; -exec ansible-playbook {} --syntax-check \\;\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch3 id=\"advanced-debugging\" class=\"mobile-header\"\u003eAdvanced Debugging\u003c/h3\u003e\n\u003cdiv class=\"mobile-code-block\" data-language=\"bash\"\u003e\n      \u003cdiv class=\"mobile-code-header\"\u003e\n        \u003cspan class=\"mobile-code-language\"\u003ebash\u003c/span\u003e\n        \u003cbutton class=\"mobile-copy-button\" onclick=\"copyCode(this)\" title=\"Copy code\"\u003e\n          \u003cspan class=\"copy-icon\"\u003e📋\u003c/span\u003e\n          \u003cspan class=\"copy-text\"\u003eCopy\u003c/span\u003e\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"mobile-code-content\"\u003e\n        \u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Enable comprehensive logging\nexport ANSIBLE_DEBUG=1\nexport ANSIBLE_VERBOSITY=4\nansible-playbook playbooks/site.yml\n\n# Profile playbook execution\nansible-playbook playbooks/site.yml --extra-vars=\u0026quot;profile_tasks_sort_order=none\u0026quot;\n\n# Memory usage analysis\nansible-playbook playbooks/site.yml --extra-vars=\u0026quot;ansible_python_interpreter=/usr/bin/python3\u0026quot;\n\n# Network debugging\nansible all -m command -a \u0026quot;ss -tulpn\u0026quot;\nansible all -m command -a \u0026quot;netstat -rn\u0026quot;\n\n# Process debugging\nansible all -m command -a \u0026quot;ps aux --sort=-%mem | head -10\u0026quot;\n\n# Disk usage analysis\nansible all -m command -a \u0026quot;df -h\u0026quot;\nansible all -m command -a \u0026quot;du -sh /var/log/*\u0026quot;\n\n# Service debugging\nansible all -m systemd -a \u0026quot;name=nginx\u0026quot; --become\nansible all -m command -a \u0026quot;systemctl status nginx\u0026quot; --become\n\n# Variable debugging\nansible-playbook playbooks/site.yml --extra-vars=\u0026quot;debug_vars=true\u0026quot; --tags debug_vars\u003c/code\u003e\u003c/pre\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\u003ch2 id=\"additional-resources\" class=\"mobile-header\"\u003eAdditional Resources\u003c/h2\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.ansible.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eOfficial Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://galaxy.ansible.com/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eAnsible Galaxy\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eBest Practices Guide\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.ansible.com/ansible/latest/user_guide/become.html#security-best-practices\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eSecurity Best Practices\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://molecule.readthedocs.io/\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eAnsible Molecule Testing\u003c/a\u003e\u003c/li\u003e\n\u003cli class=\"mobile-list-item\"\u003e\u003ca href=\"https://docs.ansible.com/ansible/latest/collections/index.html\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eCommunity Collections\u003c/a\u003e\u003c/li\u003e\n\u003cp class=\"mobile-paragraph\"\u003e---\u003c/p\u003e\n\u003cp class=\"mobile-paragraph\"\u003e\u003cstrong\u003eNote:\u003c/strong\u003e This guide is part of the \u003ca href=\"https://howtomgr.github.io\" target=\"_blank\" rel=\"noopener\" class=\"mobile-link\"\u003eHowToMgr\u003c/a\u003e collection.\u003c/p\u003e","readTime":"31 min","wordCount":6191,"lastBuilt":"2025-09-15T18:14:38.832Z"}]},"__N_SSG":true},"page":"/[category]/[guide]","query":{"category":"infrastructure","guide":"gitlab"},"buildId":"FWaJNz_CPEuOjXz3AhtJ8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>